<!DOCTYPE html>
<!-- saved from url=(0055)/manual.html -->
<html lang="ru"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" href="./Платформа CUBA. Руководство по разработке приложений_files/jquery.treeview.css"> 
   
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <meta name="generator" content="Asciidoctor 1.5.2"> 
  <title>Платформа CUBA. Руководство по разработке приложений</title> 
  <link rel="stylesheet" href="assets/cuba.css"> 
  <link rel="stylesheet" href="assets/coderay-asciidoctor.css"> 
  <meta name="viewport" content="width=device-width, initial-scale=0.6">
 </head> 
 <body class="book "> 
  <div> 
   <h1>Платформа CUBA. Руководство по разработке приложений</h1> 
   <div class="details"> 
    <span id="revnumber">Версия 6.7</span> 
    <br>
  </div> 
  <div id="content"> 
   <div class="sect1"> 
    <h2 id="preface"><a class="anchor" href="/manual.html#preface"></a>Предисловие</h2> 
    <div class="sectionbody"> 
     <div class="paragraph"> 
      <p>Данное руководство содержит справочную информацию по платформе CUBA и охватывает наиболее важные темы разработки бизнес-приложений на платформе.</p> 
     </div> 
     <div class="paragraph"> 
      <p>Для успешной работы с платформой требуется знание следующих технологий:</p> 
     </div> 
     <div class="ulist"> 
      <ul> 
       <li> <p>Java Standard Edition</p> </li> 
       <li> <p>Реляционные базы данных (SQL, DDL)</p> </li> 
      </ul> 
     </div> 
     <div class="paragraph"> 
      <p>Для глубокого понимания принципов работы платформы полезным является знакомство со следующими технологиями и фреймворками:</p> 
     </div> 
     <div class="ulist"> 
      <ul> 
       <li> <p><a href="https://docs.gradle.org/3.4/userguide/userguide.html" target="_blank">Gradle</a> build system</p> </li> 
       <li> <p><a href="http://projects.spring.io/spring-framework" target="_blank">Spring Framework</a></p> </li> 
       <li> <p><a href="http://en.wikipedia.org/wiki/Java_Persistence_API" target="_blank">Java Persistence API</a></p> </li> 
       <li> <p><a href="https://vaadin.com/book" target="_blank">Vaadin</a> web applications framework</p> </li> 
       <li> <p>HTML / CSS / JavaScript</p> </li> 
       <li> <p>Java Servlets</p> </li> 
      </ul> 
     </div> 
     <div class="paragraph"> 
      <p>Настоящее руководство, а также другая документация по платформе CUBA, доступны по адресу <a href="https://www.cuba-platform.ru/manual" target="_blank">www.cuba-platform.ru/manual</a>. Обучающие видео-материалы и презентации располагаются по адресу <a href="https://www.cuba-platform.ru/tutorials" target="_blank">www.cuba-platform.ru/tutorials</a>. Онлайн демо-приложения могут быть запущены со страницы <a href="https://www.cuba-platform.ru/online-demo" target="_blank">www.cuba-platform.ru/online-demo</a>.</p> 
     </div> 
     <div class="paragraph"> 
      <p>Если у Вас имеются предложения по улучшению данного руководства, обратитесь пожалуйста в службу поддержки по адресу <a href="https://www.cuba-platform.ru/support" target="_blank">www.cuba-platform.ru/support</a>. При обнаружении ошибки в документации укажите, пожалуйста, номер главы и приведите небольшой участок окружающего текста для облегчения поиска.</p> 
     </div> 
    </div> 
   </div> 
   <div class="sect1"> 
    <h2 id="introduction"><a class="anchor" href="/manual.html#introduction"></a>1. Введение</h2> 
    <div class="sectionbody"> 
     <div class="paragraph"> 
      <p>В данной главе приводятся сведения о назначении и возможностях платформы CUBA.</p> 
     </div> 
     <div class="sect2"> 
      <h3 id="overview"><a class="anchor" href="/manual.html#overview"></a>1.1. Обзор платформы</h3> 
      <div class="paragraph"> 
       <p>Платформа CUBA предназначена для разработки корпоративных решений, характеризующихся сложной моделью данных, десятками или сотнями экранов, большим количеством бизнес-логики, а также требованиями к контролю прав доступа, масштабируемости и отказоустойчивости.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Широкий набор готовой функциональности, развитые средства генерации кода, визуальный дизайнер интерфейсов, а также поддержка hot deploy радикально сокращают время и стоимость разработки решения.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Платформа полностью построена на стеке открытых Java технологий, что позволяет использовать наработки крупнейшей экосистемы свободного ПО в мире, а также контролировать исходный код всего стека.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Открытая архитектура позволяет переопределять поведение большинства механизмов платформы, обеспечивая высокую гибкость. Разработчики могут использовать популярные Java IDE и имеют полный доступ к исходному коду.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Приложения на платформе легко встраиваются в ИТ-инфраструктуру благодаря поддержке основных баз данных и серверов приложений, а также возможности работы в облаке. Платформа позволяет обеспечить отказоустойчивость и масштабируемость решений и предоставляет средства интеграции с внешними системами.</p> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="hardware_requirements"><a class="anchor" href="/manual.html#hardware_requirements"></a>1.2. Технические требования</h3> 
      <div class="paragraph"> 
       <p><strong>Минимальные требования</strong> для ведения разработки на платформе CUBA:</p> 
      </div> 
      <div class="ulist"> 
       <ul> 
        <li> <p>Оперативная память - 4 ГБ.</p> </li> 
        <li> <p>Место на жестком диске - 5 ГБ.</p> </li> 
        <li> <p>Операционная система - <strong>Microsoft Windows</strong>, <strong>Linux</strong> или <strong>macOS</strong>.</p> </li> 
       </ul> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="release_notes"><a class="anchor" href="/manual.html#release_notes"></a>1.3. Release Notes</h3> 
      <div class="paragraph"> 
       <p>Список изменений в платформе доступен по адресу <a href="http://files.cuba-platform.com/cuba/release-notes/6.7" class="bare" target="_blank">http://files.cuba-platform.com/cuba/release-notes/6.7</a></p> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="sect1"> 
    <h2 id="setup"><a class="anchor" href="/manual.html#setup"></a>2. Установка и настройка инструментария</h2> 
    <div class="sectionbody"> 
     <div class="paragraph"> 
      <p>Минимально необходимым набором программного обеспечения является:</p> 
     </div> 
     <div class="dlist"> 
      <dl> 
       <dt class="hdlist1">
        Java SE Development Kit (JDK) 8
       </dt> 
       <dd> 
        <div class="openblock"> 
         <div class="content"> 
          <div class="ulist"> 
           <ul> 
            <li> <p>Установите Java SE Development Kit (JDK) 8 и проверьте его работоспособность, выполнив в консоли команду</p> </li> 
           </ul> 
          </div> 
          <div class="paragraph"> 
           <p><code>java -version</code></p> 
          </div> 
          <div class="paragraph"> 
           <p>В ответ должно быть выведено сообщение с номером версии Java, например <code>1.8.0_152</code>.</p> 
          </div> 
          <div class="admonitionblock warning"> 
           <table> 
            <tbody>
             <tr> 
              <td class="icon"> 
               <div class="title">
                Warning
               </div> </td> 
              <td class="content"> 
               <div class="paragraph"> 
                <p>Java 9 пока не поддерживается. Собирать и запускать CUBA-приложения можно только на Java 8.</p> 
               </div> </td> 
             </tr> 
            </tbody>
           </table> 
          </div> 
          <div class="paragraph"> 
           <p>Для сборки и запуска проектов вне Studio в переменной окружения <code>JAVA_HOME</code> необходимо установить путь к корневому каталогу JDK, например <code>C:\Program Files\Java\jdk1.8.0_152</code>.</p> 
          </div> 
          <div class="ulist"> 
           <ul> 
            <li> <p>Для <strong>Windows</strong> это можно сделать, открыв <strong>Компьютер</strong> → <strong>Свойства системы</strong> → <strong>Дополнительные параметры системы</strong> → <strong>Дополнительно</strong> → <strong>Переменные среды</strong>, и задав значение переменной в списке <strong>Системные переменные</strong>.</p> </li> 
            <li> <p>Для <strong>macOS</strong> <code>JAVA_HOME</code> рекомендуется задать в <code>~/.bash_profile</code>:</p> 
             <div class="paragraph"> 
              <p><code>export JAVA_HOME=$(/usr/libexec/java_home -v 1.8)</code></p> 
             </div> 
             <div class="paragraph"> 
              <p>Если вы установили Java 9 на macOS, CUBA Studio и приложения перестанут запускаться, независимо от значения <code>JAVA_HOME</code>. В этом случае обратитесь к информации в разделе <a href="/manual.html#setup_troubleshooting">решение проблем</a> ниже.</p> 
             </div> </li> 
           </ul> 
          </div> 
         </div> 
        </div> 
       </dd> 
       <dt class="hdlist1">
        Cреда разработки на Java
       </dt> 
       <dd> 
        <div class="openblock"> 
         <div class="content"> 
          <div class="paragraph"> 
           <p><strong>IntelliJ IDEA</strong> или <strong>Eclipse</strong>. Рекомендуется использовать <strong>IntelliJ IDEA</strong> (Community или Ultimate).</p> 
          </div> 
         </div> 
        </div> 
       </dd> 
       <dt class="hdlist1">
        База данных
       </dt> 
       <dd> 
        <div class="openblock"> 
         <div class="content"> 
          <div class="paragraph"> 
           <p>В простейшем случае в качестве сервера баз данных приложений используется встроенный <strong>HyperSQL</strong> (<a href="http://hsqldb.org/" target="_blank"></a><a href="http://hsqldb.org/" class="bare" target="_blank">http://hsqldb.org</a>), что вполне подходит для исследования возможностей платформы и прототипирования приложений. Для создания реальных приложений рекомендуется установить и использовать в проекте какую-либо из полноценных СУБД, <a href="/manual.html#dbms_types">поддерживаемых платформой</a>, например <strong>PostgreSQL</strong>.</p> 
          </div> 
         </div> 
        </div> 
       </dd> 
       <dt class="hdlist1">
        Веб-браузер
       </dt> 
       <dd> 
        <div class="openblock"> 
         <div class="content"> 
          <div class="paragraph"> 
           <p>Веб-интерфейс приложений, создаваемых на основе платформы, поддерживает все популярные современные браузеры, в том числе <strong>Google Chrome</strong>, <strong>Mozilla Firefox</strong>, <strong>Safari</strong>, <strong>Opera 15+</strong>, <strong>Internet Explorer 9+</strong>, <strong>Microsoft Edge</strong>.</p> 
          </div> 
         </div> 
        </div> 
       </dd> 
      </dl> 
     </div> 
     <div id="setup_troubleshooting" class="dlist"> 
      <dl> 
       <dt class="hdlist1">
        Решение проблем
       </dt> 
       <dd> 
        <div class="openblock"> 
         <div class="content"> 
          <div class="olist arabic"> 
           <ol class="arabic"> 
            <li> <p>Если по какой-то причине вы установили Java 9 на macOS, CUBA Studio и приложения перестанут запускаться. Для того, чтобы восстановить работоспособность, выполните следующее:</p> 
             <div class="olist loweralpha"> 
              <ol class="loweralpha" type="a"> 
               <li> <p>Сделайте инсталляцию JDK 9 не используемой по умолчанию в системе: переименуйте файл <code>/Library/Java/JavaVirtualMachines/jdk-9.0.1.jdk/Contents/Info.plist</code> в <code>Info.plist.disabled</code> (замените <code>jdk-9.0.1.jdk</code> реальной версией вашего JDK 9).</p> </li> 
               <li> <p>Замените <code>JavaAppletPlugin.plugin</code>, установленный Java 9 на плагин из Java 8:</p> 
                <div class="ulist"> 
                 <ul> 
                  <li> <p>Удалите или переименуйте <code>/Library/Internet Plug-Ins/JavaAppletPlugin.plugin</code></p> </li> 
                  <li> <p>Установите JDK 8 снова, при этом плагин будет переустановлен.</p> </li> 
                 </ul> 
                </div> </li> 
               <li> <p>Убедитесь что вы указали получение <code>JAVA_HOME</code> с аргументом <code>-v 1.8</code>, как показано выше. Перелогиньтесь или выполните <code>source .bash_profile</code> после внесения изменений.</p> </li> 
              </ol> 
             </div> </li> 
            <li> <p>Убедитесь, что ваше окружение нe содержит переменных <code>CATALINA_HOME</code>, <code>CATALINA_BASE</code> и <code>CLASSPATH</code>. Эти переменные могут вызвать проблемы с запуском веб-сервера <strong>Apache Tomcat</strong>, который используется во время разработки. Перезагрузите компьютер после удаления переменных.</p> </li> 
           </ol> 
          </div> 
         </div> 
        </div> 
       </dd> 
      </dl> 
     </div> 
     <div class="sect2"> 
      <h3 id="cubaStudio_install"><a class="anchor" href="/manual.html#cubaStudio_install"></a>2.1. Установка CUBA Studio</h3> 
      <div class="dlist"> 
       <dl> 
        <dt class="hdlist1">
         Окружение
        </dt> 
        <dd> 
         <div class="openblock"> 
          <div class="content"> 
           <div class="ulist"> 
            <ul> 
             <li> <p>Убедитесь в том, что на компьютере <a href="/manual.html#setup">установлен</a> Java SE Development Kit (JDK) 8, выполнив в консоли команду</p> 
              <div class="paragraph"> 
               <p><code>java -version</code></p> 
              </div> 
              <div class="paragraph"> 
               <p>В ответ должно быть выведено сообщение с номером версии Java, например <code>1.8.0_152</code>.</p> 
              </div> </li> 
             <li> <p>Если вы используете OpenJDK на Linux, установите <a href="http://openjdk.java.net/projects/openjfx/" target="_blank">OpenJFX</a>, например:</p> 
              <div class="paragraph"> 
               <p><code>sudo apt-get install openjfx</code></p> 
              </div> </li> 
             <li> <p>Если для соединения с интернетом используется прокси-сервер, в JVM, исполняющие Studio и Gradle, необходимо передавать специальные системные свойства Java. Они описаны в документе <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html" class="bare" target="_blank">http://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html</a> (см. свойства для протоколов HTTP и HTTPS).</p> 
              <div class="paragraph"> 
               <p>Рекомендуется установить нужные свойства в переменной окружения <code>JAVA_OPTS</code>. Скрипт запуска Studio передает <code>JAVA_OPTS</code> в <code>java.exe</code>.</p> 
              </div> </li> 
            </ul> 
           </div> 
          </div> 
         </div> 
        </dd> 
        <dt class="hdlist1">
         Новая установка Studio
        </dt> 
        <dd> 
         <div class="olist arabic"> 
          <ol class="arabic"> 
           <li> <p>Загрузите подходящий инсталлятор или ZIP архив со страницы <a href="https://www.cuba-platform.ru/download" class="bare" target="_blank">https://www.cuba-platform.ru/download</a>.</p> </li> 
           <li> <p>Запустите инсталлятор или распакуйте ZIP архив в локальный каталог, например, <code>c:\work\studio</code>.</p> </li> 
           <li> <p>Запустите установленное приложение или откройте командную строку, перейдите в подкаталог <code>bin</code> и запустите <code>studio.bat</code> или <code>studio</code> в зависимости от вашей операционной системы.</p> </li> 
           <li> <p>В окне <strong>CUBA Studio Server</strong> введите следующие параметры:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><strong>Server port</strong> − порт, на котором будет запущен сервер CUBA Studio (по умолчанию 8111).</p> </li> 
                <li> <p><strong>Remote connection</strong> - по умолчанию Studio принимает соединения только с локального компьютера. Установите данный флажок, если вам нужна возможность подключения к этому экземпляру Studio с удаленного хоста.</p> </li> 
                <li> <p><strong>Silent startup</strong> - если выбрано, сервер Studio запускается в трее и открывает UI в браузере автоматически. Данная опция доступна только в Windows.</p> </li> 
               </ul> 
              </div> 
              <div class="imageblock" style="text-align: center"> 
               <div class="content"> 
                <img src="assets/studio_server_window.png" alt="studio server window"> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
           <li> <p>Запустите сервер Studio, нажав кнопку <strong>Start</strong>.</p> 
            <div class="paragraph"> 
             <p>Когда запустится веб-сервер, в поле <strong>URL</strong> отобразится адрес, по которому доступен интерфейс Studio. Нажав <code>→</code>, можно открыть веб-браузер, нажав <strong>Copy</strong> − скопировать адрес в буфер обмена.</p> 
            </div> </li> 
           <li> <p>Запустите веб-браузер и перейдите по указанному адресу. В веб-интерфейсе Studio перейдите на вкладку <strong>Settings</strong> и введите следующие параметры:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><strong>Java home</strong> − JDK, который будет использоваться для сборки и запуска проектов. Если вы установили переменную окружения <code>JAVA_HOME</code> как описано в <a href="/manual.html#setup">начале</a> данной главы, ее значение будет подставлено в данное поле. В противном случае Studio попытается самостоятельно найти каталог установки Java.</p> </li> 
                <li> <p><strong>Gradle home</strong> - путь к Gradle. Оставьте поле пустым, в этом случае при первом запуске будет автоматически загружен нужный дистрибутив Gradle.</p> 
                 <div class="paragraph"> 
                  <p>Если по какой-либо причине Вы хотите использовать уже установленный на компьютере Gradle, введите в поле путь к соответствующему каталогу. Текущая версия системы сборки проектов протестирована на <strong>Gradle 3.4</strong>.</p> 
                 </div> </li> 
                <li> <p><strong>IDE port</strong> − порт, на котором принимает подключения плагин IDE (по умолчанию 48561).</p> </li> 
                <li> <p><strong>Offline</strong> - включить возможность работы без интернет-соединения при условии, что все необходимые библиотеки были предварительно загружены из репозитория.</p> </li> 
                <li> <p><strong>Check for updates</strong> - проверять наличие новых версий при старте.</p> </li> 
                <li> <p><strong>Send anonymous statistics and crash reports</strong> - разрешить Studio отправлять статистику ошибок разработчикам.</p> </li> 
                <li> <p><strong>Help language</strong> - язык встроенной справки.</p> </li> 
                <li> <p><strong>Logging level</strong> - уровень логирования: TRACE, DEBUG, INFO, WARN, ERROR или FATAL. По умолчанию INFO.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/studio_server_settings.png" alt="studio server settings"> 
             </div> 
            </div> </li> 
           <li> <p>Нажмите <strong>Apply and proceed to projects</strong>.</p> </li> 
           <li> <p>Нажмите <strong>Create new</strong> для создания нового проекта, или <strong>Import</strong> для добавления имеющегося проекта в список <strong>Recent</strong>.</p> </li> 
           <li> <p>Сразу после открытия проекта Studio загружает исходный код компонентов платформы, на которых основан проект, и сохраняет его в локальном каталоге. Перед сборкой приложения рекомендуется дождаться окончания загрузки и убедиться в том, что индикатор фоновых задач в левом нижнем углу экрана Studio погас.</p> </li> 
          </ol> 
         </div> 
        </dd> 
        <dt class="hdlist1">
         Обновление CUBA Studio
        </dt> 
        <dd> 
         <div class="openblock"> 
          <div class="content"> 
           <div class="paragraph"> 
            <p>Если вы обноляете Studio на новую bug-fix версию (например с 6.5.0 на 6.5.1), устанавливайте ее в существующий каталог, например на Windows это будет <code>C:\Program Files (x86)\CUBA Studio 6.5</code>. При установке новой minor или major версии, используйте отдельный каталог, например <code>CUBA Studio 6.6</code>.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Если Studio установлена из инсталлятора Windows EXE или из ZIP-архива, она поддерживает авто-обновление на новые bug-fix релизы. Файлы обновлений сохраняются в каталоге <code>~/.haulmont/studio/update</code>. В случае каких-либо проблем с новой версией вы можете просто удалить файлы обновления и Studio вернется к версии, установленной ранее вручную.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Автообновление не работает для minor и major релизов, и если Studio была установлена из macOS DMG. В этом случае загрузите и запустите новый инсталлятор вручную.</p> 
           </div> 
          </div> 
         </div> 
        </dd> 
       </dl> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="ide_integration"><a class="anchor" href="/manual.html#ide_integration"></a>2.2. Интеграция CUBA Studio с IDE</h3> 
      <div class="paragraph"> 
       <p>Для интеграции с <strong>IntelliJ IDEA</strong> или <strong>Eclipse</strong> выполните следующие шаги:</p> 
      </div> 
      <div class="olist arabic"> 
       <ol class="arabic"> 
        <li> <p>Откройте или <a href="/manual.html#qs_create_project">создайте новый</a> проект в Studio.</p> </li> 
        <li> <p>Перейдите в секцию <strong>Project properties</strong> и нажмите кнопку <strong>Edit</strong>. Выберите нужную <strong>Java IDE</strong> флажками <strong>IntelliJ IDEA</strong> или <strong>Eclipse</strong>.</p> </li> 
        <li> <p>В главном меню Studio выберите пункт меню <strong>Build → Create or update &lt;IDE&gt; project files</strong>. В каталоге проекта будут созданы соответствующие файлы.</p> </li> 
        <li> <p>Для интеграции с IntelliJ IDEA:</p> 
         <div class="olist loweralpha"> 
          <ol class="loweralpha" type="a"> 
           <li> <p>Запустите IntelliJ IDEA 13+ и установите плагин <strong>CUBA Framework Integration</strong>, доступный в репозитории плагинов: <strong>File &gt; Settings &gt; Plugins &gt; Browse Repositories</strong>.</p> </li> 
          </ol> 
         </div> </li> 
        <li> <p>Для интеграции с Eclipse:</p> 
         <div class="olist loweralpha"> 
          <ol class="loweralpha" type="a"> 
           <li> <p>Запустите Eclipse 4.3+, откройте <strong>Help &gt; Install New Software</strong>, добавьте репозиторий <code>http://files.cuba-platform.com/eclipse-update-site</code> и установите плагин <strong>CUBA Plugin</strong>.</p> </li> 
           <li> <p>В Eclipse в меню <strong>Window &gt; Preferences</strong> в секции <strong>CUBA</strong> установите флажок <strong>Studio Integration Enabled</strong> и нажмите на кнопку <strong>OK</strong>.</p> </li> 
          </ol> 
         </div> </li> 
       </ol> 
      </div> 
      <div class="paragraph"> 
       <p>Обратите внимание, что в панели статуса Studio загорелась надпись <strong>IDE: on port 48561</strong>. Теперь при нажатии кнопок <strong>IDE</strong> в Studio соответствующие файлы исходных кодов будут открываться редактором IDE.</p> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="sect1"> 
    <h2 id="quick_start"><a class="anchor" href="/manual.html#quick_start"></a>3. Быстрый старт</h2> 
    <div class="sectionbody"> 
     <div class="paragraph"> 
      <p>В данном разделе рассматривается создание приложения при помощи CUBA Studio. Эта же информация изложена в видеороликах, доступных по адресу <a href="https://www.cuba-platform.ru/quickstart" target="_blank">www.cuba-platform.ru/quickstart</a>.</p> 
     </div> 
     <div class="paragraph"> 
      <p>На Вашей рабочей машине уже должно быть установлено и настроено необходимое программное обеспечение, см. <a href="/manual.html#setup">Установка и настройка инструментария</a>.</p> 
     </div> 
     <div class="paragraph"> 
      <p>Основные задачи, стоящие при разработке нашего приложения:</p> 
     </div> 
     <div class="olist arabic"> 
      <ol class="arabic"> 
       <li> <p>Разработка модели данных, которая заключается в создании сущностей предметной области и соответствующих таблиц базы данных.</p> </li> 
       <li> <p>Разработка экранов пользовательского интерфейса, позволяющих создавать, просматривать, обновлять и удалять сущности модели данных.</p> </li> 
      </ol> 
     </div> 
     <div class="sect2"> 
      <h3 id="qs_app_details"><a class="anchor" href="/manual.html#qs_app_details"></a>3.1. Описание задачи</h3> 
      <div class="paragraph"> 
       <p>Приложение предназначено для ведения сведений о покупателях и их заказах.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Покупатель имеет следующие характеристики:</p> 
      </div> 
      <div class="ulist"> 
       <ul> 
        <li> <p>Имя</p> </li> 
        <li> <p>Электронная почта</p> </li> 
       </ul> 
      </div> 
      <div class="paragraph"> 
       <p>Характеристики заказа:</p> 
      </div> 
      <div class="ulist"> 
       <ul> 
        <li> <p>Принадлежность покупателю</p> </li> 
        <li> <p>Дата</p> </li> 
        <li> <p>Сумма</p> </li> 
       </ul> 
      </div> 
      <div class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/quick_start_1.png" alt="quick start 1"> 
       </div> 
      </div> 
      <div class="paragraph"> 
       <p>Пользовательский интерфейс приложения должен содержать:</p> 
      </div> 
      <div class="ulist"> 
       <ul> 
        <li> <p>Окно списка покупателей;</p> </li> 
        <li> <p>Окно редактирования сведений о покупателе, содержащее также список заказов данного покупателя;</p> </li> 
        <li> <p>Окно общего списка заказов;</p> </li> 
        <li> <p>Окно редактирования заказа.</p> </li> 
       </ul> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="qs_create_project"><a class="anchor" href="/manual.html#qs_create_project"></a>3.2. Создание проекта</h3> 
      <div class="olist arabic"> 
       <ol class="arabic"> 
        <li> <p>Запустите <strong>CUBA Studio</strong> и откройте ее веб-интерфейс (см. <a href="/manual.html#cubaStudio_install">Установка CUBA Studio</a>).</p> </li> 
        <li> <p>Нажмите на кнопку <strong>Create new</strong>.</p> </li> 
        <li> <p>В окне <strong>New project</strong> в поле <strong>Project name</strong> введите имя проекта - <code>sales</code>. Имя должно содержать только латинские буквы, цифры и знак подчеркивания. Тщательно продумайте имя проекта на данном этапе, так как в дальнейшем изменить его будет достаточно сложно.</p> </li> 
        <li> <p>В полях ниже автоматически сгенерируются:</p> 
         <div class="ulist"> 
          <ul> 
           <li> <p><strong>Project path</strong> − путь к каталогу нового проекта. Каталог можно выбрать вручную, нажав на кнопку <code><strong>…​</strong></code> рядом с полем. Отобразится окно <strong>Folder select</strong> со списком папок на жестком диске. Вы можете выбрать одну из них или создать новый каталог, нажав на кнопку <strong>+</strong>.</p> </li> 
           <li> <p><strong>Project namespace</strong> - пространство имен, которое будет использоваться как префикс имен сущностей и таблиц базы данных. Пространство имен может состоять только из латинских букв, и должно быть как можно короче. Например, если имя проекта - <code>sales_2</code>, то пространство имен может быть <code>sales</code> или <code>sal</code>.</p> </li> 
           <li> <p><strong>Root package</strong> − корневой пакет Java-классов. Может быть скорректирован позже, однако сгенерированные на этапе создания классы перемещены не будут.</p> </li> 
           <li> <p><strong>Repository</strong> − URL и параметры аутентификации <a href="/manual.html#artifact_repository">репозитория</a> бинарных артефактов.</p> </li> 
           <li> <p><strong>Platform version</strong> - используемая в проекте версия платформы. Артефакты платформы будут автоматически загружены из репозитория при сборке проекта.</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/qs_new_project.png" alt="qs new project"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> </li> 
        <li> <p>Нажмите на кнопку <strong>OK</strong>. В указанном каталоге <code>sales</code> будет создан пустой проект, и откроется главное окно Studio.</p> </li> 
        <li> <p>Сборка проекта. Выберите пункт главного меню Studio <strong>Build</strong> → <strong>Assemble project</strong>. На этом этапе будут загружены все необходимые библиотеки, и в подкаталогах <code>build</code> модулей будут собраны <a href="/manual.html#artifact">артефакты</a> проекта.</p> </li> 
        <li> <p>Создание базы данных на локальном сервере <strong>HyperSQL</strong>. Выберите пункт меню <strong>Run</strong> → <strong>Create database</strong>. Имя БД по умолчанию совпадает с пространством имен проекта.</p> </li> 
        <li> <p>Выберите пункт меню <strong>Run</strong> → <strong>Deploy</strong>. В подкаталоге <code>deploy</code> проекта будет установлен сервер <strong>Tomcat</strong> с собранным приложением.</p> </li> 
        <li> <p>Выберите пункт меню <strong>Run</strong> → <strong>Start application server</strong>. Через несколько секунд в панели статуса ссылка рядом с надписью <strong>Web application</strong> станет доступной, и по ней можно осуществить переход к приложению непосредственно из Studio.</p> 
         <div class="paragraph"> 
          <p>Логин и пароль пользователя − <code>admin</code> / <code>admin</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Запущенное приложение содержит два главных пункта меню (<strong>Administration</strong> и <strong>Help</strong>), функциональность подсистемы безопасности и администрирования системы.</p> 
         </div> </li> 
       </ol> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="qs_create_entities"><a class="anchor" href="/manual.html#qs_create_entities"></a>3.3. Создание сущностей</h3> 
      <div class="paragraph"> 
       <p>Создадим класс сущности Customer (Покупатель).</p> 
      </div> 
      <div class="ulist"> 
       <ul> 
        <li> <p>Перейдите на вкладку <strong>Data Model</strong> на панели навигатора и нажмите на кнопку <strong>New</strong> &gt; <strong>Entity</strong>. Появится диалоговое окно <strong>New entity</strong>.</p> </li> 
        <li> <p>В поле <strong>Class name</strong> введите название класса сущности − <code>Customer</code>.</p> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/qs_create_customer_entity.png" alt="qs create customer entity"> 
          </div> 
         </div> </li> 
        <li> <p>Нажмите <strong>OK</strong>. В рабочей области откроется страница дизайнера сущности.</p> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/qs_customer_entity.png" alt="qs customer entity"> 
          </div> 
         </div> </li> 
        <li> <p>В полях <strong>Name</strong> и <strong>Table</strong> автоматически сгенерируются имя сущности и имя таблицы в базе данных.</p> </li> 
        <li> <p>В поле <strong>Parent class</strong> оставьте установленное значение − <code>StandardEntity</code>.</p> </li> 
        <li> <p>Поле <strong>Inheritance strategy</strong> оставьте пустым.</p> </li> 
       </ul> 
      </div> 
      <div class="paragraph"> 
       <p>Далее создадим атрибуты сущности. Для этого нажмите на кнопку <strong>New</strong>, находящуюся под таблицей <strong>Attributes</strong>.</p> 
      </div> 
      <div class="ulist"> 
       <ul> 
        <li> <p>В отобразившемся окне <strong>Create attribute</strong> в поле <strong>Name</strong> введите название атрибута сущности − <code>name</code>, в списке <strong>Attribute type</strong> выберите значение <code>DATATYPE</code>, в поле <strong>Type</strong> укажите тип атрибута <code>String</code> и далее укажите длину текстового атрибута в поле <strong>Length</strong>, равной 100 символам. Установите флажок <strong>Mandatory</strong>. В поле <strong>Column</strong> автоматически сгенерируется имя колонки таблицы в базе данных.</p> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/qs_new_attribute.png" alt="qs new attribute"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Для добавления атрибута нажмите на кнопку <strong>Add</strong>.</p> 
         </div> </li> 
        <li> <p>Атрибут <code>email</code> создается таким же образом, за исключением того, что в поле <strong>Length</strong> следует указать значение <code>50</code>.</p> </li> 
       </ul> 
      </div> 
      <div class="paragraph"> 
       <p>После создания атрибутов перейдите на вкладку <strong>Instance Name</strong> дизайнера сущности для задания <a href="/manual.html#namePattern_annotation">Name pattern</a>. В списке <strong>Available attributes</strong> выделите атрибут <code>name</code> и перенесите его в список <strong>Name pattern attributes</strong>, нажав на кнопку с изображением стрелки вправо.</p> 
      </div> 
      <div class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/qs_customer_instance_name.png" alt="qs customer instance name"> 
       </div> 
      </div> 
      <div class="paragraph"> 
       <p>На этом создание сущности Customer завершено. Нажмите на кнопку <strong>OK</strong> в верхней панели для сохранения изменений.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Создадим сущность Order (Заказ). В панели <strong>DATA MODEL</strong> нажмите на кнопку <strong>New</strong> &gt; <strong>Entity</strong>. В поле <strong>Class name</strong> введите название класса сущности − <code>Order</code>. Сущность должна иметь следующие атрибуты:</p> 
      </div> 
      <div class="ulist"> 
       <ul> 
        <li> <p><strong>Name</strong> − <code>customer</code>, <strong>Attribute type</strong> − <code>ASSOCIATION</code>, <strong>Type</strong> − <code>Customer</code>, <strong>Cardinality</strong> − <code>MANY_TO_ONE</code>.</p> </li> 
        <li> <p><strong>Name</strong> − <code>date</code>, <strong>Attribute type</strong> − <code>DATATYPE</code>, <strong>Type</strong> − <code>Date</code>. Для атрибута <code>date</code> установите флажок <strong>Mandatory</strong>.</p> </li> 
        <li> <p><strong>Name</strong> − <code>amount</code>, <strong>Attribute type</strong> − <code>DATATYPE</code>, <strong>Type</strong> − <code>BigDecimal</code>.</p> </li> 
       </ul> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="qs_create_db_tables"><a class="anchor" href="/manual.html#qs_create_db_tables"></a>3.4. Создание таблиц базы данных</h3> 
      <div class="paragraph"> 
       <p>Для <a href="/manual.html#db_update_in_dev">создания таблиц базы данных</a> достаточно на вкладке <strong>Data Model</strong> панели навигатора нажать на кнопку <strong>Generate DB scripts</strong>. После этого откроется страница <strong>Database Scripts</strong>. На вкладке будут сгенерированы скрипты обновления базы данных от ее текущего состояния (<strong>UPDATE SCRIPTS</strong>) и скрипты создания базы данных с нуля (<strong>INIT TABLES</strong>, <strong>INIT TABLES</strong>, <strong>INIT DATA</strong>). Также на вкладке будут доступны уже выполненные скрипты обновления базы данных, если они есть.</p> 
      </div> 
      <div class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/qs_generate_db_scripts.png" alt="qs generate db scripts"> 
       </div> 
      </div> 
      <div class="paragraph"> 
       <p>Чтобы сохранить сгенерированные скрипты, нажмите на кнопку <strong>Save and close</strong>. Для запуска скриптов обновления остановите запущенное приложение с помощью команды <strong>Run</strong> → <strong>Stop application server</strong>, затем выполните <strong>Run</strong> → <strong>Update database</strong>.</p> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="qs_create_ui"><a class="anchor" href="/manual.html#qs_create_ui"></a>3.5. Создание экранов пользовательского интерфейса</h3> 
      <div class="paragraph"> 
       <p>Создадим экраны приложения, позволяющие управлять информацией о покупателях и заказах.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="qs_create_customer_screens"><a class="anchor" href="/manual.html#qs_create_customer_screens"></a>3.5.1. Экраны управления Покупателями</h4> 
       <div class="paragraph"> 
        <p>Для создания стандартных экранов просмотра и редактирования покупателей необходимо выделить сущность <code>Customer</code> на вкладке <strong>Data Model</strong> панели навигатора и нажать на кнопку <strong>New</strong> &gt; <strong>Generic UI screen</strong> внизу панели. После этого на экране отобразится страница создания стандартных экранов сущности.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В списке доступных шаблонов выберите <strong>Entity browser and editor screens</strong>.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/qs_create_customer_screens.png" alt="qs create customer screens"> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Все поля этого окна заполнены значениями по умолчанию, пока не будем их менять. Нажмите на кнопку <strong>Create</strong> и затем <strong>Close</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Во вкладке <strong>Generic UI</strong> панели навигатора в модуле <strong>Web Module</strong> появятся элементы <code>customer-browse.xml</code> и <code>customer-edit.xml</code>.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="qs_create_order_screens"><a class="anchor" href="/manual.html#qs_create_order_screens"></a>3.5.2. Экраны управления Заказами</h4> 
       <div class="paragraph"> 
        <p>Сущность Order (Заказ) имеет следующую особенность: так как среди прочих атрибутов существует ссылочный атрибут <code>Order.customer</code>, требуется определить <a href="/manual.html#views">представление</a> сущности <code>Order</code>, включающее этот атрибут (стандартное представление <code>_local</code> не включает ссылочных атрибутов).</p> 
       </div> 
       <div class="paragraph"> 
        <p>Для этого перейдите на вкладку <strong>Data Model</strong> на панели навигатора, выделите сущность <code>Order</code> и выберите <strong>New</strong> &gt; <strong>View</strong>. Отобразится страница дизайнера представлений. В качестве имени введите <code>order-with-customer</code>, в списке атрибутов нажмите на атрибут <code>customer</code> и на отобразившейся справа панели выберите представление <code>_minimal</code> для сущности <code>Customer</code>.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/qs_order_view.png" alt="qs order view"> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Нажмите на кнопку <strong>OK</strong> в верхней панели.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Далее выделите сущность <code>Order</code> и выберите <strong>New</strong> &gt; <strong>Generic UI screen</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В отобразившемся окне выберите представление <code>order-with-customer</code> в полях <strong>View</strong> для браузера и редактора и нажмите на кнопку <strong>Create</strong> и, затем, <strong>Close</strong>.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/qs_create_order_screens.png" alt="qs create order screens"> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Во вкладке <strong>Generic UI</strong> панели навигатора в модуле <strong>Web Module</strong> появятся элементы <code>order-edit.xml</code> и <code>order-browse.xml</code>.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="qs_create_menu"><a class="anchor" href="/manual.html#qs_create_menu"></a>3.5.3. Меню приложения</h4> 
       <div class="paragraph"> 
        <p>При создании экраны были добавлены в пункт меню <strong>application</strong>, имеющийся по умолчанию. Переименуем его. Для этого перейдите на вкладку <strong>Generic UI</strong> на панели навигатора и нажмите на ссылку <strong>Open web menu</strong>. Отобразится страница дизайнера меню. Выделите пункт меню <code>application</code> для просмотра его свойств.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В поле <strong>Id</strong> введите новое значение идентификатора меню − <code>shop</code>. После редактирования меню нажмите на кнопку <strong>OK</strong> в верхней панели.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/qs_application_menu.png" alt="qs application menu"> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="qs_customer_edit_with_orders"><a class="anchor" href="/manual.html#qs_customer_edit_with_orders"></a>3.5.4. Экран редактирования Покупателя со списком Заказов</h4> 
       <div class="paragraph"> 
        <p>Займемся задачей отображения списка заказов в окне редактирования покупателя.</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Перейдите на вкладку <strong>Generic UI</strong> на панели навигатора. Выделите экран <code>customer-edit.xml</code> и нажмите на кнопку <strong>Edit</strong>.</p> </li> 
         <li> <p>На странице дизайнера экрана перейдите на вкладку <strong>Datasources</strong> и нажмите на кнопку <strong>New</strong>.</p> </li> 
         <li> <p>Выделите только что созданный <a href="/manual.html#datasources">источник данных</a> в списке. В правой части страницы отобразятся его характеристики.</p> </li> 
         <li> <p>В поле <strong>Type</strong> укажите <code>collectionDatasource</code>.</p> </li> 
         <li> <p>В списке <strong>Entity</strong> выберите сущность <code>Order</code>.</p> </li> 
         <li> <p>В поле <strong>Id</strong> будет автоматически заполнено значение идентификатора источника данных − <code>ordersDs</code>.</p> </li> 
         <li> <p>В списке <strong>View</strong> выберите представление <code>_local</code>.</p> </li> 
         <li> <p>В поле <strong>Query</strong> введите следующий <a href="/manual.html#datasource_query">запрос</a>:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="jpql">select e from sales$Order e where e.customer.id = :ds$customerDs order by e.date</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Здесь запрос содержит условие отбора Заказов с <a href="/manual.html#datasource_query_params">параметром</a> <code>ds$customerDs</code>. Значением параметра с именем вида <code>ds${datasource_name}</code> будет идентификатор сущности, установленной в данный момент в источнике данных <code>datasource_name</code>, в данном случае − идентификатор редактируемого Покупателя.</p> 
          </div> 
          <div class="imageblock" style="text-align: center"> 
           <div class="content"> 
            <img src="assets/qs_customer_screen_orders_ds.png" alt="qs customer screen orders ds"> 
           </div> 
          </div> </li> 
         <li> <p>Нажмите на кнопку <strong>Apply</strong> для сохранения изменений.</p> </li> 
         <li> <p>Далее перейдите на вкладку <strong>Layout</strong> в дизайнере экрана и в палитре компонентов найдите компонент <code>Label</code>. Перетащите этот компонент на панель иерархии компонентов экрана, между <code>fieldGroup</code> и <code>windowActions</code>. Перейдите на вкладку <strong>Properties</strong> на панели свойств. В поле <strong>value</strong> введите значение компонента: <code>Orders</code>.</p> 
          <div class="imageblock" style="text-align: center"> 
           <div class="content"> 
            <img src="assets/qs_customer_screen_label.png" alt="qs customer screen label"> 
           </div> 
          </div> 
          <div class="admonitionblock tip"> 
           <table> 
            <tbody>
             <tr> 
              <td class="icon"> 
               <div class="title">
                Tip
               </div> </td> 
              <td class="content"> 
               <div class="paragraph"> 
                <p>Если разрабатываемое приложение предполагает локализацию на несколько языков, используйте кнопку <span class="image"><img src="assets/localization.png" alt="localization"></span> рядом с полем <strong>value</strong>, чтобы создать новое <a href="/manual.html#messages">сообщение</a> <code>msg://orders</code> и задать его значение на требуемых языках.</p> 
               </div> </td> 
             </tr> 
            </tbody>
           </table> 
          </div> </li> 
         <li> <p>Перетащите компонент <code>Table</code> из палитры компонентов на панель иерархии компонентов между <code>label</code> и <code>windowActions</code>. Выделите компонент в иерархии и перейдите на вкладку <strong>Properties</strong>. Задайте размеры таблицы: в поле <strong>width</strong> укажите <code>100%</code>, в поле <strong>height</strong> установите значение <code>200px</code>. Из списка доступных источников данных выберите <code>orderDs</code>, после этого в поле <strong>id</strong> с помощью кнопки <span class="image"><img src="assets/generate_id.png" alt="generate_id"></span> сгенерируйте идентификатор таблицы: <code>ordersTable</code>.</p> 
          <div class="imageblock" style="text-align: center"> 
           <div class="content"> 
            <img src="assets/qs_customer_screen_table.png" alt="qs customer screen table"> 
           </div> 
          </div> </li> 
         <li> <p>Для сохранения изменений в экране редактирования Покупателя нажмите на кнопку <strong>OK</strong> в верхней панели.</p> </li> 
        </ul> 
       </div> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="qs_run"><a class="anchor" href="/manual.html#qs_run"></a>3.6. Запуск приложения</h3> 
      <div class="paragraph"> 
       <p>Посмотрим, как созданные нами экраны выглядят в работающем приложении. Для этого выполните <strong>Run</strong> &gt; <strong>Start application server</strong>.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Зайдите в систему, использовав стандартные имя и пароль в окне логина. Откройте пункт меню <strong>Shop</strong> &gt; <strong>Customers</strong>:</p> 
      </div> 
      <div id="figure_customerBrowse" class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/qs_customer_browse.png" alt="qs customer browse"> 
       </div> 
       <div class="title">
        Рисунок 1. Экран списка Customers
       </div> 
      </div> 
      <div class="paragraph"> 
       <p>Нажмите на кнопку <strong>Create</strong> и создайте нового покупателя:</p> 
      </div> 
      <div id="figure_customerEdit" class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/qs_customer_edit.png" alt="qs customer edit"> 
       </div> 
       <div class="title">
        Рисунок 2. Экран редактирования Customer
       </div> 
      </div> 
      <div class="paragraph"> 
       <p>Откройте пункт меню <strong>Shop</strong> &gt; <strong>Orders</strong>:</p> 
      </div> 
      <div id="figure_orderBrowse" class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/qs_order_browse.png" alt="qs order browse"> 
       </div> 
       <div class="title">
        Рисунок 3. Экран списка Orders
       </div> 
      </div> 
      <div class="paragraph"> 
       <p>Нажмите на кнопку <strong>Create</strong> и создайте новый заказ, выбрав в поле <strong>Customer</strong> только что созданного покупателя:</p> 
      </div> 
      <div id="figure_orderEdit" class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/qs_order_edit.png" alt="qs order edit"> 
       </div> 
       <div class="title">
        Рисунок 4. Экран редактирования Order
       </div> 
      </div> 
      <div class="paragraph"> 
       <p>В таблице на экране редактирования покупателя теперь отображается только что созданный заказ:</p> 
      </div> 
      <div id="figure_customerEdit" class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/qs_customer_edit_2.png" alt="qs customer edit 2"> 
       </div> 
       <div class="title">
        Рисунок 5. Экран редактирования Customer
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="sect1"> 
    <h2 id="cookbook"><a class="anchor" href="/manual.html#cookbook"></a>4. Сборник рецептов</h2> 
    <div class="sectionbody"> 
     <div id="dev_recipes" class="paragraph"> 
      <p>Данный раздел представляет собой коллекцию практических рецептов по решению типичных задач, встающих перед разработчиками при использовании платформы CUBA. В каждом подразделе информация организована от простого к сложному, поэтому вы в любой момент можете перейти к другой секции или заняться кодированием.</p> 
     </div> 
     <div class="paragraph"> 
      <p>Большинство разделов снабжены демо-приложениями. Вы можете увидеть их в работе онлайн, посмотреть исходный код на GitHub, или загрузить и запустить локально. Ссылки на проекты приложений доступны также на вкладке <strong>Samples</strong> в Studio.</p> 
     </div> 
     <div class="admonitionblock tip"> 
      <table> 
       <tbody>
        <tr> 
         <td class="icon"> 
          <div class="title">
           Tip
          </div> </td> 
         <td class="content"> 
          <div class="paragraph"> 
           <p>Данный раздел находится в работе и будет постоянно дополняться.</p> 
          </div> </td> 
        </tr> 
       </tbody>
      </table> 
     </div> 
     <div class="sect2"> 
      <h3 id="business_logic_recipes"><a class="anchor" href="/manual.html#business_logic_recipes"></a>4.1. Организация бизнес-логики</h3> 
      <div class="paragraph"> 
       <p>Один из первых вопросов, возникающих в начале процесса разработки на платформе, это "где мне расположить мою бизнес-логику"? Использование Studio сильно облегчает создание модели данных и CRUD экранов, любой реальный проект требует создания логики помимо загрузки и сохранения данных. Данный раздел содержит информацию о том, как эффективно организовать бизнес-логику в зависимости от задачи.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Большинство примеров в данном разделе работают со следующей моделью:</p> 
      </div> 
      <div class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/business_logic_model_1.png" alt="business logic model 1"> 
       </div> 
      </div> 
      <div class="paragraph"> 
       <p>В этих примерах мы будем рассчитывать скидки для заказчиков в зависимости от общей суммы их покупок.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="logic_in_controllers_recipe"><a class="anchor" href="/manual.html#logic_in_controllers_recipe"></a>4.1.1. Бизнес-логика в контроллерах</h4> 
       <div class="manual-live-demo-container"> 
        <a href="https://demo1.cuba-platform.com/business-logic/open?screen=sample$Customer.browse_1" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
       </div> 
       <div class="paragraph"> 
        <p>Например, необходимо запускать расчет скидки, когда пользователь нажимает кнопку на экране-браузере заказчиков. В этом случае, наиболее простое решение - это разместить логику расчета прямо в <a href="/manual.html#screen_controller">контроллере</a> экрана.</p> 
       </div> 
       <div class="paragraph"> 
        <p>См. кнопку <strong>Calculate discount</strong> в демо-приложении и реализацию контроллера: <a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/web/src/com/company/sample/web/ex1/customer/CustomerBrowse.java" target="_blank">CustomerBrowse.java</a>. Пожалуйста, имейте в виду, что данная имплементацию расчета не является оптимальной (см. варианты работы с данными в разделе <a href="/manual.html#data_recipes">Загрузка и сохранение данных</a>).</p> 
       </div> 
       <div class="paragraph"> 
        <p>Данный подход приемлем, если логика вызывается из одного места и она не слишком сложна, чтобы уместиться в нескольких коротких методах.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="using_client_beans_recipe"><a class="anchor" href="/manual.html#using_client_beans_recipe"></a>4.1.2. Использование бинов клиентского уровня</h4> 
       <div class="manual-live-demo-container"> 
        <a href="https://demo1.cuba-platform.com/business-logic/open?screen=sample$Customer.browse_2" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
       </div> 
       <div class="paragraph"> 
        <p>Теперь давайте немного усложним задачу из <a href="/manual.html#logic_in_controllers_recipe">предыдущего</a> раздела. Допустим, требуется вызывать расчет из двух экранов: и из браузера, и из редактора. Чтобы не дублировать код, нужно извлечь код из контроллера и поместить в некоторое общедоступное место. Это может быть <a href="/manual.html#managed_beans">управляемый бин</a> клиентского <a href="/manual.html#app_tiers">уровня</a>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Управляемый бин - это класс с аннотацией <code>@Component</code>. Он может быть инжектирован в другие бины и контроллеры экранов, или получен с помощью статического метода <code>AppBeans.get()</code>. Если класс бина реализует некоторый интерфейс, то к нему можно обращаться через этот интерфейс.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Имейте в виду, что для того чтобы бин был доступен для контроллеров экранов, он должен располагаться в одном из следующих <a href="/manual.html#app_modules">модулей</a>: <strong>global</strong>, <strong>gui</strong> или <strong>web</strong> вашего проекта. В случае <strong>global</strong>, бин будет также доступен на среднем слое.</p> 
       </div> 
       <div class="paragraph"> 
        <p>См. кнопку <strong>Calculate discount</strong> на экранах браузера и редактора в демо-приложении, и реализацию:</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/using_client_beans_1.png" alt="using client beans 1"> 
        </div> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/web/src/com/company/sample/web/ex2/customer/CustomerBrowse.java" target="_blank">CustomerBrowse.java</a> - контроллер браузера.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/web/src/com/company/sample/web/ex2/customer/CustomerEdit.java" target="_blank">CustomerEdit.java</a> - контроллер редактора.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/web/src/com/company/sample/web/ex2/DiscountCalculator.java" target="_blank">DiscountCalculator.java</a> - бин расчета скидок. Он использует <a href="/manual.html#dataManager">DataManager</a> для загрузки списка заказов данного заказчика из базы данных.</p> </li> 
        </ul> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="using_services_recipe"><a class="anchor" href="/manual.html#using_services_recipe"></a>4.1.3. Использование сервисов среднего слоя</h4> 
       <div class="manual-live-demo-container"> 
        <a href="https://demo1.cuba-platform.com/business-logic/open?screen=sample$Customer.browse_3" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
       </div> 
       <div class="paragraph"> 
        <p>В <a href="/manual.html#using_client_beans_recipe">предыдущем</a> разделе мы рассмотрели инкапсуляцию бизнес-логики в бине клиентского уровня. Теперь мы пойдем дальше и поместим нашу логику в наиболее подходящее место: на <a href="/manual.html#middleware">средний слой</a>. Сделав это, мы достигнем следующих целей:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Наши бизнес-методы будут доступны клиентам всех типов, включая <a href="/manual.html#polymer_ui">Polymer UI</a>.</p> </li> 
         <li> <p>Мы сможем использовать API, доступный только на middleware: <a href="/manual.html#entityManager">EntityManager</a>, <a href="/manual.html#transactions">transactions</a>, и т.п.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Чтобы вызвать бизнес-метод среднего слоя, необходимо создать <a href="/manual.html#services">сервис</a>. Studio может помочь в создании заготовки сервиса:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Переключитесь на вкладку <strong>Middleware</strong> и нажмите <strong>New &gt; Service</strong>.</p> </li> 
         <li> <p>Измените имя интерфейса сервиса на <code>DiscountService</code>. Имена класса и самого сервиса будут изменены соответственно. Нажмите <strong>OK</strong> или <strong>Apply</strong>.</p> </li> 
         <li> <p>Нажмите <strong>IDE</strong> и откройте интерфейс сервиса в IDE. Создайте новый метод и реализуйте его в классе сервиса.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>См. пример реализации в демо-приложении:</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/using_services_1.png" alt="using services 1"> 
        </div> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/web/src/com/company/sample/web/ex3/customer/CustomerBrowse.java" target="_blank">CustomerBrowse.java</a> and <a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/web/src/com/company/sample/web/ex3/customer/CustomerEdit.java" target="_blank">CustomerEdit.java</a> - контроллер экрана, который вызывает сервис.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/global/src/com/company/sample/service/DiscountService.java" target="_blank">DiscountService.java</a> - интерфейс сервиса.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/service/DiscountServiceBean.java" target="_blank">DiscountServiceBean.java</a> - класс реализации сервиса.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/core/DiscountCalculator.java" target="_blank">DiscountCalculator.java</a> - бин среднего слоя, рассчитывающий скидки. Разумеется, сервис мог бы содержать бизнес-логику сам, но мы будем использовать этот делегат для того чтобы разделять логику с entity listener и JMX-бином (см. следующие разделы).</p> 
          <div class="paragraph"> 
           <p>Обратите внимание, что данный бин отличается от рассмотренного в <a href="/manual.html#using_client_beans_recipe">предыдущем</a> разделе: он расположен в модуле <strong>core</strong> и использует <a href="/manual.html#entityManager">EntityManager</a> для загрузки суммы заказов из базы данных.</p> 
          </div> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Теперь давайте сделаем наш бизнес-метод доступным для внешних клиентов через <a href="/manual.html#rest_api_v2">REST API</a>:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Откройте сервис на редактирование в Studio и переключитесь на вкладку <strong>REST Methods</strong>.</p> </li> 
         <li> <p>Установите для метода флажок <strong>REST invocation allowed</strong>.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Studio создаст файл <code>rest-services.xml</code> и зарегистрирует в нем метод. После перезапуска сервера вы сможете вызвать метод с помощью HTTP-запросов. Например, следующий GET-запрос должен работать с нашим онлайн демо-сервером:</p> 
       </div> 
       <div class="paragraph"> 
        <p><a href="https://demo1.cuba-platform.com/business-logic/rest/v2/services/sample_DiscountService/calculateDiscount?customerId=1797f54d-5bec-87a6-4330-d958955743a2" class="bare" target="_blank">https://demo1.cuba-platform.com/business-logic/rest/v2/services/sample_DiscountService/calculateDiscount?customerId=1797f54d-5bec-87a6-4330-d958955743a2</a></p> 
       </div> 
       <div class="paragraph"> 
        <p>Имейте в виду, что демо-приложение имеет <a href="/manual.html#rest_api_v2_anonymous">анонимный доступ</a>. В большинстве реальных сценариев использования необходимо будет аутентифицироваться, прежде чем выполнять запросы.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="using_entity_listeners_recipe"><a class="anchor" href="/manual.html#using_entity_listeners_recipe"></a>4.1.4. Использование Entity Listeners</h4> 
       <div class="manual-live-demo-container"> 
        <a href="https://demo1.cuba-platform.com/business-logic/open?screen=sample$orderBrowseWithCustomers" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
       </div> 
       <div class="paragraph"> 
        <p><a href="/manual.html#entity_listeners">Entity listeners</a> позволяют выполнять бизнес-логику каждый раз, когда сущность создается, изменяется или удаляется в базе данных. Например, мы можем пересчитывать скидку для заказчика каждый раз, когда некоторый заказ для него изменяется.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Заготовку для entity listener можно легко создать в Studio:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Перейдите на вкладку <strong>Middleware</strong> и нажмите <strong>New &gt; Entity listener</strong>.</p> </li> 
         <li> <p>Измените имя класса на <code>OrderEntityListener</code> и включите флажки для интерфейсов <code>BeforeInsertEntityListener</code>, <code>BeforeUpdateEntityListener</code> и <code>BeforeDeleteEntityListener</code>.</p> </li> 
         <li> <p>Выберите сущность <code>Order</code> в поле <strong>Entity type</strong>.</p> </li> 
         <li> <p>Нажмите <strong>OK</strong> или <strong>Apply</strong> и откройте класс listener в IDE.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>См. пример в демо-приложении:</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/using_entity_listeners_1.png" alt="using entity listeners 1"> 
        </div> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/listener/OrderEntityListener.java" target="_blank">OrderEntityListener.java</a> - класс entity listener.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/core/DiscountCalculator.java" target="_blank">DiscountCalculator.java</a> - бин среднего слоя, рассчитывающий скидки. Entity listener мог бы содержать бизнес-логику сам, но мы использовуем этот делегат для того, чтобы разделять логику с сервисом и JMX бином.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Если вы откроете экран <strong>Logic in Entity Listeners</strong> демо-приложения, вы увидите две таблицы: заказы и заказчики. Создайте, измените или удалите заказ, обновите таблицу заказчиков, и вы увидите, что скидка для соответствующего заказчика изменилась.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="using_jmx_beans_recipe"><a class="anchor" href="/manual.html#using_jmx_beans_recipe"></a>4.1.5. Использование JMX-бинов</h4> 
       <div class="manual-live-demo-container"> 
        <a href="https://demo1.cuba-platform.com/business-logic/open?screen=jmxConsole" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
       </div> 
       <div class="paragraph"> 
        <p>С помощью <a href="/manual.html#jmx_beans">JMX-бинов</a> можно предоставить доступ к некоторой административной функциональности вашего приложения без создания пользовательского интерфейса для нее. Данная функциональность будет также доступна через встроенную JMX-консоль и через внешние инструменты JMX, например <code>jconsole</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В нашем примере со скидками пользователь, имеющий доступ к JMX-консоли, сможет пересчитывать скидки для всех заказчиков или для заказчика с указанным id.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Studio на данный момент не умеет создавать заготовки JMX-бинов, поэтому все классы и конфигурационные элементы придется создавать вручную в IDE.</p> 
       </div> 
       <div class="paragraph"> 
        <p>См. пример реализации в демо-приложении:</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/using_jmx_beans_1.png" alt="using jmx beans 1"> 
        </div> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/core/jmx/DiscountsMBean.java" target="_blank">DiscountsMBean.java</a> - интерфейс JMX-бина.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/core/jmx/Discounts.java" target="_blank">Discounts.java</a> - реализация JMX-бина.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/core/DiscountCalculator.java" target="_blank">DiscountCalculator.java</a> - бин среднего слоя, вызываемый JMX-бином. JMX-бин мог бы содержать бизнес-логику сам, но мы использовуем этот делегат для того, чтобы разделять логику с entity listener и JMX бином.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/spring.xml" target="_blank">spring.xml</a> - в данном файле JMX-бин регистрируется.</p> </li> 
        </ul> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="app_start_recipe"><a class="anchor" href="/manual.html#app_start_recipe"></a>4.1.6. Запуск кода на старте приложения</h4> 
       <div class="paragraph"> 
        <p>Иногда бывает необходимо выполнить некоторый код сразу после старта приложения в момент, когда все механизмы гарантированно работоспособны. Для этого можно воспользоваться слушателем <a href="/manual.html#appContext">AppContext.Listener</a>.</p> 
       </div> 
       <div class="manual-live-demo-container"> 
        <a href="https://demo1.cuba-platform.com/business-logic/open?screen=sample$Employee.browse" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
       </div> 
       <div class="paragraph"> 
        <p>В данном разделе мы рассмотрим, как динамически зарегистрировать для сущности <a href="/manual.html#entity_listeners">entity listener</a> на старте приложения. Возьмем следующую задачу: в проекте имеется сущность <code>Employee</code> (сотрудник компании), которая связана один-к-одному с платформенной сущностью <code>User</code> (пользователь системы):</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/app_start_recipe_1.png" alt="app start recipe 1"> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Если атрибут <code>name</code> сущности <code>User</code> изменяется, например через стандартный экран управления пользователями, необходимо, чтобы изменялся также и атрибут <code>name</code> связанной сущности <code>Employee</code>. Это обычная задача для "денормализованных" данных, и решается она, как правило, с использованием <a href="/manual.html#entity_listeners">entity listeners</a>. В данном случае ситуация осложняется тем, что необходимо отслеживать изменения не проектной, а платформенной сущности <code>User</code>, и добавить entity listener с помощью аннотации <a href="/manual.html#listeners_annotation">@Listeners</a> невозможно. Однако, можно добавить listener динамически через бин <code>EntityListenerManager</code>, и сделать это лучше всего на старте приложения.</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/core/AppLifecycle.java" target="_blank">AppLifecycle.java</a> - бин среднего слоя, реализующий интерфейс <code>AppContext.Listener</code>, содержащий методы <code>applicationStarted()</code> и <code>applicationStopped()</code>.</p> </li> 
         <li> <p><a href="https://github.com/cuba-platform/sample-business-logic/blob/master/modules/core/src/com/company/sample/listener/UserEntityListener.java" target="_blank">UserEntityListener.java</a> - entity listener для сущности <code>User</code>.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>В результате сразу после старта <a href="/manual.html#app_tiers">блока</a> Middleware будет вызван метод <code>applicationStarted()</code> данного бина. В этом методе в качестве entity listener сущности <code>User</code> регистрируется бин <code>sample_UserEntityListener</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Метод <code>onBeforeUpdate()</code> класса <code>UserEntityListener</code> будет вызываться перед каждым сохранением изменений экземпляров <code>User</code> в базу данных. В методе проверяется, есть ли атрибут <code>name</code> среди измененных, и если да, загружается связанный экземпляр <code>Employee</code>, и в нем устанавливается это же значение <code>name</code>.</p> 
       </div> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="modeling_domain_recipes"><a class="anchor" href="/manual.html#modeling_domain_recipes"></a>4.2. Моделирование предметной области</h3> 
      <div class="paragraph"> 
       <p>В данном разделе приведены рецепты, связанные с дизайном модели данных и работой с атрибутами сущностей.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="init_values"><a class="anchor" href="/manual.html#init_values"></a>4.2.1. Присвоение начальных значений</h4> 
       <div class="paragraph"> 
        <p>Присвоение начальных значений атрибутам новых экземпляров сущностей можно производить несколькими способами.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="init_values_in_class"><a class="anchor" href="/manual.html#init_values_in_class"></a>4.2.1.1. Инициализация полей сущности</h5> 
        <div class="manual-live-demo-container"> 
         <a href="https://demo2.cuba-platform.com/model/open?screen=sample$Customer.browse" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
        </div> 
        <div class="paragraph"> 
         <p>Атрибуты простых типов (<code>Boolean</code>, <code>Integer</code> и т.д.) и перечисления можно инициализировать прямо в объявлении соответствующего поля класса сущности. См. например поля <code>active</code> и <code>grade</code> в <a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/entity/customers/Customer.java" target="_blank">Customer.java</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Кроме того, в классе сущности можно создать специальный метод инициализации и добавить ему аннотацию <a href="/manual.html#postConstruct_entity_annotation">@PostConstruct</a>. В этом случае в процессе инициализации можно использовать вызов любых глобальных <a href="/manual.html#infrastructure_interfaces">интерфейсов инфраструктуры</a> и <a href="/manual.html#managed_beans">бинов</a>. См. метод <code>init()</code> в <a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/entity/customers/Customer.java" target="_blank">Customer.java</a>.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="init_values_in_CreateAction"><a class="anchor" href="/manual.html#init_values_in_CreateAction"></a>4.2.1.2. Инициализация с помощью CreateAction</h5> 
        <div class="manual-live-demo-container"> 
         <a href="https://demo2.cuba-platform.com/model/open?screen=sample$customersWithAddresses" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
        </div> 
        <div class="paragraph"> 
         <p>Если начальное значение атрибута зависит от данных вызывающего экрана, то можно воспользоваться методами <code>setInitialValues()</code> или <code>setInitialValuesSupplier()</code> класса <a href="/manual.html#createAction">CreateAction</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>См. пример работы с сущностями <code>Customer</code> и <code>CustomerAddress</code> в демо-приложении:</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/init_values_1.png" alt="init values 1"> 
         </div> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/customer/customer-address-browse.xml" target="_blank">customer-address-browse.xml</a> - дескриптор экрана с двумя связанными таблицами, одна для заказчиков, другая для их адресов.</p> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/customer/CustomerAddressBrowse.java" target="_blank">CustomerAddressBrowse.java</a> - контроллер экрана. В его методе <code>init()</code> вызывается <code>setInitialValuesSupplier()</code>, который используется для предоставления начального значения атрибуту <code>customer</code> создаваемого адреса. Значением будет заказчик, выбранный в данный момент в первой таблице.</p> </li> 
         </ul> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="init_values_in_initNewItem"><a class="anchor" href="/manual.html#init_values_in_initNewItem"></a>4.2.1.3. Использование метода initNewItem</h5> 
        <div class="manual-live-demo-container"> 
         <a href="https://demo2.cuba-platform.com/model/open?screen=sample$Customer.browse1" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
        </div> 
        <div class="paragraph"> 
         <p>Начальные значения можно также задать в контроллере экрана создаваемой сущности в методе <a href="/manual.html#initNewItem">initNewItem()</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Рассмотрим сущности:</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/composition_recipe_3.png" alt="composition recipe 3"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>В демо-приложении атрибут <code>info</code> сущности <code>CustomerDetails</code> редактируется в том же экране, что и сам <code>Customer</code>. Данный подход требует создания экземпляра <code>CustomerDetails</code> вместе с владеющим им <code>Customer</code>.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/customers_1/customer-edit.xml" target="_blank">customer-edit.xml</a> - дескриптор экрана редактирования заказчика. Он содержит вложенный источник данных для связанного экземпляра <code>CustomerDetails</code>. Компонент` infoField` типа <code>TextArea</code> подключен к этому источнику.</p> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/customers_1/CustomerEdit.java" target="_blank">CustomerEdit.java</a> - контроллер экрана. В нем определен метод <code>initNewItem()</code>, который создает новый экземпляр <code>CustomerDetails</code> и устанавливает его в новый <code>Customer</code>. Созданный экземпляр будет доступен через вложенный источник данных и сохранен в базе данных когда экран будет закоммичен.</p> </li> 
         </ul> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="composition_recipe"><a class="anchor" href="/manual.html#composition_recipe"></a>4.2.2. Редактирование композитных сущностей</h4> 
       <div class="paragraph"> 
        <p>Платформа CUBA поддерживает два типа связи между сущностями: ассоциацию и композицию. В интерфейсе CUBA Studio они названы соответственно ASSOCIATION и COMPOSITION. Ассоциация - это связь между объектами, которые могут существовать отдельно друг от друга. Композиция же используется для связи типа "master-detail" когда экземпляры detail существуют только в составе master. Примером композиции может служить связь аэропорта и терминалов: терминал, не относящийся ни к какому аэропорту, не имеет смысла.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Как правило, редактирование сущностей, входящих в состав композиции, удобно осуществлять совместно. То есть, например, пользователь открывает экран редактирования аэропорта, видит в нем список терминалов, может создавать и редактировать их, но все изменения, как аэропорта, так и терминалов, сохраняются в базу данных вместе в одной транзакции, и только тогда, когда пользователь подтвердит сохранение главной сущности - аэропорта.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="composition_impl_recipe"><a class="anchor" href="/manual.html#composition_impl_recipe"></a>4.2.2.1. One-to-Many: один уровень вложенности</h5> 
        <div class="manual-live-demo-container"> 
         <a href="https://demo2.cuba-platform.com/model/open?screen=sample$Airport.browse" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
        </div> 
        <div class="paragraph"> 
         <p>Рассмотрим реализацию композиции на примере сущностей <code>Airport</code> и <code>Terminal</code>:</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/composition_recipe_1.png" alt="composition recipe 1"> 
         </div> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/entity/airports/Terminal.java" target="_blank">Terminal.java</a> - сущность <code>Terminal</code> содержит обязательную ссылку на <code>Airport</code>.</p> 
           <div class="paragraph"> 
            <p>В редакторе сущностей Studio установите следующие свойства для аттрибута <code>airport</code>: <strong>Attribute type</strong> - ASSOCIATION, <strong>Cardinality</strong> - MANY_TO_ONE, <strong>Mandatory</strong> - on.</p> 
           </div> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/entity/airports/Airport.java" target="_blank">Airport.java</a> - сущность <code>Airport</code> содержит one-to-many коллекцию терминалов. Соответствующее поле аннотировано <a href="/manual.html#composition_annotation">@Composition</a> для реализации композиции, и <a href="/manual.html#onDelete_annotation">@OnDelete</a> для каскадного мягкого удаления.</p> 
           <div class="paragraph"> 
            <p>В редакторе сущностей Studio установите следующие свойства для аттрибута <code>terminals</code>: <strong>Attribute type</strong> - COMPOSITION, <strong>Cardinality</strong> - ONE_TO_MANY, <strong>On delete</strong> - CASCADE.</p> 
           </div> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/views.xml" target="_blank">views.xml</a> - <a href="/manual.html#views">представление</a> <code>airport-terminals</code> экрана редактирования аэропорта содержит атрибут-коллекцию <code>terminals</code>. Для этого атрибута используется представление <code>_local</code>, так как атрибут <code>airport</code> сущности <code>Terminal</code> устанавливается только во время создания экземпляра <code>Terminal</code> и никогда не изменяется после этого, поэтому загружать его не требуется.</p> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/airports/airport/airport-edit.xml" target="_blank">airport-edit.xml</a> - XML-дескриптор экрана редактирования аэропорта определяет источник данных для экземпляра аэропорта, и вложенный источник для его терминалов. Кроме того, экран содержит таблицу, отображающую терминалы.</p> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/airports/terminal/terminal-edit.xml" target="_blank">terminal-edit.xml</a> - стандартный редактор для сущности <code>Terminal</code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>В результате редактирование экземпляра аэропорта работает следующим образом:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>В экране редактирования аэропорта отображается таблица терминалов.</p> </li> 
          <li> <p>Пользователь может выбрать терминал и открыть экран его редактирования. При нажатии <strong>OK</strong> в экране редактирования терминала измененный экземпляр терминала сохраняется не в базу данных, а в источник данных <code>terminalsDs</code> экрана редактирования аэропорта.</p> </li> 
          <li> <p>Пользователь может создавать новые или удалять терминалы - все изменения сохраняются в источнике данных <code>terminalsDs</code>.</p> </li> 
          <li> <p>Пользователь нажимает <strong>OK</strong> в экране редактирования аэропорта, и измененный <code>Airport</code> вместе со всеми измененными экземплярами <code>Terminal</code> отправляется на middleware в метод <a href="/manual.html#dataManager">DataManager</a>.commit() и сохраняется в базе данных в рамках одной транзакции.</p> </li> 
         </ul> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="composition_deep_recipe"><a class="anchor" href="/manual.html#composition_deep_recipe"></a>4.2.2.2. One-to-Many: два уровня вложенности</h5> 
        <div class="manual-live-demo-container"> 
         <a href="https://demo2.cuba-platform.com/model/open?screen=sample$Airport.browse1" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
        </div> 
        <div class="paragraph"> 
         <p>Композиция может быть более глубокой и состоять из двух уровней вложенности. Усложним приведенный <a href="/manual.html#composition_impl_recipe">выше</a> пример, добавив сущность <code>MeetingPoint</code>, описывающую место встречи у терминала аэропорта:</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/composition_recipe_2.png" alt="composition recipe 2"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Теперь сущность <code>Terminal</code> содержит атрибут <code>meetingPoints</code> - коллекцию экземпляров <code>MeetingPoint</code>. Для того, чтобы все три сущности представляли собой единую композицию и редактировались совместно, нужно в дополнение к описанному в предыдущем разделе выполнить следующее:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/entity/airports/Terminal.java" target="_blank">Terminal.java</a> - атрибут <code>meetingPoints</code> класса <code>Terminal</code> содержит аннотации <code>@Composition</code> и <code>@OnDelete</code> аналогично атрибуту <code>terminals</code> класса <code>Airport</code>.</p> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/views.xml" target="_blank">views.xml</a> - представление <code>terminal-meetingPoints-view</code> сущности <code>Terminal</code> содержит атрибут-коллекцию <code>meetingPoints</code>. Данное представление используется в представлении <code>airport-terminals-meetingPoints-view</code> сущности <code>Airport</code>.</p> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/airports_1/airport/airport-edit.xml" target="_blank">airport-edit.xml</a> - дескриптор экрана редактирования <code>Airport</code> содержит источники данных для экземпляра <code>Airport</code> и вложенных сущностей на всю глубину композиции (<code>airportDs</code> &gt; <code>terminalsDs</code> &gt; <code>meetingPointsDs</code>).</p> 
           <div class="paragraph"> 
            <p>Источник данных <code>meetingPointsDs</code> здесь не связан ни с какими визуальными компонентами, однако он необходим для корректной работы совместного редактирования композиции.</p> 
           </div> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/airports_1/terminal/terminal-edit.xml" target="_blank">terminal-edit.xml</a> - XML-дескриптор экрана редактирования терминала в свою очередь определяет вложенный источник данных и соответствующую таблицу для коллекции <code>meetingPoints</code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>В результате измененные эземпляры <code>MeetingPoint</code>, так же как и экземпляры <code>Terminal</code>, будут сохраняться в базу данных только вместе с экземпляром <code>Airport</code> в одной транзакции.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="composition_deep3_recipe"><a class="anchor" href="/manual.html#composition_deep3_recipe"></a>4.2.2.3. One-to-Many: три уровня вложенности</h5> 
        <div class="paragraph"> 
         <p>Представьте, что вам необходима еще одна сущность, содержащая некоторые детали места встречи (<code>MeetingPoint</code>). Назовем эту сущность <strong>Note</strong>. Таким образом, вся структура будет выглядеть следующим образом: <strong>Airport &gt; Terminal &gt; Meeting Point &gt; Note</strong>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/composition_recipe_4.png" alt="composition recipe 4"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>CUBA может обеспечить работу с композициями с максимум 2-мя уровнями вложенности. Теперь у структура с 3-мя уровня, поэтому необходимо ограничить глубину композиции либо сверху, либо снизу. В данном разделе мы рассмотрим два различных (с точки зрения user experience) подхода для исключения из композиции аэропорта. Оба подхода решают одну и ту же проблему: так как теперь терминалы сохраняются в базу данных независимо от аэропорта, невозможно сохранить терминал для только-что созданного аэропорта пока он не сохранен в БД.</p> 
        </div> 
        <div class="manual-live-demo-container"> 
         <a href="https://demo2.cuba-platform.com/model/open?screen=sample$Airport.browse2" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>При первом подходе браузер и редактор аэропорта выглядят так-же как и раньше, но редактор имеет дополнительную кнопку <strong>Save</strong> для сохранения нового аэропорта не закрывая экрана. Пользователь не может создавать терминалы, пока новый аэропорт не сохранен.</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/airports_2/airport/airport-edit.xml" target="_blank">airport-edit.xml</a> содержит standalone источник данных для терминалов вместо вложенного. Этот источник связан с источником аэропорта, и поэтому загружает терминалы только для редактируемого аэропорта. Кроме того, экран содержит фрейм <code>extendedEditWindowActions</code>, позволяющий пользователю сохранить аэропорт не закрывая экран.</p> </li> 
             <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/airports_2/airport/AirportEdit.java" target="_blank">AirportEdit.java</a> - здесь, в методе <code>postInit()</code> редактора аэропорта, мы управляем состоянием enabled действия создания терминала и передаем текущий экземпляр аэропорта для инициализации ссылки в создаваемом терминале.</p> </li> 
            </ul> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="manual-live-demo-container"> 
         <a href="https://demo2.cuba-platform.com/model/open?screen=sample$Airport.browse3" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>При втором подходе мы разбиваем браузер аэропортов на две панели: одна для списка аэропортов, вторая для зависимого списка терминалов. Т.е. список терминалов теперь находится вне редактора аэропорта. Действие создания терминалов недоступно, если не выбран ни один аэропорт.</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/airports_3/airport/airport-browse.xml" target="_blank">airport-browse.xml</a> содержит standalone источник данных для списка терминалов. Он связан с источником аэропортов, и загружает терминалы только для выбранного аэропорта.</p> </li> 
             <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/airports_3/airport/AirportBrowse.java" target="_blank">AirportBrowse.java</a> - здесь, в методе <code>init()</code> браузера аэропорта, мы управляем состоянием enabled действия создания терминала и передаем выбранный экземпляр аэропорта для инициализации ссылки в создаваемом терминале.</p> </li> 
            </ul> 
           </div> </li> 
         </ul> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="composition_oto_recipe"><a class="anchor" href="/manual.html#composition_oto_recipe"></a>4.2.2.4. Композиция One-to-One</h5> 
        <div class="manual-live-demo-container"> 
         <a href="https://demo2.cuba-platform.com/model/open?screen=sample$Customer.browse2" class="live-demo-btn" target="_blank">LIVE DEMO</a> 
        </div> 
        <div class="paragraph"> 
         <p>Композиция one-to-one рассматривается на примере сущностей <code>Customer</code> и <code>CustomerDetails</code>:</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/composition_recipe_3.png" alt="composition recipe 3"> 
         </div> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/entity/customers/Customer.java" target="_blank">Customer.java</a> - сущность <code>Customer</code> содержит необязательную ссылку на <code>CustomerDetails</code>, аннотированную как <code>@Composition</code>.</p> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/global/src/com/company/sample/entity/customers/CustomerDetails.java" target="_blank">CustomerDetails.java</a> - сущность <code>CustomerDetails</code>.</p> </li> 
          <li> <p><a href="https://github.com/cuba-platform/sample-model/blob/master/modules/web/src/com/company/sample/web/customers_2/customer-edit.xml" target="_blank">customer-edit.xml</a> - дескриптор экрана редактирования заказчика. Он содержит вложенный источник данных для экземпляра <code>CustomerDetails</code>. Для того, чтобы загрузить вложенный экземляр, корневой источник данных использует <a href="/manual.html#views">представление</a> сущности <code>Customer</code>, включающее атрибут <code>details</code>. Компонент FieldGroup просто декларирует поле для атрибута <code>details</code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>В результате редактирование экземпляра <code>Customer</code> работает следующим образом:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Экран редактирования <code>Customer</code> содержит компонент <a href="/manual.html#gui_PickerField">PickerField</a> с двумя действиями: <a href="/manual.html#openAction">OpenAction</a> и <a href="/manual.html#clearAction">ClearAction</a>:</p> </li> 
         </ul> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/composition_recipe_oto_1.png" alt="composition recipe oto 1"> 
         </div> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Когда вызывается <code>OpenAction</code>, создается новый экземпляр <code>CustomerDetails</code> и он отображается в собственном экране редактирования. При нажатии <strong>OK</strong> в этом экране, экземпляр <code>CustomerDetails</code> сохраняется не в БД, а в источнике данных <code>detailsDs</code> редактора <code>Customer</code>.</p> </li> 
          <li> <p>Компонент выбора отображает <a href="/manual.html#namePattern_annotation">instance name</a> сущности <code>CustomerDetails</code>:</p> </li> 
         </ul> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/composition_recipe_oto_2.png" alt="composition recipe oto 2"> 
         </div> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Когда пользователь нажимает <strong>OK</strong> в редакторе <code>Customer</code>, измененный экземпляр <code>Customer</code> вместе с экземпляром <code>CustomerDetails</code> отправляется в метод <code>DataManager.commit()</code> на средний слой и сохраняется в БД в одной транзакции.</p> </li> 
          <li> <p>Если пользователь вызывает <code>ClearAction</code> в поле выбора, экземпляр <code>CustomerDetails</code> удаляется и ссылка на него очищается в одной транзакции после коммита редактора <code>Customer</code>.</p> </li> 
         </ul> 
        </div> 
       </div> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="data_recipes"><a class="anchor" href="/manual.html#data_recipes"></a>4.3. Загрузка и сохранение данных</h3> 
      <div class="paragraph"> 
       <p>В данном разделе рассматриваются различные способы загрузки и сохранения данных в БД.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="dm_vs_em"><a class="anchor" href="/manual.html#dm_vs_em"></a>4.3.1. DataManager vs. EntityManager</h4> 
       <div class="paragraph"> 
        <p>И <a href="/manual.html#dataManager">DataManager</a> и <a href="/manual.html#entityManager">EntityManager</a> предназначены для выполнения операций с сущностями (CRUD). Ниже приведены различия между этими интерфейсами.</p> 
       </div> 
       <table class="tableblock frame-all grid-all spread"> 
        <colgroup> 
         <col style="width: 50%;"> 
         <col style="width: 50%;"> 
        </colgroup> 
        <thead> 
         <tr> 
          <th class="tableblock halign-left valign-top">DataManager</th> 
          <th class="tableblock halign-left valign-top">EntityManager</th> 
         </tr> 
        </thead> 
        <tbody> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">DataManager доступен и на среднем слое и на клиентском <a href="/manual.html#app_tiers">уровне</a>.</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">EntityManager доступен только на среднем слое.</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">DataManager является синглтон-бином.</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Ссылку на EntityManager необходимо получать через интерфейс <a href="/manual.html#persistence">Persistence</a>.</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">DataManager содержит несколько высокоуровневых методов для работы с <a href="/manual.html#entity_states">detached</a> сущностями: <code>load()</code>, <code>loadList()</code>, <code>reload()</code>, <code>commit()</code>.</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">EntityManager в большой степени повторяет стандартный <code>javax.persistence.EntityManager</code>.</p></td> 
         </tr> 
        </tbody> 
       </table> 
       <div class="paragraph"> 
        <p>DataManager на самом деле делегирует выполнение реализациям <a href="/manual.html#data_store">DataStore</a>, поэтому особенности DataManager, перечисленные ниже, актуальны только для наиболее часто встречающегося случая, когда вы работаете с сущностями, хранящимися в реляционной базе данных.</p> 
       </div> 
       <table class="tableblock frame-all grid-all spread"> 
        <colgroup> 
         <col style="width: 50%;"> 
         <col style="width: 50%;"> 
        </colgroup> 
        <thead> 
         <tr> 
          <th class="tableblock halign-left valign-top">DataManager</th> 
          <th class="tableblock halign-left valign-top">EntityManager</th> 
         </tr> 
        </thead> 
        <tbody> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">DataManager всегда стартует новую <a href="/manual.html#transactions">транзакцию</a> внутри.</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Для работы с EntityManager необходима открытая транзакция.</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">DataManager загружает <em>частичные</em> сущности в соответствие с <a href="/manual.html#views">представлением</a>. Есть некоторые исключения, см. <a href="/manual.html#dm_partial_entities">подробности</a>.</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">EntityManager всегда загружает все локальные атрибуты. Если используется представление, оно влияет только на загрузку ссылочных атрибутов. См. <a href="/manual.html#em_partial_entities">подробности</a>.</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">DataManager выполняет только JPQL запросы. Кроме того, он имеет отдельные методы для загрузки сущностей: <code>load()</code>, <code>loadList()</code>; и скалярных и агрегатных значений: <code>loadValues()</code>.</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">EntityManager может выполнять любые JPQL или native (SQL) запросы.</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">DataManager проверяет <a href="/manual.html#dm_security">права доступа</a>, когда вызывается с клиентского уровня.</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">EntityManager не проверяет права доступа.</p></td> 
         </tr> 
        </tbody> 
       </table> 
       <div class="paragraph"> 
        <p>При работе на клиентском уровне доступен только <code>DataManager</code>. На среднем слое, используйте <code>EntityManager</code> когда необходимо реализовать атомарную логику внутри транзакции или если его интерфейс лучше подходит для решения задачи. В противном случае, на среднем слое можно использовать любой из интерфейсов на выбор.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Если вам нужно обойти ограничения <code>DataManager</code> при работе на клиентском уровне, создайте свой <a href="/manual.html#services">сервис</a> и используйте <code>EntityManager</code> для работы с данными. В сервисе можно проверять права пользователя с помощью интерфейса <a href="/manual.html#security">Security</a> и возвращать клиенту данные в виде персистентных или неперсистентных сущностей или произвольных значений.</p> 
       </div> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="rest_api_v2_usage_example"><a class="anchor" href="/manual.html#rest_api_v2_usage_example"></a>4.4. Использование REST API</h3> 
      <div class="paragraph"> 
       <p>Данный раздел содержит ряд примеров использования <a href="/manual.html#rest_api_v2">REST API</a>.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Детальная информация о методах REST API описана согласно спецификации <a href="http://swagger.io/specification" target="_blank">Swagger</a> и доступна по адресу <a href="http://files.cuba-platform.com/swagger/6.7" class="bare" target="_blank">http://files.cuba-platform.com/swagger/6.7</a>.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_get_token"><a class="anchor" href="/manual.html#rest_api_v2_ex_get_token"></a>4.4.1. Получение OAuth токена</h4> 
       <div class="paragraph"> 
        <p>OAuth токен необходим для выполнения любого метода REST API (кроме случая <a href="/manual.html#rest_api_v2_anonymous">анонимного доступа к REST API</a>). Получить токен можно выполнив POST запрос по адресу</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/oauth/token</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Доступ к данному URL защищен с помощью базовой аутентификации с использованием идентификатора и пароля клиента REST API. Обратите внимание, что это не логин и пароль пользователя приложения. Идентификатор и пароль клиента REST API заданы в свойствах приложения <a href="/manual.html#cuba.rest.client.id">cuba.rest.client.id</a> и <a href="/manual.html#cuba.rest.client.secret">cuba.rest.client.secret</a> (значения по умолчанию для этих свойств: <code>client</code> и <code>secret</code>). Заголовок Authorization запроса на получение токена должен содеражть логин и пароль клиента, разделенные символом ":" и закодированные в base64.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Тип запроса на получение токена должен быть <code>application/x-www-form-urlencoded</code>, кодировка <code>UTF-8</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Запрос должен содержать следующие параметры:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>grant_type</code> - всегда значение <code>password</code>.</p> </li> 
         <li> <p><code>username</code> - логин пользователя приложения.</p> </li> 
         <li> <p><code>password</code> - пароль пользователя приложения.</p> </li> 
        </ul> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="httprequest">POST /oauth/token
Authorization: Basic Y2xpZW50OnNlY3JldA==
Content-Type: application/x-www-form-urlencoded

grant_type=password&amp;username=smith&amp;password=qwerty123</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Метод возвращает JSON объект:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">access_token</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">29bc6b45-83cd-4050-8c7a-2a8a60adf251</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">token_type</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">bearer</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">expires_in</span><span class="delimiter">"</span></span>: <span class="integer">43198</span>,
  <span class="key"><span class="delimiter">"</span><span class="content">scope</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">rest-api</span><span class="delimiter">"</span></span>
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Значение токена содержится в поле <code>access_token</code></p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ldap"><a class="anchor" href="/manual.html#rest_api_v2_ldap"></a>4.4.2. Аутентификация LDAP в REST API</h4> 
       <div class="paragraph"> 
        <p>Для настройки LDAP аутентификации в REST API используются следующие свойства приложения:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>cuba.rest.ldap.enabled</code> - определяет включен ли вход по LDAP логину/паролю.</p> </li> 
         <li> <p><code>cuba.rest.ldap.urls</code> - URL сервера LDAP.</p> </li> 
         <li> <p><code>cuba.rest.ldap.base</code> - base DN поиска имен пользователей.</p> </li> 
         <li> <p><code>cuba.rest.ldap.user</code> - distinguished name системного пользователя, имеющего право на чтение информации из LDAP.</p> </li> 
         <li> <p><code>cuba.rest.ldap.password</code> - пароль системного пользователя, заданного свойством <code>cuba.web.ldap.user</code>.</p> </li> 
         <li> <p><code>cuba.rest.ldap.userLoginField</code> - название атрибута пользователя в LDAP, значение которого соответствует логину пользователя. По умолчанию <code>sAMAccountName</code> (подходит для Active Directory).</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Пример содержимого файла <a href="/manual.html#app_properties_files">local.app.properties</a>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="properties">cuba.rest.ldap.enabled = true
cuba.rest.ldap.urls = ldap://192.168.1.1:389
cuba.rest.ldap.base = ou=Employees,dc=mycompany,dc=com
cuba.rest.ldap.user = cn=System User,ou=Employees,dc=mycompany,dc=com
cuba.rest.ldap.password = system_user_password</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Получить OAuth токен можно выполнив POST запрос по адресу:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/ldap/token</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Доступ к данному URL защищен с помощью базовой аутентификации с использованием идентификатора и пароля клиента REST API. Обратите внимание, что это не логин и пароль пользователя приложения. Идентификатор и пароль клиента REST API заданы в свойствах приложения <a href="/manual.html#cuba.rest.client.id">cuba.rest.client.id</a> и <a href="/manual.html#cuba.rest.client.secret">cuba.rest.client.secret</a> (значения по умолчанию для этих свойств: <code>client</code> и <code>secret</code>). Заголовок <code>Authorization</code> запроса на получение токена должен содержать логин и пароль клиента, разделенные символом ":" и закодированные в base64.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Запрос должен содержать следующие параметры (соответствуют параметрам стандартной аутентификации):</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>grant_type</code> - всегда значение <code>password</code>.</p> </li> 
         <li> <p><code>username</code> - логин пользователя приложения.</p> </li> 
         <li> <p><code>password</code> - пароль пользователя приложения.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Тип запроса на получение токена должен быть <code>application/x-www-form-urlencoded</code>, кодировка <code>UTF-8</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Стандартная аутентификация может быть отключена при помощи свойства <code>cuba.rest.standardAuthenticationEnabled</code>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="properties">cuba.rest.standardAuthenticationEnabled = false</code></pre> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_custom_auth"><a class="anchor" href="/manual.html#rest_api_v2_custom_auth"></a>4.4.3. Собственный механизм аутентификации</h4> 
       <div class="paragraph"> 
        <p>Различные механизмы аутентификации могут предоставлять токен по ключу, по ссылке, по логину и паролю LDAP и т.д. Стандартный механизм аутентификации в REST API изменить нельзя, но можно создать свой механизм. Для этого необходимо создать REST-контроллер, который предоставит свой URL для входа в приложение.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В этом примере мы рассмотрим механизм аутентификации, позволяющий получить OAuth-токен по промо-коду. За основу возьмём приложение, содержащее сущность <code>Coupon</code> (Купон) с атрибутом <code>code</code> (промо-код). Значение этого атрибута мы будем передавать в качестве параметра аутентификации в GET-запросе.</p> 
       </div> 
       <div class="olist arabic"> 
        <ol class="arabic"> 
         <li> <p>Создайте сущность <code>Coupon</code> и добавьте ей атрибут <code>code</code>:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CODE</span><span class="delimiter">"</span></span>, unique = <span class="predefined-constant">true</span>, length = <span class="integer">4</span>)
<span class="directive">protected</span> <span class="predefined-type">String</span> code;</code></pre> 
           </div> 
          </div> </li> 
         <li> <p>Создайте нового <a href="/manual.html#users">пользователя</a> с логином <strong>promo-user</strong>, от лица которого будет выполняться аутентификация по промо-коду.</p> </li> 
         <li> <p>В корневом каталоге модуля <strong>web</strong> (<code>com.company.demo</code>) создайте новый файл конфигурации Spring <code>rest-dispatcher-spring.xml</code> со следующим содержанием:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">"</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">"</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.springframework.org/schema/beans</span> <span class="content">http://www.springframework.org/schema/beans/spring-beans-4.3.xsd</span> <span class="content">http://www.springframework.org/schema/context</span> <span class="content">http://www.springframework.org/schema/context/spring-context-4.3.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.demo.web.rest</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre> 
           </div> 
          </div> </li> 
         <li> <p>Ссылку на этот файл укажите в свойстве приложения <code>cuba.restSpringContextConfig</code> в файле <code>modules/web/src/web-app.properties</code>:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="properties">cuba.restSpringContextConfig = +com/company/demo/rest-dispatcher-spring.xml</code></pre> 
           </div> 
          </div> </li> 
         <li> <p>Создайте пакет <code>rest</code> в корневом каталоге модуля <strong>web</strong>, а в нём - свой контроллер Spring MVC. В контроллере используйте бин <code>OAuthTokenIssuer</code>, который позволяет сгенерировать и выдать REST API токен после аутентификации:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RestController</span>
<span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">"</span><span class="content">auth-code</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AuthCodeController</span> {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> OAuthTokenIssuer oAuthTokenIssuer;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> LoginService loginService;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">Configuration</span> configuration;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> DataManager dataManager;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> MessageTools messageTools;

    <span class="comment">// here we check secret code and issue token using OAuthTokenIssuer</span>
    <span class="annotation">@RequestMapping</span>(method = RequestMethod.GET)
    <span class="directive">public</span> ResponseEntity get(<span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">code</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> authCode) {
        <span class="comment">// obtain system session to be able to call middleware services</span>
        WebAuthConfig webAuthConfig = configuration.getConfig(WebAuthConfig.class);
        UserSession systemSession;
        <span class="keyword">try</span> {
            systemSession = loginService.getSystemSession(webAuthConfig.getTrustedClientPassword());
        } <span class="keyword">catch</span> (<span class="exception">LoginException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">"</span><span class="content">Error during system auth</span><span class="delimiter">"</span></span>);
        }

        <span class="comment">// set security context</span>
        AppContext.setSecurityContext(<span class="keyword">new</span> SecurityContext(systemSession));
        <span class="keyword">try</span> {
            <span class="comment">// find coupon with code</span>
            LoadContext&lt;Coupon&gt; loadContext = LoadContext.create(Coupon.class)
                    .setQuery(LoadContext.createQuery(<span class="string"><span class="delimiter">"</span><span class="content">select c from demo$Coupon c where c.code = :code</span><span class="delimiter">"</span></span>)
                            .setParameter(<span class="string"><span class="delimiter">"</span><span class="content">code</span><span class="delimiter">"</span></span>, authCode));

            <span class="keyword">if</span> (dataManager.load(loadContext) == <span class="predefined-constant">null</span>) {
                <span class="comment">// if coupon is not found - code is incorrect</span>
                <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(<span class="keyword">new</span> ErrorInfo(<span class="string"><span class="delimiter">"</span><span class="content">invalid_grant</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Bad credentials</span><span class="delimiter">"</span></span>), HttpStatus.BAD_REQUEST);
            }

            <span class="comment">// generate token for "promo-user"</span>
            OAuthTokenIssuer.OAuth2AccessTokenResult tokenResult =
                    oAuthTokenIssuer.issueToken(<span class="string"><span class="delimiter">"</span><span class="content">promo-user</span><span class="delimiter">"</span></span>, messageTools.getDefaultLocale(), <span class="predefined-type">Collections</span>.emptyMap());
            OAuth2AccessToken accessToken = tokenResult.getAccessToken();

            <span class="comment">// set security HTTP headers to prevent browser caching of security token</span>
            HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();
            headers.set(HttpHeaders.CACHE_CONTROL, <span class="string"><span class="delimiter">"</span><span class="content">no-store</span><span class="delimiter">"</span></span>);
            headers.set(HttpHeaders.PRAGMA, <span class="string"><span class="delimiter">"</span><span class="content">no-cache</span><span class="delimiter">"</span></span>);
            <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(accessToken, headers, HttpStatus.OK);
        } <span class="keyword">finally</span> {
            <span class="comment">// clean up security context</span>
            AppContext.setSecurityContext(<span class="predefined-constant">null</span>);
        }
    }

    <span class="comment">// POJO for JSON error messages</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">ErrorInfo</span> {
        <span class="directive">private</span> <span class="predefined-type">String</span> error;
        <span class="directive">private</span> <span class="predefined-type">String</span> error_description;

        <span class="directive">public</span> ErrorInfo(<span class="predefined-type">String</span> error, <span class="predefined-type">String</span> error_description) {
            <span class="local-variable">this</span>.error = error;
            <span class="local-variable">this</span>.error_description = error_description;
        }

        <span class="directive">public</span> <span class="predefined-type">String</span> getError() {
            <span class="keyword">return</span> error;
        }

        <span class="directive">public</span> <span class="predefined-type">String</span> getError_description() {
            <span class="keyword">return</span> error_description;
        }
    }
}</code></pre> 
           </div> 
          </div> </li> 
         <li> <p>Исключите пакет <code>rest</code> из сканирования в модулях <strong>web/core</strong>: это необходимо, так как бин <code>OAuthTokenIssuer</code> доступен только внутри контекста REST API, и сканирование его в контексте приложения будет вызывать ошибку.</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.demo</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;context:exclude-filter</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">regex</span><span class="delimiter">"</span></span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">"</span><span class="content">com\.company\.demo\.web\.rest\..*</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/context:component-scan&gt;</span></code></pre> 
           </div> 
          </div> </li> 
         <li> <p>Теперь пользователи могут получать код доступа OAuth2 через обычный запрос GET HTTP, передавая значение промо-кода в параметре <code>code</code>:</p> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>http://localhost:8080/app/rest/auth-code?code=A325</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Результат:</p> 
          </div> 
          <div class="literalblock"> 
           <div class="content"> 
            <pre>{"access_token":"74202587-6c2b-4d74-bcf2-0d687ea85dca","token_type":"bearer","expires_in":43199,"scope":"rest-api"}</pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Теперь полученный access token нужно передавать в REST API, как описано в общей документации.</p> 
          </div> </li> 
        </ol> 
       </div> 
       <div class="sect4"> 
        <h5 id="rest_api_v2_social_login"><a class="anchor" href="/manual.html#rest_api_v2_social_login"></a>4.4.3.1. Social Login в REST API</h5> 
        <div class="paragraph"> 
         <p>Механизм авторизации через социальные сети, или social login, также можно использовать в REST API. Исходный код приложения, описанного в этом примере, доступен на <a href="https://github.com/cuba-platform/sample-social-login/" target="_blank">GitHub</a>, а сам пример описан в разделе <a href="/manual.html#social_login">Social Login</a>. Ниже приведены ключевые моменты этого примера, позволяющие получить OAuth-токен через аккаунт Facebook.</p> 
        </div> 
        <div class="olist arabic"> 
         <ol class="arabic"> 
          <li> <p>Создайте пакет <code>restapi</code> в корневом каталоге модуля <strong>web</strong> и поместите в него собственный контроллер Spring MVC. Контроллер должен содержать два основных метода: <code>get()</code>, возвращающий <code>ResponseEntity</code>, и <code>login()</code>, в котором мы будем получать OAuth-токен.</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="listingblock"> 
              <div class="title">
               <a href="https://github.com/cuba-platform/sample-social-login/blob/master/modules/web/src/com/company/demo/restapi/FacebookAuthenticationController.java" target="_blank">FacebookAuthenticationController.java</a>
              </div> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(method = RequestMethod.GET)
<span class="directive">public</span> ResponseEntity get() {
    <span class="predefined-type">String</span> loginUrl = getAsPrivilegedUser(() -&gt;
            facebookService.getLoginUrl(getAppUrl(), OAuth2ResponseType.CODE_TOKEN)
    );

    HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();
    headers.set(HttpHeaders.LOCATION, loginUrl);
    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(headers, HttpStatus.FOUND);
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Здесь мы проверяем переданный код Facebook, получаем код доступа и издаём токен с помощью <code>OAuthTokenIssuer</code>:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="title">
               <a href="https://github.com/cuba-platform/sample-social-login/blob/master/modules/web/src/com/company/demo/restapi/FacebookAuthenticationController.java" target="_blank">FacebookAuthenticationController.java</a>
              </div> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(method = RequestMethod.POST, value = <span class="string"><span class="delimiter">"</span><span class="content">login</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> ResponseEntity&lt;OAuth2AccessToken&gt; login(<span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">"</span><span class="content">code</span><span class="delimiter">"</span></span>) <span class="predefined-type">String</span> code) {
    User user = getAsPrivilegedUser(() -&gt; {
        FacebookUserData userData = facebookService.getUserData(getAppUrl(), code);

        <span class="keyword">return</span> socialRegistrationService.findOrRegisterUser(
            userData.getId(), userData.getEmail(), userData.getName());
    });

    OAuth2AccessTokenResult tokenResult = oAuthTokenIssuer.issueToken(user.getLogin(),
            messageTools.getDefaultLocale(), <span class="predefined-type">Collections</span>.emptyMap());

    HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();
    headers.set(HttpHeaders.CACHE_CONTROL, <span class="string"><span class="delimiter">"</span><span class="content">no-store</span><span class="delimiter">"</span></span>);
    headers.set(HttpHeaders.PRAGMA, <span class="string"><span class="delimiter">"</span><span class="content">no-cache</span><span class="delimiter">"</span></span>);
    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(tokenResult.getAccessToken(), headers, HttpStatus.OK);
}</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> </li> 
          <li> <p>Исключите пакет <code>restapi</code> из сканирования в модулях <strong>web/core</strong>: это необходимо, так как бин <code>OAuthTokenIssuer</code> доступен только внутри контекста REST API, и сканирование его в контексте приложения будет вызывать ошибку.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.demo</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;context:exclude-filter</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">regex</span><span class="delimiter">"</span></span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">"</span><span class="content">com\.company\.demo\.restapi\..*</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/context:component-scan&gt;</span></code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Создайте файл <code>facebook-login-demo.html</code> в каталоге проекта <code>modules/web/web/VAADIN</code>. Он будет содержать JavaScript-код, выполняющийся на HTML-странице:</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="listingblock"> 
              <div class="title">
               <a href="https://github.com/cuba-platform/sample-social-login/blob/master/modules/web/web/VAADIN/facebook-login-demo.html" target="_blank">facebook-login-demo.html</a>
              </div> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;title&gt;</span>Facebook login demo with REST-API<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="content">jquery-3.2.1.min.js</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;style</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">text/css</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="inline"> <span class="id">#users</span> { <span class="key">display</span>: <span class="value">none</span>; }</span>
    <span class="tag">&lt;/style&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
<span class="tag">&lt;h1&gt;</span>Facebook login demo with REST-API<span class="tag">&lt;/h1&gt;</span>

<span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">application/javascript</span><span class="delimiter">"</span></span><span class="attribute-name">...</span><span class="tag">&gt;</span>
<span class="tag">&lt;/script&gt;</span>

<span class="tag">&lt;a</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fbLink</span><span class="delimiter">"</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">"</span><span class="content">/app/rest/facebook</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>Login with Facebook<span class="tag">&lt;/a&gt;</span>

<span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">users</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    You are logged in!

    <span class="tag">&lt;h1&gt;</span>Users<span class="tag">&lt;/h1&gt;</span>

    <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersList</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span>

<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>В этом скрипте мы попробуем залогиниться через Facebook. Сначала удаляем лишний код из URL, затем передаём код в REST API для получения OAuth-токена, и в случае успешной аутентификации мы сможем загружать и сохранять данные как обычно:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="title">
               <a href="https://github.com/cuba-platform/sample-social-login/blob/master/modules/web/web/VAADIN/facebook-login-demo.html" target="_blank">facebook-login-demo.html</a>
              </div> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="js"><span class="keyword">var</span> oauth2Token = <span class="predefined-constant">null</span>;

<span class="keyword">function</span> <span class="function">tryToLoginWithFacebook</span>() {
    <span class="keyword">var</span> urlHash = window.location.hash;

    <span class="keyword">if</span> (urlHash &amp;&amp; urlHash.indexOf(<span class="string"><span class="delimiter">'</span><span class="content">&amp;code=</span><span class="delimiter">'</span></span>) &gt;= <span class="integer">0</span>) {
        console.log(<span class="string"><span class="delimiter">"</span><span class="content">Try to login to CUBA REST-API!</span><span class="delimiter">"</span></span>);

        <span class="keyword">var</span> urlCode = urlHash.substring(urlHash.indexOf(<span class="string"><span class="delimiter">'</span><span class="content">&amp;code=</span><span class="delimiter">'</span></span>) + <span class="string"><span class="delimiter">'</span><span class="content">&amp;code=</span><span class="delimiter">'</span></span>.length);
        console.log(<span class="string"><span class="delimiter">"</span><span class="content">Facebook code: </span><span class="delimiter">"</span></span> + urlCode);

        history.pushState(<span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span>, document.title, window.location.pathname);

        <span class="predefined">$</span>.post({
            <span class="key">url</span>: <span class="string"><span class="delimiter">'</span><span class="content">/app/rest/facebook/login</span><span class="delimiter">'</span></span>,
            <span class="key">headers</span>: {
                <span class="key"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">'</span></span>
            },
            <span class="key">dataType</span>: <span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>,
            <span class="key">data</span>: {<span class="key">code</span>: urlCode},
            <span class="function">success</span>: <span class="keyword">function</span> (data) {
                oauth2Token = data.access_token;

                loadUsers();
            }
        })
    }
}

<span class="keyword">function</span> <span class="function">loadUsers</span>() {
    <span class="predefined">$</span>.get({
        <span class="key">url</span>: <span class="string"><span class="delimiter">'</span><span class="content">/app/rest/v2/entities/sec$User?view=_local</span><span class="delimiter">'</span></span>,
        <span class="key">headers</span>: {
            <span class="key"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">Bearer </span><span class="delimiter">'</span></span> + oauth2Token,
            <span class="key"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">'</span></span>
        },
        <span class="function">success</span>: <span class="keyword">function</span> (data) {
            <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#fbLink</span><span class="delimiter">'</span></span>).hide();
            <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#users</span><span class="delimiter">'</span></span>).show();

            <span class="predefined">$</span>.each(data, <span class="keyword">function</span> (i, user) {
                <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#usersList</span><span class="delimiter">'</span></span>).append(<span class="string"><span class="delimiter">"</span><span class="content">&lt;li&gt;</span><span class="delimiter">"</span></span> + user.name + <span class="string"><span class="delimiter">"</span><span class="content"> (</span><span class="delimiter">"</span></span> + user.email + <span class="string"><span class="delimiter">"</span><span class="content">)&lt;/li&gt;</span><span class="delimiter">"</span></span>);
            });
        }
    });
}

tryToLoginWithFacebook();</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Другой пример использования JavaScript-кода в приложениях CUBA вы можете найти в разделе <a href="/manual.html#rest_api_v2_ex_javascript_usage">Пример использования из JavaScript</a>.</p> 
             </div> 
            </div> 
           </div> </li> 
         </ol> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_get_entities_list"><a class="anchor" href="/manual.html#rest_api_v2_ex_get_entities_list"></a>4.4.4. Получение списка экземпляров сущности</h4> 
       <div class="paragraph"> 
        <p>Предполжим, в системе имеется сущность <code>sales$Order</code>, и необходимо получить список экземляров этой сущности. При этом, необходимо получить не все записи, а 50 записей, начиная с сотой (для отображения третьей странице в каком-либо списке клиентского приложения). Кроме простых атрибутов сущности <code>sales$Order</code> результат должен содержать данные о клиенте (поле <code>customer</code>). Заказы должны быть отсортированы по дате.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Базовый URL для получения списка экземпляров сущности <code>sales$Order</code>:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/entities/sales$Order</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Для выполнения описанных выше условий необходимо задать параметры запроса:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><strong>view</strong> - <a href="/manual.html#views">представление</a>, с которым должны быть загружены сущности. В нашем примере представление <code>order-edit-view</code> содержит ссылку на <code>customer</code>.</p> </li> 
         <li> <p><strong>limit</strong> - количество возвращаемыех экземпляров.</p> </li> 
         <li> <p><strong>offset</strong> - позиция первого извлеченного элемента.</p> </li> 
         <li> <p><strong>sort</strong> - имя атрибута сущности, по которому будет произведена сортировка.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>OAuth-токен должен быть передан в заголовке запроса <code>Authorization</code> с типом <strong>Bearer</strong>:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>Authorization: Bearer 29bc6b45-83cd-4050-8c7a-2a8a60adf251</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>В итоге получаем следующий <strong>GET</strong> http-запрос:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/entities/sales$Order?view=order-edit-view&amp;limit=50&amp;offset=100&amp;sort=date</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Ответ будет выглядеть следующим образом:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">[
  {
    <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">46322d73-2374-1d65-a5f2-160461da22bf</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-31</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Vacation order</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">items</span><span class="delimiter">"</span></span>: [
      {
        <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Beach umbrella</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">95a04f46-af7a-a307-de4e-f2d73cfc74f7</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="integer">23</span>,
        <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Beach umbrella</span><span class="delimiter">"</span></span>
      },
      {
        <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Sun lotion</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">a2129675-d158-9e3a-5496-41bf1a315917</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="float">9.9</span>,
        <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Sun lotion</span><span class="delimiter">"</span></span>
      }
    ],
    <span class="key"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>: {
      <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Customer</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Toby Burns</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">4aa9a9d8-01df-c8df-34c8-c385b566ea05</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Toby</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Burns</span><span class="delimiter">"</span></span>
    }
  },
  {
    <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00002</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">b2ad3059-384c-3e03-b62d-b8c76621b4a8</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-12-31</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">New Year party set</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00002</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">items</span><span class="delimiter">"</span></span>: [
      {
        <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Jack Daniels</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">0c566c9d-7078-4567-a85b-c67a44f9d5fe</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="float">50.7</span>,
        <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Jack Daniels</span><span class="delimiter">"</span></span>
      },
      {
        <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Hennessy X.O</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">c01be87b-3f91-7a86-50b5-30f2f0a49127</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="float">79.9</span>,
        <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Hennessy X.O</span><span class="delimiter">"</span></span>
      }
    ],
    <span class="key"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>: {
      <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Customer</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Morgan Collins</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">5d111245-2ed0-abec-3bee-1a196da92e3e</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Morgan</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Collins</span><span class="delimiter">"</span></span>
    }
  }
]</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Обратите внимание, что для каждой сущности загружаются атрибуты <code>_entityName</code> с именем сущности и <code>_instanceName</code>, содержащий результат вычисления <a href="/manual.html#namePattern_annotation">короткого имени</a> для сущности.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_create_entity"><a class="anchor" href="/manual.html#rest_api_v2_ex_create_entity"></a>4.4.5. Создание экземпляра сущности</h4> 
       <div class="paragraph"> 
        <p>Для создания нового экземпляра сущности <code>sales$Order</code> необходимо выполнить <strong>POST</strong> запрос по адресу:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/entities/sales$Order</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>OAuth-токен должен быть передан в заголовке запроса <code>Authorization</code> с типом <strong>Bearer</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Тело запроса должно содержать JSON объект, описывающий новый экземпляр, например:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00017</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-09-01</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Back to school</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">items</span><span class="delimiter">"</span></span>: [
    {
      <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="integer">100</span>,
      <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">School bag</span><span class="delimiter">"</span></span>
    },
    {
      <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="float">9.90</span>,
      <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Pencils</span><span class="delimiter">"</span></span>
    }
  ],
  <span class="key"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>: {
    <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">4aa9a9d8-01df-c8df-34c8-c385b566ea05</span><span class="delimiter">"</span></span>
  }
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>В теле запроса передается коллекция позиций заказа <code>items</code> и ссылка на клиента <code>customer</code>. Рассмотрим, как будут обработаны эти атрибуты.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Саначала посмотрим на класс <code>Order</code>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.sales.entity</span>;

<span class="keyword">import</span> <span class="include">com.haulmont.chile.core.annotations.Composition</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.chile.core.annotations.NamePattern</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.entity.StandardEntity</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.entity.annotation.OnDelete</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.global.DeletePolicy</span>;

<span class="keyword">import</span> <span class="include">javax.persistence</span>.*;
<span class="keyword">import</span> <span class="include">java.util.Date</span>;
<span class="keyword">import</span> <span class="include">java.util.Set</span>;

<span class="annotation">@NamePattern</span>(<span class="string"><span class="delimiter">"</span><span class="content">%s|number</span><span class="delimiter">"</span></span>)
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SALES_ORDER</span><span class="delimiter">"</span></span>)
<span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Order</span> <span class="directive">extends</span> StandardEntity {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">7565070704618724997L</span>;

    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">NUMBER_</span><span class="delimiter">"</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> number;

    <span class="annotation">@Temporal</span>(TemporalType.DATE)
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DATE_</span><span class="delimiter">"</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">Date</span> date;

    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DESCRIPTION</span><span class="delimiter">"</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> description;

    <span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY)
    <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CUSTOMER_ID</span><span class="delimiter">"</span></span>)
    <span class="directive">protected</span> Customer customer;

    <span class="annotation">@Composition</span>
    <span class="annotation">@OnDelete</span>(DeletePolicy.CASCADE)
    <span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;OrderItem&gt; items;

    <span class="comment">//getters and setters omitted</span>
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>В сущности <code>Order</code> коллекция <code>items</code> аннотирована <a href="/manual.html#composition_annotation">@Composition</a>. Методы создания и обновления сущности REST API создают новые экземпляры для всех элементов таких коллекций. Т.е. вместе с заказом (<code>Order</code>) будет создано две позиции заказа (<code>OrderItem</code>).</p> 
       </div> 
       <div class="paragraph"> 
        <p>Ссылка <code>customer</code> не имеет аннотации @Composition, поэтому метод REST API попытается найти клиента с переданным идентификатором и проставить его в поле <code>customer</code>. Если клиент не будет найден, заказ не будет создан и метод вернет ошибку.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В случае успеха возвращается полный граф созданной сущности:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">5d7ff8e3-7828-ba94-d6ba-155c5c4f2a50</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-09-01</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Back to school</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">version</span><span class="delimiter">"</span></span>: <span class="integer">1</span>,
  <span class="key"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00017</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">createdBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">createTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 18:12:21.047</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">updateTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 18:12:21.047</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">items</span><span class="delimiter">"</span></span>: [
    {
      <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">3158b8ed-7b7a-568e-aec5-0822c3ebbc24</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">createdBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="float">9.9</span>,
      <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Pencils</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">createTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 18:12:21.047</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">version</span><span class="delimiter">"</span></span>: <span class="integer">1</span>,
      <span class="key"><span class="delimiter">"</span><span class="content">updateTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 18:12:21.047</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span>: {
        <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">5d7ff8e3-7828-ba94-d6ba-155c5c4f2a50</span><span class="delimiter">"</span></span>
      }
    },
    {
      <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">72774b8b-4fea-6403-7b52-4a6a749215fc</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">createdBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="integer">100</span>,
      <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">School bag</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">createTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 18:12:21.047</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">version</span><span class="delimiter">"</span></span>: <span class="integer">1</span>,
      <span class="key"><span class="delimiter">"</span><span class="content">updateTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 18:12:21.047</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span>: {
        <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">5d7ff8e3-7828-ba94-d6ba-155c5c4f2a50</span><span class="delimiter">"</span></span>
      }
    }
  ],
  <span class="key"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>: {
    <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Customer</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">4aa9a9d8-01df-c8df-34c8-c385b566ea05</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Toby</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Burns</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">createdBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">createTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 15:32:01.657</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">version</span><span class="delimiter">"</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">"</span><span class="content">updateTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 15:32:01.657</span><span class="delimiter">"</span></span>
  }
}</code></pre> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_update_entity"><a class="anchor" href="/manual.html#rest_api_v2_ex_update_entity"></a>4.4.6. Изменение существующего экземпляра сущности</h4> 
       <div class="paragraph"> 
        <p>Для изменения экземпляра сущности <code>sales$Order</code> необходимо выполнить <strong>PUT</strong> запрос по адресу:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/entities/sales$Order/5d7ff8e3-7828-ba94-d6ba-155c5c4f2a50</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Последняя часть запроса здесь - это идентификатор изменяемой сущности.</p> 
       </div> 
       <div class="paragraph"> 
        <p>OAuth-токен должен быть передан в заголовке запроса <code>Authorization</code> с типом <strong>Bearer</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В теле запроса необходимо передать JSON объект, содержащий только поля, которые мы хотим изменить, например:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2017-10-01</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span> : {
    <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span> : <span class="string"><span class="delimiter">"</span><span class="content">5d111245-2ed0-abec-3bee-1a196da92e3e</span><span class="delimiter">"</span></span>
  }
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>В теле ответа будет возвращена измененная сущность:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">5d7ff8e3-7828-ba94-d6ba-155c5c4f2a50</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2017-10-01</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">updatedBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Back to school</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">version</span><span class="delimiter">"</span></span>: <span class="integer">2</span>,
  <span class="key"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00017</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">createdBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">createTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 18:12:21.047</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">updateTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 19:13:02.656</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>: {
    <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Customer</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">5d111245-2ed0-abec-3bee-1a196da92e3e</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Morgan</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Collins</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">createdBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">createTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 15:31:27.821</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">version</span><span class="delimiter">"</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">"</span><span class="content">updateTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-13 15:31:27.821</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">email</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">collins@gmail.com</span><span class="delimiter">"</span></span>
  }
}</code></pre> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_query_get"><a class="anchor" href="/manual.html#rest_api_v2_ex_query_get"></a>4.4.7. Выполнение JPQL-запроса (GET)</h4> 
       <div class="paragraph"> 
        <p>Перед выполнением запроса с помощью REST API необходимо описать его в <a href="/manual.html#rest_api_v2_queries_config">конфигурационном файле</a>. В корневом пакете модуля <strong>web</strong> (например, <code>com.company.sales</code>) необходимо создать файл <code>rest-queries.xml</code>. Затем этот файл объявляется в файле свойств приложения модуля <strong>web</strong> (web-app.properties):</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="properties">cuba.rest.queriesConfig = +com/company/sales/rest-queries.xml</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Содержимое файла <code>rest-queries.xml</code>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0"?&gt;</span>
<span class="tag">&lt;queries</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/rest-queries.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;query</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersAfterDate</span><span class="delimiter">"</span></span> <span class="attribute-name">entity</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">order-edit-view</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;jpql&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span>select o from sales$Order o where o.date &gt;= :startDate and o.date &lt;= :endDate<span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/jpql&gt;</span>
        <span class="tag">&lt;params&gt;</span>
            <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">startDate</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">java.util.Date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">endDate</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">java.util.Date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/params&gt;</span>
    <span class="tag">&lt;/query&gt;</span>
<span class="tag">&lt;/queries&gt;</span></code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Для выполнения JPQL запроса, необходимо выполнить <strong>GET</strong> http-запрос к REST API:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/queries/sales$Order/ordersAfterDate?startDate=2016-11-01&amp;endDate=2017-11-01</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Части URL:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>sales$Order</code> - имя извлекаемой сущности.</p> </li> 
         <li> <p><code>ordersAfterDate</code> - имя запроса из конфигурационного файла.</p> </li> 
         <li> <p><code>startDate</code> и <code>endDate</code> - параметры запроса со значениями.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>OAuth-токен должен быть передан в заголовке запроса <code>Authorization</code> с типом <strong>Bearer</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Метод возвращает JSON-массив со списком извлеченных экземпляров сущности:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">[
  {
    <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00002</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">b2ad3059-384c-3e03-b62d-b8c76621b4a8</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-12-31</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">New Year party set</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00002</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">items</span><span class="delimiter">"</span></span>: [
      {
        <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Jack Daniels</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">0c566c9d-7078-4567-a85b-c67a44f9d5fe</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="float">50.7</span>,
        <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Jack Daniels</span><span class="delimiter">"</span></span>
      },
      {
        <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$OrderItem</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Hennessy X.O</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">c01be87b-3f91-7a86-50b5-30f2f0a49127</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">price</span><span class="delimiter">"</span></span>: <span class="float">79.9</span>,
        <span class="key"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Hennessy X.O</span><span class="delimiter">"</span></span>
      }
    ],
    <span class="key"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>: {
      <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Customer</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Morgan Collins</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">5d111245-2ed0-abec-3bee-1a196da92e3e</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Morgan</span><span class="delimiter">"</span></span>,
      <span class="key"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Collins</span><span class="delimiter">"</span></span>
    }
  }
]</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Список других возможных параметров для метода выполнения запросов можно посмотреть в <a href="http://files.cuba-platform.com/swagger/6.7" target="_blank">Swagger документации</a>.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_query_post"><a class="anchor" href="/manual.html#rest_api_v2_ex_query_post"></a>4.4.8. Выполнение JPQL-запроса (POST)</h4> 
       <div class="paragraph"> 
        <p>JPQL-запрос также может быть выполнен с помощью POST-запроса. Это необходимо для случая, когда параметр JPQL-запроса является коллекцией. В файле конфигурации JPQL-запросов для REST API тип параметра-коллекции должен заканчиваться символами <code>[]</code>: <code>java.lang.String[]</code>, <code>java.util.UUID[]</code> и т.п.</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0"?&gt;</span>
<span class="tag">&lt;queries</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/rest-queries.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;query</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersByIds</span><span class="delimiter">"</span></span> <span class="attribute-name">entity</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">order-edit-view</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;jpql&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span>select o from sales$Order o where o.id in :ids and o.status = :status<span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/jpql&gt;</span>
        <span class="tag">&lt;params&gt;</span>
            <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">ids</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">java.util.UUID[]</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">status</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">java.lang.String</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/params&gt;</span>
    <span class="tag">&lt;/query&gt;</span>
<span class="tag">&lt;/queries&gt;</span></code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Параметры JPQL-запроса должны быть переданы в теле HTTP-запроса в JSON map:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">ids</span><span class="delimiter">"</span></span>: [<span class="string"><span class="delimiter">"</span><span class="content">c273fca1-33c2-0229-2a0c-78bc6d09110a</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">e6c04c18-c8a1-b741-7363-a2d58589d800</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">d268a4e1-f316-a7c8-7a96-87ba06afbbbd</span><span class="delimiter">"</span></span>],
  <span class="key"><span class="delimiter">"</span><span class="content">status</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">ready</span><span class="delimiter">"</span></span>
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>URL POST-запроса:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/queries/sales$Order/ordersByIds?returnCount=true</pre> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_service_get"><a class="anchor" href="/manual.html#rest_api_v2_ex_service_get"></a>4.4.9. Вызов метода сервиса (GET)</h4> 
       <div class="paragraph"> 
        <p>Предположим, в системе имеется <a href="/manual.html#services">сервис</a> OrderService, реализация которого выглядит следующим образом:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.sales.service</span>;

<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.EntityManager</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.Persistence</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.Transaction</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Service</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;

<span class="annotation">@Service</span>(OrderService.NAME)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderServiceBean</span> <span class="directive">implements</span> OrderService {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Persistence persistence;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> calculatePrice(<span class="predefined-type">String</span> orderNumber) {
        <span class="predefined-type">BigDecimal</span> orderPrice = <span class="predefined-constant">null</span>;
        <span class="keyword">try</span> (Transaction tx = persistence.createTransaction()) {
            EntityManager em = persistence.getEntityManager();
            orderPrice = (<span class="predefined-type">BigDecimal</span>) em.createQuery(<span class="string"><span class="delimiter">"</span><span class="content">select sum(oi.price) from sales$OrderItem oi where oi.order.number = :orderNumber</span><span class="delimiter">"</span></span>)
                    .setParameter(<span class="string"><span class="delimiter">"</span><span class="content">orderNumber</span><span class="delimiter">"</span></span>, orderNumber)
                    .getSingleResult();
            tx.commit();
        }

        <span class="keyword">return</span> orderPrice;
    }
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Перед выполнением метода сервиса с помощью REST API необходимо разрешить его вызов в <a href="/manual.html#rest_api_v2_services_config">конфигурационном файле</a>. В корневом пакете модуля <strong>web</strong> (например, <code>com.company.sales</code>) необходимо создать файл <code>rest-services.xml</code>. Затем этот файл объявляется в файле свойств приложения модуля <strong>web</strong> (web-app.properties):</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="properties">cuba.rest.servicesConfig = +com/company/sales/rest-services.xml</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Содержимое файла <code>rest-services.xml</code>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="tag">&lt;services</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/rest-services-v2.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_OrderService</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">calculatePrice</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderNumber</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/method&gt;</span>
    <span class="tag">&lt;/service&gt;</span>
<span class="tag">&lt;/services&gt;</span></code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Для вызова метода сервиса, необходимо выполнить <strong>GET</strong> http-запрос к REST API вида:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/services/sales_OrderService/calculatePrice?orderNumber=00001</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Части URL:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>sales_OrderService</code> - имя сервиса</p> </li> 
         <li> <p><code>calculatePrice</code> - имя метода сервиса</p> </li> 
         <li> <p><code>orderNumber</code> - аргумент метода со значением</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>OAuth-токен должен быть передан в заголовке запроса <code>Authorization</code> с типом <strong>Bearer</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Метод сервиса может вернуть как простой тип данных, так и сущность, коллекцию сущностей или произвольный POJO. В нашем случае метод возвращает BigDecimal, поэтому в теле ответа нам вернется число:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>39.2</pre> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_service_post"><a class="anchor" href="/manual.html#rest_api_v2_ex_service_post"></a>4.4.10. Вызов метода сервиса (POST)</h4> 
       <div class="paragraph"> 
        <p>REST API позволяет выполнять методы сервисов, аргументами которых являются не только простые типы, но также:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>сущности</p> </li> 
         <li> <p>коллекции сущностей</p> </li> 
         <li> <p>произвольные POJO</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Небольшой пример. Предположим, в сервис <code>OrderService</code>, созданный в предыдущем разделе, добавлен следующий метод:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> OrderValidationResult validateOrder(Order order, <span class="predefined-type">Date</span> validationDate){
    OrderValidationResult result=<span class="keyword">new</span> OrderValidationResult();
    result.setSuccess(<span class="predefined-constant">false</span>);
    result.setErrorMessage(<span class="string"><span class="delimiter">"</span><span class="content">Validation of order </span><span class="delimiter">"</span></span>+order.getNumber()+<span class="string"><span class="delimiter">"</span><span class="content"> failed. validationDate parameter is: </span><span class="delimiter">"</span></span>+validationDate);
    <span class="keyword">return</span> result;
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Класс <code>OrderValidationResult</code> выглядит следующим образом:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.sales.service</span>;

<span class="keyword">import</span> <span class="include">java.io.Serializable</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderValidationResult</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="type">boolean</span> success;

    <span class="directive">private</span> <span class="predefined-type">String</span> errorMessage;

    <span class="directive">public</span> <span class="type">boolean</span> isSuccess() {
        <span class="keyword">return</span> success;
    }

    <span class="directive">public</span> <span class="type">void</span> setSuccess(<span class="type">boolean</span> success) {
        <span class="local-variable">this</span>.success = success;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getErrorMessage() {
        <span class="keyword">return</span> errorMessage;
    }

    <span class="directive">public</span> <span class="type">void</span> setErrorMessage(<span class="predefined-type">String</span> errorMessage) {
        <span class="local-variable">this</span>.errorMessage = errorMessage;
    }
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Новый метод сервиса принимает сущность <code>Order</code> в качестве первого аргумента и возвращает POJO.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Перед вызовом данного метода с помощью REST API необходимо разрешить его, добавив запись в конфигурационный файл <code>rest-services.xml</code> (его создание было рассмотрено в <a href="/manual.html#rest_api_v2_ex_service_get">Вызов метода сервиса (GET)</a>):</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="tag">&lt;services</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/rest-services-v2.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_OrderService</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">calculatePrice</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderNumber</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/method&gt;</span>
        <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">validateOrder</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">validationDate</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/method&gt;</span>
    <span class="tag">&lt;/service&gt;</span>
<span class="tag">&lt;/services&gt;</span></code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Метод <code>validateOrder</code> сервиса вызвается <strong>POST</strong> запросом по адресу:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/services/sales_OrderService/validateOrder</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Параметры в случае POST передаются в теле запроса в JSON объекте. Каждое поле JSON объекта соответствует аргументу метода сервиса:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span> : {
    <span class="key"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00050</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span> : <span class="string"><span class="delimiter">"</span><span class="content">2016-01-01</span><span class="delimiter">"</span></span>
  },
  <span class="key"><span class="delimiter">"</span><span class="content">validationDate</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-01</span><span class="delimiter">"</span></span>
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>OAuth-токен должен быть передан в заголовке запроса <code>Authorization</code> с типом <strong>Bearer</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Метод вернет сериализованный POJO:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">success</span><span class="delimiter">"</span></span>: <span class="value">false</span>,
  <span class="key"><span class="delimiter">"</span><span class="content">errorMessage</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Validation of order 00050 failed. validationDate parameter is: 2016-10-01</span><span class="delimiter">"</span></span>
}</code></pre> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_file_download"><a class="anchor" href="/manual.html#rest_api_v2_ex_file_download"></a>4.4.11. Скачивание файлов</h4> 
       <div class="paragraph"> 
        <p>При <a href="http://files.cuba-platform.com/swagger/6.7/#!/Files/get_files_id" target="_blank">скачивании файла</a> передавать токен в заголовке запроса часто оказывается неудобно. Хочется иметь URL для скачивания, который можно подставить например в атрибут <strong>src</strong> тега <strong>img</strong>. В этом случае передача OAuth-токена возможна в самом запросе в параметре с именем <strong>access_token</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Например, в систему загружено изображение. Идентификатор соответствующего FileDescriptor - <code>44809679-e81c-e5ae-dd81-f56f223761d6</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В этом случае URL для загрузки изображения будет выглядеть так:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/files/44809679-e81c-e5ae-dd81-f56f223761d6?access_token=a2f0bb4e-773f-6b59-3450-3934cbf0a2d6</pre> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_file_upload"><a class="anchor" href="/manual.html#rest_api_v2_ex_file_upload"></a>4.4.12. Загрузка файлов</h4> 
       <div class="paragraph"> 
        <p>Для загрузки файлов вам нужно получить <a href="/manual.html#rest_api_v2_ex_get_token">OAuth-токен</a>, который понадобится в дальнейших запросах.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Используем простую форму для загрузки:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;form</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fileForm</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;h2&gt;</span>Select a file:<span class="tag">&lt;/h2&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">file</span><span class="delimiter">"</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">file</span><span class="delimiter">"</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fileUpload</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;br</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">submit</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>Upload<span class="tag">&lt;/button&gt;</span>
<span class="tag">&lt;/form&gt;</span>

<span class="tag">&lt;h2&gt;</span>Result:<span class="tag">&lt;/h2&gt;</span>
<span class="tag">&lt;img</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">uploadedFile</span><span class="delimiter">"</span></span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">"</span><span class="key">display</span>: <span class="value">none</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Далее используем jQuery, чтобы получить JSON с объектом <a href="http://files.cuba-platform.com/swagger/6.7/#!/Files/post_files" target="_blank">data</a>, который, по сути, представляет собой новый <code>FileDescriptor</code>. Использовать загруженный файл мы можем по идентификатору созданного экземпляра <code>FileDescriptor</code> с токеном в качестве параметра:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="js"><span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#fileForm</span><span class="delimiter">'</span></span>).submit(<span class="keyword">function</span> (e) {
    e.preventDefault();

    <span class="keyword">var</span> file = <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#fileUpload</span><span class="delimiter">'</span></span>)[<span class="integer">0</span>].files[<span class="integer">0</span>];
    <span class="keyword">var</span> url = <span class="string"><span class="delimiter">'</span><span class="content">http://localhost:8080/app/rest/v2/files?name=</span><span class="delimiter">'</span></span> + file.name; <span class="comment">// send file name as parameter</span>

    <span class="predefined">$</span>.ajax({
        <span class="key">type</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
        <span class="key">url</span>: url,
        <span class="key">headers</span>: {
            <span class="key"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">Bearer </span><span class="delimiter">'</span></span> + oauthToken <span class="comment">// add header with access token</span>
        },
        <span class="key">processData</span>: <span class="predefined-constant">false</span>,
        <span class="key">contentType</span>: <span class="predefined-constant">false</span>,
        <span class="key">dataType</span>: <span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>,
        <span class="key">data</span>: file,
        <span class="function">success</span>: <span class="keyword">function</span> (data) {
            alert(<span class="string"><span class="delimiter">'</span><span class="content">Upload successful</span><span class="delimiter">'</span></span>);

            <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#uploadedFile</span><span class="delimiter">'</span></span>).attr(<span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>,
                <span class="string"><span class="delimiter">'</span><span class="content">http://localhost:8080/app/rest/v2/files/</span><span class="delimiter">'</span></span> + data.id + <span class="string"><span class="delimiter">'</span><span class="content">?access_token=</span><span class="delimiter">'</span></span> + oauthToken); <span class="comment">// update image url</span>
            <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#uploadedFile</span><span class="delimiter">'</span></span>).show();
        }
    });
});</code></pre> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_javascript_usage"><a class="anchor" href="/manual.html#rest_api_v2_ex_javascript_usage"></a>4.4.13. Пример использования из JavaScript</h4> 
       <div class="paragraph"> 
        <p>В данном разделе приведен пример использования REST API v2 из JavaScript, выполняющегося на HTML-странице. На странице изначально отображается форма логина, а после успешного входа - соответствующее сообщение и список сущностей.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Для простоты, в данном примере для хранения файлов HTML/CSS/JavaScript используется каталог <code>modules/web/web/VAADIN</code>, так как соответствующий каталог развернутого веб-приложения используется для выдачи статических ресурсов. Поэтому никаких настроек на сервере Tomcat делать не требуется. Результирующий URL будет начинаться с <code>http://localhost:8080/app/VAADIN</code>, так что данный вариант не стоит использовать в реальном приложении, вместо этого создайте отдельное веб-приложение со своим контекстом.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Загрузите <a href="https://jquery.com/download" target="_blank">jQuery</a> и <a href="http://getbootstrap.com/getting-started/#download" target="_blank">Bootstrap</a> и скопируйте в каталог <code>modules/web/web/VAADIN</code> вашего проекта. Создайте файлы <code>customers.html</code> и <code>customers.js</code>, так что содержимое каталога должно быть примерно таким:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="plain">bootstrap.min.css
customers.html
customers.js
jquery-3.1.1.min.js</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Содержимое файла <code>customers.html</code>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;html&gt;</span>
    <span class="tag">&lt;head&gt;</span>
        <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">text/javascript</span><span class="delimiter">"</span></span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="content">jquery-3.1.1.min.js</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">"</span><span class="content">stylesheet</span><span class="delimiter">"</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">"</span><span class="content">bootstrap.min.css</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/head&gt;</span>
    <span class="tag">&lt;body&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">"</span><span class="key">width</span>: <span class="float">300px</span>; <span class="key">margin</span>: <span class="value">auto</span>;<span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;h1&gt;</span>Sales<span class="tag">&lt;/h1&gt;</span>

            <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">loggedInStatus</span><span class="delimiter">"</span></span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">"</span><span class="key">display</span>: <span class="value">none</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">alert alert-success</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                Logged in successfully
            <span class="tag">&lt;/div&gt;</span>
            <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">loginForm</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">form-group</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;label</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">"</span><span class="content">loginField</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>Login:<span class="tag">&lt;/label&gt;</span>
                    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">form-control</span><span class="delimiter">"</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">loginField</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;/div&gt;</span>
                <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">form-group</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;label</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">"</span><span class="content">passwordField</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>Password:<span class="tag">&lt;/label&gt;</span>
                    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">password</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">form-control</span><span class="delimiter">"</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">passwordField</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;/div&gt;</span>
                <span class="tag">&lt;button</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">submit</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">btn btn-default</span><span class="delimiter">"</span></span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">"</span>login()<span class="delimiter">"</span></span><span class="tag">&gt;</span>Submit<span class="tag">&lt;/button&gt;</span>
            <span class="tag">&lt;/div&gt;</span>

            <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customers</span><span class="delimiter">"</span></span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">"</span><span class="key">display</span>: <span class="value">none</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;h2&gt;</span>Customers<span class="tag">&lt;/h2&gt;</span>
                <span class="tag">&lt;ul</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersList</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/ul&gt;</span>
            <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">text/javascript</span><span class="delimiter">"</span></span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="content">customers.js</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Содержимое файла <code>customers.js</code>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="javascript"><span class="keyword">var</span> oauthToken = <span class="predefined-constant">null</span>;
<span class="keyword">function</span> <span class="function">login</span>() {
    <span class="keyword">var</span> userLogin = <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#loginField</span><span class="delimiter">'</span></span>).val();
    <span class="keyword">var</span> userPassword = <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#passwordField</span><span class="delimiter">'</span></span>).val();
    <span class="predefined">$</span>.post({
        <span class="key">url</span>: <span class="string"><span class="delimiter">'</span><span class="content">http://localhost:8080/app/rest/v2/oauth/token</span><span class="delimiter">'</span></span>,
        <span class="key">headers</span>: {
            <span class="key"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">Basic Y2xpZW50OnNlY3JldA==</span><span class="delimiter">'</span></span>,
            <span class="key"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">'</span></span>
        },
        <span class="key">dataType</span>: <span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>,
        <span class="key">data</span>: {<span class="key">grant_type</span>: <span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>, <span class="key">username</span>: userLogin, <span class="key">password</span>: userPassword},
        <span class="function">success</span>: <span class="keyword">function</span> (data) {
            oauthToken = data.access_token;
            <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#loggedInStatus</span><span class="delimiter">'</span></span>).show();
            <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#loginForm</span><span class="delimiter">'</span></span>).hide();
            loadCustomers();
        }
    })
}

<span class="keyword">function</span> <span class="function">loadCustomers</span>() {
    <span class="predefined">$</span>.get({
        <span class="key">url</span>: <span class="string"><span class="delimiter">'</span><span class="content">http://localhost:8080/app/rest/v2/entities/sales$Customer?view=_local</span><span class="delimiter">'</span></span>,
        <span class="key">headers</span>: {
            <span class="key"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">Bearer </span><span class="delimiter">'</span></span> + oauthToken,
            <span class="key"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">'</span></span>
        },
        <span class="function">success</span>: <span class="keyword">function</span> (data) {
            <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#customers</span><span class="delimiter">'</span></span>).show();
            <span class="predefined">$</span>.each(data, <span class="keyword">function</span> (i, customer) {
                <span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#customersList</span><span class="delimiter">'</span></span>).append(<span class="string"><span class="delimiter">"</span><span class="content">&lt;li&gt;</span><span class="delimiter">"</span></span> + customer.name + <span class="string"><span class="delimiter">"</span><span class="content"> (</span><span class="delimiter">"</span></span> + customer.email + <span class="string"><span class="delimiter">"</span><span class="content">)&lt;/li&gt;</span><span class="delimiter">"</span></span>);
            });
        }
    });
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Имя пользователя и пароль из полей ввода передаётся на сервер POST-запросом с закодированными Base64 клиентскими именем и паролем в заголовке <code>Authorization</code>, как описано в разделе <a href="/manual.html#rest_api_v2_ex_get_token">Получение OAuth токена</a>. В случае успешной аутентификации, страница получает с сервера значение токена доступа, токен записывается в переменную <code>oauthToken</code>, скрывается блок <code>loginForm</code> и отображается блок <code>loggedInStatus</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Чтобы отобразить список покупателей, на сервер отправляется <a href="/manual.html#rest_api_v2_ex_get_entities_list">запрос на получение списка экземпляров</a> сущности <code>sales$Customer</code>, передавая значение <code>oauthToken</code> в заголовке <code>Authorization</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Если запрос выполнен, блок <code>customers</code> отображается на экране, и маркированный список <code>customersList</code> заполняется элементами, содержащими значения атрибутов name и email сущности Customer.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/rest_js_1.png" alt="rest js 1"> 
        </div> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/rest_js_2.png" alt="rest js 2"> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_localized_messages"><a class="anchor" href="/manual.html#rest_api_v2_ex_localized_messages"></a>4.4.14. Получение локализованных сообщений</h4> 
       <div class="paragraph"> 
        <p>REST API позволяет получить локализованные заголовки для сущностей, перечислений и их атрибутов.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Например, чтобы получить локализованные сообщения для сущности <code>sec$User</code>, необходимо выполнить следующий <strong>GET</strong> запрос:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/messages/entities/sec$User</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>OAuth-токен должен быть передан в заголовке запроса <code>Authorization</code> с типом <strong>Bearer</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Явно указать локаль запроса можно с помощью http-заголовка <strong>Accept-Language</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Ответ будет выглядеть следующим образом:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">User</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.active</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Active</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.changePasswordAtNextLogon</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Change Password at Next Logon</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.createTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Created At</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.createdBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Created By</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.deleteTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Deleted At</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.deletedBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Deleted By</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.email</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Email</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.firstName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">First Name</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.group</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Group</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">ID</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.ipMask</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Permitted IP Mask</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.language</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Language</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.lastName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Last Name</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.login</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Login</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.loginLowerCase</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Login</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.middleName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Middle Name</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.name</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Name</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.password</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Password</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.position</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Position</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.substitutions</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Substitutions</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.timeZone</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Time Zone</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.timeZoneAuto</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Autodetect Time Zone</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.updateTs</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Updated At</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.updatedBy</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Updated By</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.userRoles</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">User Roles</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">sec$User.version</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Version</span><span class="delimiter">"</span></span>
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Для получения списка локализованных сообщений для перечисления используется следующий запрос:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/messages/enums/com.haulmont.cuba.security.entity.RoleType</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Если из URL убрать часть с именем сущности или перечисления, то будут возвращены локализованные сообщения для всех сущностей или перечислений.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_json_transformations"><a class="anchor" href="/manual.html#rest_api_v2_ex_json_transformations"></a>4.4.15. Примеры версионирования модели данных</h4> 
       <div class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Атрибут сущности переименован
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Предположим, атрибут <code>oldNumber</code> сущности <code>sales$Order</code> был переименован в <code>newNumber</code>, а атрибут <code>date</code> был переименован в <code>deliveryDate</code>. В этом случае конфигурация трансформации будет выглядеть следующим образом:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0"?&gt;</span>
<span class="tag">&lt;transformations</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/rest-json-transformations.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transformation</span> <span class="attribute-name">modelVersion</span>=<span class="string"><span class="delimiter">"</span><span class="content">1.0</span><span class="delimiter">"</span></span> <span class="attribute-name">currentEntityName</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;renameAttribute</span> <span class="attribute-name">oldName</span>=<span class="string"><span class="delimiter">"</span><span class="content">oldNumber</span><span class="delimiter">"</span></span> <span class="attribute-name">currentName</span>=<span class="string"><span class="delimiter">"</span><span class="content">newNumber</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;renameAttribute</span> <span class="attribute-name">oldName</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span> <span class="attribute-name">currentName</span>=<span class="string"><span class="delimiter">"</span><span class="content">deliveryDate</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/transformation&gt;</span>
    ...
<span class="tag">&lt;/transformations&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Если клиентскому приложению необходимо работать со старой версии сущности <code>sales$Order</code>, то приложение должно передать значение версии модели данных в параметре URL <code>modelVersion</code>:</p> 
            </div> 
            <div class="literalblock"> 
             <div class="content"> 
              <pre>http://localhost:8080/app/rest/v2/entities/sales$Order/c838be0a-96d0-4ef4-a7c0-dff348347f93?modelVersion=1.0</pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Будет возвращен следующий результат:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">46322d73-2374-1d65-a5f2-160461da22bf</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-31</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Vacation order</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">oldNumber</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Видим, что ответ содержит атрибуты <code>oldNumber</code> и <code>date</code>, хотя сущность в последней версии приложения уже имеет переименованные атрибуты <code>newNumber</code> и <code>deliveryDate</code>.</p> 
            </div> 
           </div> 
          </div> 
         </dd> 
         <dt class="hdlist1">
          Имя сущности изменено
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Предположим, что в одном из следующих релизов приложения имя сущности <code>sales$Order</code> также было изменено. Новое имя сущности теперь <code>sales$NewOrder</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Конфиг трансформации для версии <code>1.1</code> выглядит так:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0"?&gt;</span>
<span class="tag">&lt;transformations</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/rest-json-transformations.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transformation</span> <span class="attribute-name">modelVersion</span>=<span class="string"><span class="delimiter">"</span><span class="content">1.1</span><span class="delimiter">"</span></span> <span class="attribute-name">oldEntityName</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span> <span class="attribute-name">currentEntityName</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales$NewOrder</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;renameAttribute</span> <span class="attribute-name">oldName</span>=<span class="string"><span class="delimiter">"</span><span class="content">oldNumber</span><span class="delimiter">"</span></span> <span class="attribute-name">currentName</span>=<span class="string"><span class="delimiter">"</span><span class="content">newNumber</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/transformation&gt;</span>
    ...
<span class="tag">&lt;/transformations&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В дополнение к конфигу из предыдущего примера здесь появился атрибут <code>oldEntityName</code>. Он описывает имя сущности, действительное для версии модели данных <code>1.1</code>. Атрибут <code>currentEntityName</code> описывает текущее имя сущности.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Хотя сущность с именем <code>sales$Order</code> более не существует, следующий запрос будет работать:</p> 
            </div> 
            <div class="literalblock"> 
             <div class="content"> 
              <pre>http://localhost:8080/app/rest/v2/entities/sales$Order/c838be0a-96d0-4ef4-a7c0-dff348347f93?modelVersion=1.1</pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Контроллер REST API поймет, что поиск должен быть осуществлен среди экземпляров сущности <code>sales$NewOrder</code>, и после того, как сущность с заданным ID будет найдена, имя сущности и имя атрибута <code>newNumber</code> будут заменены в JSON:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">46322d73-2374-1d65-a5f2-160461da22bf</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-31</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Vacation order</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">oldNumber</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Клиентское приложение также может использовать старую версию модели данных для создания или изменения сущности.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Этот <strong>POST</strong> запрос использует старое имя сущности и имеет JSON в старом формате в теле запроса, однако, запрос будет работать:</p> 
            </div> 
            <div class="literalblock"> 
             <div class="content"> 
              <pre>http://localhost:8080/app/rest/v2/entities/sales$Order</pre> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">46322d73-2374-1d65-a5f2-160461da22bf</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-31</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Vacation order</span><span class="delimiter">"</span></span>,
  <span class="key"><span class="delimiter">"</span><span class="content">oldNumber</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>
}</code></pre> 
             </div> 
            </div> 
           </div> 
          </div> 
         </dd> 
         <dt class="hdlist1">
          Атрибут должен быть удален из JSON
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Иногда может возникнуть ситуация, когда в сущность был добавлен новый атрибут, но клиент, работающий со старой версией модели данных, не должен получать этот атрибут при запросе к сущности. В этом случае стандартный JSON трансформер может удалить атрибут из результата.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Конфиг трансформации для данного случае выглядит примерно так:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0"?&gt;</span>
<span class="tag">&lt;transformations</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/rest-json-transformations.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;transformation</span> <span class="attribute-name">modelVersion</span>=<span class="string"><span class="delimiter">"</span><span class="content">1.5</span><span class="delimiter">"</span></span> <span class="attribute-name">currentEntityName</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;toVersion&gt;</span>
            <span class="tag">&lt;removeAttribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">discount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/toVersion&gt;</span>
    <span class="tag">&lt;/transformation&gt;</span>
    ...
<span class="tag">&lt;/transformations&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Описание трансформации здесь содержит тег <code>toVersion</code> с вложенной командой <code>removeAttribute</code>. Это значит, что при выполнении трасформации из текущей версии модели данных к определенной версии (например, при запросе списка сущностей) атрибут <code>discount</code> будет удален из JSON.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если выполнить запрос к REST API без атрибута <code>modelVersion</code>, то атрибут <code>discount</code> будет возвращен.</p> 
            </div> 
            <div class="literalblock"> 
             <div class="content"> 
              <pre>http://localhost:8080/app/rest/v2/entities/sales$Order/c838be0a-96d0-4ef4-a7c0-dff348347f93</pre> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">46322d73-2374-1d65-a5f2-160461da22bf</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">deliveryDate</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-31</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Vacation order</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">discount</span><span class="delimiter">"</span></span>: <span class="integer">50</span>
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Если указать <code>modelVersion</code> в запросе, то атрибут <code>discount</code> будет удален:</p> 
            </div> 
            <div class="literalblock"> 
             <div class="content"> 
              <pre>http://localhost:8080/app/rest/v2/entities/sales$Order/c838be0a-96d0-4ef4-a7c0-dff348347f93?modelVersion=1.1</pre> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">"</span><span class="content">_entityName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">sales$Order</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">_instanceName</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">46322d73-2374-1d65-a5f2-160461da22bf</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">deliveryDate</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">2016-10-31</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Vacation order</span><span class="delimiter">"</span></span>,
    <span class="key"><span class="delimiter">"</span><span class="content">oldNumber</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">00001</span><span class="delimiter">"</span></span>
}</code></pre> 
             </div> 
            </div> 
           </div> 
          </div> 
         </dd> 
         <dt class="hdlist1">
          Использование кастомных трансформеров
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Вы также можете создать и зарегистрировать свой собственный трансформер JSON. В качестве примера рассмотрим следующую ситуацию.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Сущность <code>sales$OldOrder</code> была переименована в <code>sales$NewOrder</code>. В сущности имеется поле <code>orderDate</code> с типом дата. В старой версии сущности это поле содержало часть со временем, в новой версии сущности часть со временем в поле отсутствует. Клиент REST API, запрашивающий сущность со старой версией модели данных <code>1.0</code> ожидает, что дата будет иметь часть со временем. Получается, что JSON трансформер должен изменить значение в JSON.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Так будет выглядеть конфигурация трансформации для данного случая:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0"?&gt;</span>
<span class="tag">&lt;transformations</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/rest-json-transformations.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;transformation</span> <span class="attribute-name">modelVersion</span>=<span class="string"><span class="delimiter">"</span><span class="content">1.0</span><span class="delimiter">"</span></span> <span class="attribute-name">oldEntityName</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales$OldOrder</span><span class="delimiter">"</span></span> <span class="attribute-name">currentEntityName</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales$NewOrder</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;custom&gt;</span>
            <span class="tag">&lt;fromVersion</span> <span class="attribute-name">transformerBeanRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_OrderJsonTransformerFromVersion</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;toVersion</span> <span class="attribute-name">transformerBeanRef</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_OrderJsonTransformerToVersion</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/custom&gt;</span>
    <span class="tag">&lt;/transformation&gt;</span>

    ...
<span class="tag">&lt;/transformations&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Конфигурация содержит элемент <code>custom</code> с вложенными элементами <code>toVersion</code> и <code>fromVersion</code>. Эти элементы содержат ссылки на бины, т.е. кастомный трансформер должен быть зарегистрирован как Spring bean.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Важная деталь: в кастомном трансформере возможно потребуется использовать бин платформы <code>RestTransformations</code> (он предоставляет доступ к транформерам для других сущностей). Но бин <code>RestTransformations</code> зарегистрирован в Spring контексте сервлета REST API, а не в главном контексте веб-приложения. Это значит, что бин кастомного трансформера также должен быть зарегистрирован в контексте REST API.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Как это сделать. Во-первых, создайте файл <code>rest-dispatcher-spring.xml</code> в модуле <strong>web</strong> или <strong>portal</strong> (например в пакете <code>com.company.test</code>).</p> 
            </div> 
            <div class="paragraph"> 
             <p>Затем зарегистрируйте этот файл в файле свойств <code>app.properties</code> соответствующего модуля.</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="properties">cuba.restSpringContextConfig = +com/company/test/rest-dispatcher-spring.xml</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Файл <code>rest-dispatcher-spring.xml</code> должен содержать определения бинов для кастомных трансформеров:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">"</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_OrderJsonTransformerFromVersion</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.test.transformer.OrderJsonTransformerFromVersion</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_OrderJsonTransformerToVersion</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.test.transformer.OrderJsonTransformerToVersion</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Исходный код бина <code>sales_OrderJsonTransformerToVersion</code>:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.test.transformer</span>;

<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.databind.JsonNode</span>;
<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.databind.ObjectMapper</span>;
<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.databind.node.ObjectNode</span>;
<span class="keyword">import</span> <span class="include">com.google.common.base.Strings</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.restapi.transform.AbstractEntityJsonTransformer</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.restapi.transform.JsonTransformationDirection</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderJsonTransformerToVersion</span> <span class="directive">extends</span> AbstractEntityJsonTransformer {

    <span class="directive">public</span> RepairJsonTransformerToVersion() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">"</span><span class="content">sales$NewOrder</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">sales$OldOrder</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">1.0</span><span class="delimiter">"</span></span>, JsonTransformationDirection.TO_VERSION);
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> doCustomTransformations(ObjectNode rootObjectNode, ObjectMapper objectMapper) {
        JsonNode orderDateNode = rootObjectNode.get(<span class="string"><span class="delimiter">"</span><span class="content">orderDate</span><span class="delimiter">"</span></span>);
        <span class="keyword">if</span> (orderDateNode != <span class="predefined-constant">null</span>) {
            <span class="predefined-type">String</span> orderDateNodeValue = orderDateNode.asText();
            <span class="keyword">if</span> (!Strings.isNullOrEmpty(orderDateNodeValue))
                rootObjectNode.put(<span class="string"><span class="delimiter">"</span><span class="content">orderDate</span><span class="delimiter">"</span></span>, orderDateNodeValue + <span class="string"><span class="delimiter">"</span><span class="content"> 00:00:00.000</span><span class="delimiter">"</span></span>);
        }
    }
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Данный трансформер находит элемент <code>orderDate</code> в JSON и изменяет значение элемента, добавляя к нему часть со временем.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Когда сущность <code>sales$Order</code> будет запрошена с версией модели данных <code>1.0</code>, то JSON результат будет содержать сущность, поле <code>orderDate</code> которой содержит часть со временем, хотя текущий тип поля сущности - дата без времени.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Несколько слов о кастомных трансформерах. Они должны реализовывать интерфейс <code>EntityJsonTransformer</code>. Вы также можете отнаследоваться от класса <code>AbstractEntityJsonTransformer</code> и переопределить его метод <code>doCustomTransformations</code>. Класс <code>AbstractEntityJsonTransformer</code> содержит функциональность стандартных трансформеров.</p> 
            </div> 
           </div> 
          </div> 
         </dd> 
        </dl> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="rest_api_v2_ex_search_filter"><a class="anchor" href="/manual.html#rest_api_v2_ex_search_filter"></a>4.4.16. Поиск сущностей с фильтром</h4> 
       <div class="paragraph"> 
        <p>REST API даёт возможность искать экземпляры сущностей по определенным условиям.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Примеры мы рассмотрим на модели данных, состоящей из двух сущностей:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><strong>Author</strong> с двумя полями: <code>lastName</code> и <code>firstName</code></p> </li> 
         <li> <p><strong>Book</strong> с тремя полями: <code>title</code> (String), <code>author</code> (Author) и <code>publicationYear</code> (Integer)</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Чтобы выполнить поиск с фильром URL должен выглядеть следующим образом:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>http://localhost:8080/app/rest/v2/entities/test$Book/search</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Условия поиска должны быть переданы в параметре <code>filter</code>. <code>filter</code> - это JSON объект, который содержит набор условий поиска. Если поиск выполняется с помощью GET запроса, то параметр <code>filter</code> передается в URL.</p> 
       </div> 
       <div class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Пример 1
         </dt> 
         <dd> 
          <p>Необходимо найти все книги, опубликованные в 2007 году с именем автора, начинающимся с "Alex". JSON фильтр для подобного условия будет выглядеть так:</p> 
         </dd> 
        </dl> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">"</span><span class="content">conditions</span><span class="delimiter">"</span></span>: [
        {
            <span class="key"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">author.firstName</span><span class="delimiter">"</span></span>,
            <span class="key"><span class="delimiter">"</span><span class="content">operator</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">startsWith</span><span class="delimiter">"</span></span>,
            <span class="key"><span class="delimiter">"</span><span class="content">value</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Alex</span><span class="delimiter">"</span></span>
        },
        {
            <span class="key"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">publicationDate</span><span class="delimiter">"</span></span>,
            <span class="key"><span class="delimiter">"</span><span class="content">operator</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span>,
            <span class="key"><span class="delimiter">"</span><span class="content">value</span><span class="delimiter">"</span></span>: <span class="integer">2007</span>
        }
    ]
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>По умолчанию все критерии поиска применяются с условием И.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Данный пример также демонстрирует возможность использования вложенных свойств объекта (<code>author.firstName</code>).</p> 
       </div> 
       <div class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Пример 2
         </dt> 
         <dd> 
          <p>Следующий пример показывает две вещи: как выполнять поиск с помощью POST запроса и как использовать группы ИЛИ. В случае POST все параметры должны быть переданы в JSON объекте в теле запроса. Условия поиска должны быть помещены в поле объекта с именем <code>filter</code>. Остальные параметры (имя view, количество выгружаемых сущностей и т.п.) должы быть попомещны в поля объекта с соответствующими именами:</p> 
         </dd> 
        </dl> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">"</span><span class="content">filter</span><span class="delimiter">"</span></span>: {
    <span class="key"><span class="delimiter">"</span><span class="content">conditions</span><span class="delimiter">"</span></span>: [
      {
        <span class="key"><span class="delimiter">"</span><span class="content">group</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">OR</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">conditions</span><span class="delimiter">"</span></span>: [
          {
            <span class="key"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">author.lastName</span><span class="delimiter">"</span></span>,
            <span class="key"><span class="delimiter">"</span><span class="content">operator</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">contains</span><span class="delimiter">"</span></span>,
            <span class="key"><span class="delimiter">"</span><span class="content">value</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Stev</span><span class="delimiter">"</span></span>
          },
          {
            <span class="key"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">author.lastName</span><span class="delimiter">"</span></span>,
            <span class="key"><span class="delimiter">"</span><span class="content">operator</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span>,
            <span class="key"><span class="delimiter">"</span><span class="content">value</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Dumas</span><span class="delimiter">"</span></span>
          }
        ]
      },
      {
        <span class="key"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">publicationDate</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">operator</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">=</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">in</span><span class="delimiter">"</span></span>: [<span class="integer">2007</span>, <span class="integer">2008</span>]
      }
    ]
  },
  <span class="key"><span class="delimiter">"</span><span class="content">view</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">book-view</span><span class="delimiter">"</span></span>
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>В этом примере коллекция <code>conditions</code> содержит не только объекты с критериями поиска, но и группу ИЛИ (OR). Итоговое условие можно представить так:</p> 
       </div> 
       <div class="literalblock"> 
        <div class="content"> 
         <pre>((author.lastName contains Stev) OR (author.lastName = Duma) AND (publicationDate in [2007, 2008]))</pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Обратите внимание, что параметр <code>view</code> также передан в теле запроса.</p> 
       </div> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="misc_recipes"><a class="anchor" href="/manual.html#misc_recipes"></a>4.5. Разное</h3> 
      <div class="paragraph"> 
       <p>В данном разделе собраны рецепты, которые сложно отнести к одной из категорий выше.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="getting_messages"><a class="anchor" href="/manual.html#getting_messages"></a>4.5.1. Получение локализованных сообщений</h4> 
       <div class="paragraph"> 
        <p>В данном разделе рассмотрены способы получения <a href="/manual.html#localization">локализованных сообщений</a> в различных компонентах приложения.</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>В <a href="/manual.html#screen_xml">XML-дескрипторах</a> экранов атрибуты компонентов, отображающие статичный текст (например <a href="/manual.html#gui_attr_caption">caption</a>), могут обращаться к локализованным сообщениям по правилам метода <a href="/manual.html#messageTools.loadString">MessageTools.loadString()</a>. Например:</p> 
          <div class="ulist"> 
           <ul> 
            <li> <p><code>caption="msg://roleName"</code> - получить сообщение, заданное ключом <code>roleName</code> в пакете сообщений текущего экрана. Пакет сообщений экрана задается в атрибуте <code>messagesPack</code> корневого элемента <code>window</code>.</p> </li> 
            <li> <p><code>caption="msg://com.company.sample.entity/Role.name"</code> - получить сообщение, заданное ключом <code>Role.name</code> в пакете сообщений <code>com.company.sample.entity</code>.</p> </li> 
           </ul> 
          </div> </li> 
         <li> <p>В <a href="/manual.html#screen_controller">контроллерах экранов</a> локализованные сообщения можно получать следующими способами:</p> 
          <div class="ulist"> 
           <ul> 
            <li> <p>Из пакета сообщений текущего экрана:</p> 
             <div class="ulist"> 
              <ul> 
               <li> <p>Методом <code>getMessage()</code>, унаследованным от базового класса <a href="/manual.html#abstractFrame">AbstractFrame</a>. Например:</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> msg = getMessage(<span class="string"><span class="delimiter">"</span><span class="content">warningMessage</span><span class="delimiter">"</span></span>);</code></pre> 
                 </div> 
                </div> </li> 
               <li> <p>Методом <code>formatMessage()</code>, унаследованным от базового класса <code>AbstractFrame</code>. В этом случае сообщение используется для форматирования переданных параметров по правилам метода <code>String.format()</code>. Например:</p> 
                <div class="paragraph"> 
                 <p>messages.properties:</p> 
                </div> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="plain">warningMessage = Invalid email address: '%s'</code></pre> 
                 </div> 
                </div> 
                <div class="paragraph"> 
                 <p>Java-контроллер:</p> 
                </div> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> msg = formatMessage(<span class="string"><span class="delimiter">"</span><span class="content">warningMessage</span><span class="delimiter">"</span></span>, email);</code></pre> 
                 </div> 
                </div> </li> 
              </ul> 
             </div> </li> 
            <li> <p>Из произвольного пакета сообщений путем инжекции интерфейса инфраструктуры <a href="/manual.html#messages">Messages</a>. Например:</p> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Messages messages;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="predefined-type">String</span> msg = messages.getMessage(getClass(), <span class="string"><span class="delimiter">"</span><span class="content">warningMessage</span><span class="delimiter">"</span></span>);
    ...
}</code></pre> 
              </div> 
             </div> </li> 
           </ul> 
          </div> </li> 
         <li> <p>В компонентах, управляемых контейнером Spring (<a href="/manual.html#managed_beans">управляемых бинах</a>, <a href="/manual.html#services">сервисах</a>, <a href="/manual.html#jmx_beans">JMX-бинах</a>, контроллерах Spring MVC модуля <strong>portal</strong>) локализованные сообщения можно получать путем инжекции интерфейса инфраструктуры <a href="/manual.html#messages">Messages</a>:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Messages messages;
...
String msg = messages.getMessage(getClass(), <span class="string"><span class="delimiter">"</span><span class="content">warningMessage</span><span class="delimiter">"</span></span>);</code></pre> 
           </div> 
          </div> </li> 
         <li> <p>В любом коде приложения, где невозможна инжекция, интерфейс <code>Messages</code> может быть получен с помощью статического метода <code>get()</code> класса <code>AppBeans</code>:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> Messages messages = AppBeans.get(Messages.class);
...
String msg = messages.getMessage(getClass(), <span class="string"><span class="delimiter">"</span><span class="content">warningMessage</span><span class="delimiter">"</span></span>);</code></pre> 
           </div> 
          </div> </li> 
        </ul> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="images_recipe"><a class="anchor" href="/manual.html#images_recipe"></a>4.5.2. Загрузка и вывод изображений</h4> 
       <div class="paragraph"> 
        <p>Рассмотрим задачу загрузки, хранения и отображения фотографий сотрудников:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Сотрудник представлен сущностью <code>Employee</code>.</p> </li> 
         <li> <p>Файлы изображений хранятся в <a href="/manual.html#file_storage">FileStorage</a>. Сущность <code>Employee</code> содержит ссылку на соответствующий <code>FileDescriptor</code>.</p> </li> 
         <li> <p>Экран редактирования <code>Employee</code> отображает фотографию, а также дает возможность загрузить, выгрузить и очистить изображение.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Класс сущности со ссылкой на файл изображения:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SAMPLE_EMPLOYEE</span><span class="delimiter">"</span></span>)
<span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">sample$Employee</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">extends</span> StandardEntity {
...
    <span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY)
    <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">IMAGE_FILE_ID</span><span class="delimiter">"</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">FileDescriptor</span> imageFile;

    <span class="directive">public</span> <span class="type">void</span> setImageFile(<span class="predefined-type">FileDescriptor</span> imageFile) {
        <span class="local-variable">this</span>.imageFile = imageFile;
    }

    <span class="directive">public</span> <span class="predefined-type">FileDescriptor</span> getImageFile() {
        <span class="keyword">return</span> imageFile;
    }
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p><a href="/manual.html#views">Представление</a> для загрузки <code>Employee</code> вместе с <code>FileDescriptor</code> должно содержать все локальные атрибуты <code>FileDescriptor</code>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;view</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Employee</span><span class="delimiter">"</span></span>
      <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">employee-edit</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    ...
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">imageFile</span><span class="delimiter">"</span></span>
              <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/view&gt;</span></code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Фрагмент XML-дескриптора экрана редактирования <code>Employee</code>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groupBox</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Photo</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">image</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;image</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">image</span><span class="delimiter">"</span></span>
           <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
           <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span>
           <span class="attribute-name">scaleMode</span>=<span class="string"><span class="delimiter">"</span><span class="content">CONTAIN</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;hbox</span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">BOTTOM_LEFT</span><span class="delimiter">"</span></span>
          <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;upload</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">uploadField</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">downloadImageBtn</span><span class="delimiter">"</span></span>
                <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Download</span><span class="delimiter">"</span></span>
                <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">onDownloadImageBtnClick</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">clearImageBtn</span><span class="delimiter">"</span></span>
                <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Clear</span><span class="delimiter">"</span></span>
                <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">onClearImageBtnClick</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hbox&gt;</span>
<span class="tag">&lt;/groupBox&gt;</span></code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Компоненты отображения и загрузки/выгрузки фотографии заключены внутрь контейнера <a href="/manual.html#gui_GroupBoxLayout">groupBox</a>. В верхней его части с помощью компонента <a href="/manual.html#gui_Image">image</a> выводится изображение, а в нижней слева направо расположены компонент <a href="/manual.html#gui_FileUploadField">upload</a> для загрузки файла и <a href="/manual.html#gui_Button">кнопки</a> выгрузки и очистки изображения. В результате эта часть экрана должна выглядеть следующим образом:</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/images_recipe.png" alt="images recipe"> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Теперь рассмотрим <a href="/manual.html#abstractEditor">контроллер экрана редактирования</a>.</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.entity.FileDescriptor</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.global.FileStorageException</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components</span>.*;
<span class="keyword">import</span> <span class="include">com.company.employeeimages.entity.Employee</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.data.DataSupplier</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.data.Datasource</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.export.ExportDisplay</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.export.ExportFormat</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.upload.FileUploadingAPI</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeEdit</span> <span class="directive">extends</span> AbstractEditor&lt;Employee&gt; {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> DataSupplier dataSupplier;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> FileUploadingAPI fileUploadingAPI;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> ExportDisplay exportDisplay;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> FileUploadField uploadField;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">Button</span> downloadImageBtn;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">Button</span> clearImageBtn;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Datasource&lt;Employee&gt; employeeDs;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">Image</span> image;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        uploadField.addFileUploadSucceedListener(event -&gt; {
            <span class="predefined-type">FileDescriptor</span> fd = uploadField.getFileDescriptor();
            <span class="keyword">try</span> {
                fileUploadingAPI.putFileIntoStorage(uploadField.getFileId(), fd);
            } <span class="keyword">catch</span> (FileStorageException e) {
                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">"</span><span class="content">Error saving file to FileStorage</span><span class="delimiter">"</span></span>, e);
            }
            getItem().setImageFile(dataSupplier.commit(fd));
            displayImage();
        });

        uploadField.addFileUploadErrorListener(event -&gt;
                showNotification(<span class="string"><span class="delimiter">"</span><span class="content">File upload error</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED));

        employeeDs.addItemPropertyChangeListener(event -&gt; {
            <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">imageFile</span><span class="delimiter">"</span></span>.equals(event.getProperty()))
                updateImageButtons(event.getValue() != <span class="predefined-constant">null</span>);
        });
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> postInit() {
        displayImage();
        updateImageButtons(getItem().getImageFile() != <span class="predefined-constant">null</span>);
    }

    <span class="directive">public</span> <span class="type">void</span> onDownloadImageBtnClick() {
        <span class="keyword">if</span> (getItem().getImageFile() != <span class="predefined-constant">null</span>)
            exportDisplay.show(getItem().getImageFile(), ExportFormat.OCTET_STREAM);
    }

    <span class="directive">public</span> <span class="type">void</span> onClearImageBtnClick() {
        getItem().setImageFile(<span class="predefined-constant">null</span>);
        displayImage();
    }

    <span class="directive">private</span> <span class="type">void</span> updateImageButtons(<span class="type">boolean</span> enable) {
        downloadImageBtn.setEnabled(enable);
        clearImageBtn.setEnabled(enable);
    }

    <span class="directive">private</span> <span class="type">void</span> displayImage() {
        <span class="keyword">if</span> (getItem().getImageFile() != <span class="predefined-constant">null</span>) {
            image.setSource(FileDescriptorResource.class).setFileDescriptor(getItem().getImageFile());
            image.setVisible(<span class="predefined-constant">true</span>);
        } <span class="keyword">else</span> {
            image.setVisible(<span class="predefined-constant">false</span>);
        }
    }
}</code></pre> 
        </div> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>В методе <code>init()</code> сначала инициализируется компонент <code>uploadField</code>, предназначенный для загрузки новой фотографии. В случае успешной загрузки из компонента получается экземпляр нового <code>FileDescriptor</code>, и соответствующий файл отправляется из временного хранилища в постоянное вызовом <code>FileUploadingAPI.putFileIntoStorage()</code>. После этого <code>FileDescriptor</code> сохраняется в БД вызовом <a href="/manual.html#dataSupplier">DataSupplier.commit()</a>, и сохраненный экземпляр устанавливается в атрибуте <code>imageFile</code> редактируемой сущности <code>Employee</code>. Затем вызывается метод <code>displayImage()</code> контроллера для отображения загруженной фотографии.</p> 
          <div class="paragraph"> 
           <p>Далее в методе <code>init()</code> источнику данных, содержащему редактируемый экземпляр <code>Employee</code>, добавляется слушатель для запрещения или разрешения кнопок выгрузки и очистки файла в зависимости от того, загружен файл или нет.</p> 
          </div> </li> 
         <li> <p>Метод <code>postInit()</code> вызывает отображение файла и обновляет состояние кнопок в зависимости от наличия загруженного файла.</p> </li> 
         <li> <p>Метод <code>onDownloadImageBtnClick()</code> вызывается при нажатии кнопки <code>downloadImageBtn</code> и выполняет выгрузку файла с помощью интерфейса <a href="/manual.html#file_download">ExportDisplay</a>.</p> </li> 
         <li> <p>Метод <code>onClearImageBtnClick()</code> вызывается при нажатии кнопки <code>clearImageBtn</code> и очищает атрибут <code>imageFile</code> сущности <code>Employee</code>. Удаления файла из хранилища не производится.</p> </li> 
         <li> <p>Метод <code>displayImage()</code> выгружает файл из хранилища и устанавливает его в качестве содержимого компонента <code>image</code>.</p> </li> 
        </ul> 
       </div> 
       <div class="sect4"> 
        <h5 id="images_in_table"><a class="anchor" href="/manual.html#images_in_table"></a>4.5.2.1. Вывод изображений в колонках таблицы</h5> 
        <div class="paragraph"> 
         <p>Расширим задачу из предыдущего примера, настроив отображение фотографий на экране просмотра списка сотрудников.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Изображения можно отобразить как в отдельной колонке, так и внутри существующих колонок. В обоих случаях будет использоваться интерфейс <a href="/manual.html#gui_Table_addGeneratedColumn">Table.ColumnGenerator</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Фрагмент XML-дескриптора экрана просмотра списка <code>Employee</code>:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groupTable</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">employeesTable</span><span class="delimiter">"</span></span>
            <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">remove</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
    <span class="tag">&lt;columns&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/columns&gt;</span>
    <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">employeesDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;rowsCount</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;buttonsPanel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">buttonsPanel</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">alwaysVisible</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">createBtn</span><span class="delimiter">"</span></span>
                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">employeesTable.create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">editBtn</span><span class="delimiter">"</span></span>
                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">employeesTable.edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">removeBtn</span><span class="delimiter">"</span></span>
                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">employeesTable.remove</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/buttonsPanel&gt;</span>
<span class="tag">&lt;/groupTable&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Чтобы отображать фотографию рядом с именем сотрудника в колонке <code>name</code>, необходимо изменить стандартное представление данных в этой колонке. Например, можно использовать контейнер <a href="/manual.html#gui_BoxLayout">HBoxLayout</a>, поместив внутрь него компонент <a href="/manual.html#gui_Image">Image</a>:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.entity.FileDescriptor</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components</span>.*;
<span class="keyword">import</span> <span class="include">com.company.employeeimages.entity.Employee</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.xml.layout.ComponentsFactory</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">com.haulmont.cuba.gui.components.Image</span>.*;

<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeBrowse</span> <span class="directive">extends</span> AbstractLookup {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> ComponentsFactory componentsFactory;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> GroupTable&lt;Employee&gt; employeesTable;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {

        employeesTable.addGeneratedColumn(<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>, entity -&gt; {
            <span class="predefined-type">Image</span> image = componentsFactory.createComponent(<span class="predefined-type">Image</span>.class);
            image.setScaleMode(ScaleMode.CONTAIN);
            image.setHeight(<span class="string"><span class="delimiter">"</span><span class="content">40</span><span class="delimiter">"</span></span>);
            image.setWidth(<span class="string"><span class="delimiter">"</span><span class="content">40</span><span class="delimiter">"</span></span>);

            <span class="predefined-type">FileDescriptor</span> userImageFile = entity.getImageFile();
            image.setSource(FileDescriptorResource.class).setFileDescriptor(userImageFile);

            <span class="predefined-type">Label</span> userLogin = componentsFactory.createComponent(<span class="predefined-type">Label</span>.class);
            userLogin.setValue(entity.getName());
            userLogin.setAlignment(Alignment.MIDDLE_LEFT);

            HBoxLayout hBox = componentsFactory.createComponent(HBoxLayout.class);
            hBox.setSpacing(<span class="predefined-constant">true</span>);
            hBox.add(image);
            hBox.add(userLogin);

            <span class="keyword">return</span> hBox;
        });
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>В методе <code>init()</code> вызывается метод <code>addGeneratedColumn()</code>, который принимает два параметра: идентификатор колонки и реализацию интерфейса <code>Table.ColumnGenerator</code>, с помощью которого мы зададим своё представление для колонки <code>name</code>.</p> </li> 
          <li> <p>В этом методе мы создадим компонент <code>Image</code>, пользуясь интерфейсом <code>ComponentsFactory</code>. Укажем <a href="/manual.html#gui_Image_scaleMode">режим масштабирования</a> компонента (<code>CONTAIN</code>) и зададим его размеры.</p> </li> 
          <li> <p>Затем получим экземпляр <code>FileDescriptor</code> с изображением, которое хранится в <a href="/manual.html#file_storage">File Storage</a>. Ссылка на это изображение хранится в атрибуте <code>imageFile</code> сущности <code>Employee</code>. Используем тип ресурса <code>FileDescriptorImageResource</code>, чтобы задать источник данных для компонента <code>Image</code>.</p> </li> 
          <li> <p>Атрибут <code>name</code> можно отобразить как компонент <code>Label</code> рядом с изображением.</p> </li> 
          <li> <p>Оба компонента <code>Image</code> и <code>Label</code> обернём в контейнер <code>HBoxLayout</code>, который будет возвращать метод <code>addGeneratedColumn()</code> в качестве новой разметки ячейки.</p> </li> 
         </ul> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/image_recipe.png" alt="image recipe"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Можно использовать также более декларативный подход с атрибутом <a href="/manual.html#gui_Table_column_generator">generator</a>.</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="sending_emails_recipe"><a class="anchor" href="/manual.html#sending_emails_recipe"></a>4.5.3. Отправка email</h4> 
       <div class="paragraph"> 
        <p>В данном разделе рассматривается пример использования <a href="/manual.html#email_sending">механизма</a> рассылки email.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Рассмотрим следующую задачу:</p> 
       </div> 
       <div class="openblock"> 
        <div class="content"> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Имеется сущность <code>NewsItem</code> и экран ее редактирования <code>NewsItemEdit</code>.</p> </li> 
           <li> <p>Сущность <code>NewsItem</code> имеет следующие атрибуты: <code>date</code>, <code>caption</code>, <code>content</code>.</p> </li> 
           <li> <p>Необходимо отсылать электронные письма каждый раз, когда через экран <code>NewsItemEdit</code> создается новый экземпляр сущности. Email должен содержать <code>NewsItem.caption</code> в качестве темы письма, тело письма должно формироваться на основе шаблона, включающего <code>NewsItem.content</code>.</p> </li> 
          </ul> 
         </div> 
        </div> 
       </div> 
       <div class="olist arabic"> 
        <ol class="arabic"> 
         <li> <p>Добавьте следующий код в <code>NewsItemEdit.java</code>:</p> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">NewsItemEdit</span> <span class="directive">extends</span> AbstractEditor&lt;NewsItem&gt; {

    <span class="comment">// Indicates that a new item was created in this editor</span>
    <span class="directive">private</span> <span class="type">boolean</span> justCreated;

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> EmailService emailService;

    <span class="comment">// This method is invoked when a new item is initialized</span>
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> initNewItem(NewsItem item) {
        justCreated = <span class="predefined-constant">true</span>;
    }

    <span class="comment">// This method is invoked after the screen commit</span>
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">boolean</span> postCommit(<span class="type">boolean</span> committed, <span class="type">boolean</span> close) {
        <span class="keyword">if</span> (committed &amp;&amp; justCreated) {
            <span class="comment">// If a new entity was saved to the database, ask a user about sending an email</span>
            showOptionDialog(
                    <span class="string"><span class="delimiter">"</span><span class="content">Email</span><span class="delimiter">"</span></span>,
                    <span class="string"><span class="delimiter">"</span><span class="content">Send the news item by email?</span><span class="delimiter">"</span></span>,
                    MessageType.CONFIRMATION,
                    <span class="keyword">new</span> <span class="predefined-type">Action</span><span class="type">[]</span> {
                            <span class="keyword">new</span> DialogAction(DialogAction.Type.YES) {
                                <span class="annotation">@Override</span>
                                <span class="directive">public</span> <span class="type">void</span> actionPerform(<span class="predefined-type">Component</span> component) {
                                    sendByEmail();
                                }
                            },
                            <span class="keyword">new</span> DialogAction(DialogAction.Type.NO)
                    }
            );
        }
        <span class="keyword">return</span> <span class="local-variable">super</span>.postCommit(committed, close);
    }

    <span class="comment">// Queues an email for sending asynchronously</span>
    <span class="directive">private</span> <span class="type">void</span> sendByEmail() {
        NewsItem newsItem = getItem();
        EmailInfo emailInfo = <span class="keyword">new</span> EmailInfo(
                <span class="string"><span class="delimiter">"</span><span class="content">john.doe@company.com,jane.roe@company.com</span><span class="delimiter">"</span></span>, <span class="comment">// recipients</span>
                newsItem.getCaption(), <span class="comment">// subject</span>
                <span class="predefined-constant">null</span>, <span class="comment">// the "from" address will be taken from the "cuba.email.fromAddress" app property</span>
                <span class="string"><span class="delimiter">"</span><span class="content">com/company/demo/templates/news_item.txt</span><span class="delimiter">"</span></span>, <span class="comment">// body template</span>
                <span class="predefined-type">Collections</span>.singletonMap(<span class="string"><span class="delimiter">"</span><span class="content">newsItem</span><span class="delimiter">"</span></span>, newsItem) <span class="comment">// template parameters</span>
        );
        emailService.sendEmailAsync(emailInfo);
    }
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Как видно, метод <code>sendByEmail()</code> вызывает сервис <code>EmailService</code> и передает ему экземпляр <code>EmailInfo</code>, описывающий сообщение. Тело сообщений будет создаваться на основе шаблона <code>news_item.txt</code>.</p> 
            </div> 
           </div> 
          </div> </li> 
         <li> <p>Создайте шаблон тела письма в файле <code>news_item.txt</code> в пакете <code>com.company.demo.templates</code> модуля <strong>core</strong>:</p> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="plain">The company news:
${newsItem.content}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Это шаблон <a href="http://freemarker.incubator.apache.org/" target="_blank">Freemarker</a>, который использует параметры, переданные в <code>EmailInfo</code> (в данном случае единственный параметр <code>newsItem</code>).</p> 
            </div> 
           </div> 
          </div> </li> 
         <li> <p>Запустите приложение, откройте браузер сущности <code>NewsItem</code> и нажмите <strong>Create</strong>. Откроется экран редактирования сущности. Заполните поля и нажмите <strong>OK</strong>. Появится диалог подтверждения с вопросом об отсылке email. Нажмите <strong>Yes</strong>.</p> </li> 
         <li> <p>Перейдите в экран <strong>Administration &gt; Email History</strong> вашего приложения. Вы увидите две записи (по числу получателей) со статусом <code>Queue</code>. Он означает, что сообщения находятся в очереди и еще не отосланы.</p> </li> 
         <li> <p>Для обработки очереди необходимо создать <a href="/manual.html#scheduled_tasks_cuba">назначенное задание</a>. Перейдите в экран <strong>Administration &gt; Scheduled Tasks</strong> вашего приложения. Создайте новую задачу и установите ей следующие параметры:</p> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="ulist"> 
             <ul> 
              <li> <p><strong>Bean Name</strong> - <code>cuba_Emailer</code></p> </li> 
              <li> <p><strong>Method Name</strong> - <code>processQueuedEmails()</code></p> </li> 
              <li> <p><strong>Singleton</strong> - да (этот параметр важен только при эксплуатации кластера серверов middleware)</p> </li> 
              <li> <p><strong>Period, sec</strong> - 10</p> </li> 
             </ul> 
            </div> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Сохраните задачу и нажмите на ней <strong>Activate</strong>.</p> 
          </div> 
          <div class="paragraph"> 
           <p>Если вы ранее не настраивали выполнение назначенных заданий для данного приложения ранее, то на данном этапе ничего не произойдет - новая задача не начнет выполняться пока вы не запустите весь механизм назначенных заданий.</p> 
          </div> </li> 
         <li> <p>Откройте файл <code>modules/core/src/app.properties</code> и добавьте в него следующее <a href="/manual.html#cuba.schedulingActive">свойство</a>:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="properties">cuba.schedulingActive = true</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Перезапустите сервер приложения. Механизм выполнения заданий теперь активен и вызывает обработку очереди email.</p> 
          </div> </li> 
         <li> <p>Перейдите в экран <strong>Administration &gt; Email History</strong>. Статус сообщений будет либо <code>Sent</code>, если они успешно отосланы, либо, что более вероятно, <code>Sending</code> или <code>Queue</code>, если произошла ошибка отправки. В последнем случае вы можете открыть журнал приложения в файле <code>build/tomcat/logs/app.log</code> и выяснить причину. Механизм отсылки email предпримет несколько (по умолчанию 10) попыток и в случае неудачи переведет сообщения в статус <code>Not sent</code>.</p> </li> 
         <li> <p>Наиболее очевидной причиной ошибки отправки является то, что вы не настроили <a href="/manual.html#email_sending_properties">параметры</a> SMTP-сервера. Эти параметры могут быть заданы в базе данных с помощью JMX бина <code>app-core.cuba:type=Emailer</code> или в свойствах приложения блока middleware. Рассмотрим второй способ. Откройте файл <code>modules/core/src/app.properties</code> и добавьте в него требуемые <a href="/manual.html#email_sending_properties">параметры</a>:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="properties">cuba.email.fromAddress = do-not-reply@company.com
cuba.email.smtpHost = mail.company.com</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Перезапустите сервер приложения. Перейдите в экран <strong>Administration &gt; JMX Console</strong>, найдите JMX бин <code>Emailer</code> и попробуйте послать самому себе тестовое сообщение с помощью операции <code>sendTestEmail()</code>.</p> 
          </div> </li> 
         <li> <p>Теперь механизм отсылки email настроен корректно, однако он не будет отсылать сообщения, уже переведенные в статус <code>Not sent</code>. Поэтому необходимо создать новый экземпляр <code>NewsItem</code> через экран редактирования. Сделайте это и понаблюдайте, как статус новых сообщений в экране <strong>Email History</strong> изменится на <code>Sent</code>.</p> </li> 
        </ol> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="app_components_sample"><a class="anchor" href="/manual.html#app_components_sample"></a>4.5.4. Использование компонентов приложения</h4> 
       <div class="paragraph"> 
        <p>Как упоминалось в разделе <a href="/manual.html#app_components">Компоненты приложения</a>, любое CUBA-приложение может быть компонентом другого приложения. Компонент приложения представляет собой по сути full-stack библиотеку, предоставляющую функциональность на всех уровнях - от схемы БД до бизнес-логики и UI.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В данном разделе рассматривается пример создания компонента приложения и использования его в проекте. Компонент будет предоставлять функциональность "Customer Management" и содержать сущность <code>Customer</code> и соответствующие экраны UI. Приложение будет использовать сущность <code>Customer</code> из компонента в качестве ссылки в собственной сущности <code>Order</code>.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/app_components_sample.png" alt="app components sample"> 
        </div> 
       </div> 
       <div class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Создание компонента Customer Management
         </dt> 
         <dd> 
          <div class="olist arabic"> 
           <ol class="arabic"> 
            <li> <p>Создайте новый проект в Studio и укажите следующие значения в окне <strong>New project</strong>:</p> 
             <div class="ulist"> 
              <ul> 
               <li> <p><strong>Project name</strong> - <code>customers</code></p> </li> 
               <li> <p><strong>Project namespace</strong> - <code>cust</code></p> </li> 
               <li> <p><strong>Root package</strong> - <code>com.company.customers</code></p> </li> 
              </ul> 
             </div> </li> 
            <li> <p>Откройте <strong>Project properties</strong> на редактирование и на вкладке <strong>Advanced</strong> установите значение поля <strong>Module prefix</strong> в <code>cust</code>. Это необходимо для того, чтобы имена артефактов компонента имели префикс, отличный от <code>app</code>, принятого по умолчанию.</p> </li> 
            <li> <p>Создайте сущность <code>Customer</code> с атрибутом <code>name</code>. Переключитесь на вкладку <strong>Instance name</strong> и укажите <code>name</code> в атрибутах name pattern.</p> 
             <div class="admonitionblock warning"> 
              <table> 
               <tbody>
                <tr> 
                 <td class="icon"> 
                  <div class="title">
                   Warning
                  </div> </td> 
                 <td class="content"> 
                  <div class="paragraph"> 
                   <p>Если компонент содержит персистентные классы, аннотированные <code>@MappedSuperclass</code>, убедитесь, что в этом же проекте есть их наследники, являющиеся сущностями (т.е. аннотированные <code>@Entity</code>). В противном случае байткод таких базовых классов не будет необходимым образом модифицирован и они не будут правильно работать в приложениях, использующих компонент.</p> 
                  </div> </td> 
                </tr> 
               </tbody>
              </table> 
             </div> </li> 
            <li> <p>Сгененрируйте скрипты БД и создайте стандартные экраны для сущности <code>Customer</code>: <code>cust$Customer.browse</code> и <code>cust$Customer.edit</code>. После этого откройте дизайнер меню и переименуйте пункт <code>application</code> в <code>customerManagement</code>.</p> </li> 
            <li> <p>Нажмите на ссылку <strong>App component descriptor</strong> на панели <strong>Project properties</strong>. Сохраните сгенерированный <a href="/manual.html#app-component.xml">описатель компонента</a> нажав <strong>OK</strong>.</p> </li> 
            <li> <p>Проверьте функциональность Customer Management: <strong>Run &gt; Create database</strong>, <strong>Run &gt; Start application server</strong>, затем откройте <code>http://localhost:8080/cust</code> в веб-браузере.</p> </li> 
            <li> <p>Установите компонент приложения в локальный Maven-репозиторий, выполнив команду главного меню <strong>Run &gt; Install app component</strong>. Данная команда просто запускает задачу Gradle <code>install</code> после остановки демонов Gradle.</p> </li> 
           </ol> 
          </div> 
         </dd> 
         <dt class="hdlist1">
          Создание приложения Sales
         </dt> 
         <dd> 
          <div class="olist arabic"> 
           <ol class="arabic"> 
            <li> <p>Создайте новый проект в Studio и укажите следующие значения в окне <strong>New project</strong>:</p> 
             <div class="ulist"> 
              <ul> 
               <li> <p><strong>Project name</strong> - <code>sales</code></p> </li> 
               <li> <p><strong>Project namespace</strong> - <code>sales</code></p> </li> 
               <li> <p><strong>Root package</strong> - <code>com.company.sales</code></p> </li> 
              </ul> 
             </div> </li> 
            <li> <p>Откройте <strong>Project properties</strong> на редактирование и на панели <strong>App components</strong> нажмите на кнопку добавления <strong>Custom components</strong>. В диалоге <strong>Custom application component</strong> выберите проект <code>customers</code> в списке <strong>Registered project</strong>. Данный список содержит все проекты, зарегистрированные в Studio и имеющие описатель <code>app-component.xml</code>. Нажмите в диалоге <strong>OK</strong>. В списке кастомных компонентов проекта появятся Maven-координаты компонента Customer Management. Сохраните страницу свойств проекта нажатием <strong>OK</strong>.</p> </li> 
            <li> <p>Создайте сущность <code>Order</code> с атрибутами <code>date</code> и <code>amount</code>. Добавьте атрибут <code>customer</code> в виде many-to-one ассоциации с сущностью <code>Customer</code> - она дожна быть доступна в выпадающем списке <strong>Type</strong>.</p> </li> 
            <li> <p>Сгенерируйте скрипты БД и создайте стандартные экраны для сущности <code>Order</code>. При создании экранов создайте представление <code>order-with-customer-view</code>, включающее атрибут <code>customer</code> и используйте его в экранах.</p> </li> 
            <li> <p>Проверьте функциональность приложения: <strong>Run &gt; Create database</strong>, <strong>Run &gt; Start application server</strong>, затем откройте <code>http://localhost:8080/app</code> в веб-браузере. Приложение должно содержать два пункта меню верхнего уровня: <strong>Customer Management</strong> и <strong>Application</strong>.</p> </li> 
           </ol> 
          </div> 
         </dd> 
         <dt class="hdlist1">
          Модификация компонента Customer Management
         </dt> 
         <dd> 
          <p>Предположим, что необходимо изменить функциональность компонента (добавить атрибут в сущность <code>Customer</code>) и пересобрать приложение для внесения этих изменений.</p> 
          <div class="olist arabic"> 
           <ol class="arabic"> 
            <li> <p>Откройте проект <code>customers</code> в Studio.</p> </li> 
            <li> <p>Откройте сущность <code>Customer</code> на редактирование и добавьте атрибут <code>address</code>. При сохранении изменений выберите экраны браузера и редактора для включения нового атрибута.</p> </li> 
            <li> <p>Сгенерируйте скрипты БД - будет создано новый скрипт обновления с изменением таблицы. Сохраните скрипты.</p> </li> 
            <li> <p>Проверьте изменения в компоненте: <strong>Run &gt; Update database</strong>, <strong>Run &gt; Start application server</strong>, затем откройте <code>http://localhost:8080/cust</code> в веб-браузере.</p> </li> 
            <li> <p>Переинсталлируйте компонент в локальный Maven-репозиторий выполнив команду меню <strong>Run &gt; Install app component</strong>.</p> </li> 
            <li> <p>Закройте проект <code>customers</code> и откройте <code>sales</code>.</p> </li> 
            <li> <p>Выполните команды меню <strong>Build &gt; Clean</strong>, затем <strong>Build &gt; Assemble project</strong>.</p> </li> 
            <li> <p>Запустите <strong>Run &gt; Update database</strong> - будет выполнен скрипт обновления из компонента Customer Management.</p> </li> 
            <li> <p>Выполните <strong>Run &gt; Start application server</strong> и откройте <code>http://localhost:8080/app</code> в веб-браузере - приложение теперь содержит сущность <code>Customer</code> и соответствующие экраны с атрибутом <code>address</code>.</p> </li> 
           </ol> 
          </div> 
         </dd> 
         <dt class="hdlist1">
          Предоставление общего доступа к компоненту Customer Management
         </dt> 
         <dd> 
          <p>Компонент приложения можно выгрузить в удаленный Maven-репозиторий.</p> 
          <div class="olist arabic"> 
           <ol class="arabic"> 
            <li> <p>Остановите сервер Studio.</p> </li> 
            <li> <p>Установите репозиторий как описано в разделе <a href="/manual.html#private_repo">Установка приватного репозитория артефактов</a>.</p> </li> 
            <li> <p>Откройте <code>build.gradle</code> проекта <code>customers</code> в текстовом редакторе. Замените репозиторий и имя/пароль пользователя в секции <code>buildscript/repositories</code> и добавьте <code>uploadRepository</code> в секции <code>cuba</code>:</p> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    ...
    repositories {
        maven {
            url <span class="string"><span class="delimiter">'</span><span class="content">http://repo.company.com/nexus/content/groups/work</span><span class="delimiter">'</span></span> <span class="comment">// repository containing CUBA and your own artifacts</span>
            credentials {
                username(rootProject.hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">repoUser</span><span class="delimiter">'</span></span>) ? rootProject[<span class="string"><span class="delimiter">'</span><span class="content">repoUser</span><span class="delimiter">'</span></span>] : <span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>)
                password(rootProject.hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">repoPass</span><span class="delimiter">'</span></span>) ? rootProject[<span class="string"><span class="delimiter">'</span><span class="content">repoPass</span><span class="delimiter">'</span></span>] : <span class="string"><span class="delimiter">'</span><span class="content">admin123</span><span class="delimiter">'</span></span>)
            }
        }
...
cuba {
    ...
    uploadRepository {
        url = <span class="string"><span class="delimiter">'</span><span class="content">http://repo.company.com/nexus/content/repositories/snapshots</span><span class="delimiter">'</span></span> <span class="comment">// repository for uploading your artifacts</span>
        user = <span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>
        password = <span class="string"><span class="delimiter">'</span><span class="content">admin123</span><span class="delimiter">'</span></span>
    }
}</code></pre> 
              </div> 
             </div> </li> 
            <li> <p>Откройте командную строку в корневом каталоге проекта <code>customers</code> и выполните <code>gradle assemble</code>. Это необходимо для того, чтобы новый репозиторий закэшировал артефакты CUBA, требуемые для работы Studio.</p> </li> 
            <li> <p>В окне сервера Studio укажите ваш репозиторий и имя/пароль для доступа к нему вместо стандартного репозитория CUBA. Запустите сервер Studio.</p> </li> 
            <li> <p>Откройте проект <code>customers</code> в Studio.</p> </li> 
            <li> <p>Найдите в диалоге <strong>Search</strong> (Alt-/) задачу Gradle <code>uploadArchives</code> и запустите ее. Эту задачу можно запускать и из командной строки. Артефакты компонента Customer Management будет выгружены в ваш репозиторий.</p> </li> 
            <li> <p>Удалите артефакты компонента из локального Maven-репозитория чтобы быть уверенным, что они загрузятся из удаленного репозитория при последующей сборке приложения <code>sales</code>: просто удалите каталог <code>.m2/repository/com/company</code>, находящийся в домашнем каталоге пользователя.</p> </li> 
            <li> <p>Откройте проект <code>customers</code> в Studio. Адрес репозитория в <code>build.gradle</code> будет автоматически заменен на тот, который указан в окне сервера Studio.</p> </li> 
            <li> <p>Теперь можно собрать и запустить приложение - компонент Customer Management будет загружен из удаленного репозитория.</p> </li> 
           </ol> 
          </div> 
         </dd> 
        </dl> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="own_component_samples"><a class="anchor" href="/manual.html#own_component_samples"></a>4.5.5. Создание собственных визуальных компонентов</h4> 
       <div class="paragraph"> 
        <p>В разделе <a href="/manual.html#own_components">Собственные визуальные компоненты</a> был приведен обзор методов расширения набора стандартных визуальных компонентов в проекте. У вас есть следующие варианты:</p> 
       </div> 
       <div class="olist arabic"> 
        <ol class="arabic"> 
         <li> <p>Подключение аддона Vaadin. Много сторонних компонентов Vaadin распространяются в виде дополнений (add-on). Библиотека аддонов находится по адресу <a href="https://vaadin.com/directory" class="bare" target="_blank">https://vaadin.com/directory</a>.</p> </li> 
         <li> <p>Подключение компонента, написанного на JavaScript. Vaadin дает возможность создавать серверные компоненты, использующие JavaScript-библиотеку.</p> </li> 
         <li> <p>Создание собственного компонента Vaadin с клиентской частью, написанной на GWT.</p> </li> 
        </ol> 
       </div> 
       <div class="paragraph"> 
        <p>Далее вы можете интегрировать получившийся компонент Vaadin в универсальный пользовательский интерфейс CUBA, чтобы иметь возможность использовать его декларативно в XML-дескрипторах экранов и привязывать к источникам данных.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Финальным шагом интеграции является поддержка нового компонента в WYSIWYG редакторе экранов Studio.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Далее в этом разделе приводятся примеры создания новых визуальных компонентов каждым из описанных выше способов. Интеграция в Generic UI одинакова для всех трех способов, поэтому она описана только для примера с подключением аддона Vaadin.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="vaadin_addon_sample"><a class="anchor" href="/manual.html#vaadin_addon_sample"></a>4.5.5.1. Подключение аддона Vaadin</h5> 
        <div class="paragraph"> 
         <p>Рассмотрим пример использования компонента <strong>Stepper</strong>, доступного по адресу <a href="http://vaadin.com/addon/stepper" class="bare" target="_blank">http://vaadin.com/addon/stepper</a>. Данный компонент позволяет пошагово изменять значение текстового поля с помощью клавиатуры, колесика мыши и встроенных кнопок вверх/вниз.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Создайте новый проект в CUBA Studio и назовите его <code>addon-demo</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Для подключения аддона Vaadin проект должен иметь модуль <strong>web-toolkit</strong>. Создайте его, нажав на ссылку <strong>Create web toolkit module</strong> секции <strong>Project properties</strong> навигатора.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Далее нажмите на ссылку <strong>New UI component</strong>. Откроется окно создания визуального компонента <strong>UI component generation</strong>. В секции <strong>Component type</strong> выберите значение <code>Vaadin add-on</code>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/studio_vaadin_addon_wizard_no_gui.png" alt="studio vaadin addon wizard no gui"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Заполните следующие поля:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><strong>Add-on Maven dependency</strong> - в этом поле необходимо указать Maven-координаты аддона Vaadin для подключения его как зависимости к текущему проекту. Указание координат возможно в двух форматах:</p> 
           <div class="olist arabic"> 
            <ol class="arabic"> 
             <li> <p>XML, скопированный с сайта аддона (<a href="http://vaadin.com/addon/stepper" class="bare" target="_blank">http://vaadin.com/addon/stepper</a>):</p> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.vaadin.addons<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>stepper<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>2.2.2<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre> 
               </div> 
              </div> </li> 
             <li> <p>Одной строкой в том виде, как вы добавляете зависимости в <a href="/manual.html#build.gradle">build.gradle</a>: <code>org.vaadin.addons:stepper:2.2.2</code></p> </li> 
            </ol> 
           </div> </li> 
          <li> <p><strong>Inherited widgetset</strong> - в этом поле необходимо указать имя виджетсета подключаемого аддона:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code>org.vaadin.risto.stepper.widgetset.StepperWidgetset</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><strong>Integrate into generic UI</strong> - в данном примере флажок должен быть снят, т.к. мы не интегрируем компонент в универсальный интерфейс платформы.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Нажмите кнопку <strong>OK</strong>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Если открыть проект в IDE, то можно увидеть, что Студия изменила два файла:</p> 
        </div> 
        <div class="olist arabic"> 
         <ol class="arabic"> 
          <li> <p><a href="/manual.html#build.gradle">build.gradle</a>. В модуле <strong>web</strong> появилась новая зависимость от аддона, содержащего компонент:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java">configure(webModule) {
    ...
    dependencies {
        ...
        compile(<span class="string"><span class="delimiter">"</span><span class="content">org.vaadin.addons:stepper:2.2.2</span><span class="delimiter">"</span></span>)
    }</code></pre> 
            </div> 
           </div> </li> 
          <li> <p>В файл <code>AppWidgetSet.gwt.xml</code> модуля <strong>web-toolkit</strong> проекта подключен виджетсет аддона после виджетсета платформы:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;module&gt;</span>
    <span class="tag">&lt;inherits</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.web.toolkit.ui.WidgetSet</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>

    <span class="tag">&lt;inherits</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">org.vaadin.risto.stepper.widgetset.StepperWidgetset</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>

    <span class="tag">&lt;set-property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">user.agent</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">safari</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span></code></pre> 
            </div> 
           </div> 
           <div class="admonitionblock tip"> 
            <table> 
             <tbody>
              <tr> 
               <td class="icon"> 
                <div class="title">
                 Tip
                </div> </td> 
               <td class="content"> 
                <div class="paragraph"> 
                 <p>Для более быстрой сборки виджетов на время разработки вы можете установить свойство <code>user.agent</code>. В данном примере набор виджетов будет собираться только для браузеров, основанных на WebKit: Chrome, Safari, и т.д.</p> 
                </div> </td> 
              </tr> 
             </tbody>
            </table> 
           </div> </li> 
         </ol> 
        </div> 
        <div class="paragraph"> 
         <p>Компонент из аддона Vaadin подключен. Далее мы покажем как использовать его в экранах проекта.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Создаем новую сущность <code>Customer</code> с двумя полями:</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p><code>name</code> типа String</p> </li> 
             <li> <p><code>score</code> типа Integer</p> </li> 
            </ul> 
           </div> </li> 
          <li> <p>Сгенерируем для новой сущности стандартные экраны. В диалоге генерации стандартных экранов убедитесь что значение поля <strong>In module</strong> - <code>Web Module</code>. Экраны, использующие компоненты Vaadin напрямую, должны располагаться в модуле <strong>web</strong>.</p> 
           <div class="admonitionblock tip"> 
            <table> 
             <tbody>
              <tr> 
               <td class="icon"> 
                <div class="title">
                 Tip
                </div> </td> 
               <td class="content"> 
                <div class="paragraph"> 
                 <p>На самом деле экран может располагаться и в модуле <strong>gui</strong>, но тогда код, работающий с Vaadin компонентом, должен быть вынесен в отдельный <a href="/manual.html#companions">компаньон</a>.</p> 
                </div> </td> 
              </tr> 
             </tbody>
            </table> 
           </div> </li> 
          <li> <p>Далее добавим компонент <code>stepper</code> на экран. Вы можете поместить его как в <a href="/manual.html#gui_FieldGroup">FieldGroup</a>, так и вне ее. Рассмотрим оба способа.</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="olist arabic"> 
              <ol class="arabic"> 
               <li> <p>В XML-дескрипторе экрана редактирования <code>customer-edit.xml</code> для поля <code>score</code> компонента <code>fieldGroup</code> добавим атрибут <code>custom = "true"</code>:</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="tag">&lt;window</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/window.xsd</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://editCaption</span><span class="delimiter">"</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addondemo.web.customer.CustomerEdit</span><span class="delimiter">"</span></span>
        <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
        <span class="attribute-name">focusComponent</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span>
        <span class="attribute-name">messagesPack</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addondemo.web.customer</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dsContext&gt;</span>
        <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addondemo.entity.Customer</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dsContext&gt;</span>
    <span class="tag">&lt;layout</span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span> <span class="attribute-name">custom</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/column&gt;</span>
        <span class="tag">&lt;/fieldGroup&gt;</span>
        <span class="tag">&lt;frame</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span> <span class="attribute-name">screen</span>=<span class="string"><span class="delimiter">"</span><span class="content">editWindowActions</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/layout&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
                 </div> 
                </div> 
                <div class="paragraph"> 
                 <p>В контроллер экрана редактирования <code>CustomerEdit.java</code> добавим следующий код:</p> 
                </div> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.addondemo.web.customer</span>;

<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.AbstractEditor</span>;
<span class="keyword">import</span> <span class="include">com.company.addondemo.entity.Customer</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.Component</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.FieldGroup</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.VBoxLayout</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.data.Datasource</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.xml.layout.ComponentsFactory</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.web.gui.components.WebComponentsHelper</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.ui.Layout</span>;
<span class="keyword">import</span> <span class="include">org.vaadin.risto.stepper.IntStepper</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerEdit</span> <span class="directive">extends</span> AbstractEditor&lt;Customer&gt; {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> ComponentsFactory componentsFactory;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> FieldGroup fieldGroup;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Datasource&lt;Customer&gt; customerDs;

    <span class="directive">private</span> IntStepper stepper = <span class="keyword">new</span> IntStepper();

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        fieldGroup.createField(<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span>);
        <span class="predefined-type">Component</span> box = componentsFactory.createComponent(VBoxLayout.class);
        fieldGroup.getFieldNN(<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span>).setComponent(box);
        Layout layout = (Layout) WebComponentsHelper.unwrap(box);
        layout.addComponent(stepper);
        stepper.setSizeFull();
        stepper.addValueChangeListener(event -&gt;
                customerDs.getItem().setValue(<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span>, event.getProperty().getValue())
        );
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> initNewItem(Customer item) {
        item.setScore(<span class="integer">0</span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> postInit() {
        stepper.setValue(getItem().getScore());
    }
}</code></pre> 
                 </div> 
                </div> 
                <div class="paragraph"> 
                 <p>Здесь в поле <code>stepper</code> создается экземпляр компонента, подключенного из аддона. В методе <code>init()</code> производится инициализация кастомного поля <code>score</code>. Через <code>ComponentsFactory</code> создается экземпляр <a href="/manual.html#gui_BoxLayout">BoxLayout</a>, затем из него с помощью <a href="/manual.html#webComponentsHelper">WebComponentsHelper</a> извлекается ссылка на Vaadin-контейнер, и в этот контейнер добавляется наш новый компонент. <code>BoxLayout</code> возвращается для отображения в кастомном поле.</p> 
                </div> 
                <div class="paragraph"> 
                 <p>Для связи компонента с данными во-первых, в методе <code>postInit()</code> ему устанавливается текущее значение из редактируемого <code>Customer</code>, а во-вторых, добавляется слушатель на изменение значения, который обновляет соответствующий атрибут сущности при изменении значения пользователем.</p> 
                </div> </li> 
               <li> <p>Чтобы использовать новый компонент вне <code>FieldGroup</code> в произвольном месте экрана в XML-дескрипторе объявим контейнер <code>scoreBox</code> и удалим поле <code>score</code> из <code>fieldGroup</code>:</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="tag">&lt;window</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/window.xsd</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://editCaption</span><span class="delimiter">"</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addondemo.web.customer.CustomerEdit</span><span class="delimiter">"</span></span>
        <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
        <span class="attribute-name">focusComponent</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span>
        <span class="attribute-name">messagesPack</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addondemo.web.customer</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dsContext&gt;</span>
        <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addondemo.entity.Customer</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dsContext&gt;</span>
    <span class="tag">&lt;layout</span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/column&gt;</span>
        <span class="tag">&lt;/fieldGroup&gt;</span>

        <span class="tag">&lt;hbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">scoreBox</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Score</span><span class="delimiter">"</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_LEFT</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/hbox&gt;</span>

        <span class="tag">&lt;frame</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span> <span class="attribute-name">screen</span>=<span class="string"><span class="delimiter">"</span><span class="content">editWindowActions</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/layout&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
                 </div> 
                </div> 
                <div class="paragraph"> 
                 <p>В контроллере инжектируем контейнер, извлекаем ссылку на Vaadin-контейнер и добавляем в него компонент:</p> 
                </div> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.addondemo.web.customer</span>;

<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components</span>.*;
<span class="keyword">import</span> <span class="include">com.company.addondemo.entity.Customer</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.data.Datasource</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.web.gui.components.WebComponentsHelper</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.ui.Layout</span>;
<span class="keyword">import</span> <span class="include">org.vaadin.risto.stepper.IntStepper</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerEdit</span> <span class="directive">extends</span> AbstractEditor&lt;Customer&gt; {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> FieldGroup fieldGroup;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Datasource&lt;Customer&gt; customerDs;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">BoxLayout</span> scoreBox;

    <span class="directive">private</span> IntStepper stepper = <span class="keyword">new</span> IntStepper();

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {

        Layout box = (Layout) WebComponentsHelper.unwrap(scoreBox);
        box.addComponent(stepper);

        fieldGroup.addField(fieldGroup.createField(<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span>));

        stepper.setSizeFull();
        stepper.addValueChangeListener(event -&gt;
                customerDs.getItem().setValue(<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span>, event.getProperty().getValue())
        );
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> initNewItem(Customer item) {
        item.setScore(<span class="integer">0</span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> postInit() {
        stepper.setValue(getItem().getScore());
    }
}</code></pre> 
                 </div> 
                </div> 
                <div class="paragraph"> 
                 <p>Связь с данными выполняется здесь аналогично примеру с <code>FieldGroup</code>.</p> 
                </div> </li> 
              </ol> 
             </div> 
            </div> 
           </div> </li> 
          <li> <p>Для адаптации внешнего вида компонента создадим в проекте расширение темы. Для этого в Studio выполним команду <strong>Create theme extension</strong> секции <strong>Project properties</strong> навигатора. В списке тем для расширения выберем <code>halo</code> и нажмем кнопку <strong>Create</strong>. Затем откроем файл <code>themes/halo/halo-ext.scss</code> модуля <strong>web</strong>, и добавим в него следующий код:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../halo/halo</span><span class="delimiter">"</span></span>;

<span class="comment">/* Define your theme modifications inside next mixin */</span>
<span class="directive">@mixin</span> <span class="tag">halo-ext</span> {
    <span class="directive">@include</span> <span class="key">halo</span>;

    <span class="comment">/* Basic styles for stepper inner text box */</span>
    .<span class="key">stepper</span> <span class="key">input</span><span class="error">[</span><span class="key">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span><span class="error">]</span> {
       <span class="directive">@include</span> <span class="key">box-defaults</span>;
       <span class="directive">@include</span> <span class="key">valo-textfield-style</span>;
       <span class="error">&amp;</span>:<span class="value">focus</span> {
         <span class="directive">@include</span> <span class="key">valo-textfield-focus-style</span>;
       }
    }
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Запускаем сервер приложения. Экран редактирования должен выглядеть следующим образом:</p> </li> 
         </ul> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/customer_edit_result.png" alt="customer edit result"> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="vaadin_addon_sample_gui"><a class="anchor" href="/manual.html#vaadin_addon_sample_gui"></a>4.5.5.2. Подключение аддона Vaadin с интеграцией в Generic UI</h5> 
        <div class="paragraph"> 
         <p>В <a href="/manual.html#vaadin_addon_sample">предыдущем разделе</a> мы подключили в проект сторонний компонент Stepper. В данном разделе мы интегрируем его в универсальный пользовательский интерфейс CUBA, что даст разработчикам возможность использовать компонент декларативно в XML-дескрипторах экранов и связывать его с сущностями через <a href="/manual.html#datasources">источники данных</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Создадим новый проект в CUBA Studio и назовем его <code>addon-gui-demo</code>. В поле <strong>Project namespace</strong> введем значение <code>agd</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Создадим модуль <strong>web-toolkit</strong>, нажав на кнопку <strong>Create web toolkit module</strong> секции <strong>Project properties</strong> навигатора Studio.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Далее нажимаем на кнопку <strong>New UI component</strong>. Откроется окно создания визуального компонента <strong>UI component generation</strong>. В секции <strong>Component type</strong> выбираем значение <code>Vaadin add-on</code>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/studio_vaadin_addon_wizard_gui.png" alt="studio vaadin addon wizard gui"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Заполним поля <strong>Add-on Maven dependency</strong> и <strong>Inherited widgetset</strong> как описано в <a href="/manual.html#vaadin_addon_sample">предыдущем разделе</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Далее заполним поля в нижней секции:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><strong>Integrate into Generic UI</strong> указывает на необходимости интеграции компонента в универсальный пользовательский интерфейс платформы.</p> </li> 
          <li> <p><strong>Component XML element</strong> - имя элемента компонента в XML-дескрипторе экрана. Введите значение <code>stepper</code>.</p> </li> 
          <li> <p><strong>Component interface name</strong> - имя интерфейса компонента для универсального UI платформы. Введите <code>Stepper</code>.</p> </li> 
          <li> <p><strong>FQN of Vaadin component from add-on</strong> - полное имя класса компонента Vaadin из аддона. В нашем случае это <code>org.vaadin.risto.stepper.IntStepper</code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>После нажатия кнопки <strong>OK</strong> Studio сделает следующее:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Добавит аддон Vaadin в зависимости модуля <strong>web</strong> в файле <code>build.gradle</code>.</p> </li> 
          <li> <p>Подключит виджетсет аддона в файле <code>AppWidgetSet.gwt.xml</code> модуля <strong>web-toolkit</strong>.</p> </li> 
          <li> <p>Сгенерирует заготовки для следующих файлов:</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p><code>Stepper</code> - интерфейс компонента в модуле <strong>gui</strong>.</p> </li> 
             <li> <p><code>WebStepper</code> - реализация компонента в модуле <strong>web</strong>.</p> </li> 
             <li> <p><code>StepperLoader</code> - XML-загрузчик компонента в модуле <strong>gui</strong>.</p> </li> 
             <li> <p><code>ui-component.xsd</code> - описатель схемы XML для нового компонента. Если файл уже существовал на момент генерации компонента, то информация о новом компоненте будет добавлена в существующий файл.</p> </li> 
             <li> <p><code>cuba-ui-component.xml</code> - файл регистрации загрузчика нового компонента в модуле <strong>web</strong>. Если файл существовал, то информация о новом компоненте будет добавлена в существующий файл.</p> </li> 
            </ul> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Откройте проект в IDE.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Последовательно пройдемся по сгенерированным Studio заготовкам файлов и внесем в них необходимые изменения.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Перейдите к интерфейсу <code>Stepper</code> в модуле <strong>gui</strong>. Замените его содержимое на следующий код:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.addonguidemo.gui.components</span>;

<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.Field</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Stepper</span> <span class="directive">extends</span> <span class="predefined-type">Field</span> {

    <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">"</span><span class="content">stepper</span><span class="delimiter">"</span></span>;

    <span class="type">boolean</span> isManualInputAllowed();
    <span class="type">void</span> setManualInputAllowed(<span class="type">boolean</span> value);

    <span class="type">boolean</span> isMouseWheelEnabled();
    <span class="type">void</span> setMouseWheelEnabled(<span class="type">boolean</span> value);

    <span class="type">int</span> getStepAmount();
    <span class="type">void</span> setStepAmount(<span class="type">int</span> amount);

    <span class="type">int</span> getMaxValue();
    <span class="type">void</span> setMaxValue(<span class="type">int</span> maxValue);

    <span class="type">int</span> getMinValue();
    <span class="type">void</span> setMinValue(<span class="type">int</span> minValue);
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>В качестве базового для нашего компонента выбран интерфейс <code>Field</code>. Это позволяет осуществить связь с данными (data binding), то есть отображать и редактировать значение некоторого атрибута сущности.</p> 
           </div> </li> 
          <li> <p>Далее перейдите к классу <code>WebStepper</code> - реализации компонента в модуле <strong>web</strong>. Замените содержимое класса следующим кодом:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.addonguidemo.web.gui.components</span>;

<span class="keyword">import</span> <span class="include">com.company.addonguidemo.gui.components.Stepper</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.web.gui.components.WebAbstractField</span>;
<span class="keyword">import</span> <span class="include">org.vaadin.risto.stepper.IntStepper</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">WebStepper</span> <span class="directive">extends</span> WebAbstractField&lt;IntStepper&gt; <span class="directive">implements</span> Stepper {
    <span class="directive">public</span> WebStepper() {
        <span class="local-variable">this</span>.component = <span class="keyword">new</span> org.vaadin.risto.stepper.IntStepper();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> isManualInputAllowed() {
        <span class="keyword">return</span> component.isManualInputAllowed();
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setManualInputAllowed(<span class="type">boolean</span> value) {
        component.setManualInputAllowed(value);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> isMouseWheelEnabled() {
        <span class="keyword">return</span> component.isMouseWheelEnabled();
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setMouseWheelEnabled(<span class="type">boolean</span> value) {
        component.setMouseWheelEnabled(value);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getStepAmount() {
        <span class="keyword">return</span> component.getStepAmount();
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setStepAmount(<span class="type">int</span> amount) {
        component.setStepAmount(amount);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getMaxValue() {
        <span class="keyword">return</span> component.getMaxValue();
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setMaxValue(<span class="type">int</span> maxValue) {
        component.setMaxValue(maxValue);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getMinValue() {
        <span class="keyword">return</span> component.getMinValue();
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setMinValue(<span class="type">int</span> minValue) {
        component.setMinValue(minValue);
    }
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>В качестве базового класса выбран <code>WebAbstractField</code>, который реализует логику интерфейса <code>Field</code>.</p> 
           </div> </li> 
          <li> <p><code>StepperLoader</code> в модуле <strong>gui</strong> загружает компонент из его представления в XML.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.addonguidemo.gui.xml.layout.loaders</span>;

<span class="keyword">import</span> <span class="include">com.company.addonguidemo.gui.components.Stepper</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.xml.layout.loaders.AbstractFieldLoader</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">StepperLoader</span> <span class="directive">extends</span> AbstractFieldLoader&lt;Stepper&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> createComponent() {
        resultComponent = factory.createComponent(Stepper.class);
        loadId(resultComponent, element);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> loadComponent() {

        <span class="local-variable">super</span>.loadComponent();

        <span class="predefined-type">String</span> manualInput = element.attributeValue(<span class="string"><span class="delimiter">"</span><span class="content">manualInput</span><span class="delimiter">"</span></span>);
        <span class="keyword">if</span> (manualInput != <span class="predefined-constant">null</span>) {
            resultComponent.setManualInputAllowed(<span class="predefined-type">Boolean</span>.parseBoolean(manualInput));
        }
        <span class="predefined-type">String</span> mouseWheel = element.attributeValue(<span class="string"><span class="delimiter">"</span><span class="content">mouseWheel</span><span class="delimiter">"</span></span>);
        <span class="keyword">if</span> (mouseWheel != <span class="predefined-constant">null</span>) {
            resultComponent.setMouseWheelEnabled(<span class="predefined-type">Boolean</span>.parseBoolean(mouseWheel));
        }
        <span class="predefined-type">String</span> stepAmount = element.attributeValue(<span class="string"><span class="delimiter">"</span><span class="content">stepAmount</span><span class="delimiter">"</span></span>);
        <span class="keyword">if</span> (stepAmount != <span class="predefined-constant">null</span>) {
            resultComponent.setStepAmount(<span class="predefined-type">Integer</span>.parseInt(stepAmount));
        }
        <span class="predefined-type">String</span> maxValue = element.attributeValue(<span class="string"><span class="delimiter">"</span><span class="content">maxValue</span><span class="delimiter">"</span></span>);
        <span class="keyword">if</span> (maxValue != <span class="predefined-constant">null</span>) {
            resultComponent.setMaxValue(<span class="predefined-type">Integer</span>.parseInt(maxValue));
        }
        <span class="predefined-type">String</span> minValue = element.attributeValue(<span class="string"><span class="delimiter">"</span><span class="content">minValue</span><span class="delimiter">"</span></span>);
        <span class="keyword">if</span> (minValue != <span class="predefined-constant">null</span>) {
            resultComponent.setMinValue(<span class="predefined-type">Integer</span>.parseInt(minValue));
        }
    }
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Логика загрузки базовых свойств компонента <code>Field</code> сосредоточена в классе <code>AbstractFieldLoader</code>. Нам достаточно загрузить только специфические свойства <code>Stepper</code>.</p> 
           </div> </li> 
          <li> <p>В файле <code>cuba-ui-component.xml</code>, расположенном в корне модуля <strong>web</strong>, регистрируется новый компонент и его загрузчик. Оставляем файл без изменений.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="tag">&lt;components&gt;</span>
    <span class="tag">&lt;component</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/components.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;name&gt;</span>stepper<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;componentLoader&gt;</span>com.company.addonguidemo.gui.xml.layout.loaders.StepperLoader<span class="tag">&lt;/componentLoader&gt;</span>
        <span class="tag">&lt;class&gt;</span>com.company.addonguidemo.web.gui.components.WebStepper<span class="tag">&lt;/class&gt;</span>
    <span class="tag">&lt;/component&gt;</span>
<span class="tag">&lt;/components&gt;</span></code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Файл <code>ui-component.xsd</code>, расположенный в корне модуля <strong>gui</strong>, это описатель XML схемы новых компонентов проекта. Добавим к элементу <code>stepper</code> описание его атрибутов.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="tag">&lt;xs:schema</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.company.com/agd/0.1/ui-component.xsd</span><span class="delimiter">"</span></span>
           <span class="attribute-name">attributeFormDefault</span>=<span class="string"><span class="delimiter">"</span><span class="content">unqualified</span><span class="delimiter">"</span></span>
           <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">"</span><span class="content">qualified</span><span class="delimiter">"</span></span>
           <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.company.com/agd/0.1/ui-component.xsd</span><span class="delimiter">"</span></span>
           <span class="attribute-name">xmlns:xs</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;xs:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">stepper</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xs:complexType&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:string</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">caption</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:string</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">width</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:string</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">height</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:string</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">datasource</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:string</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">property</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:string</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">manualInput</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:boolean</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">mouseWheel</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:boolean</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">stepAmount</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:int</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">maxValue</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:int</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;xs:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">minValue</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">xs:int</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xs:complexType&gt;</span>
    <span class="tag">&lt;/xs:element&gt;</span>
<span class="tag">&lt;/xs:schema&gt;</span></code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Далее рассмотрим, как добавить новый компонент на экран.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Создадим новую сущность <code>Customer</code> с двумя полями:</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p><code>name</code> типа String</p> </li> 
             <li> <p><code>score</code> типа Integer</p> </li> 
            </ul> 
           </div> </li> 
          <li> <p>Сгенерируем для новой сущности стандартные экраны.</p> </li> 
          <li> <p>Далее добавим компонент <code>stepper</code> на экран. Вы можете поместить его как в <a href="/manual.html#gui_FieldGroup">FieldGroup</a>, так и в отдельный контейнер. Рассмотрим оба способа.</p> 
           <div class="olist arabic"> 
            <ol class="arabic"> 
             <li> <p>Использование компонента в экране внутри произвольного контейнера.</p> 
              <div class="openblock"> 
               <div class="content"> 
                <div class="ulist"> 
                 <ul> 
                  <li> <p>Откройте файл <code>customer-edit.xml</code>.</p> </li> 
                  <li> <p>Объявите новое пространство имен <code>xmlns:app="http://schemas.company.com/agd/0.1/ui-component.xsd"</code></p> </li> 
                  <li> <p>Удалите поле <code>score</code> из <code>fieldGroup</code>.</p> </li> 
                  <li> <p>Добавьте компонент <code>stepper</code> на экран.</p> </li> 
                 </ul> 
                </div> 
                <div class="paragraph"> 
                 <p>В результате XML-дескриптор редактора должен выглядеть так:</p> 
                </div> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="tag">&lt;window</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/window.xsd</span><span class="delimiter">"</span></span>
        <span class="attribute-name">xmlns:app</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.company.com/agd/0.1/ui-component.xsd</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://editCaption</span><span class="delimiter">"</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addonguidemo.gui.customer.CustomerEdit</span><span class="delimiter">"</span></span>
        <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
        <span class="attribute-name">focusComponent</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span>
        <span class="attribute-name">messagesPack</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addonguidemo.gui.customer</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dsContext&gt;</span>
        <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addonguidemo.entity.Customer</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dsContext&gt;</span>
    <span class="tag">&lt;layout</span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/column&gt;</span>
        <span class="tag">&lt;/fieldGroup&gt;</span>
        <span class="tag">&lt;app:stepper</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">stepper</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Score</span><span class="delimiter">"</span></span>
                     <span class="attribute-name">minValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">1</span><span class="delimiter">"</span></span> <span class="attribute-name">maxValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">20</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;frame</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span> <span class="attribute-name">screen</span>=<span class="string"><span class="delimiter">"</span><span class="content">editWindowActions</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/layout&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
                 </div> 
                </div> 
                <div class="paragraph"> 
                 <p>В данном примере компонент <code>stepper</code> подсоединен к атрибуту <code>score</code> сущности <code>Customer</code>, экземпляр которой находится в источнике данных <code>customerDs</code>.</p> 
                </div> 
               </div> 
              </div> </li> 
             <li> <p>Использование компонента в поле <a href="/manual.html#gui_FieldGroup">FieldGroup</a>:</p> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="tag">&lt;window</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/window.xsd</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://editCaption</span><span class="delimiter">"</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addonguidemo.gui.customer.CustomerEdit</span><span class="delimiter">"</span></span>
        <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
        <span class="attribute-name">focusComponent</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span>
        <span class="attribute-name">messagesPack</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addonguidemo.gui.customer</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dsContext&gt;</span>
        <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addonguidemo.entity.Customer</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dsContext&gt;</span>
    <span class="tag">&lt;layout</span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span> <span class="attribute-name">custom</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/column&gt;</span>
        <span class="tag">&lt;/fieldGroup&gt;</span>
        <span class="tag">&lt;frame</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span> <span class="attribute-name">screen</span>=<span class="string"><span class="delimiter">"</span><span class="content">editWindowActions</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/layout&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.addonguidemo.web.customer</span>;

<span class="keyword">import</span> <span class="include">com.company.addonguidemo.gui.components.Stepper</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.AbstractEditor</span>;
<span class="keyword">import</span> <span class="include">com.company.addonguidemo.entity.Customer</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.FieldGroup</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.data.Datasource</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.xml.layout.ComponentsFactory</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerEdit</span> <span class="directive">extends</span> AbstractEditor&lt;Customer&gt; {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> ComponentsFactory componentsFactory;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> FieldGroup fieldGroup;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Datasource&lt;Customer&gt; customerDs;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        Stepper stepper = componentsFactory.createComponent(Stepper.class);
        stepper.setDatasource(customerDs, <span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span>);
        stepper.setWidth(<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>);
        fieldGroup.getFieldNN(<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span>).setComponent(stepper);
    }
}</code></pre> 
               </div> 
              </div> </li> 
            </ol> 
           </div> </li> 
          <li> <p>Для адаптации внешнего вида компонента создадим в проекте расширение темы. Для этого в Studio выполним команду <strong>Create theme extension</strong> секции <strong>Project properties</strong> навигатора. В списке тем для расширения выберем <code>halo</code> и нажмем кнопку <strong>Create</strong>. Затем откроем файл <code>themes/halo/halo-ext.scss</code> модуля <strong>web</strong>, и добавим в него следующий код:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../halo/halo</span><span class="delimiter">"</span></span>;

<span class="comment">/* Define your theme modifications inside next mixin */</span>
<span class="directive">@mixin</span> <span class="tag">halo-ext</span> {
    <span class="directive">@include</span> <span class="key">halo</span>;

    <span class="comment">/* Basic styles for stepper inner text box */</span>
    .<span class="key">stepper</span> <span class="key">input</span><span class="error">[</span><span class="key">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">text</span><span class="delimiter">"</span></span><span class="error">]</span> {
       <span class="directive">@include</span> <span class="key">box-defaults</span>;
       <span class="directive">@include</span> <span class="key">valo-textfield-style</span>;
       <span class="error">&amp;</span>:<span class="value">focus</span> {
         <span class="directive">@include</span> <span class="key">valo-textfield-focus-style</span>;
       }
    }
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Запускаем сервер приложения. Экран редактирования должен выглядеть следующим образом:</p> </li> 
         </ul> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/customer_edit_result.png" alt="customer edit result"> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="js_library_sample"><a class="anchor" href="/manual.html#js_library_sample"></a>4.5.5.3. Подключение JavaScript библиотеки</h5> 
        <div class="paragraph"> 
         <p>В данном примере мы подключим компонент <a href="https://jqueryui.com/slider/#range" target="_blank">Slider</a> из библиотеки <strong>jQuery UI</strong>. Слайдер будет иметь два ползунка, определяющих диапазон значений.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Создайте новый проект в CUBA Studio и назовите его <code>jscomponent</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Далее нажмите на кнопку <strong>New UI component</strong>. Откроется окно создания визуального компонента <strong>UI component generation</strong>. В секции <strong>Component type</strong> выберите значение <code>JavaScript component</code>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/studio_js_component_wizard.png" alt="studio js component wizard"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>В поле <strong>Vaadin component class name</strong> диалога генерации компонента введите значение <code>SliderServerComponent</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Уберите флажок <strong>Integrate into Generic UI</strong>. Процесс интеграции компонента в универсальный интерфейс аналогичен описанному в разделе <a href="/manual.html#vaadin_addon_sample_gui">Подключение аддона Vaadin с интеграцией в Generic UI</a>, поэтому рассматривать его здесь мы не будем.</p> 
        </div> 
        <div class="paragraph"> 
         <p>После нажатия кнопки <strong>OK</strong> Studio сгенерирует файлы:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>SliderServerComponent</code> - интегрированный с JavaScript компонент Vaadin.</p> </li> 
          <li> <p><code>SliderState</code> - класс состояния компонента Vaadin.</p> </li> 
          <li> <p><code>slider-connector.js</code> - JavaScript коннектор для компонента Vaadin</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Последовательно пройдемся по сгенерированным заготовкам файлов и внесем в них необходимые изменения.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Класс состояния <code>SliderState</code> определяет, какие данные будут пересылаться между сервером и клиентом. В нашем случае мы будем пересылать информацию о минимальном и максимальном возможном значении и выбранных значениях слайдера.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.jscomponent.web.toolkit.ui.slider</span>;

<span class="keyword">import</span> <span class="include">com.vaadin.shared.ui.JavaScriptComponentState</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SliderState</span> <span class="directive">extends</span> JavaScriptComponentState {
    <span class="directive">public</span> <span class="type">double</span><span class="type">[]</span> values;
    <span class="directive">public</span> <span class="type">double</span> minValue;
    <span class="directive">public</span> <span class="type">double</span> maxValue;
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Серверный компонент Vaadin <code>SliderServerComponent</code>.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.jscomponent.web.toolkit.ui.slider</span>;

<span class="keyword">import</span> <span class="include">com.vaadin.annotations.StyleSheet</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.ui.AbstractJavaScriptComponent</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.annotations.JavaScript</span>;
<span class="keyword">import</span> <span class="include">elemental.json.JsonArray</span>;

<span class="annotation">@JavaScript</span>({<span class="string"><span class="delimiter">"</span><span class="content">slider-connector.js</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">jquery-ui.js</span><span class="delimiter">"</span></span>})
<span class="annotation">@StyleSheet</span>({<span class="string"><span class="delimiter">"</span><span class="content">jquery-ui.css</span><span class="delimiter">"</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">SliderServerComponent</span> <span class="directive">extends</span> AbstractJavaScriptComponent {

    <span class="directive">public</span> <span class="type">interface</span> <span class="class">ValueChangeListener</span> {
        <span class="type">void</span> valueChanged(<span class="type">double</span><span class="type">[]</span> newValue);
    }

    <span class="directive">private</span> ValueChangeListener listener;

    <span class="directive">public</span> SliderServerComponent() {
        addFunction(<span class="string"><span class="delimiter">"</span><span class="content">valueChanged</span><span class="delimiter">"</span></span>, arguments -&gt; {
            JsonArray array = arguments.getArray(<span class="integer">0</span>);
            <span class="type">double</span><span class="type">[]</span> values = <span class="keyword">new</span> <span class="type">double</span>[<span class="integer">2</span>];
            values[<span class="integer">0</span>] = array.getNumber(<span class="integer">0</span>);
            values[<span class="integer">1</span>] = array.getNumber(<span class="integer">1</span>);
            listener.valueChanged(values);
        });
    }

    <span class="directive">public</span> <span class="type">void</span> setValue(<span class="type">double</span><span class="type">[]</span> value) {
        getState().values = value;
    }

    <span class="directive">public</span> <span class="type">double</span><span class="type">[]</span> getValue() {
        <span class="keyword">return</span> getState().values;
    }

    <span class="directive">public</span> <span class="type">double</span> getMinValue() {
        <span class="keyword">return</span> getState().minValue;
    }

    <span class="directive">public</span> <span class="type">void</span> setMinValue(<span class="type">double</span> minValue) {
        getState().minValue = minValue;
    }

    <span class="directive">public</span> <span class="type">double</span> getMaxValue() {
        <span class="keyword">return</span> getState().maxValue;
    }

    <span class="directive">public</span> <span class="type">void</span> setMaxValue(<span class="type">double</span> maxValue) {
        getState().maxValue = maxValue;
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> SliderState getState() {
        <span class="keyword">return</span> (SliderState) <span class="local-variable">super</span>.getState();
    }

    <span class="directive">public</span> ValueChangeListener getListener() {
        <span class="keyword">return</span> listener;
    }

    <span class="directive">public</span> <span class="type">void</span> setListener(ValueChangeListener listener) {
        <span class="local-variable">this</span>.listener = listener;
    }
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Серверный компонент Vaadin определяет набор геттеров и сеттеров для работы с состоянием слайдера, а также интерфейс слушателя изменения значений. Класс компонента должен быть унаследован от <code>AbstractJavaScriptComponent</code>.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Метод <code>addFunction()</code> в конструкторе класса объявляет обработчик RPC-вызова функции <code>valueChanged()</code> с клиента.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Аннотации <code>@JavaScript</code> и <code>@StyleSheet</code> указывают на файлы, которые должны быть загружены на веб-страницу. В нашем примере это JavaScript файлы библиотеки jQuery UI и коннектора, а также файл со стилями для jQuery UI. Расположим их в одном Java-пакете с серверным компонентом.</p> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Скачайте архив jQuery UI с сайта <a href="http://jqueryui.com/download" class="bare" target="_blank">http://jqueryui.com/download</a> и поместите файлы <code>jquery-ui.js</code> и <code>jquery-ui.css</code> в пакет с классом <code>SliderServerComponent</code>. На странице скачивания jQuery UI у вас будет возможность выбрать компоненты, которые будут помещены в архив. Для нашего примера достаточно выделить пункт <code>Slider</code> группы <code>Widgets</code>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/js_project_structure.png" alt="js project structure"> 
         </div> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>JavaScript коннектор <code>slider-connector.js</code>.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="javascript"><span class="function">com_company_jscomponent_web_toolkit_ui_slider_SliderServerComponent</span> = <span class="keyword">function</span>() {
    <span class="keyword">var</span> connector = <span class="local-variable">this</span>;
    <span class="keyword">var</span> element = connector.getElement();
    <span class="predefined">$</span>(element).html(<span class="string"><span class="delimiter">"</span><span class="content">&lt;div/&gt;</span><span class="delimiter">"</span></span>);
    <span class="predefined">$</span>(element).css(<span class="string"><span class="delimiter">"</span><span class="content">padding</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">5px 10px</span><span class="delimiter">"</span></span>);

    <span class="keyword">var</span> slider = <span class="predefined">$</span>(<span class="string"><span class="delimiter">"</span><span class="content">div</span><span class="delimiter">"</span></span>, element).slider({
        <span class="key">range</span>: <span class="predefined-constant">true</span>,
        <span class="function">slide</span>: <span class="keyword">function</span>(event, ui) {
            connector.valueChanged(ui.values);
        }
    });

    connector.<span class="function">onStateChange</span> = <span class="keyword">function</span>() {
        <span class="keyword">var</span> state = connector.getState();
        slider.slider(<span class="string"><span class="delimiter">"</span><span class="content">values</span><span class="delimiter">"</span></span>, state.values);
        slider.slider(<span class="string"><span class="delimiter">"</span><span class="content">option</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">min</span><span class="delimiter">"</span></span>, state.minValue);
        slider.slider(<span class="string"><span class="delimiter">"</span><span class="content">option</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">max</span><span class="delimiter">"</span></span>, state.maxValue);
        <span class="predefined">$</span>(element).width(state.width);
    }
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Коннектор представляет собой функцию, которая при загрузке веб-страницы проинициализирует JavaScript компонент. Имя функции должно соответствовать полному имени класса серверного компонента, где точки в имени пакета заменены на символ подчеркивания.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Vaadin добавляет ряд полезных методов в фунцию коннектора. Например, <code>this.getElement()</code> возвращает HTML DOM элемент компонента, <code>this.getState()</code> возвращает объект-состояние.</p> 
           </div> 
           <div class="paragraph"> 
            <p>В нашем примере коннектор делает следующее:</p> 
           </div> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="ulist"> 
              <ul> 
               <li> <p>Инициализирует компонент <code>slider</code> из библиотеки jQuery UI. При изменении положения одного из ползунков будет вызывана функция <code>slide()</code>. Мы видим, что она в свою очередь вызывает метод <code>valueChanged()</code> коннектора. <code>valueChanged()</code> - это метод, который мы объявили на стороне сервера в классе <code>SliderServerComponent</code>.</p> </li> 
               <li> <p>Объявляет функцию <code>onStateChange()</code>. Она будет вызываться при изменении объекта-состояния на стороне сервера.</p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Для демонстрации работы компонента создадим сущность <code>Product</code> с тремя атрибутами:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>name</code> типа String</p> </li> 
          <li> <p><code>minDiscount</code> типа Double</p> </li> 
          <li> <p><code>maxDiscount</code> типа Double</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Затем сгенерируем стандартные экраны для данной сущности. Обратите внимание, что мы используем не универсальный компонент платформы, а "нативный" компонент Vaadin. Следовательно экраны должны располагаться в модуле Web, а не в GUI - укажите это в окне генерации стандартных экранов.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В редакторе сущности мы хотим устанавливать минимальное и максимальное значение скидки с помощью компонента <code>slider</code>, который мы только что создали.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Перейдите к файлу <code>product-edit.xml</code>. Поля <code>minDiscount</code> и <code>maxDiscount</code> сделайте нередактируемыми, добавив к соответствующим элементам атрибут <code>editable="false"</code>. Затем добавьте в <code>fieldGroup</code> новое кастомное поле <code>slider</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В результате XML-дескриптор экрана редактирования должен выглядеть следующим образом:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="tag">&lt;window</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/window.xsd</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://editCaption</span><span class="delimiter">"</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.jscomponent.web.product.ProductEdit</span><span class="delimiter">"</span></span>
        <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">productDs</span><span class="delimiter">"</span></span>
        <span class="attribute-name">focusComponent</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span>
        <span class="attribute-name">messagesPack</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.jscomponent.web.product</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dsContext&gt;</span>
        <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">productDs</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.jscomponent.entity.Product</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dsContext&gt;</span>
    <span class="tag">&lt;layout</span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span>
            <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">productDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">minDiscount</span><span class="delimiter">"</span></span> <span class="attribute-name">editable</span>=<span class="string"><span class="delimiter">"</span><span class="content">false</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">maxDiscount</span><span class="delimiter">"</span></span> <span class="attribute-name">editable</span>=<span class="string"><span class="delimiter">"</span><span class="content">false</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">slider</span><span class="delimiter">"</span></span> <span class="attribute-name">custom</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/column&gt;</span>
        <span class="tag">&lt;/fieldGroup&gt;</span>
        <span class="tag">&lt;frame</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span>
               <span class="attribute-name">screen</span>=<span class="string"><span class="delimiter">"</span><span class="content">editWindowActions</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/layout&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Перейдите к файлу <code>ProductEdit.java</code>. Замените его содержимое следующим кодом:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.jscomponent.web.product</span>;

<span class="keyword">import</span> <span class="include">com.company.jscomponent.web.toolkit.ui.slider.SliderServerComponent</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.AbstractEditor</span>;
<span class="keyword">import</span> <span class="include">com.company.jscomponent.entity.Product</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.Component</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.FieldGroup</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.VBoxLayout</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.data.Datasource</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.xml.layout.ComponentsFactory</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.web.gui.components.WebComponentsHelper</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.ui.Layout</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ProductEdit</span> <span class="directive">extends</span> AbstractEditor&lt;Product&gt; {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> FieldGroup fieldGroup;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> ComponentsFactory componentsFactory;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Datasource&lt;Product&gt; productDs;

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> initNewItem(Product item) {
        <span class="local-variable">super</span>.initNewItem(item);
        item.setMinDiscount(<span class="float">15.0</span>);
        item.setMaxDiscount(<span class="float">70.0</span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> postInit() {
        <span class="local-variable">super</span>.postInit();

        <span class="predefined-type">Component</span> box = componentsFactory.createComponent(VBoxLayout.class);
        Layout vBox = (Layout) WebComponentsHelper.unwrap(box);
        SliderServerComponent slider = <span class="keyword">new</span> SliderServerComponent();
        slider.setValue(<span class="keyword">new</span> <span class="type">double</span><span class="type">[]</span>{getItem().getMinDiscount(), getItem().getMaxDiscount()});
        slider.setMinValue(<span class="integer">0</span>);
        slider.setMaxValue(<span class="integer">100</span>);
        slider.setWidth(<span class="string"><span class="delimiter">"</span><span class="content">240px</span><span class="delimiter">"</span></span>);
        slider.setListener(newValue -&gt; {
            getItem().setMinDiscount(newValue[<span class="integer">0</span>]);
            getItem().setMaxDiscount(newValue[<span class="integer">1</span>]);
        });
        vBox.addComponent(slider);
        fieldGroup.getFieldNN(<span class="string"><span class="delimiter">"</span><span class="content">slider</span><span class="delimiter">"</span></span>).setComponent(box);
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>В методе <code>initNewItem()</code> мы проставляем начальные значения скидок для нового продукта.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В методе <code>init()</code> инициализируем кастомное поле для слайдера. Для компонента слайдера мы проставляем текущие значения, максимальное и минимальное значения, а также объявляем слушатель изменений значений. При движении ползунка мы будем проставлять новые значения скидок в соответвующие поля редактируемой сущности.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Запустите проект и откройте экран редактирования продукта. Изменение положения ползунка на слайдере должно изменять значение в соответствующем текстовом поле.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/product_edit.png" alt="product edit"> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="gwt_component_sample"><a class="anchor" href="/manual.html#gwt_component_sample"></a>4.5.5.4. Создание GWT компонента</h5> 
        <div class="paragraph"> 
         <p>В данном примере мы рассмотрим создание простого GWT-компонента - поля рейтинга в виде 5 звезд, а также использование его в экранах приложения.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/rating_field_component.png" alt="rating field component"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Создадим новый проект в CUBA Studio. Имя проекта - <code>ratingsample</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Создайте модуль <strong>web-toolkit</strong>, нажав на кнопку <strong>Create web-toolkit module</strong> секции <strong>Project properties</strong> навигатора Studio.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Далее нажмите на ссылку <strong>Create new UI component</strong>. Откроется окно создания визуального компонента <strong>New UI component</strong>. В секции <strong>Component type</strong> выберите значение <code>New GWT component</code>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/studio_gwt_component_wizard.png" alt="studio gwt component wizard"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>В поле <strong>Vaadin component class name</strong> диалога генерации компонента введите значение <code>RatingFieldServerComponent</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Снимите флажок <strong>Integrate into Generic UI</strong>. Процесс интеграции компонента в универсальный интерфейс аналогичен описанному в разделе <a href="/manual.html#vaadin_addon_sample_gui">Подключение аддона Vaadin с интеграцией в Generic UI</a>, поэтому рассматривать его здесь мы не будем.</p> 
        </div> 
        <div class="paragraph"> 
         <p>После нажатия кнопки <strong>OK</strong> Studio сгенерирует файлы:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>RatingFieldWidget.java</code> - виджет GWT в модуле <strong>web-toolkit</strong>.</p> </li> 
          <li> <p><code>RatingFieldServerComponent.java</code> - класс компонента Vaadin.</p> </li> 
          <li> <p><code>RatingFieldState.java</code> - класс состояния компонента.</p> </li> 
          <li> <p><code>RatingFieldConnector.java</code> - коннектор, связывающий клиентский код с серверным компонентом.</p> </li> 
          <li> <p><code>RatingFieldServerRpc.java</code> - класс, определяющий API сервера для клиентской части.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Последовательно рассмотрим сгенерированные студией заготовки файлов и внесем в них необходимые изменения.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>GWT виджет <code>RatingFieldWidget.java</code>. Замените содержимое файла на следующий код:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.ratingsample.web.toolkit.ui.client.ratingfield</span>;

<span class="keyword">import</span> <span class="include">com.google.gwt.dom.client.DivElement</span>;
<span class="keyword">import</span> <span class="include">com.google.gwt.dom.client.SpanElement</span>;
<span class="keyword">import</span> <span class="include">com.google.gwt.dom.client.Style.Display</span>;
<span class="keyword">import</span> <span class="include">com.google.gwt.user.client.DOM</span>;
<span class="keyword">import</span> <span class="include">com.google.gwt.user.client.Event</span>;
<span class="keyword">import</span> <span class="include">com.google.gwt.user.client.ui.FocusWidget</span>;

<span class="keyword">import</span> <span class="include">java.util.ArrayList</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">RatingFieldWidget</span> <span class="directive">extends</span> FocusWidget {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> CLASSNAME = <span class="string"><span class="delimiter">"</span><span class="content">ratingfield</span><span class="delimiter">"</span></span>;

    <span class="comment">// API for handle clicks</span>
    <span class="directive">public</span> <span class="type">interface</span> <span class="class">StarClickListener</span> {
        <span class="type">void</span> starClicked(<span class="type">int</span> value);
    }

    <span class="directive">protected</span> <span class="predefined-type">List</span>&lt;SpanElement&gt; stars = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;SpanElement&gt;(<span class="integer">5</span>);
    <span class="directive">protected</span> StarClickListener listener;
    <span class="directive">protected</span> <span class="type">int</span> value = <span class="integer">0</span>;

    <span class="directive">public</span> RatingFieldWidget() {
        DivElement container = DOM.createDiv().cast();
        container.getStyle().setDisplay(Display.INLINE_BLOCK);
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; <span class="integer">5</span>; i++) {
            SpanElement star = DOM.createSpan().cast();

            <span class="comment">// add star element to the container</span>
            DOM.insertChild(container, star, i);
            <span class="comment">// subscribe on ONCLICK event</span>
            DOM.sinkEvents(star, <span class="predefined-type">Event</span>.ONCLICK);

            stars.add(star);
        }
        setElement(container);

        setStylePrimaryName(CLASSNAME);
    }

    <span class="comment">// main method for handling events in GWT widgets</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onBrowserEvent(<span class="predefined-type">Event</span> event) {
        <span class="local-variable">super</span>.onBrowserEvent(event);

        <span class="keyword">switch</span> (event.getTypeInt()) {
            <span class="comment">// react on ONCLICK event</span>
            <span class="keyword">case</span> <span class="predefined-type">Event</span>.ONCLICK:
                SpanElement element = event.getEventTarget().cast();
                <span class="comment">// if click was on the star</span>
                <span class="type">int</span> index = stars.indexOf(element);
                <span class="keyword">if</span> (index &gt;= <span class="integer">0</span>) {
                    <span class="type">int</span> value = index + <span class="integer">1</span>;
                    <span class="comment">// set internal value</span>
                    setValue(value);

                    <span class="comment">// notify listeners</span>
                    <span class="keyword">if</span> (listener != <span class="predefined-constant">null</span>) {
                        listener.starClicked(value);
                    }
                }
                <span class="keyword">break</span>;
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setStylePrimaryName(<span class="predefined-type">String</span> style) {
        <span class="local-variable">super</span>.setStylePrimaryName(style);

        <span class="keyword">for</span> (SpanElement star : stars) {
            star.setClassName(style + <span class="string"><span class="delimiter">"</span><span class="content">-star</span><span class="delimiter">"</span></span>);
        }

        updateStarsStyle(<span class="local-variable">this</span>.value);
    }

    <span class="comment">// let application code change the state</span>
    <span class="directive">public</span> <span class="type">void</span> setValue(<span class="type">int</span> value) {
        <span class="local-variable">this</span>.value = value;
        updateStarsStyle(value);
    }

    <span class="comment">// refresh visual representation</span>
    <span class="directive">private</span> <span class="type">void</span> updateStarsStyle(<span class="type">int</span> value) {
        <span class="keyword">for</span> (SpanElement star : stars) {
            star.removeClassName(getStylePrimaryName() + <span class="string"><span class="delimiter">"</span><span class="content">-star-selected</span><span class="delimiter">"</span></span>);
        }

        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; value; i++) {
            stars.get(i).addClassName(getStylePrimaryName() + <span class="string"><span class="delimiter">"</span><span class="content">-star-selected</span><span class="delimiter">"</span></span>);
        }
    }
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Виджет представляет собой клиентский класс, отвечающий за отображение компонента в веб-браузере и реакцию на события. Он определяет интерфейсы для работы с серверной частью. В нашем случае это метод <code>setValue()</code> и интерфейс <code>StarClickListener</code>.</p> 
           </div> </li> 
          <li> <p>Класс компонента Vaadin <code>RatingFieldServerComponent</code>. Он определяет API для серверного кода, различные get/set методы, слушатели событий и подключение источников данных. Прикладные разработчики используют в своём коде методы этого класса.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.ratingsample.web.toolkit.ui</span>;

<span class="keyword">import</span> <span class="include">com.company.ratingsample.web.toolkit.ui.client.ratingfield.RatingFieldServerRpc</span>;
<span class="keyword">import</span> <span class="include">com.company.ratingsample.web.toolkit.ui.client.ratingfield.RatingFieldState</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.ui.AbstractField</span>;

<span class="comment">// the field will have a value with integer type</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RatingFieldServerComponent</span> <span class="directive">extends</span> AbstractField&lt;<span class="predefined-type">Integer</span>&gt; {

    <span class="directive">public</span> RatingFieldServerComponent() {
        <span class="comment">// register an interface implementation that will be invoked on a request from the client</span>
        registerRpc((RatingFieldServerRpc) value -&gt; setValue(value, <span class="predefined-constant">true</span>));
    }

    <span class="comment">// field value type</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Integer</span>&gt; getType() {
        <span class="keyword">return</span> <span class="predefined-type">Integer</span>.class;
    }

    <span class="comment">// define own state class</span>
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> RatingFieldState getState() {
        <span class="keyword">return</span> (RatingFieldState) <span class="local-variable">super</span>.getState();
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> RatingFieldState getState(<span class="type">boolean</span> markAsDirty) {
        <span class="keyword">return</span> (RatingFieldState) <span class="local-variable">super</span>.getState(markAsDirty);
    }

    <span class="comment">// we need to refresh the state when setValue is invoked from the application code</span>
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> setInternalValue(<span class="predefined-type">Integer</span> newValue) {
        <span class="local-variable">super</span>.setInternalValue(newValue);
        <span class="keyword">if</span> (newValue == <span class="predefined-constant">null</span>) {
            newValue = <span class="integer">0</span>;
        }
        getState().value = newValue;
    }
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Класс состояния <code>RatingFieldState</code> отвечает за то, какие данные будут пересылаться между клиентом и сервером. В нём определяются публичные поля, которые будут автоматически сериализованы на сервере и десериализованы на клиенте.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.ratingsample.web.toolkit.ui.client.ratingfield</span>;

<span class="keyword">import</span> <span class="include">com.vaadin.shared.AbstractFieldState</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">RatingFieldState</span> <span class="directive">extends</span> AbstractFieldState {
    {   <span class="comment">// change the main style name of the component</span>
        primaryStyleName = <span class="string"><span class="delimiter">"</span><span class="content">ratingfield</span><span class="delimiter">"</span></span>;
    }
    <span class="comment">// define a field for the value</span>
    <span class="directive">public</span> <span class="type">int</span> value = <span class="integer">0</span>;
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Интерфейс <code>RatingFieldServerRpc</code> — определяет API сервера для клиентской части, его методы могут вызываться с клиента при помощи механизма удалённого вызова процедур, встроенного в Vaadin. Этот интерфейс мы реализуем в самом компоненте, в данном случае просто вызываем метод <code>setValue()</code> нашего поля.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.ratingsample.web.toolkit.ui.client.ratingfield</span>;

<span class="keyword">import</span> <span class="include">com.vaadin.shared.communication.ServerRpc</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">RatingFieldServerRpc</span> <span class="directive">extends</span> ServerRpc {
    <span class="comment">//method will be invoked in the client code</span>
    <span class="type">void</span> starClicked(<span class="type">int</span> value);
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Коннектор <code>RatingFieldConnector</code> связывает клиентский код с серверной частью.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.ratingsample.web.toolkit.ui.client.ratingfield</span>;

<span class="keyword">import</span> <span class="include">com.company.ratingsample.web.toolkit.ui.RatingFieldServerComponent</span>;
<span class="keyword">import</span> <span class="include">com.company.ratingsample.web.toolkit.ui.client.ratingfield.RatingFieldServerRpc</span>;
<span class="keyword">import</span> <span class="include">com.company.ratingsample.web.toolkit.ui.client.ratingfield.RatingFieldState</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.client.communication.StateChangeEvent</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.client.ui.AbstractFieldConnector</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.shared.ui.Connect</span>;

<span class="comment">// link the connector with the server implementation of RatingField</span>
<span class="comment">// extend AbstractField connector</span>
<span class="annotation">@Connect</span>(RatingFieldServerComponent.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RatingFieldConnector</span> <span class="directive">extends</span> AbstractFieldConnector {

    <span class="comment">// we will use a RatingFieldWidget widget</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> RatingFieldWidget getWidget() {
        RatingFieldWidget widget = (RatingFieldWidget) <span class="local-variable">super</span>.getWidget();

        <span class="keyword">if</span> (widget.listener == <span class="predefined-constant">null</span>) {
            widget.listener = <span class="keyword">new</span> RatingFieldWidget.StarClickListener() {
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">void</span> starClicked(<span class="type">int</span> value) {
                    getRpcProxy(RatingFieldServerRpc.class).starClicked(value);
                }
            };
        }
        <span class="keyword">return</span> widget;
    }

    <span class="comment">// our state class is RatingFieldState</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> RatingFieldState getState() {
        <span class="keyword">return</span> (RatingFieldState) <span class="local-variable">super</span>.getState();
    }

    <span class="comment">// react on server state change</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStateChanged(StateChangeEvent stateChangeEvent) {
        <span class="local-variable">super</span>.onStateChanged(stateChangeEvent);

        <span class="comment">// refresh the widget if the value on server has changed</span>
        <span class="keyword">if</span> (stateChangeEvent.hasPropertyChanged(<span class="string"><span class="delimiter">"</span><span class="content">value</span><span class="delimiter">"</span></span>)) {
            getWidget().setValue(getState().value);
        }
    }
}</code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Код виджета <code>RatingFieldWidget</code> не определяет внешний вид компонента, кроме назначения имён стилей ключевым элементам. Для того, чтобы определить внешний вид нашего компонента, создадим файлы стилей. Для этого можно воспользоваться ссылкой <strong>Create theme extension</strong> секции <strong>Project properties</strong> в навигаторе Studio. В появившемся диалоге выбираем тему <code>halo</code>. Эта тема использует вместо иконок глифы шрифта FontAwesome, чем мы и воспользуемся. Studio создаст пустые файлы SCSS для расширения темы в каталоге <code>themes</code> модуля <strong>web</strong>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Стили каждого компонента принято выделять в отдельный файл <code>componentname.scss</code> в каталоге <code>components/componentname</code> в формате примеси SCSS. В каталоге <code>themes/halo</code> модуля <code>web</code> создадим структуру вложенных каталогов: <code>components/ratingfield</code>. Затем внутри <code>ratingfield</code> создадим файл <code>ratingfield.scss</code>:</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/gwt_theme_ext_structure.png" alt="gwt theme ext structure"> 
         </div> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@mixin</span> <span class="error">r</span><span class="error">a</span><span class="error">t</span><span class="error">i</span><span class="error">n</span><span class="error">g</span><span class="error">f</span><span class="error">i</span><span class="error">e</span><span class="error">l</span><span class="error">d</span>(<span class="error">$</span><span class="tag">primary-stylename</span>: <span class="tag">ratingfield</span>) {
  .<span class="error">#</span>{<span class="error">$</span><span class="key">primary-stylename</span>}<span class="key">-star</span> {
    <span class="key">font-family</span>: <span class="value">FontAwesome</span>;
    <span class="key">font-size</span>: <span class="error">$</span><span class="value">v-font-size--h2</span>;
    <span class="key">padding-right</span>: <span class="error">r</span><span class="error">o</span><span class="error">u</span><span class="error">n</span><span class="error">d</span>(<span class="error">$</span><span class="value">v-unit-size</span>/<span class="float">4</span>);
    <span class="key">cursor</span>: <span class="value">pointer</span>;

    <span class="error">&amp;</span>:<span class="value">after</span> {
          <span class="key">content</span>: <span class="string"><span class="delimiter">'</span><span class="content">\f006</span><span class="delimiter">'</span></span>; // <span class="string"><span class="delimiter">'</span><span class="content">fa-star-o</span><span class="delimiter">'</span></span>
    }
  }

  .<span class="error">#</span>{<span class="error">$</span><span class="key">primary-stylename</span>}<span class="key">-star-selected</span> {
    <span class="error">&amp;</span>:<span class="value">after</span> {
          <span class="key">content</span>: <span class="string"><span class="delimiter">'</span><span class="content">\f005</span><span class="delimiter">'</span></span>; // <span class="string"><span class="delimiter">'</span><span class="content">fa-star</span><span class="delimiter">'</span></span>
    }
  }

  .<span class="error">#</span>{<span class="error">$</span><span class="key">primary-stylename</span>} .<span class="error">#</span>{<span class="error">$</span><span class="key">primary-stylename</span>}<span class="key">-star</span>:<span class="value">last-child</span> {
    <span class="key">padding-right</span>: <span class="float">0</span>;
  }

  .<span class="error">#</span>{<span class="error">$</span><span class="key">primary-stylename</span>}.<span class="key">v-disabled</span> .<span class="error">#</span>{<span class="error">$</span><span class="key">primary-stylename</span>}<span class="key">-star</span> {
    <span class="key">cursor</span>: <span class="value">default</span>;
  }
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Подключим этот файл в главном файле темы <code>halo-ext.scss</code>:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../halo/halo</span><span class="delimiter">"</span></span>;

<span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">components/ratingfield/ratingfield</span><span class="delimiter">"</span></span>;

<span class="comment">/* Define your theme modifications inside next mixin */</span>
<span class="directive">@mixin</span> <span class="tag">halo-ext</span> {
  <span class="directive">@include</span> <span class="key">halo</span>;

  <span class="directive">@include</span> <span class="key">ratingfield</span>;
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Для демонстрации работы компонента создадим новый экран в модуле <strong>web</strong>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Назовите файл с экраном <code>rating-screen.xml</code>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/gwt_rating_screen_designer.png" alt="gwt rating screen designer"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Добавим экран в меню приложения. Перейдите в секцию <strong>Main menu</strong> навигатора Studio и нажмите кнопку <strong>Edit</strong>. Откроется редактор меню. Добавьте созданный экран в меню <code>application</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Перейдем к редактированию экрана <code>rating-screen.xml</code> в IDE. Нам понадобится контейнер для нашего компонента, объявим его в XML экрана:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="tag">&lt;window</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/window.xsd</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://caption</span><span class="delimiter">"</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.ratingsample.web.screens.RatingScreen</span><span class="delimiter">"</span></span>
        <span class="attribute-name">messagesPack</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.ratingsample.web.screens</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;layout</span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">container</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;vbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">container</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- we'll add vaadin component here--&gt;</span>
        <span class="tag">&lt;/vbox&gt;</span>
    <span class="tag">&lt;/layout&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Откроем класс контроллера экрана <code>RatingScreen.java</code> и добавим код размещения нашего компонента на экране:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.ratingsample.web.screens</span>;

<span class="keyword">import</span> <span class="include">com.company.ratingsample.web.toolkit.ui.RatingFieldServerComponent</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.AbstractWindow</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.BoxLayout</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.web.gui.components.WebComponentsHelper</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.ui.Layout</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">RatingScreen</span> <span class="directive">extends</span> AbstractWindow {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">BoxLayout</span> container;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        <span class="local-variable">super</span>.init(params);
        com.vaadin.ui.Layout containerLayout = (Layout) WebComponentsHelper.unwrap(container);
        RatingFieldServerComponent field = <span class="keyword">new</span> RatingFieldServerComponent();
        field.setCaption(<span class="string"><span class="delimiter">"</span><span class="content">Rate this!</span><span class="delimiter">"</span></span>);
        containerLayout.addComponent(field);
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Запускаем сервер приложения и смотрим на результат.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/rating_screen_result.png" alt="rating screen result"> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="own_component_in_studio"><a class="anchor" href="/manual.html#own_component_in_studio"></a>4.5.5.5. Поддержка собственных компонентов в CUBA Studio</h5> 
        <div class="paragraph"> 
         <p>В данном разделе описывается, как добавить поддержку новых визуальных компонентов в дизайнер экранов CUBA Studio. Новый компонент появится в палитре компонентов, вы сможете перетаскивать его в рабочую область и редактировать его свойства в панели свойств компонента.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Рассмотрим процесс создания интеграции компонента <code>stepper</code>, создание которого было описано в разделе <a href="/manual.html#vaadin_addon_sample_gui">Подключение аддона Vaadin с интеграцией в Generic UI</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Откроем проект, содержащий компонент <code>stepper</code>.</p> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Если указанный проект вы не создавали, то вы можете воспроизвести шаги, описанные ниже, и на новом проекте. Вы увидите поддержку компонента в Studio, но не сможете запустить приложение.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="paragraph"> 
         <p>Нажмем кнопку <strong>Extend Studio</strong> на панели <strong>Project properties</strong>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/ui_component_extension_window.png" alt="ui component extension window"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Рассмотрим поля, которые необходимо заполнить.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><strong>Configuration name</strong> - идентификатор конфигурации. Введем значение <code>stepper</code>.</p> </li> 
          <li> <p><strong>Component XML element</strong> - имя компонента в том виде, как он должен быть добавлен в XML-дескриптор экрана. В нашем случае это <code>stepper</code>.</p> 
           <div class="paragraph"> 
            <p>Поля <strong>Component class name</strong> и <strong>Component model class name</strong> будут заполнены автоматически на основе введенного значения. Оставьте их значения без изменения.</p> 
           </div> </li> 
          <li> <p><strong>Component namespace URI</strong> - пространство имен из XSD, описывающего компонент. Если вы генерировали новый компонент с помощью Studio, то узнать значение для этого поля вы можете в файле <code>ui-component.xsd</code>.</p> </li> 
          <li> <p><strong>Component namespace prefix</strong> - префикс XML-элемента компонента в XML-дескриптор экрана.</p> </li> 
          <li> <p><strong>Standard properties</strong> - стандартные свойства компонента, которые должны быть доступны для редактирования в панели свойств компонента в дизайнере экранов.</p> 
           <div class="paragraph"> 
            <p>Выберите <code>caption</code>, <code>datasource</code> и <code>property</code>.</p> 
           </div> 
           <div class="admonitionblock tip"> 
            <table> 
             <tbody>
              <tr> 
               <td class="icon"> 
                <div class="title">
                 Tip
                </div> </td> 
               <td class="content"> 
                <div class="paragraph"> 
                 <p>Свойства <code>id</code>, <code>align</code>, <code>height</code>, <code>width</code>, <code>enable</code>, <code>stylename</code>, <code>visible</code> по умолчанию доступны для всех компонентов.</p> 
                </div> </td> 
              </tr> 
             </tbody>
            </table> 
           </div> </li> 
          <li> <p><strong>Custom properties</strong> - в данной таблице добавляются специфичные для компонента свойства, которые должны редактироваться в панели свойств дизайнера экранов.</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Добавим следующие свойства:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><strong>manualInput</strong>, тип <code>Boolean</code>, значение по умолчанию <code>true</code></p> </li> 
               <li> <p><strong>mouseWheel</strong>, тип <code>Boolean</code>, значение по умолчанию <code>true</code></p> </li> 
               <li> <p><strong>stepAmount</strong>, тип <code>Integer</code>, значение по умолчанию <code>0</code></p> </li> 
               <li> <p><strong>maxValue</strong>, тип <code>Integer</code>, значение по умолчанию <code>0</code></p> </li> 
               <li> <p><strong>minValue</strong>, тип <code>Integer</code>, значение по умолчанию <code>0</code></p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Далее нажмитие кнопку <strong>OK</strong>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Новые визуальные компоненты инициализируются при старте сервера Studio. Откройте окно сервера Studio, остановите сервер, выйдите из Studio, затем отройте и запустите его снова.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Сгенерируем стандартные экраны для сущности <code>Customer</code> заново, чтобы стереть результаты наших прошлых экспериментов.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Переходим в секцию <strong>GENERIC UI</strong> навигатора студии и открываем экран <code>customer-edit</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Для начала удалим поле <code>score</code> из <code>fieldGroup</code>, т.к. мы хотим для его редактирования использовать специальный компонент.</p> 
        </div> 
        <div class="paragraph"> 
         <p>На палитре компонентов найдите новый компонент <code>Stepper</code> и перетащите его на экран под <code>fieldGroup</code>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/stepper_in_palette.png" alt="stepper in palette"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Выделите компонент <code>stepper</code> и перейдите на закладку свойств компонента <strong>Properties</strong>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/stepper_component_properties.png" alt="stepper component properties"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Заполните необходимые поля:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><strong>id</strong> - <code>stepper</code></p> </li> 
          <li> <p><strong>caption</strong> - <code>Stepper</code></p> </li> 
          <li> <p><strong>datasource</strong> - <code>customerDs</code></p> </li> 
          <li> <p><strong>property</strong> - <code>score</code></p> </li> 
          <li> <p><strong>maxValue</strong> - <code>50</code></p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>После этого перейдите на закладку <strong>XML</strong>, чтобы увидеть результат.</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="tag">&lt;window</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/window.xsd</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://editCaption</span><span class="delimiter">"</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addonguidemo.gui.customer.CustomerEdit</span><span class="delimiter">"</span></span>
        <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
        <span class="attribute-name">focusComponent</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span>
        <span class="attribute-name">messagesPack</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addonguidemo.gui.customer</span><span class="delimiter">"</span></span>
        <span class="attribute-name">xmlns:app</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.company.com/agd/0.1/ui-component.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dsContext&gt;</span>
        <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.addonguidemo.entity.Customer</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/dsContext&gt;</span>
    <span class="tag">&lt;layout</span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span>
            <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/column&gt;</span>
        <span class="tag">&lt;/fieldGroup&gt;</span>
        <span class="tag">&lt;app:stepper</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">stepper</span><span class="delimiter">"</span></span>
                     <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Stepper</span><span class="delimiter">"</span></span>
                     <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span>
                     <span class="attribute-name">maxValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">50</span><span class="delimiter">"</span></span>
                     <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">score</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;frame</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">windowActions</span><span class="delimiter">"</span></span>
               <span class="attribute-name">screen</span>=<span class="string"><span class="delimiter">"</span><span class="content">editWindowActions</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/layout&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>В XML экрана объявлено пространство имен компонента с префиксом <code>app</code>, компонент <code>stepper</code> добавлен на экран, и у него установлены необходимые свойства.</p> 
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="sect1"> 
    <h2 id="framework"><a class="anchor" href="/manual.html#framework"></a>5. Устройство платформы</h2> 
    <div class="sectionbody"> 
     <div class="paragraph"> 
      <p>Данная глава содержит подробное описание архитектуры, компонентов и механизмов платформы.</p> 
     </div> 
     <div class="sect2"> 
      <h3 id="architecture"><a class="anchor" href="/manual.html#architecture"></a>5.1. Архитектура</h3> 
      <div class="paragraph"> 
       <p>В данной главе рассмотрена архитектура CUBA-приложений в различных разрезах: по уровням, блокам, модулям и компонентам.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="app_tiers"><a class="anchor" href="/manual.html#app_tiers"></a>5.1.1. Уровни и блоки приложения</h4> 
       <div class="paragraph"> 
        <p>Платформа позволяет строить приложения по классической трехуровневой схеме: клиентский уровень, средний слой, база данных. <em>Уровень</em> отражает степень "удаленности" от хранимых данных.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В дальнейшем речь пойдет в основном о среднем слое и клиентах, поэтому для краткости выражение "все уровни" означает два этих уровня.</p> 
       </div> 
       <div class="paragraph"> 
        <p>На каждом уровне возможно создание одного или нескольких <em>блоков</em> (units) приложения. Блок представляет собой обособленную исполняемую программу, взаимодействующую с другими блоками приложения. Средства платформы CUBA позволяют создавать блоки в виде веб-приложений и десктопных приложений.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/AppTiers.png" alt="AppTiers"> 
        </div> 
        <div class="title">
         Рисунок 6. Уровни и блоки приложения
        </div> 
       </div> 
       <div class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Middleware
         </dt> 
         <dd> 
          <p>Средний слой, содержащий основную бизнес-логику приложения и выполняющий обращения к базе данных. Представляет собой отдельное веб-приложение под управлением стандартного контейнера <a href="/manual.html#javaee_web_profile">Java EE Web Profile</a>. См. <a href="/manual.html#middleware">Компоненты среднего слоя</a>.</p> 
         </dd> 
         <dt class="hdlist1">
          Web Client
         </dt> 
         <dd> 
          <p>Основной блок клиентского уровня. Содержит интерфейс, предназначенный, как правило, для внутренних пользователей организации. Представляет собой отдельное веб-приложение под управлением стандартного контейнера Java EE Web Profile. Реализация пользовательского интерфейса основана на фреймворке <strong>Vaadin</strong>. См. <a href="/manual.html#gui_framework">Универсальный пользовательский интерфейс</a>.</p> 
         </dd> 
         <dt class="hdlist1">
          Desktop Client
         </dt> 
         <dd> 
          <p>Дополнительный блок клиентского уровня. Содержит интерфейс, предназначенный, как правило, для внутренних пользователей организации. Представляет собой десктопное Java-приложение, реализация пользовательского интерфейса основана на фреймворке <strong>Java Swing</strong>. См. <a href="/manual.html#gui_framework">Универсальный пользовательский интерфейс</a>.</p> 
         </dd> 
         <dt class="hdlist1">
          Web Portal
         </dt> 
         <dd> 
          <p>Дополнительный блок клиентского уровня. Может содержать интерфейс для внешних пользователей и средства интеграции с мобильными устройствами и сторонними приложениями. Представляет собой отдельное веб-приложение под управлением стандартного контейнера Java EE Web Profile. Реализация пользовательского интерфейса основана на фреймворке <strong>Spring MVC</strong>. См. <a href="/manual.html#portal">Компоненты портала</a>.</p> 
         </dd> 
         <dt class="hdlist1">
          Polymer Client
         </dt> 
         <dd> 
          <p>Дополнительный клиентский блок на чистом JavaScript, предоставляющий интерфейс для внешних пользователей. Основан на фреймворке <a href="https://www.polymer-project.org/" target="_blank">Google Polymer</a>, работает со средним слоем через <a href="/manual.html#rest_api_v2">REST API</a>, запущенный в блоке Web Client или Web Portal. См. <a href="/manual.html#polymer_ui">Пользовательский интерфейс на Polymer</a>.</p> 
         </dd> 
        </dl> 
       </div> 
       <div class="paragraph"> 
        <p>Обязательным блоком любого приложения является средний слой - <strong>Middleware</strong>. Для реализации пользовательского интерфейса, как правило, используется один или несколько клиентских блоков, например, <strong>Web Client</strong> и <strong>Web Portal</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Все основанные на Java клиентские блоки взаимодействуют со средним слоем одинаковым образом посредством протокола HTTP, что позволяет размещать средний слой произвольным образом, в том числе за сетевым экраном. Следует отметить, что при развертывании в простейшем случае среднего слоя и веб-клиента на одном сервере между ними организуется локальное взаимодействие в обход сетевого стека для снижения накладных расходов.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="app_modules"><a class="anchor" href="/manual.html#app_modules"></a>5.1.2. Модули приложения</h4> 
       <div class="paragraph"> 
        <p>Модуль – наименьшая структурная единица CUBA-приложения. Представляет собой один модуль проекта приложения и соответствующий ему JAR файл с исполняемым кодом.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Стандартные модули:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><strong>global</strong> – включает в себя классы сущностей, интерфейсы сервисов и другие общие для всех уровней классы. Используется во всех <a href="/manual.html#app_tiers">блоках приложения</a>.</p> </li> 
         <li> <p><strong>core</strong> – реализация сервисов и всех остальных компонентов среднего слоя. Используется только на <strong>Middleware</strong>.</p> </li> 
         <li> <p><strong>gui</strong> – общие компоненты <a href="/manual.html#gui_framework">Универсальный пользовательский интерфейс</a>. Используется в <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> </li> 
         <li> <p><strong>web</strong> – реализация универсального пользовательского интерфейса на <strong>Vaadin</strong>, а также другие специфичные для веб-клиента классы. Используется в блоке <strong>Web Client</strong>.</p> </li> 
         <li> <p><strong>desktop</strong> – опциональный модуль – реализация универсального пользовательского интерфейса на <strong>Java Swing</strong>, а также другие специфичные для десктоп-клиента классы. Используется в блоке <strong>Desktop Client</strong>.</p> </li> 
         <li> <p><strong>portal</strong> – опциональный модуль – реализация веб-портала на <strong>Spring MVC</strong>.</p> </li> 
         <li> <p><strong>polymer-client</strong> – опциональный модуль – реализация <a href="/manual.html#polymer_ui">Пользовательский интерфейс на Polymer</a> на JavaScript.</p> </li> 
        </ul> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/AppModules.png" alt="AppModules"> 
        </div> 
        <div class="title">
         Рисунок 7. Модули приложения
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="app_components"><a class="anchor" href="/manual.html#app_components"></a>5.1.3. Компоненты приложения</h4> 
       <div class="paragraph"> 
        <p>Функциональность платформы разделена на несколько <em>компонентов приложения</em> (ранее называемых <em>базовыми проектами</em>):</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><strong>cuba</strong> – основной компонент, содержит всю функциональность, описанную в данном руководстве.</p> </li> 
         <li> <p><strong>reports</strong> – подсистема генерации отчетов.</p> </li> 
         <li> <p><strong>fts</strong> – подсистема полнотекстового поиска.</p> </li> 
         <li> <p><strong>charts</strong> – подсистема вывода диаграмм.</p> </li> 
         <li> <p><strong>bpm</strong> – механизм исполнения бизнес-процессов по стандарту BPMN 2.0.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Проект приложения всегда зависит от одного или нескольких компонентов. Это означает, что приложение использует компоненты как библиотеки и включает их функциональность.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Любое CUBA-приложение зависит от компонента <strong>cuba</strong>. Остальные компоненты платформы являются опциональными и могут быть включены в приложение при необходимости. Все опциональные компоненты зависят от <strong>cuba</strong> и могут также иметь зависимости между собой.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Ниже приведена диаграмма зависимостей между компонентами платформы. Сплошными линиями изображены обязательные зависимости, пунктирными − опциональные.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/BaseProjects.png" alt="BaseProjects"> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Любое CUBA-приложение может в свою очередь быть использовано как компонент другого приложения. Это позволяет декомпозировать большие проекты в наборы функциональных модулей, которые могут разрабатываться независимо. Можно также создать в организации набор собственных компонентов использовать их в различных проектах, тем самым создав собственную платформу более высокого уровня на основе CUBA. Ниже приведена диаграмма возможной структуры зависимостей компонентов приложения.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/AppComponents2.png" alt="AppComponents2"> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Для того чтобы приложение можно было использовать в качестве компонента, оно должно содержать дескриптор <a href="/manual.html#app-component.xml">app-component.xml</a> и специальный элемент в манифесте JAR модуля <strong>global</strong>. CUBA Studio позволяет автоматически сгенерировать дескриптор и манифест для текущего проекта.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Практическое руководство по работе с собственным компонентом приложения приведено в разделе <a href="/manual.html#app_components_sample">Использование компонентов приложения</a>.</p> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="app_structure"><a class="anchor" href="/manual.html#app_structure"></a>5.1.4. Состав приложения</h4> 
       <div class="paragraph"> 
        <p>Вышеописанные архитектурные принципы напрямую отражаются на составе собранного приложения. Рассмотрим его на примере простого приложения <strong>sales</strong>, которое имеет два блока – <strong>Middleware</strong> и <strong>Web Client</strong>; и включает в себя функциональность компонентов <strong>cuba</strong> и <strong>reports</strong>.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/SampleAppArtifacts.png" alt="SampleAppArtifacts"> 
        </div> 
        <div class="title">
         Рисунок 8. Состав простого приложения
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>На рисунке изображено содержимое некоторых каталогов сервера <strong>Tomcat</strong> с развернутым в нем приложением <strong>sales</strong>.</p> 
       </div> 
       <div class="paragraph"> 
        <p><a href="/manual.html#app_tiers">Блок</a> <strong>Middleware</strong> реализован веб-приложением <code>app-core</code>, блок <strong>Web Client</strong> – веб-приложением <code>app</code>. Исполняемый код веб-приложений содержится в каталогах <code>WEB-INF/lib</code> в наборе JAR-файлов. Каждый JAR представляет собой результат сборки (<a href="/manual.html#artifact">артефакт</a>) одного из <a href="/manual.html#app_modules">модулей</a> приложения или <a href="/manual.html#app_components">базового проекта</a>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Например, состав JAR-файлов веб-приложения среднего слоя <code>app-core</code> определяется тем, что блок <strong>Middleware</strong> состоит из модулей <strong>global</strong> и <strong>core</strong>, и приложение использует компоненты <strong>cuba</strong> и <strong>reports</strong>.</p> 
       </div> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="common_components"><a class="anchor" href="/manual.html#common_components"></a>5.2. Общие компоненты</h3> 
      <div class="paragraph"> 
       <p>В данной главе рассмотрены компоненты платформы, общие для всех <a href="/manual.html#app_tiers">уровней</a> приложения.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="data_model"><a class="anchor" href="/manual.html#data_model"></a>5.2.1. Модель данных</h4> 
       <div class="paragraph"> 
        <p>Предметная область моделируется в приложении с помощью взаимосвязанных классов Java, называемых классами сущностей или просто сущностями.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Сущности подразделяются на две категории:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Персистентные – экземпляры таких сущностей хранятся в таблицах базы данных с помощью <a href="/manual.html#orm">ORM</a>.</p> </li> 
         <li> <p>Неперсистентные – экземпляры существуют только в оперативной памяти, или сохраняются где-то с помощью иных механизмов.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Сущности характеризуются своими атрибутами. Атрибут соответствует полю класса и паре методов доступа (get / set) к полю. Чтобы атрибут был неизменяемым (read only), достаточно не создавать метод set.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Персистентные сущности могут включать в себя атрибуты, не хранящиеся в БД. В случае неперсистентного атрибута можно не создавать поле класса, ограничившись методами доступа.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Класс сущности должен удовлетворять следующим требованиям:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Наследоваться от одного из базовых классов, предоставляемых платформой (см. <a href="/manual.html#base_entity_classes">ниже</a>).</p> </li> 
         <li> <p>Мметь набор полей и методов доступа, соответствующих атрибутам сущностей.</p> </li> 
         <li> <p>Класс и его поля (или методы доступа при отсутствии для атрибута соответствующего поля) должны быть определенным образом <a href="/manual.html#entity_annotations">аннотированы</a> для предоставления нужной информации фреймворкам <a href="/manual.html#jpa">JPA</a> (в случае персистентной сущности) и <a href="/manual.html#metadata_framework">метаданных</a>.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Поддерживаются следующие типы атрибутов сущностей:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>java.lang.String</code></p> </li> 
         <li> <p><code>java.lang.Boolean</code></p> </li> 
         <li> <p><code>java.lang.Integer</code></p> </li> 
         <li> <p><code>java.lang.Long</code></p> </li> 
         <li> <p><code>java.lang.Double</code></p> </li> 
         <li> <p><code>java.math.BigDecimal</code></p> </li> 
         <li> <p><code>java.util.Date</code></p> </li> 
         <li> <p><code>java.sql.Date</code></p> </li> 
         <li> <p><code>java.sql.Time</code></p> </li> 
         <li> <p><code>java.util.UUID</code></p> </li> 
         <li> <p><code>byte[]</code></p> </li> 
         <li> <p><code>enum</code></p> </li> 
         <li> <p>Cущность</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Базовые классы сущностей (см. ниже) переопределяют <code>equals()</code> и <code>hashCode()</code> таким образом, что экземпляры сущностей сравниваются по их идентификаторам. То есть экземпляры одного класса считаются равными, если равны их идентификаторы.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="base_entity_classes"><a class="anchor" href="/manual.html#base_entity_classes"></a>5.2.1.1. Базовые классы сущностей</h5> 
        <div class="paragraph"> 
         <p>Рассмотрим базовые классы и интерфейсы сущностей более подробно.</p> 
        </div> 
        <div id="entity_base_classes" class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/EntityClasses.png" alt="EntityClasses"> 
         </div> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>Instance</code> – декларирует базовые методы работы с объектами предметной области:</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p>Получение ссылки на мета-класс объекта.</p> </li> 
             <li> <p>Генерация имени экземпляра.</p> </li> 
             <li> <p>Чтение/установка значений атрибутов по имени.</p> </li> 
             <li> <p>Добавление слушателей, получающих уведомления об изменениях атрибутов.</p> </li> 
            </ul> 
           </div> </li> 
          <li> <p><code>Entity</code> – дополняет <code>Instance</code> понятием идентификатора сущности, причем <code>Entity</code> не определяет тип идентификатора, оставляя эту возможность наследникам.</p> </li> 
          <li> <p><code>AbstractInstance</code> – реализует логику работы со слушателями изменения атрибутов.</p> 
           <div class="admonitionblock warning"> 
            <table> 
             <tbody>
              <tr> 
               <td class="icon"> 
                <div class="title">
                 Warning
                </div> </td> 
               <td class="content"> 
                <div class="paragraph"> 
                 <p><code>AbstractInstance</code> хранит слушателей в коллекции <code>WeakReference</code>, т.е. при отсутствии внешних ссылок на добавленного слушателя, он будет немедленно уничтожен сборщиком мусора. Как правило, слушателями изменения атрибутов являются <a href="/manual.html#gui_vcl">визуальные компоненты</a> и <a href="/manual.html#datasources">источники данных</a> UI, на которые всегда имеются ссылки из других объектов, поэтому проблема исчезновения слушателей не возникает. Однако если слушатель создается прикладным кодом и на него никто не ссылается естественным образом, необходимо кроме добавления в <code>Instance</code> сохранить его в некотором поле объекта.</p> 
                </div> </td> 
              </tr> 
             </tbody>
            </table> 
           </div> </li> 
          <li> <p><code>BaseGenericIdEntity</code> - базовый класс персистентных и неперсистентных сущностей. Реализует <code>Entity</code>, но не специфицирует тип идентификатора (то есть первичного ключа) сущности.</p> </li> 
          <li> <p><code>EmbeddableEntity</code> - базовый класс персистентных встраиваемых сущностей.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Ниже рассмотрены базовые классы, от которых рекомендуется наследовать сущности. Неперсистентные сущности наследуются от тех же классов, что и персистентные. Фреймворк определяет, является ли сущность персистентной или нет по файлу, в котором зарегистрирован класс: <a href="/manual.html#persistence.xml">persistence.xml</a> или <a href="/manual.html#metadata.xml">metadata.xml</a>.</p> 
        </div> 
        <div class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           StandardEntity
          </dt> 
          <dd> 
           <p>Наследуйте от <code>StandardEntity</code>, если необходим стандартный набор свойств сущности: первичный ключ типа UUID, экземпляры должны содержать информацию о том, кто и когда создал и изменил их, необходима оптимистичная блокировка и мягкое удаление.</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="imageblock" style="text-align: center"> 
              <div class="content"> 
               <img src="assets/EntityClasses_Standard.png" alt="EntityClasses Standard"> 
              </div> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>HasUuid</code> – интерфейс сущностей имеющих глобальные уникальные идентификаторы</p> </li> 
               <li> <p><code>Versioned</code> – интерфейс сущностей, поддерживающих <a href="/manual.html#optimistic_locking">оптимистичную блокировку</a></p> </li> 
               <li> <p><code>Creatable</code> – интерфейс сущностей, для которых требуется сохранять информацию о том, кто и когда ее создал</p> </li> 
               <li> <p><code>Updatable</code> – интерфейс сущностей, для которых требуется сохранять информацию о том, кто и когда изменял экземпляр в последний раз</p> </li> 
               <li> <p><code>SoftDelete</code> – интерфейс сущностей, поддерживающих <a href="/manual.html#soft_deletion">мягкое удаление</a></p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           BaseUuidEntity
          </dt> 
          <dd> 
           <p>Наследуйте от <code>BaseUuidEntity</code> если необходима сущность с идентификатором типа UUID, но не нужны все остальные свойства <code>StandardEntity</code>. Интерфейсы <code>Creatable</code>, <code>Versioned</code> и др. можно выборочно реализовать в конкретном классе сущности.</p> 
           <div class="imageblock" style="text-align: center"> 
            <div class="content"> 
             <img src="assets/EntityClasses_Uuid.png" alt="EntityClasses Uuid"> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           BaseLongIdEntity
          </dt> 
          <dd> 
           <p>Наследуйте от <code>BaseLongIdEntity</code> или <code>BaseIntegerIdEntity</code> если необходима сущность с идентификатором типа <code>Long</code> или <code>Integer</code>. Интерфейсы <code>Creatable</code>, <code>Versioned</code> и др. можно выборочно реализовать в конкретном классе сущности. Рекомендуется реализовать <code>HasUuid</code>, так как это позволяет платформе в некоторых случаях работать с сущностью более оптимально, а кроме того, сущность получает уникальный идентификатор в распределенном окружении.</p> 
           <div class="imageblock" style="text-align: center"> 
            <div class="content"> 
             <img src="assets/EntityClasses_Long.png" alt="EntityClasses Long"> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           BaseStringIdEntity
          </dt> 
          <dd> 
           <p>Наследуйте от <code>BaseStringIdEntity</code> если необходима сущность с идентификатором типа <code>String</code>. Интерфейсы <code>Creatable</code>, <code>Versioned</code> и др. можно выборочно реализовать в конкретном классе сущности. Рекомендуется реализовать <code>HasUuid</code>, так как это позволяет платформе в некоторых случаях работать с сущностью более оптимально, а кроме того, сущность получает уникальный идентификатор в распределенном окружении. В конкретном классе сущности, унаследованной от <code>BaseStringIdEntity</code>, необходимо задать атрибут-идентификатор типа <code>String</code> и добавить ему <a href="/manual.html#jpa">JPA</a>-аннотацию <code>@Id</code>.</p> 
           <div class="imageblock" style="text-align: center"> 
            <div class="content"> 
             <img src="assets/EntityClasses_String.png" alt="EntityClasses String"> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           BaseIdentityIdEntity
          </dt> 
          <dd> 
           <p>Наследуйте от <code>BaseIdentityIdEntity</code> если необходимо отобразить сущность на таблицу с первичным ключом типа IDENTITY. Интерфейсы <code>Creatable</code>, <code>Versioned</code> и др. можно выборочно реализовать в конкретном классе сущности. Рекомендуется реализовать <code>HasUuid</code>, так как это позволяет платформе в некоторых случаях работать с сущностью более оптимально, а кроме того, сущность получает уникальный идентификатор в распределенном окружении. Атрибут <code>id</code> сущности (т.е. методы getId/setId) будут иметь тип <code>IdProxy</code>, который предназначен для использования вместо реального идентификатора, пока он не сгенерирован базой данных на вставке записи.</p> 
           <div class="imageblock" style="text-align: center"> 
            <div class="content"> 
             <img src="assets/EntityClasses_Identity.png" alt="EntityClasses Identity"> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           BaseGenericIdEntity
          </dt> 
          <dd> 
           <p>Наследуйте напрямую от <code>BaseGenericIdEntity</code> если необходимо отобразить сущность на таблицу с композитным первичным ключом. В этом случае в классе сущности необходимо создать поле встраиваемого типа, представляющего композитный ключ, и аннотировать его <a href="/manual.html#jpa">JPA</a>-аннотацией <code>@EmbeddedId</code>.</p> 
          </dd> 
         </dl> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="entity_annotations"><a class="anchor" href="/manual.html#entity_annotations"></a>5.2.1.2. Аннотации сущностей</h5> 
        <div class="paragraph"> 
         <p>В данном разделе описаны все поддерживаемые платформой аннотации классов и атрибутов сущностей.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Аннотации пакета <code>javax.persistence</code> обеспечивают работу <a href="/manual.html#jpa">JPA</a>, аннотации пакетов <code>com.haulmont.*</code> предназначены для управления <a href="/manual.html#metadata_framework">метаданными</a> и другими механизмами платформы.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Если для аннотации указано только простое имя класса, подразумевается что это класс платформы, расположенный в одном из пакетов <code>com.haulmont.*</code></p> 
        </div> 
        <div class="sect5"> 
         <h6 id="entity_class_annotations"><a class="anchor" href="/manual.html#entity_class_annotations"></a>5.2.1.2.1. Аннотации класса</h6> 
         <div id="embeddable_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Embeddable
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>See <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Embeddable.html" target="_blank">javax.persistence.Embeddable</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет встраиваемую сущность, экземпляры которой хранятся вместе с владеющей сущностью в той же таблице.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Для задания имени сущности требуется применение аннотации <a href="/manual.html#metaclass_annotation">@MetaClass</a>.</p> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="enableRestore_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @EnableRestore
           </dt> 
           <dd> 
            <p>Указывает, что экземпляры данной сущности доступны для восстановления после <a href="/manual.html#soft_deletion">мягкого удаления</a> в специальном экране <code>core$Entity.restore</code>, доступном через пункт <strong>Administration &gt; Data Recovery</strong> главного меню.</p> 
           </dd> 
          </dl> 
         </div> 
         <div id="entity_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Entity
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Entity.html" target="_blank">javax.persistence.Entity</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Объявляет класс сущностью модели данных.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>name</code> - имя сущности, обязательно должно начинаться с префикса, отделенного знаком <code>$</code>. Желательно использовать в качестве префикса короткое имя проекта для формирования отдельного пространства имен.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">sales$Customer</span><span class="delimiter">"</span></span>)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="extends_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Extends
           </dt> 
           <dd> 
            <p>Указывает, что данная сущность является расширением и должна повсеместно использоваться вместо базовой. См. <a href="/manual.html#extension">Расширение функциональности</a>.</p> 
           </dd> 
          </dl> 
         </div> 
         <div id="discriminatorColumn_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @DiscriminatorColumn
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/DiscriminatorColumn.html" target="_blank">javax.persistence.DiscriminatorColumn</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Используется для определения колонки БД, отвечающей за различение типов сущностей в случае стратегий наследования <code>SINGLE_TABLE</code> и <code>JOINED</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>name</code> - имя колонки-дискриминатора</p> </li> 
                <li> <p><code>discriminatorType</code> - тип данных колонки-дискриминатора</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DiscriminatorColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">TYPE</span><span class="delimiter">"</span></span>, discriminatorType = DiscriminatorType.INTEGER)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="discriminatorValue_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @DiscriminatorValue
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/DiscriminatorValue.html" target="_blank">javax.persistence.DiscriminatorValue</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет значение колонки-дискриминатора для данной сущности. Эта аннотация должна быть помещена на конкретном классе сущности.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DiscriminatorValue</span>(<span class="string"><span class="delimiter">"</span><span class="content">0</span><span class="delimiter">"</span></span>)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="inheritance_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Inheritance
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Inheritance.html" target="_blank">javax.persistence.Inheritance</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет стратегию наследования для иерархии классов сущностей. Данная аннотация должна быть помещена на корневом классе иерархии.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>strategy</code> - стратегия, по умолчанию <code>SINGLE_TABLE</code></p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="listeners_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Listeners
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Определяет список слушателей, предназначенных для реакции на события жизненного цикла экземпляров сущности на <a href="/manual.html#app_tiers">уровне</a> Middleware.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Значением аннотации должна быть строка или массив строк с именами бинов слушателей - см. <a href="/manual.html#entity_listeners">Entity Listeners</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Примеры:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Listeners</span>(<span class="string"><span class="delimiter">"</span><span class="content">sample_UserEntityListener</span><span class="delimiter">"</span></span>)</code></pre> 
               </div> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Listeners</span>({<span class="string"><span class="delimiter">"</span><span class="content">sample_FooListener</span><span class="delimiter">"</span></span>,<span class="string"><span class="delimiter">"</span><span class="content">sample_BarListener</span><span class="delimiter">"</span></span>})</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="mappedSuperclass_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @MappedSuperclass
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/MappedSuperclass.html" target="_blank">javax.persistence.MappedSuperclass</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет, что данный класс является предком некоторых сущностей, и его атрибуты должны быть использованы в составе сущностей-наследников. Такой класс не сопоставляется никакой отдельной таблице БД.</p> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="metaclass_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @MetaClass
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Используется для объявления неперсистентной или <a href="/manual.html#embeddable_annotation">встраиваемой</a> сущности (т.е. когда аннотация <code>@javax.persistence.Entity</code> не применима)</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>name</code> - имя сущности, обязательно должно начинаться с префикса, отделенного знаком <code>$</code>. Желательно использовать в качестве префикса короткое имя проекта для формирования отдельного пространства имен.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MetaClass</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">sales$Customer</span><span class="delimiter">"</span></span>)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="namePattern_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @NamePattern
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Определяет способ получения имени экземпляра, возвращаемого методом <code>Instance.getInstanceName()</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Значением аннотации должна быть строка вида <code>{0}|{1}</code>, где</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>{0}</code> - строка форматирования по правилам <code>String.format()</code>, или имя метода данного объекта с префиксом <code>#</code>. Метод должен возвращать <code>String</code> и не иметь параметров.</p> </li> 
                <li> <p><code>{1}</code> - разделенный запятыми список имен полей класса, соответствующий формату <code>{0}</code>. В случае использования в <code>{0}</code> метода список полей все равно необходим, так как по нему формируется <a href="/manual.html#views">представление</a> <code>_minimal</code>.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Примеры:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamePattern</span>(<span class="string"><span class="delimiter">"</span><span class="content">%s|name</span><span class="delimiter">"</span></span>)</code></pre> 
               </div> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamePattern</span>(<span class="string"><span class="delimiter">"</span><span class="content">#getCaption|login,name</span><span class="delimiter">"</span></span>)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="postConstruct_entity_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @PostConstruct
           </dt> 
           <dd> 
            <p>Данная аннотация может быть указана для метода класса. Такой метод будет вызван сразу после создания экземпляра сущности через <a href="/manual.html#metadata">Metadata.create()</a>. Это удобно, если для инициализации экземпляра сущности требуется вызов каких-либо <a href="/manual.html#managed_beans">бинов</a>. Пример см. в <a href="/manual.html#init_values_in_class">Инициализация полей сущности</a>.</p> 
           </dd> 
          </dl> 
         </div> 
         <div id="primaryKeyJoinColumn_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @PrimaryKeyJoinColumn
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/PrimaryKeyJoinColumn.html" target="_blank">javax.persistence.PrimaryKeyJoinColumn</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Используется в случае стратегии наследования <code>JOINED</code> для указания колонки внешнего ключа данной сущности, ссылающегося на первичный ключ сущности-предка.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>name</code> - имя колонки внешнего ключа данной сущности</p> </li> 
                <li> <p><code>referencedColumnName</code> - имя колонки первичного ключа сущности предка</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PrimaryKeyJoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CARD_ID</span><span class="delimiter">"</span></span>, referencedColumnName = <span class="string"><span class="delimiter">"</span><span class="content">ID</span><span class="delimiter">"</span></span>)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="systemLevel_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @SystemLevel
           </dt> 
           <dd> 
            <p>Указывает, что данная сущность является системной и не должна быть доступна для выбора пользователем в различных списках сущностей, например, как тип параметра универсального фильтра или тип <a href="/manual.html#dynamic_attributes">динамического атрибута</a>.</p> 
           </dd> 
          </dl> 
         </div> 
         <div id="table_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Table
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Table.html" target="_blank">javax.persistence.Table</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет таблицу базы данных для данной сущности.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>name</code> - имя таблицы</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SALES_CUSTOMER</span><span class="delimiter">"</span></span>)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="trackEditScreenHistory_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @TrackEditScreenHistory
           </dt> 
           <dd> 
            <p>Указывает, что для данной сущности будет запоминаться история открытия экранов редактирования (<code>{имя_сущности}.edit</code>) с возможностью отображения в специальном экране <code>sec$ScreenHistory.browse</code>, доступном через пункт <strong>Help &gt; History</strong> главного меню.</p> 
           </dd> 
          </dl> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="entity_attr_annotations"><a class="anchor" href="/manual.html#entity_attr_annotations"></a>5.2.1.2.2. Аннотации атрибутов</h6> 
         <div class="paragraph"> 
          <p>Аннотации атрибутов устанавливаются на соответствующие поля класса, за одним исключением: если требуется объявить неизменяемый (read only) неперсистентный атрибут <code>foo</code>, то достаточно создать метод доступа <code>getFoo()</code> и поместить на этот метод аннотацию <code>@MetaProperty</code>.</p> 
         </div> 
         <div id="caseconversion_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @CaseConversion
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Применяет автоматическую конвертацию регистра к текстовым полям ввода, связанным с аннотированным атрибутом.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>type</code> - тип конвертации: <code>UPPER</code> (по умолчанию), <code>LOWER</code>.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CaseConversion</span>(type = ConversionType.UPPER)
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">COUNTRY_CODE</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">String</span> countryCode;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="column_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Column
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Column.html" target="_blank">javax.persistence.Column</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет колонку БД, в которой будут храниться значения данного атрибута.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>name</code> - имя колонки</p> </li> 
                <li> <p><code>length</code> - (необязательный параметр, по умолчанию <code>255</code>) - длина колонки. Используется также при формировании <a href="/manual.html#metadata_framework">метаданных</a> и, в конечном счете, может ограничивать максимальную длину вводимого текста в визуальных компонентах, работающих с данным атрибутом. Для отмены ограничения по длине атрибуту необходимо добавить аннотацию <a href="/manual.html#lob_annotation">@Lob</a>.</p> </li> 
                <li> <p><code>nullable</code> - (необязательный параметр, по умолчанию <code>true</code>) - может ли атрибут содержать <code>null</code>. При указании <code>nullable = false</code> <a href="/manual.html#jpa">JPA</a> контролирует наличие значения поля при сохранении, кроме того, визуальные компоненты, работающие с данным атрибутом, могут сигнализировать пользователю о необходимости ввода значения.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="composition_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Composition
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Указывает на то, что связь является композицией - более тесным вариантом ассоциации. Это означает, что связанная сущность имеет смысл только как часть владеющей сущности, т.е. создается и удаляется вместе с ней.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Например, список пунктов в заказе (класс <code>Order</code> содержит коллекцию экземпляров <code>Item</code>):</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span>)
<span class="annotation">@Composition</span>
<span class="directive">protected</span> <span class="predefined-type">List</span>&lt;Item&gt; items;</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Другой пример - one-to-one отношение:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Composition</span>
<span class="annotation">@OneToOne</span>(fetch = FetchType.LAZY)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DETAILS_ID</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> CustomerDetails details;</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Указание для связи аннотации <code>@Composition</code> позволяет организовать в <a href="/manual.html#screen_edit">экранах редактирования</a> специальный режим коммита источников данных, при котором изменения экземпляров детализирующей сущности сохраняются в базе данных только при коммите основной сущности. Подробнее см. <a href="/manual.html#composition_recipe">Редактирование композитных сущностей</a>.</p> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="embedded_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Embedded
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Embedded.html" target="_blank">javax.persistence.Embedded</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет атрибут типа встраиваемой сущности, в свою очередь аннотированной <code>@Embeddable</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Embedded</span>
<span class="directive">protected</span> Address address;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="embeddedParameters_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @EmbeddedParameters
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>По умолчанию <a href="/manual.html#orm">ORM</a> не создает экземпляр встроенной сущности если все ее атрибуты равны null в базе данных. Аннотацию <code>@EmbeddedParameters</code> можно использовать для указания того, что экземпляр всегда должен создаваться, например:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Embedded</span>
<span class="annotation">@EmbeddedParameters</span>(nullAllowed = <span class="predefined-constant">false</span>)
<span class="directive">protected</span> Address address;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="id_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Id
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Id.html" target="_blank">javax.persistence.Id</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Указывает, что данный атрибут является первичным ключом сущности. Обычно эта аннотация присутствует на поле базового класса, такого как <a href="/manual.html#base_entity_classes">BaseUuidEntity</a>. Использовать эту аннотацию в конкретном классе сущности необходимо только при наследовании от базового класса <code>BaseStringIdEntity</code> (то есть при создании сущности со строковым первичным ключом).</p> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="ignoreUserTimeZone" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @IgnoreUserTimeZone
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Для атрибутов типа timestamp с аннотацией <code>@javax.persistence.Temporal.TIMESTAMP</code> заставляет платформу игнорировать <a href="/manual.html#timeZone">часовой пояс</a> пользователя, если он задан для текущей сессии.</p> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="joinColumn_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @JoinColumn
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinColumn.html" target="_blank">javax.persistence.JoinColumn</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Используется для указания колонки БД, определяющей ассоциацию между сущностями. Наличие этой аннотации указывает, что данная сторона отношения является владеющей (owning).</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>name</code> - имя колонки</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CUSTOMER_ID</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> Customer customer;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="joinTable_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @JoinTable
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/JoinTable.html" target="_blank">javax.persistence.JoinTable</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Используется для указания таблицы связи на ведущей стороне <code>@ManyToMany</code> ассоциации.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>name</code> - имя таблицы связи</p> </li> 
                <li> <p><code>joinColumns</code> - элемент <code>@JoinColumn</code>, определяющий колонку таблицы связей, соответствующую первичному ключу ведущей стороны ассоциации (т.е. содержащей аннотацию <code>@JoinTable</code>)</p> </li> 
                <li> <p><code>inverseJoinColumns</code> - элемент <code>@JoinColumn</code>, определяющий колонку таблицы связей, соответствующую первичному ключу ведомой стороны ассоциации</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример атрибута <code>customers</code> класса <code>Group</code>, являющегося ведущей стороной ассоциации:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToMany</span>
<span class="annotation">@JoinTable</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SALES_CUSTOMER_GROUP_LINK</span><span class="delimiter">"</span></span>,
  joinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">GROUP_ID</span><span class="delimiter">"</span></span>),
  inverseJoinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CUSTOMER_ID</span><span class="delimiter">"</span></span>))
<span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;Customer&gt; customers;</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Пример атрибута <code>groups</code> класса <code>Customer</code>, являющегося ведомой стороной этой же ассоциации:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToMany</span>(mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">customers</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Group</span>&gt; groups;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="lob_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Lob
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Lob.html" target="_blank">javax.persistence.Lob</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Указывает, что данный атрибут не имеет ограничений длины. Применяется совместно с аннотацией <code>@Column</code>. Если <code>@Lob</code> указан, то длина, заданная в <code>@Column</code> явно или по умолчанию, игнорируется.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DESCRIPTION</span><span class="delimiter">"</span></span>)
<span class="annotation">@Lob</span>
<span class="directive">private</span> <span class="predefined-type">String</span> description;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="localizedValue_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @LocalizedValue
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Служит для описания способа получения локализованного значения некоторого изменяющегося атрибута, которое возвращает метод <code><a href="/manual.html#messageTools">MessageTools</a>.getLocValue()</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>messagePack</code> - явное указание пакета, из которого будет взято локализованное сообщение, например, <code>com.haulmont.cuba.core.entity</code></p> </li> 
                <li> <p><code>messagePackExpr</code> - выражение в терминах пути к атрибуту, хранящему имя пакета, из которого будет взято локализованное сообщение, например <code>proc.messagesPack</code>. Путь начинается с атрибута текущей сущности.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример аннотации, означающей, что локализованное значение атрибута <code>state</code> будет взято из пакета, имя которого хранится в атрибуте <code>messagesPack</code> связанной сущности <code>proc</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">STATE</span><span class="delimiter">"</span></span>)
<span class="annotation">@LocalizedValue</span>(messagePackExpr = <span class="string"><span class="delimiter">"</span><span class="content">proc.messagesPack</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">String</span> state;

<span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">PROC_ID</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> Proc proc;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="lookup_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Lookup
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Определяет тип просмотра ссылочных атрибутов.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>type</code> - по умолчанию имеет значение <code>SCREEN</code>, при котором ссылки открываются через <a href="/manual.html#screen_lookup">lookup-экран</a>. Значение <code>DROPDOWN</code> позволяет открывать ссылки в виде выпадающего списка. Если за способ отображения выбран <code>DROPDOWN</code>, Studio создаст <a href="/manual.html#datasources">options datasource</a> для выпадающего списка при скаффолдинге экрана редактирования. Таким образом, параметр Lookup type необходимо задать ДО генерации экрана редактирования сущности. Кроме того, компонент <a href="/manual.html#gui_Filter">Filter</a> позволит пользователям выбирать параметры фильтрации также из выпадающего списка вместо lookup-экрана.</p> </li> 
                <li> <p><code>actions</code> - определяет действия, которые будут использованы в компоненте <code>PickerField</code> в составе <code>FieldGroup</code> по умолчанию. Возможные значения: <code>lookup</code>, <code>clear</code>, <code>open</code>.</p> </li> 
               </ul> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Lookup</span>(type = LookupType.DROPDOWN, actions = {<span class="string"><span class="delimiter">"</span><span class="content">open</span><span class="delimiter">"</span></span>})
<span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CUSTOMER_ID</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> Customer customer;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="manyToMany_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @ManyToMany
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToMany.html" target="_blank">javax.persistence.ManyToMany</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет атрибут-коллекцию ссылок на сущность с типом ассоциации много-ко-многим.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Ассоциация много-ко-многим всегда имеет ведущую сторону и может иметь обратную сторону - ведомую. На ведущей стороне указывается дополнительная аннотация <code>@JoinTable</code>, на ведомой стороне - параметр <code>mappedBy</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>mappedBy</code> - поле связанной сущности, определяющее ассоциацию с ведущей стороны. Необходимо указывать только на ведомой стороне.</p> </li> 
                <li> <p><code>targetEntity</code> - тип связанной сущности. Необязательный параметр, если коллекция объявлена с использованием <strong>Java generics</strong>.</p> </li> 
                <li> <p><code>fetch</code> - (необязательный параметр, по умолчанию <code>LAZY</code>) - определяет, будет ли <a href="/manual.html#jpa">JPA</a> <a href="/manual.html#eager_fetching">жадно</a> загружать коллекцию связанных сущностей. Необходимо всегда оставлять значение по умолчанию <code>LAZY</code>, так как в CUBA-приложении политика загрузки связей определяется динамически на основе механизма <a href="/manual.html#views">представлений</a>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="manyToOne_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @ManyToOne
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/ManyToOne.html" target="_blank">javax.persistence.ManyToOne</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет атрибут-ссылку на сущность с типом ассоциации много-к-одному.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>fetch</code> - (по умолчанию <code>EAGER</code>) параметр, определяющий, будет ли <a href="/manual.html#jpa">JPA</a> <a href="/manual.html#eager_fetching">жадно</a> загружать ассоциированную сущность. Данный параметр всегда должен быть установлен в значение <code>LAZY</code>, так как в CUBA-приложении политика загрузки связей определяется динамически на основе механизма <a href="/manual.html#views">представлений</a>.</p> </li> 
                <li> <p><code>optional</code> - (необязательный параметр, по умолчанию <code>true</code>) - может ли атрибут содержать <code>null</code>. При указании <code>optional = false</code> <a href="/manual.html#jpa">JPA</a> контролирует наличие ссылки при сохранении, кроме того, визуальные компоненты, работающие с данным атрибутом, могут сигнализировать пользователю о необходимости ввода значения.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Например, несколько экземпляров <code>Order</code> (заказов) ссылаются на один экземпляр <code>Customer</code> (покупателя), в этом случае класс <code>Order</code> должен содержать следующее объявление:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CUSTOMER_ID</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> Customer customer;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="metaProperty_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @MetaProperty
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Указывает, что данный атрибут должен быть включен в <a href="/manual.html#metadata_framework">метаданные</a>. Данная аннотация может быть установлена как на поле класса, так и на метод доступа, в случае отсутствия соответствующего атрибуту поля.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Данная аннотация не обязательна для полей, снабженных следующими аннотациями пакета <code>javax.persistence</code>: <code>@Column</code>, <code>@OneToOne</code>, <code>@OneToMany</code>, <code>@ManyToOne</code>, <code>@ManyToMany</code>, <code>@Embedded</code>. Такие поля отражаются в метаданных автоматически. Поэтому <code>@MetaProperty</code> в основном применяется для определения неперсистентных атрибутов сущностей.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры (опционально):</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>mandatory</code> - может ли атрибут содержать <code>null</code>. При указании <code>mandatory = true</code> визуальные компоненты, работающие с данным атрибутом, могут сигнализировать пользователю о необходимости ввода значения.</p> </li> 
                <li> <p><code>datatype</code> - явно задает <a href="/manual.html#datatype">datatype</a>, чтобы переопределить datatype задаваемый Java-типом атрибута.</p> </li> 
                <li> <p><code>related</code> - задает массив связанных персистентных атрибутов, которые должны быть загружены из БД, если данный атрибут включен во <a href="/manual.html#views">view</a>.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример использования для поля:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transient</span>
<span class="annotation">@MetaProperty</span>
<span class="directive">protected</span> <span class="predefined-type">String</span> token;</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Пример использования для метода:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MetaProperty</span>
<span class="directive">public</span> <span class="predefined-type">String</span> getLocValue() {
  <span class="keyword">if</span> (!StringUtils.isBlank(messagesPack)) {
      <span class="keyword">return</span> AppBeans.get(Messsages.class).getMessage(messagesPack, value);
  } <span class="keyword">else</span> {
      <span class="keyword">return</span> value;
  }
}</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="numberFormat_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @NumberFormat
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Задает формат атрибута типа <code>Number</code> (это может быть <code>BigDecimal</code>, <code>Integer</code>, <code>Long</code> или <code>Double</code>). Значения такого атрибута будут форматироваться в пользовательском интерфейсе в соответствии с указанными параметрами аннотации:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>pattern</code> - паттерн форматирования, задается по правилам, описанным в <a href="https://docs.oracle.com/javase/8/docs/api/java/text/DecimalFormat.html" target="_blank">DecimalFormat</a>.</p> </li> 
                <li> <p><code>decimalSeparator</code> - символ, используемый в качестве разделителя целой и дробной части (опционально).</p> </li> 
                <li> <p><code>groupingSeparator</code> - символ, используемый в качестве разделителя групп разрядов (optional).</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Если <code>decimalSeparator</code> и/или <code>groupingSeparator</code> не указаны, фреймворк использует соответствующие значения из format strings для локали текущего пользователя. При форматировании без учета локали в этом случае используются символы из системной локали сервера.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Примеры:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">PRECISE_NUMBER</span><span class="delimiter">"</span></span>, precision = <span class="integer">19</span>, scale = <span class="integer">4</span>)
<span class="annotation">@NumberFormat</span>(pattern = <span class="string"><span class="delimiter">"</span><span class="content">0.0000</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">BigDecimal</span> preciseNumber;

<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">WEIRD_NUMBER</span><span class="delimiter">"</span></span>, precision = <span class="integer">19</span>, scale = <span class="integer">4</span>)
<span class="annotation">@NumberFormat</span>(pattern = <span class="string"><span class="delimiter">"</span><span class="content">#,##0.0000</span><span class="delimiter">"</span></span>, decimalSeparator = <span class="string"><span class="delimiter">"</span><span class="content">_</span><span class="delimiter">"</span></span>, groupingSeparator = <span class="string"><span class="delimiter">"</span><span class="content">`</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">BigDecimal</span> weirdNumber;

<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SIMPLE_NUMBER</span><span class="delimiter">"</span></span>)
<span class="annotation">@NumberFormat</span>(pattern = <span class="string"><span class="delimiter">"</span><span class="content">#</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">Integer</span> simpleNumber;

<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">PERCENT_NUMBER</span><span class="delimiter">"</span></span>, precision = <span class="integer">19</span>, scale = <span class="integer">4</span>)
<span class="annotation">@NumberFormat</span>(pattern = <span class="string"><span class="delimiter">"</span><span class="content">#%</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">BigDecimal</span> percentNumber;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="onDelete_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @OnDelete
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Определяет политику обработки связи в случае мягкого удаления сущности, содержащей данный атрибут. См. <a href="/manual.html#soft_deletion">Мягкое удаление</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">group</span><span class="delimiter">"</span></span>)
<span class="annotation">@OnDelete</span>(DeletePolicy.CASCADE)
<span class="directive">private</span> <span class="predefined-type">Set</span>&lt;Constraint&gt; constraints;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="onDeleteInverse_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @OnDeleteInverse
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Определяет политику обработки связи в случае мягкого удаления сущности с обратной стороны ассоциации. См. <a href="/manual.html#soft_deletion">Мягкое удаление</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToOne</span>
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DRIVER_ID</span><span class="delimiter">"</span></span>)
<span class="annotation">@OnDeleteInverse</span>(DeletePolicy.DENY)
<span class="directive">private</span> <span class="predefined-type">Driver</span> driver;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="oneToMany_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @OneToMany
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToMany.html" target="_blank">javax.persistence.OneToMany</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет атрибут-коллекцию ссылок на сущность с типом ассоциации один-ко-многим.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>mappedBy</code> - поле связанной сущности, определяющее ассоциацию</p> </li> 
                <li> <p><code>targetEntity</code> - тип связанной сущности. Необязательный параметр, если коллекция объявлена с использованием <strong>Java generics</strong>.</p> </li> 
                <li> <p><code>fetch</code> - (необязательный параметр, по умолчанию <code>LAZY</code>) - определяет, будет ли <a href="/manual.html#jpa">JPA</a> <a href="/manual.html#eager_fetching">жадно</a> загружать коллекцию связанных сущностей. Необходимо всегда оставлять значение по умолчанию <code>LAZY</code>, так как в CUBA-приложении политика загрузки связей определяется динамически на основе механизма <a href="/manual.html#views">представлений</a>.</p> </li> 
                <li> <p><code>cascade</code> - (необязательный параметр, по умолчанию <code>{}</code>) - каскадирование операций определяет, какие операции над сущностью должны быть применены к ассоциированным сущностям. Каскадирование на данном уровне не рекомендуется использовать.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Например, несколько экземпляров <code>Item</code> (пунктов заказа) ссылаются на один экземпляр <code>Order</code> (заказ) с помощью <code>@ManyToOne</code> поля <code>Item.order</code>, в этом случае класс <code>Order</code> может содержать коллекцию экземпляров <code>Item</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">order</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;Item&gt; items;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="oneToOne_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @OneToOne
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OneToOne.html" target="_blank">javax.persistence.OneToOne</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет атрибут-ссылку на сущность с типом ассоциации один-к-одному.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>fetch</code> - (по умолчанию <code>EAGER</code>) параметр, определяющий, будет ли <a href="/manual.html#jpa">JPA</a> <a href="/manual.html#eager_fetching">жадно</a> загружать ассоциированную сущность. Данный параметр всегда должен быть установлен в значение <code>LAZY</code>, так как в CUBA-приложении политика загрузки связей определяется динамически на основе механизма <a href="/manual.html#views">представлений</a>.</p> </li> 
                <li> <p><code>mappedBy</code> - поле связанной сущности, определяющее ассоциацию. Требуется устанавливать только на ведомой стороне ассоциации.</p> </li> 
                <li> <p><code>optional</code> - (необязательный параметр, по умолчанию <code>true</code>) - может ли атрибут содержать <code>null</code>. При указании <code>optional = false</code> <a href="/manual.html#jpa">JPA</a> контролирует наличие ссылки при сохранении, кроме того, визуальные компоненты, работающих с данным атрибутом, могут сигнализировать пользователю о необходимости ввода значения.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример ведущей стороны ассоциации, класс <code>Driver</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToOne</span>(fetch = FetchType.LAZY)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CALLSIGN_ID</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> DriverCallsign callsign;</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Пример ведомой стороны ассоциации, класс <code>DriverCallsign</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToOne</span>(fetch = FetchType.LAZY, mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">callsign</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">Driver</span> driver;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="orderBy_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @OrderBy
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/OrderBy.html" target="_blank">javax.persistence.OrderBy</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Определяет порядок элементов в атрибуте-коллекции на момент извлечения из базы данных. Данную аннотацию необходимо задавать для упорядоченных коллекций, таких как <code>List</code> или <code>LinkedHashSet</code> для получения предсказуемого порядка следования элементов.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>value</code> - строка, определяющая порядок, в формате:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java">orderby_list::= orderby_item [,orderby_item]*
orderby_item::= property_or_field_name [ASC | DESC]</code></pre> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">user</span><span class="delimiter">"</span></span>)
<span class="annotation">@OrderBy</span>(<span class="string"><span class="delimiter">"</span><span class="content">createTs</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">List</span>&lt;UserRole&gt; userRoles;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="temporal_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Temporal
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Temporal.html" target="_blank">javax.persistence.Temporal</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Для атрибута типа <code>java.util.Date</code> уточняет тип хранимого значения: дата, время или дата+время.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Параметры:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>value</code> - тип хранимого значения: <code>DATE</code>, <code>TIME</code>, <code>TIMESTAMP</code></p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">START_DATE</span><span class="delimiter">"</span></span>)
<span class="annotation">@Temporal</span>(TemporalType.DATE)
<span class="directive">protected</span> <span class="predefined-type">Date</span> startDate;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="transient_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Transient
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Transient.html" target="_blank">javax.persistence.Transient</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Указывает, что данное поле не хранится в БД, т.е. является неперсистентным.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Поля поддерживаемых <a href="/manual.html#jpa">JPA</a> типов (см. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Basic.html" target="_blank"></a><a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Basic.html" class="bare" target="_blank">http://docs.oracle.com/javaee/7/api/javax/persistence/Basic.html</a>) <em>по умолчанию являются персистентными</em>, поэтому аннотация <code>@Transient</code> обязательна для объявления неперсистентного атрибута такого типа.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Для включения <code>@Transient</code> атрибута в метаданные, необходимо также указать аннотацию <code><a href="/manual.html#metaProperty_annotation">@MetaProperty</a></code>.</p> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="version_annotation" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @Version
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>См. <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Version.html" target="_blank">javax.persistence.Version</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Указывает, что данное поле хранит версию для поддержки <a href="/manual.html#optimistic_locking">оптимистичной блокировки</a> сущностей.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Применение такого поля необходимо при реализации классом сущности интерфейса <code>Versioned</code> (базовый класс <code>StandardEntity</code> уже содержит такое поле).</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Version</span>
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">VERSION</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> <span class="predefined-type">Integer</span> version;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="enum_attributes"><a class="anchor" href="/manual.html#enum_attributes"></a>5.2.1.3. Атрибуты типа enum</h5> 
        <div class="paragraph"> 
         <p>В стандартном варианте использования <a href="/manual.html#jpa">JPA</a> для атрибутов типа <code>enum</code> в базе данных хранится целое число, получаемое методом <code>ordinal()</code> этого перечисления. Такой подход может привести к следующим проблемам при эксплуатации и развитии системы:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>при появлении в БД значения, не равного ни одному <code>ordinal</code> значению перечисления, экземпляр сущности нельзя загрузить вообще;</p> </li> 
          <li> <p>невозможно ввести новое значение между имеющимися, что актуально при использовании сортировки по значению перечисления (order by).</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Чтобы решить эти проблемы, в подходе CUBA предлагается отвязать значение, хранимое в БД, от <code>ordinal</code> перечисления. Для этого необходимо поле класса сущности объявлять с типом, хранимым в БД (<code>Integer</code> или <code>String</code>), а методы доступа (getter / setter) создавать для типа самого перечисления.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">sales$Customer</span><span class="delimiter">"</span></span>)
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SALES_CUSTOMER</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> <span class="directive">extends</span> StandardEntity {

    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">GRADE</span><span class="delimiter">"</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">Integer</span> grade;

    <span class="directive">public</span> CustomerGrade getGrade() {
        <span class="keyword">return</span> grade == <span class="predefined-constant">null</span> ? <span class="predefined-constant">null</span> : CustomerGrade.fromId(grade);
    }

    <span class="directive">public</span> <span class="type">void</span> setGrade(CustomerGrade grade) {
        <span class="local-variable">this</span>.grade = grade == <span class="predefined-constant">null</span> ? <span class="predefined-constant">null</span> : grade.getId();
    }
    ...
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>При этом сам класс перечисления может выглядеть следующим образом:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">enum</span> CustomerGrade <span class="directive">implements</span> EnumClass&lt;<span class="predefined-type">Integer</span>&gt; {

    PREMIUM(<span class="integer">10</span>),
    HIGH(<span class="integer">20</span>),
    MEDIUM(<span class="integer">30</span>);

    <span class="directive">private</span> <span class="predefined-type">Integer</span> id;

    CustomerGrade(<span class="predefined-type">Integer</span> id) {
        <span class="local-variable">this</span>.id = id;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> getId() {
        <span class="keyword">return</span> id;
    }

    <span class="directive">public</span> <span class="directive">static</span> CustomerGrade fromId(<span class="predefined-type">Integer</span> id) {
        <span class="keyword">for</span> (CustomerGrade grade : CustomerGrade.values()) {
            <span class="keyword">if</span> (grade.getId().equals(id))
                <span class="keyword">return</span> grade;
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Для правильного отражения в <a href="/manual.html#metadata_framework">метаданных</a> класс перечисления, используемый в качестве типа атрибута сущности, должен реализовывать интерфейс <code>EnumClass</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Как видно из примеров, для атрибута <code>grade</code> в БД хранится значение типа <code>Integer</code>, задаваемое полем <code>id</code> перечисления <code>CustomerGrade</code>, а конкретно <code>10</code>, <code>20</code> или <code>30</code>. В то же время прикладной код и метаданные работают с самим типом <code>CustomerGrade</code> через методы доступа, которые и осуществляют конвертацию.</p> 
        </div> 
        <div class="paragraph"> 
         <p>При наличии в поле БД значения, не соответствующего ни одному значению перечисления, метод <code>getGrade()</code> просто вернет <code>null</code>. Для ввода нового значения, например, <code>HIGHER</code>, между <code>HIGH</code> и <code>PREMIUM</code>, достаточно добавить это значение в перечисление с идентификатором <code>15</code>, при этом сортировка по полю <code>Customer.grade</code> останется верной.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Тип поля <code>Integer</code> удобно использовать в случаях, когда необходим упорядоченный список констант, подлежащий сортировке, например, в запросах JPQL и SQL (<code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>⇐</code>, <code>order</code> <code>by</code>), кроме того, он имеет незначительное преимущество перед <code>String</code> в плане производительности формата хранения и занимаемого места. С другой стороны, значения типа <code>Integer</code> сами по себе неочевидны и могут затруднять отладку и интерпретацию результатов запросов, они неудобны в работе с голыми данными и сериализованными форматами. Если отношение упорядочения между константами не требуется, удобнее использовать тип <code>String</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Перечисления могут быть созданы в CUBA Studio на вкладке <strong>DATA MODEL</strong> (New → Enumeration). Чтобы использовать перечисление в качестве атрибута сущности, в редакторе атрибута нужно выбрать <code>ENUM</code> в поле <strong>Attribute type</strong> и класс перечисления в поле <strong>Type</strong>. Значениям перечисления могут быть сопоставлены <a href="/manual.html#enum_localization">локализованные названия</a> для отображения в пользовательском интерфейсе приложения.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="soft_deletion"><a class="anchor" href="/manual.html#soft_deletion"></a>5.2.1.4. Мягкое удаление</h5> 
        <div class="paragraph"> 
         <p>Платформа CUBA поддерживает режим "мягкого удаления" данных - когда вместо удаления записей из базы данных они только помечаются определенным образом и становятся недоступными для обычного использования. В дальнейшем такие записи можно либо совсем удалить из БД с помощью отдельной регламентной процедуры, либо восстановить.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Механизм мягкого удаления является "прозрачным" для прикладного программиста - достаточно убедиться, что класс сущности реализует интерфейс <code>SoftDelete</code>, и платформа сама нужным образом будет модифицировать запросы и операции с данными.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Режим мягкого удаления имеет следующие преимущества:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>значительно снижается риск потери данных вследствие неверных действий пользователей</p> </li> 
          <li> <p>позволяет быстро сделать некоторые записи недоступными, даже если на них имеются ссылки.</p> 
           <div class="paragraph"> 
            <p>Возьмем для примера модель данных <code>Заказы</code> - <code>Покупатели</code>. Допустим, на некоторого покупателя оформлено несколько заказов, однако нам нужно сделать его недоступным для дальнейшей работы пользователей. Традиционным "жестким" удалением сделать это невозможно, так как для удаления покупателя нам нужно либо удалить все его заказы, либо обнулить в этих заказах ссылки на него (т.е. потерять информацию). При мягком удалении покупателя он становится недоступным для поиска и изменения, однако при просмотре заказов пользователь видит на экране имя покупателя, так как при загрузке связей признак удаления намеренно игнорируется.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Описанное поведение является стандартным, но может быть модифицировано с помощью <a href="/manual.html#delete_policy">политики обработки связей</a> при удалении.</p> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Восстановить удалённые сущности можно через экран <strong>Restore Deleted Entities</strong>, по умолчанию доступный в стандартном меню <strong>Administration</strong> приложения. Эта функциональность предназначена для использования администраторами системы, имеющими <a href="/manual.html#permissions">разрешения</a> на все сущности. Её следует использовать с осторожностью, также рекомендуется ограничить доступ к этому экрану для простых пользователей системы.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Отрицательной стороной мягкого удаления является увеличение объема базы данных и потенциальная необходимость дополнительных процедур ее очистки.</p> 
        </div> 
        <div class="sect5"> 
         <h6 id="soft_deletion_usage"><a class="anchor" href="/manual.html#soft_deletion_usage"></a>5.2.1.4.1. Использование</h6> 
         <div class="paragraph"> 
          <p>Для того чтобы экземпляры сущности удалялись мягко, класс сущности должен реализовывать интерфейс <code>SoftDelete</code>, а соответствующая таблица БД должна содержать колонки:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>DELETE_TS</code> - когда удалена запись</p> </li> 
           <li> <p><code>DELETED_BY</code> - логин пользователя, который удалил запись</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Поведение системы по умолчанию - сущности, реализующие <code>SoftDelete</code>, удаляются мягко, удаленные сущности не возвращаются запросами и поиском по идентификатору. При необходимости такое поведение можно динамически отключить следующими способами:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>для текущего экземпляра <a href="/manual.html#entityManager">EntityManager</a> - вызовом <code>setSoftDeletion(false)</code></p> </li> 
           <li> <p>при запросе данных через <a href="/manual.html#dataManager">DataManager</a> - вызовом у передаваемого объекта <code>LoadContext</code> метода <code>setSoftDeletion(false)</code></p> </li> 
           <li> <p>на уровне <a href="/manual.html#datasources">источников данных</a> - используя метод <code>CollectionDatasource.setSoftDeletion(false)</code> или атрибут <code>softDeletion="false"</code> элемента <code>collectionDatasource</code> в <a href="/manual.html#screen_xml">XML-дескрипторе</a> экрана.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В режиме мягкого удаления платформа автоматически отфильтровывает удаленные экземпляры при загрузке по идентификатору и по <a href="/manual.html#jpql">JPQL-запросу</a>, а также удаленные элементы связанных сущностей в атрибутах-коллекциях. Однако связанные сущности в единичных (*ToOne) атрибутах загружаются независимо от того, удален связанный экземпляр или нет.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="delete_policy"><a class="anchor" href="/manual.html#delete_policy"></a>5.2.1.4.2. Политика обработки связей</h6> 
         <div class="paragraph"> 
          <p>Платформа предоставляет средство обработки связей при удалении сущностей, во многом аналогичное правилам <strong>ON DELETE</strong> внешних ключей в базе данных. Это средство работает на <a href="/manual.html#app_tiers">уровне</a> Middleware и использует аннотации <a href="/manual.html#onDelete_annotation">@OnDelete</a>, <a href="/manual.html#onDeleteInverse_annotation">@OnDeleteInverse</a> атрибутов сущности.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Аннотация <code>@OnDelete</code> обрабатывается при удалении той сущности, в которой она встретилась, а не той, на которую указывает аннотированный атрибут (в этом отличие от каскадных удалений на уровне БД).</p> 
         </div> 
         <div class="paragraph"> 
          <p>Аннотация <code>@OnDeleteInverse</code> обрабатывается при удалении той сущности, на которую указывает аннотированный атрибут, (т.е. аналогично каскадному удалению на уровне внешних ключей в БД). Эта аннотация полезна при отсутствии в удаляемом объекте атрибута, который нужно проверять при удалении. При этом, как правило, в проверяемом объекте существует ссылка на удаляемый, на этот атрибут и устанавливается аннотация <code>@OnDeleteInverse</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Значением аннотации может быть:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>DeletePolicy.DENY</code> - запретить удаление сущности, если аннотированный атрибут не <code>null</code> или не пустая коллекция</p> </li> 
           <li> <p><code>DeletePolicy.CASCADE</code> - каскадно удалить аннотированный атрибут</p> </li> 
           <li> <p><code>DeletePolicy.UNLINK</code> - разорвать связь с аннотированным атрибутом. Разрыв связи имеет смысл указывать только на ведущей стороне ассоциации - той, которая в классе сущности аннотирована <code>@JoinColumn</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Примеры:</p> 
         </div> 
         <div class="olist arabic"> 
          <ol class="arabic"> 
           <li> <p>Запрет удаления при наличии ссылки: при попытке удаления экземпляра <code>Customer</code>, на который ссылается хотя бы один <code>Order</code>, будет выброшено исключение <code>DeletePolicyException</code>.</p> 
            <div class="paragraph"> 
             <p><code>Order.java</code></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CUSTOMER_ID</span><span class="delimiter">"</span></span>)
<span class="annotation">@OnDeleteInverse</span>(DeletePolicy.DENY)
<span class="directive">protected</span> Customer customer;</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p><code>Customer.java</code></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">List</span>&lt;Order&gt; orders;</code></pre> 
             </div> 
            </div> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Сообщения в окне исключения могут быть локализованы в <a href="/manual.html#main_message_pack">главном пакете сообщений</a>. Используйте для этого следующие ключи:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>deletePolicy.caption</code> - заголовок уведомления.</p> </li> 
                <li> <p><code>deletePolicy.references.message</code> - тело сообщения.</p> </li> 
                <li> <p><code>deletePolicy.caption.sales$Customer</code> - заголовок уведомления для конкретной сущности.</p> </li> 
                <li> <p><code>deletePolicy.references.message.sales$Customer</code> - тело сообщения для конкретной сущности.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
           <li> <p>Каскадное удаление элементов коллекции: при удалении экземпляра <code>Role</code> все экземпляры <code>Permission</code> также будут удалены.</p> 
            <div class="paragraph"> 
             <p><code>Role.java</code></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">role</span><span class="delimiter">"</span></span>)
<span class="annotation">@OnDelete</span>(DeletePolicy.CASCADE)
<span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Permission</span>&gt; permissions;</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p><code>Permission.java</code></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">ROLE_ID</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">Role</span> role;</code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Разрыв связи с элементами коллекции: удаление экземпляра <code>Role</code> приведет к установке в <code>null</code> ссылок со стороны всех входивших в коллекцию экземпляров <code>Permission</code>.</p> 
            <div class="paragraph"> 
             <p><code>Role.java</code></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@OneToMany</span>(mappedBy = <span class="string"><span class="delimiter">"</span><span class="content">role</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Permission</span>&gt; permissions;</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p><code>Permission.java</code></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ManyToOne</span>(fetch = FetchType.LAZY)
<span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">ROLE_ID</span><span class="delimiter">"</span></span>)
<span class="annotation">@OnDeleteInverse</span>(DeletePolicy.UNLINK)
<span class="directive">protected</span> <span class="predefined-type">Role</span> role;</code></pre> 
             </div> 
            </div> </li> 
          </ol> 
         </div> 
         <div class="paragraph"> 
          <p>Особенности реализации:</p> 
         </div> 
         <div class="olist arabic"> 
          <ol class="arabic"> 
           <li> <p>Политика обработки связей реализуется при сохранении данных в БД на уровне Middleware.</p> </li> 
           <li> <p>Нужно быть осторожным при использовании <code>@OnDeleteInverse</code> с политиками <code>CASCADE</code> и <code>UNLINK</code>, так как при этом происходит извлечение из БД на сервер приложения всех экземпляров ссылающихся объектов, изменение и затем сохранение.</p> 
            <div class="paragraph"> 
             <p>Например, в случае ассоциации <code>Customer</code> - <code>Job</code> и большого количества работ для одного заказчика, если поставить на атрибут <code>Job.customer</code> политику <code>@OnDeleteInverse(CASCADE)</code>, то при удалении экземпляра заказчика будет предпринята попытка извлечь и изменить все его работы. Это может привести к перегрузке сервера приложения и БД.</p> 
            </div> 
            <div class="paragraph"> 
             <p>С другой стороны, использование <code>@OnDeleteInverse(DENY)</code> безопасно, так как при этом производится только подсчет количества ссылающихся объектов, и если оно больше <code>0</code>, выбрасывается исключение. Поэтому <code>@OnDeleteInverse(DENY)</code> для атрибута <code>Job.customer</code> вполне допустимо.</p> 
            </div> </li> 
           <li> <p>Политика <code>UNLINK</code> не поддерживается для ссылок на коллекции с отношениями one-to-many и many-to-many: при попытке удаления экземпляра сущности на ведущей стороне ассоциации будет выброшено исключение <code>UnsupportedOperationException</code>. Пример ошибочной политики:</p> 
            <div class="paragraph"> 
             <p><code>Owner.java</code></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JoinTable</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SAMPLE_OWNER_SUBORDINATE_LINK</span><span class="delimiter">"</span></span>,
    joinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">OWNER_ID</span><span class="delimiter">"</span></span>),
    inverseJoinColumns = <span class="annotation">@JoinColumn</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">SUBORDINATE_ID</span><span class="delimiter">"</span></span>))
<span class="annotation">@OnDelete</span>(DeletePolicy.UNLINK)
<span class="annotation">@ManyToMany</span>
<span class="directive">protected</span> <span class="predefined-type">List</span>&lt;Subordinate&gt; subordinate;</code></pre> 
             </div> 
            </div> </li> 
          </ol> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="soft_deletion_unique_constr"><a class="anchor" href="/manual.html#soft_deletion_unique_constr"></a>5.2.1.4.3. Ограничение уникальности на уровне БД</h6> 
         <div class="paragraph"> 
          <p>В режиме мягкого удаления для ограничения уникальности некоторого значения необходимо обеспечить существование единственной неудаленной записи с этим значением, и произвольного количества удаленных записей с этим же значением.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Реализуется данная логика путем, специфичным для используемого сервера базы данных:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Если сервер БД поддерживает частичные (partial) индексы (например, <strong>PostgreSQL</strong>), то ограничение уникальности можно создать следующим образом:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">create</span> <span class="directive">unique</span> <span class="type">index</span> IDX_SEC_USER_UNIQ_LOGIN <span class="keyword">on</span> SEC_USER (LOGIN_LC) <span class="keyword">where</span> DELETE_TS <span class="keyword">is</span> <span class="predefined-constant">null</span></code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Если сервер БД не поддерживает частичные индексы (например, <strong>Microsoft SQL Server 2005</strong>), то в уникальный индекс можно включить поле <strong>DELETE_TS</strong>:</p> </li> 
          </ul> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">create</span> <span class="directive">unique</span> <span class="type">index</span> IDX_SEC_USER_UNIQ_LOGIN <span class="keyword">on</span> SEC_USER (LOGIN_LC, DELETE_TS)</code></pre> 
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="metadata_framework"><a class="anchor" href="/manual.html#metadata_framework"></a>5.2.2. Metadata Framework</h4> 
       <div class="paragraph"> 
        <p>Для эффективной работы с <a href="/manual.html#data_model">моделью данных</a> в CUBA-приложениях используется фреймворк метаданных, который:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>предоставляет удобный интерфейс для получения информации о <a href="/manual.html#entity">сущностях</a>, их атрибутах и отношениях между сущностями; а также для навигации по ссылкам</p> </li> 
         <li> <p>служит специализированной и более удобной в использовании альтернативой <strong>Java Reflection API</strong></p> </li> 
         <li> <p>регламентирует допустимые типы данных и отношений между сущностями</p> </li> 
         <li> <p>позволяет создавать универсальные механизмы работы с данными</p> </li> 
        </ul> 
       </div> 
       <div class="sect4"> 
        <h5 id="metadata_interfaces"><a class="anchor" href="/manual.html#metadata_interfaces"></a>5.2.2.1. Интерфейсы метаданных</h5> 
        <div class="paragraph"> 
         <p>Рассмотрим основные интерфейсы метаданных.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/MetadataFramework.png" alt="MetadataFramework"> 
         </div> 
         <div class="title">
          Рисунок 9. Интерфейсы фреймворка метаданных
         </div> 
        </div> 
        <div class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           <code>Session</code>
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Точка входа в фреймворк метаданных. Позволяет получать экземпляры <code>MetaClass</code> по имени и по соответствующему классу Java. Обратите внимание на различие методов <code>getClass()</code> и <code>getClassNN()</code> - первые могут возвращать <code>null</code>, вторые нет (NonNull).</p> 
             </div> 
             <div class="paragraph"> 
              <p>Объект <code>Session</code> может быть получен через интерфейс инфраструктуры <code><a href="/manual.html#metadata">Metadata</a></code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Пример:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Metadata metadata;
...
Session session = metadata.getSession();
MetaClass metaClass1 = session.getClassNN(<span class="string"><span class="delimiter">"</span><span class="content">sec$User</span><span class="delimiter">"</span></span>);
MetaClass metaClass2 = session.getClassNN(User.class);
<span class="keyword">assert</span> metaClass1 == metaClass2;</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           <code>MetaModel</code>
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Редко используемый интерфейс, служит для группировки мета-классов.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Группировка осуществляется по имени корневого Java пакета проекта, указываемого в файле <code><a href="/manual.html#metadata.xml">metadata.xml</a></code>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="metaClass" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           <code>MetaClass</code>
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Интерфейс метаданных класса сущности. <code>MetaClass</code> всегда ассоциирован с классом Java, которого он представляет.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Основные методы:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>getName()</code> – имя сущности, по соглашению первой частью имени до знака <code>$</code> является код пространства имен, например, <code>sales$Customer</code></p> </li> 
               <li> <p><code>getProperties()</code> – список мета-свойств (<code>MetaProperty</code>)</p> </li> 
               <li> <p><code>getProperty()</code>, <code>getPropertyNN()</code> - получение мета-свойства по имени. Первый метод в случае отсутствия атрибута с указанным именем возвращает <code>null</code>, второй выбрасывает исключение.</p> 
                <div class="paragraph"> 
                 <p>Пример:</p> 
                </div> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">MetaClass userClass = session.getClassNN(User.class);
MetaProperty groupProperty = userClass.getPropertyNN(<span class="string"><span class="delimiter">"</span><span class="content">group</span><span class="delimiter">"</span></span>);</code></pre> 
                 </div> 
                </div> </li> 
              </ul> 
             </div> 
             <div id="MetaPropertyPath" class="ulist"> 
              <ul> 
               <li> <p><code>getPropertyPath()</code> - позволяет перемещаться по ссылкам. Данный метод принимает строковый параметр - путь из имен атрибутов, разделенных точкой. Возвращаемый объект <code>MetaPropertyPath</code> позволяет обратиться к искомому (последнему в пути) атрибуту вызовом <code>getMetaProperty()</code>.</p> 
                <div class="paragraph"> 
                 <p>Пример:</p> 
                </div> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">MetaClass userClass = session.getClassNN(User.class);
MetaProperty groupNameProp = userClass.getPropertyPath(<span class="string"><span class="delimiter">"</span><span class="content">group.name</span><span class="delimiter">"</span></span>).getMetaProperty();
<span class="keyword">assert</span> groupNameProp.getDomain().getName().equals(<span class="string"><span class="delimiter">"</span><span class="content">sec$Group</span><span class="delimiter">"</span></span>);</code></pre> 
                 </div> 
                </div> </li> 
               <li> <p><code>getJavaClass()</code> – класс сущности, которому соответствует данный <code>MetaClass</code></p> </li> 
               <li> <p><code>getAnnotations()</code> – коллекция <a href="/manual.html#meta_annotations">мета-аннотаций</a></p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="metaProperty" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           <code>MetaProperty</code>
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Интерфейс метаданных атрибута сущности.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Основные методы:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>getName()</code> – имя свойства, соответствует имени атрибута сущности</p> </li> 
               <li> <p><code>getDomain()</code> – мета-класс, которому принадлежит данное свойство</p> </li> 
              </ul> 
             </div> 
             <div id="metaProperty.getType" class="ulist"> 
              <ul> 
               <li> <p><code>getType()</code> – тип свойства:</p> 
                <div class="ulist"> 
                 <ul> 
                  <li> <p>простой тип: <code>DATATYPE</code></p> </li> 
                  <li> <p>перечисление: <code>ENUM</code></p> </li> 
                  <li> <p>ссылочный тип двух видов:</p> 
                   <div class="ulist"> 
                    <ul> 
                     <li> <p><code>ASSOCIATION</code> − простая ссылка на другую сущность. Например, отношение заказа и покупателя − ассоциация.</p> </li> 
                     <li> <p><code>COMPOSITION</code> − ссылка на сущность, которая не имеет самостоятельного значения без владеющей сущности. <code>COMPOSITION</code> можно считать "более тесным" отношением, чем <code>ASSOCIATION</code>. Например, отношение заказа и пункта этого заказа − <code>COMPOSITION</code>, т.к. пункт не может существовать без заказа, которому он принадлежит.</p> 
                      <div class="paragraph"> 
                       <p>Вид ссылочного атрибута <code>ASSOCIATION</code> или <code>COMPOSITION</code> влияет на режим редактирования сущности: в первом случае сохранение связанной сущности в базу данных происходит независимо, а во втором − связанная сущность сохраняется в БД только вместе с владеющей сущностью.</p> 
                      </div> </li> 
                    </ul> 
                   </div> </li> 
                 </ul> 
                </div> </li> 
               <li> <p><code>getRange()</code> – интерфейс <code>Range</code>, детально описывающий тип данного атрибута</p> </li> 
               <li> <p><code>isMandatory()</code> – признак обязательности атрибута. Используется, например, визуальными компонентами для сигнализации пользователю о необходимости ввода значения.</p> </li> 
               <li> <p><code>isReadOnly()</code> – признак неизменности атрибута</p> </li> 
               <li> <p><code>getInverse()</code> – для ссылочного атрибута возвращает мета-свойство с обратной стороны ассоциации, если таковое имеется</p> </li> 
               <li> <p><code>getAnnotatedElement()</code> – поле (<code>java.lang.reflect.Field</code>) или метод (<code>java.lang.reflect.Method</code>), соответствующие данному атрибуту сущности</p> </li> 
               <li> <p><code>getJavaType()</code> – класс Java данного атрибута сущности. Это либо тип поля класса, либо тип возвращаемого значения метода.</p> </li> 
               <li> <p><code>getDeclaringClass()</code> – класс Java, содержащий данный атрибут</p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           <code>Range</code>
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Интерфейс, детально описывающий тип атрибута сущности.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Основные методы:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>isDatatype()</code> – возвращает <code>true</code> для атрибута простого <a href="/manual.html#metaProperty.getType">типа</a></p> </li> 
               <li> <p><code>asDatatype()</code> - возвращает <a href="/manual.html#datatype">Datatype</a> для атрибута простого <a href="/manual.html#metaProperty.getType">типа</a></p> </li> 
               <li> <p><code>isEnum()</code> – возвращает <code>true</code> для атрибута <a href="/manual.html#metaProperty.getType">типа</a> перечисления</p> </li> 
               <li> <p><code>asEnumeration()</code> - возвращает <a href="/manual.html#datatype">Enumeration</a> для атрибута <a href="/manual.html#metaProperty.getType">типа</a> перечисления</p> </li> 
               <li> <p><code>isClass()</code> – возвращает <code>true</code> для ссылочного атрибута <a href="/manual.html#metaProperty.getType">типа</a> <code>ASSOCIATION</code> или <code>COMPOSITION</code></p> </li> 
               <li> <p><code>asClass()</code> - возвращает <a href="/manual.html#metaClass">мета-класс</a> ассоциированной сущности для ссылочного атрибута</p> </li> 
               <li> <p><code>isOrdered()</code> – возвращает <code>true</code> если атрибут представляет собой упорядоченную коллекцию (например, <code>List</code>)</p> </li> 
               <li> <p><code>getCardinality()</code> – вид отношения для ссылочного атрибута: <code>ONE_TO_ONE</code>, <code>MANY_TO_ONE</code>, <code>ONE_TO_MANY</code>, <code>MANY_TO_MANY</code></p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="metadata_building"><a class="anchor" href="/manual.html#metadata_building"></a>5.2.2.2. Формирование метаданных</h5> 
        <div class="paragraph"> 
         <p>Основной источник формирования структуры метаданных - <a href="/manual.html#entity_annotations">аннотированные</a> классы сущностей.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Класс сущности отражается в метаданных в следующих случаях:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Класс персистентной сущности аннотирован <code>@Entity</code>, <code>@Embeddable</code>, <code>@MappedSuperclass</code> и расположен в пределах корневого пакета, указанного в <code><a href="/manual.html#metadata.xml">metadata.xml</a></code>.</p> </li> 
          <li> <p>Класс неперсистентной сущности аннотирован <code>@MetaClass</code> и расположен в пределах корневого пакета, указанного в <code><a href="/manual.html#metadata.xml">metadata.xml</a></code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Все сущности внутри одного корневого пакета помещаются в один экземпляр <code>MetaModel</code>, которому присваивается имя этого пакета. Между сущностями внутри одной <code>MetaModel</code> можно устанавливать произвольные связи, между разными - в порядке объявления файлов <code>metadata.xml</code> в свойстве <code><a href="/manual.html#cuba.metadataConfig">cuba.metadataConfig</a></code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Атрибут сущности отражается в метаданных, если:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>поле класса аннотировано <code>@Column</code>, <code>@OneToOne</code>, <code>@OneToMany</code>, <code>@ManyToOne</code>, <code>@ManyToMany</code>, <code>@Embedded</code></p> </li> 
          <li> <p>поле класса или метод доступа на чтение (getter) аннотирован <code>@MetaProperty</code></p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Параметры мета-класса и мета-свойств формируются на основе параметров перечисленных <a href="/manual.html#entity_annotations">аннотаций</a>, а также типов полей и методов класса. Кроме того, если у атрибута отсутствует метод доступа на запись (setter), атрибут становится неизменяемым (read only).</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="datatype"><a class="anchor" href="/manual.html#datatype"></a>5.2.2.3. Datatype</h5> 
        <div class="paragraph"> 
         <p>Интерфейс <code>Datatype</code> определяет методы конвертации значение в строку и из строки (formatting &amp; parsing). Каждый атрибут сущности, не являющийся ссылкой, имеет некоторый <code>Datatype</code>, который и используется фреймворком для конвертации значений данного атрибута.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Экземпляры <code>Datatype</code> регистрируются в бине <code>DatatypeRegistry</code>, который выполняет загрузку и инициализацию классов реализации <code>Datatype</code> из файлов <a href="/manual.html#metadata.xml">metadata.xml</a> <a href="/manual.html#app_components">компонентов приложения</a> и самого проекта.</p> 
        </div> 
        <div class="paragraph"> 
         <p><code>Datatype</code> атрибута сущности может быть получен из соответствующего <a href="/manual.html#metaProperty">meta-property</a> методом <code>getRange().asDatatype()</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Кроме конвертации значений атрибутов сущностей, зарегистрированные экземпляры <code>Datatype</code> могут быть использованы для преобразования в строку и из строки произвольных значений поддерживаемых типов. Для этого необходимо получить экземпляр <code>Datatype</code> из <code>DatatypeRegistry</code> с помощью его методов <code>get(Class)</code> или <code>getNN(Class)</code>, передавая тип Java, который необходимо конвертировать.</p> 
        </div> 
        <div class="paragraph"> 
         <p><code>Datatype</code> сопоставляется атрибуту сущности по следующим правилам:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Как правило, атрибуту сопоставляется экземпляр <code>Datatype</code>, зарегистрированный в <code>DatatypeRegistry</code> и предназначенный для конвертации типа атрибута.</p> 
           <div class="paragraph"> 
            <p>Например, в данном случае атрибут <code>amount</code> получит <code>BigDecimalDatatype</code>:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">AMOUNT</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> <span class="predefined-type">BigDecimal</span> amount;</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>потому что в <code>cuba-metadata.xml</code> есть следующий элемент:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;datatype</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">decimal</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.chile.core.datatypes.impl.BigDecimalDatatype</span><span class="delimiter">"</span></span>
          <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
          <span class="attribute-name">format</span>=<span class="string"><span class="delimiter">"</span><span class="content">0.####</span><span class="delimiter">"</span></span> <span class="attribute-name">decimalSeparator</span>=<span class="string"><span class="delimiter">"</span><span class="content">.</span><span class="delimiter">"</span></span> <span class="attribute-name">groupingSeparator</span>=<span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Для поля или метода можно задать аннотацию <a href="/manual.html#metaProperty_annotation">@MetaProperty</a>, указав в ней атрибут <code>datatype</code>.</p> 
           <div class="paragraph"> 
            <p>Например, атрибут <code>issueYear</code> получит тип <code>YearDatatype</code>:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MetaProperty</span>(datatype = <span class="string"><span class="delimiter">"</span><span class="content">year</span><span class="delimiter">"</span></span>)
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">ISSUE_YEAR</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> <span class="predefined-type">Integer</span> issueYear;</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>если файл <code>metadata.xml</code> проекта содержит следующий элемент:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;datatype</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">year</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.YearDatatype</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Как видно, атрибут <code>datatype</code> аннотации <code>@MetaProperty</code> указывает на идентификатор, который использован при регистрации класса имплементации <code>Datatype</code> в файле <code>metadata.xml</code>.</p> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Основные методы интерфейса <code>Datatype</code>:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>format()</code> - преобразовывает переданное значение в строку</p> </li> 
          <li> <p><code>parse()</code> - преобразовывает строку в значение нужного типа</p> </li> 
          <li> <p><code>getJavaClass()</code> – возвращает тип Java, для конвертации которого создан данный <code>Datatype</code>. Этот метод имеет реализацию по умолчанию, которая считывает значение аннотации <code>@JavaClass</code>, если она присутствует на классе.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p><code>Datatype</code> определяет два набора методов для форматирования/парсинга: с учетом локали и без учета локали. Преобразование с учетом локали используется повсеместно в пользовательском интерфейсе, преобразование без учета локали используется в системных механизмах, например, для сериализации в <a href="/manual.html#rest_api_v2">REST API</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Форматы для преобразований без учета локали задаются в коде имплементации или в файле <code>metadata.xml</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В следующем разделе описано, как задать форматы преобразований с учетом локали.</p> 
        </div> 
        <div class="sect5"> 
         <h6 id="datatype_format_strings"><a class="anchor" href="/manual.html#datatype_format_strings"></a>5.2.2.3.1. Строки форматов Datatype</h6> 
         <div class="paragraph"> 
          <p>Форматы для преобразований с учетом локали задаются в <a href="/manual.html#main_message_pack">главном пакете локализованных сообщений</a> проекта или его <a href="/manual.html#app_components">компонентов</a>, в строках со следующими ключами:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>numberDecimalSeparator</code> - задает символ разделителя целой и дробной части для числовых типов</p> </li> 
           <li> <p><code>numberGroupingSeparator</code> - задает символ разделителя групп разрядов для числовых типов</p> </li> 
           <li> <p><code>integerFormat</code> - формат для типов <code>Integer</code> и <code>Long</code></p> </li> 
           <li> <p><code>doubleFormat</code> - формат для типа <code>Double</code></p> </li> 
           <li> <p><code>decimalFormat</code> - формат для типа <code>BigDecimal</code></p> </li> 
           <li> <p><code>dateTimeFormat</code> - формат для типа <code>java.util.Date</code></p> </li> 
           <li> <p><code>dateFormat</code> - формат для типа <code>java.sql.Date</code></p> </li> 
           <li> <p><code>timeFormat</code> - формат для типа <code>java.sql.Time</code></p> </li> 
           <li> <p><code>trueString</code> - строка, соответствующая <code>Boolean.TRUE</code></p> </li> 
           <li> <p><code>falseString</code> - строка, соответствующая <code>Boolean.FALSE</code></p> </li> 
          </ul> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Форматы для используемых в приложении языков могут быть заданы в Studio. Для этого откройте на редактирование <strong>Project Properties</strong>, нажмите кнопку в поле <strong>Available locales</strong>, затем нажмите <strong>Show data format strings</strong>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>Строки форматов могут быть получены из бина <code>FormatStringsRegistry</code>.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="datatype_custom_example"><a class="anchor" href="/manual.html#datatype_custom_example"></a>5.2.2.3.2. Пример специализированного Datatype</h6> 
         <div class="paragraph"> 
          <p>В качестве примера рассмотрим следующую задачу: в приложении есть атрибуты сущностей, хранящие годы в виде целых чисел. Пользователи должны иметь возможность просматривать и редактировать годы, причем если пользователь вводит только две цифры, приложение должно преобразовать их в год между 2000 и 2100. В противном случае, все введенное число считается годом.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Создайте класс в модуле <strong>global</strong>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.sample.entity</span>;

<span class="keyword">import</span> <span class="include">com.google.common.base.Strings</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.chile.core.annotations.JavaClass</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.chile.core.datatypes.Datatype</span>;

<span class="keyword">import</span> <span class="include">javax.annotation.Nullable</span>;
<span class="keyword">import</span> <span class="include">java.text.DecimalFormat</span>;
<span class="keyword">import</span> <span class="include">java.text.ParseException</span>;
<span class="keyword">import</span> <span class="include">java.util.Locale</span>;

<span class="annotation">@JavaClass</span>(<span class="predefined-type">Integer</span>.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">YearDatatype</span> <span class="directive">implements</span> Datatype&lt;<span class="predefined-type">Integer</span>&gt; {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PATTERN = <span class="string"><span class="delimiter">"</span><span class="content">##00</span><span class="delimiter">"</span></span>;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> format(<span class="annotation">@Nullable</span> <span class="predefined-type">Object</span> value) {
        <span class="keyword">if</span> (value == <span class="predefined-constant">null</span>)
            <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span>;

        <span class="predefined-type">DecimalFormat</span> format = <span class="keyword">new</span> <span class="predefined-type">DecimalFormat</span>(PATTERN);
        <span class="keyword">return</span> format.format(value);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> format(<span class="annotation">@Nullable</span> <span class="predefined-type">Object</span> value, <span class="predefined-type">Locale</span> locale) {
        <span class="keyword">return</span> format(value);
    }

    <span class="annotation">@Nullable</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> parse(<span class="annotation">@Nullable</span> <span class="predefined-type">String</span> value) <span class="directive">throws</span> <span class="exception">ParseException</span> {
        <span class="keyword">if</span> (Strings.isNullOrEmpty(value))
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;

        <span class="predefined-type">DecimalFormat</span> format = <span class="keyword">new</span> <span class="predefined-type">DecimalFormat</span>(PATTERN);
        <span class="type">int</span> year = format.parse(value).intValue();
        <span class="keyword">if</span> (year &gt; <span class="integer">2100</span> || year &lt; <span class="integer">0</span>)
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">ParseException</span>(<span class="string"><span class="delimiter">"</span><span class="content">Invalid year</span><span class="delimiter">"</span></span>, <span class="integer">0</span>);
        <span class="keyword">if</span> (year &lt; <span class="integer">100</span>)
            year += <span class="integer">2000</span>;
        <span class="keyword">return</span> year;
    }

    <span class="annotation">@Nullable</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> parse(<span class="annotation">@Nullable</span> <span class="predefined-type">String</span> value, <span class="predefined-type">Locale</span> locale) <span class="directive">throws</span> <span class="exception">ParseException</span> {
        <span class="keyword">return</span> parse(value);
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Затем добавьте элемент <code>datatypes</code> в файл <a href="/manual.html#metadata.xml">metadata.xml</a> вашего проекта:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/metadata.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;datatypes&gt;</span>
        <span class="tag">&lt;datatype</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">year</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.YearDatatype</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/datatypes&gt;</span>
    <span class="comment">&lt;!-- ... --&gt;</span>
<span class="tag">&lt;/metadata&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В элементе <code>datatype</code> можно также указать атрибут <code>sqlType</code>, содержащий SQL-тип вашей базы данных, подходящий для хранения значений нового типа. Этот SQL-тип будет использоваться CUBA Studio при генерации скриптов базы данных. Studio может автоматически определить SQL-тип для следующих типов Java:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>java.lang.Boolean</code></p> </li> 
           <li> <p><code>java.lang.Integer</code></p> </li> 
           <li> <p><code>java.lang.Long</code></p> </li> 
           <li> <p><code>java.math.BigDecimal</code></p> </li> 
           <li> <p><code>java.lang.Double</code></p> </li> 
           <li> <p><code>java.lang.String</code></p> </li> 
           <li> <p><code>java.util.Date</code></p> </li> 
           <li> <p><code>java.util.UUID</code></p> </li> 
           <li> <p><code>byte[]</code></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В нашем случае класс предназначен для работы с типом <code>Integer</code> (что декларируется аннотацией <code>@JavaClass</code> со значением <code>Integer.class</code>), поэтому атрибут <code>sqlType</code> можно не указывать.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Наконец, укажите новый тип данных для требуемых атрибутов (программно или с помощью интерфейса Studio):</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MetaProperty</span>(datatype = <span class="string"><span class="delimiter">"</span><span class="content">year</span><span class="delimiter">"</span></span>)
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">ISSUE_YEAR</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> <span class="predefined-type">Integer</span> issueYear;</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>После выполнения перечисленных действий атрибут <code>latitude</code> везде в приложении будет отображаться в нужном формате.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="datatype_ui_format"><a class="anchor" href="/manual.html#datatype_ui_format"></a>5.2.2.3.3. Пример форматирования даты в UI</h6> 
         <div class="paragraph"> 
          <p>Рассмотрим отображение атрибута <code>Order.date</code> в таблице браузера заказов.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>order-browse.xml</code></p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersTable</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;columns&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="comment">&lt;!--...--&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибут <code>date</code> в классе <code>Order</code> определен с типом "дата":</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DATE</span><span class="delimiter">"</span></span>, nullable = <span class="predefined-constant">false</span>)
<span class="annotation">@Temporal</span>(TemporalType.DATE)
<span class="directive">private</span> <span class="predefined-type">Date</span> date;</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Если текущий пользователь зарегистрирован c русской локалью, то из <a href="/manual.html#main_message_pack">главного пакета</a> локализованных сообщений извлекается строка:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="plain">dateFormat=dd.MM.yyyy</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В результате дата "2012-08-06" конвертируется в строку "06.08.2012" для отображения в ячейке таблицы.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="datatype_date_number_format"><a class="anchor" href="/manual.html#datatype_date_number_format"></a>5.2.2.3.4. Примеры форматирования дат и чисел в коде приложения</h6> 
         <div class="paragraph"> 
          <p>Если вам необходимо отформатировать или получить из строки значения <code>BigDecimal</code>, <code>Integer</code>, <code>Long</code>, <code>Double</code>, <code>Boolean</code> или <code>Date</code> учитывая локаль текущего пользователя, используйте бин <code>DatatypeFormatter</code>. Например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> DatatypeFormatter formatter;

<span class="type">void</span> sample() {
    <span class="predefined-type">String</span> dateStr = formatter.formatDate(dateField.getValue());
    <span class="comment">// ...</span>
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Ниже приведены примеры использования методов интерфейса <code>Datatype</code> напрямую.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Пример форматирования даты</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> UserSessionSource userSessionSource;
<span class="annotation">@Inject</span>
<span class="directive">protected</span> DatatypeRegistry datatypes;

<span class="type">void</span> sample() {
    <span class="predefined-type">Date</span> date;
    <span class="comment">// ...</span>
    <span class="predefined-type">String</span> dateStr = datatypes.getNN(<span class="predefined-type">Date</span>.class).format(date, userSessionSource.getLocale());
    <span class="comment">// ...</span>
}</code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Пример форматирования числового значения с 5 знаками после запятой в Web Client:</p> 
            <div class="listingblock"> 
             <div class="title">
              com/sample/sales/web/messages_ru.properties
             </div> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="plain">coordinateFormat = #,##0.00000</code></pre> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Messages messages;
<span class="annotation">@Inject</span>
<span class="directive">protected</span> UserSessionSource userSessionSource;
<span class="annotation">@Inject</span>
<span class="directive">protected</span> FormatStringsRegistry formatStringsRegistry;

<span class="type">void</span> sample() {
    <span class="predefined-type">String</span> coordinateFormat = messages.getMainMessage(<span class="string"><span class="delimiter">"</span><span class="content">coordinateFormat</span><span class="delimiter">"</span></span>);
    FormatStrings formatStrings = formatStringsRegistry.getFormatStrings(userSessionSource.getLocale());
    <span class="predefined-type">NumberFormat</span> format = <span class="keyword">new</span> <span class="predefined-type">DecimalFormat</span>(coordinateFormat, formatStrings.getFormatSymbols());
    <span class="predefined-type">String</span> formattedValue = format.format(value);
    <span class="comment">// ...</span>
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="meta_annotations"><a class="anchor" href="/manual.html#meta_annotations"></a>5.2.2.4. Мета-аннотации</h5> 
        <div class="paragraph"> 
         <p>Мета-аннотации сущностей - набор пар ключ/значение, содержащих дополнительную информацию о сущностях.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Обращение к мета-аннотациям производится с помощью метода <a href="/manual.html#metaClass">мета-класса</a> <code>getAnnotations()</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Источниками мета-аннотаций сущности являются:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="/manual.html#entity_annotations">Аннотации</a> <code>@OnDelete</code>, <code>@OnDeleteInverse</code>, <code>@Extends</code>. При этом в мета-аннотациях создаются служебные объекты связей между сущностями.</p> </li> 
          <li> <p>Расширяемые мета-аннотации, помеченные аннотацией <code>@MetaAnnotation</code>. Эти аннотации конвертируются в мета-аннотации с ключом, соответствующими полному имени класса Java аннотации и значением, являющимся map атрибутов аннотации. Например, аннотация <code>@TrackEditScreenHistory</code> будет иметь значение, являющееся map с единственным элементом: <code>value → true</code>. Платформа предоставляет следующие аннотации такого вида: <code>@NamePattern</code>, <code>@SystemLevel</code>, <code>@EnableRestore</code>, <code>@TrackEditScreenHistory</code>. В вашем приложении или <a href="/manual.html#app_components">компоненте</a> можно создать собственные аннотации и пометить их аннотацией <code>@MetaAnnotation</code>.</p> </li> 
          <li> <p>Опционально: в файлах <a href="/manual.html#metadata.xml">metadata.xml</a> также могут быть определены мета-аннотации сущностей. Если мета-аннотация в XML имеет то же имя, что и мета-аннотация, созданная по Java аннотации класса сущности, первая переопределит значение второй.</p> 
           <div class="paragraph"> 
            <p>Пример переопределения мета-аннотаций в <a href="/manual.html#metadata.xml">metadata.xml</a>:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;metadata</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/metadata.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- ... --&gt;</span>

    <span class="tag">&lt;annotations&gt;</span>
        <span class="tag">&lt;entity</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.customers.entity.Customer</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;annotation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.core.entity.annotation.TrackEditScreenHistory</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">value</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">datatype</span>=<span class="string"><span class="delimiter">"</span><span class="content">boolean</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/annotation&gt;</span>

            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;annotation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">length</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/property&gt;</span>

            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerGroup</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;annotation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.core.entity.annotation.Lookup</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.core.entity.annotation.LookupType</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">DROPDOWN</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">actions</span><span class="delimiter">"</span></span> <span class="attribute-name">datatype</span>=<span class="string"><span class="delimiter">"</span><span class="content">string</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;value&gt;</span>lookup<span class="tag">&lt;/value&gt;</span>
                        <span class="tag">&lt;value&gt;</span>open<span class="tag">&lt;/value&gt;</span>
                    <span class="tag">&lt;/attribute&gt;</span>
                <span class="tag">&lt;/annotation&gt;</span>
            <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/entity&gt;</span>

        <span class="tag">&lt;entity</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.customers.entity.CustomerGroup</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;annotation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.core.entity.annotation.EnableRestore</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">value</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">false</span><span class="delimiter">"</span></span> <span class="attribute-name">datatype</span>=<span class="string"><span class="delimiter">"</span><span class="content">boolean</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/annotation&gt;</span>
        <span class="tag">&lt;/entity&gt;</span>
    <span class="tag">&lt;/annotations&gt;</span>
<span class="tag">&lt;/metadata&gt;</span></code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="views"><a class="anchor" href="/manual.html#views"></a>5.2.3. Представления</h4> 
       <div class="paragraph"> 
        <p>При извлечении сущностей из базы данных обычно встает вопрос - как обеспечить загрузку связанных сущностей на нужную глубину?</p> 
       </div> 
       <div class="paragraph"> 
        <p>Например, для браузера Заказов нужно отобразить дату и сумму заказа совместно с названием Покупателя, т.е. загрузить связанный экземпляр Покупателя. А для экрана редактирования Заказа необходимо загрузить еще и коллекцию Пунктов заказа, причем каждый Пункт заказа должен содержать связанный экземпляр Товара для отображения его наименования.</p> 
       </div> 
       <div class="paragraph"> 
        <p><a href="/manual.html#lazy_loading">Загрузка по требованию</a> в большинстве случаев не может помочь, так как обработка данных, как правило, происходит не в транзакции, в которой загружаются сущности, а, например, на клиентском <a href="/manual.html#app_tiers">уровне</a> в пользовательском интерфейсе. В то же время задание <a href="/manual.html#eager_fetching">жадной загрузки</a> в <a href="/manual.html#entity_annotations">аннотациях сущностей</a> недопустимо, так как приводит к постоянному извлечению всего графа связанных сущностей, который может быть очень большим.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Другой похожей проблемой является ограничение набора <a href="/manual.html#local_attribute">локальных атрибутов</a> сущностей загружаемого графа: например, некоторая сущность имеет 50 атрибутов, в том числе BLOB, а в экране отображается только 10 атрибутов. Зачем загружать из БД, затем сериализовать и передавать клиенту 40 атрибутов, которые ему в данный момент не нужны?</p> 
       </div> 
       <div class="paragraph"> 
        <p>Механизм <em>представлений</em> (views) решает эти проблемы, обеспечивая извлечение из базы данных и передачу клиенту графов сущностей, ограниченных в глубину и по атрибутам. <em>Представление</em> является описателем графа объектов, который требуется в некотором экране UI или другом процессе обработки данных.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Обработка представлений производится следующим образом:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Все связи в модели данных объявляются с признаком <a href="/manual.html#lazy_loading">загрузки по требованию</a> (<code>fetch = FetchType.LAZY</code>, см. <a href="/manual.html#entity_annotations">Аннотации сущностей</a>).</p> </li> 
         <li> <p>В процессе загрузки данных через <a href="/manual.html#dataManager">DataManager</a> клиентский код помимо <a href="/manual.html#jpql">JPQL</a>-запроса указывает нужное представление.</p> </li> 
         <li> <p>На основе представления формируется так называемая <em>FetchGroup</em> - особенность лежащего в основе <a href="/manual.html#orm">слоя ORM</a> фреймворка <strong>EclipseLink</strong>. Fetch Group влияет на формирование SQL-запроса к базе данных: как на список возвращаемых полей, так и на соединения с другими таблицами, содержащими связанные сущности.</p> </li> 
        </ul> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/View.png" alt="View"> 
        </div> 
        <div class="title">
         Рисунок 10. Классы представления
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Представление определяется экземпляром класса <code>View</code>, в котором:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>entityClass</code> - класс сущности, для которого определено представление. Другими словами, "корень" дерева загружаемых сущностей.</p> </li> 
         <li> <p><code>name</code> - имя представления. Должно быть либо <code>null</code>, либо уникальным в пределах данной сущности.</p> </li> 
         <li> <p><code>properties</code> - коллекция экземпляров класса ViewProperty, соответствующих загружаемым атрибутам сущности.</p> </li> 
         <li> <p><code>includeSystemProperties</code> - признак включения системных атрибутов (входящих в состав <a href="/manual.html#base_entity_classes">базовых интерфейсов</a> персистентных сущностей <code>BaseEntity</code> и <code>Updatable</code>).</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Класс <code>ViewProperty</code> имеет следующие свойства:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>name</code> - имя атрибута сущности</p> </li> 
         <li> <p><code>view</code> - для ссылочных атрибутов задает представление, с которым необходимо загружать связанную сущность</p> </li> 
         <li> <p><code>fetch</code> - для ссылочных атрибутов задает способ загрузки связанной сущности из БД. Соответствует перечислению <code>FetchMode</code>:</p> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>AUTO</code> - платформа автоматически выбирает оптимальный режим в зависимости от типа отношения.</p> </li> 
              <li> <p><code>UNDEFINED</code> - загрузка будет выполнена по правилам JPA, что означает загрузку отдельными SELECT-запросами.</p> </li> 
              <li> <p><code>JOIN</code> - загрузка в том же SELECT-запросе путем объединения с таблицей, содержащей ссвязанную сущность.</p> </li> 
              <li> <p><code>BATCH</code> - загрузка экземпляров связанной сущности будет осуществляться порциями. Подробнее см. <a href="http://java-persistence-performance.blogspot.ru/2010/08/batch-fetching-optimizing-object-graph.html" target="_blank">здесь</a>.</p> </li> 
             </ul> 
            </div> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Если атрибут <code>fetch</code> не указан, будет использоваться режим <code>AUTO</code>. Если атрибут представляет собой <a href="/manual.html#entity_cache">кэшируемую</a> сущность, независимо от указанного значения будет использоваться <code>UNDEFINED</code>.</p> 
          </div> </li> 
        </ul> 
       </div> 
       <div class="admonitionblock tip"> 
        <table> 
         <tbody>
          <tr> 
           <td class="icon"> 
            <div class="title">
             Tip
            </div> </td> 
           <td class="content"> 
            <div class="paragraph"> 
             <p>Независимо от набора атрибутов, определенного в представлении, всегда загружаются следующие атрибуты:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>id</code> - идентификатор сущности</p> </li> 
              <li> <p><code>version</code> - для оптимистично блокируемых сущностей, реализующих <code>Versioned</code></p> </li> 
              <li> <p><code>deleteTs</code>, <code>deletedBy</code> - для сущностей, реализующих <a href="/manual.html#soft_deletion">SoftDelete</a></p> </li> 
             </ul> 
            </div> </td> 
          </tr> 
         </tbody>
        </table> 
       </div> 
       <div class="admonitionblock warning"> 
        <table> 
         <tbody>
          <tr> 
           <td class="icon"> 
            <div class="title">
             Warning
            </div> </td> 
           <td class="content"> 
            <div class="paragraph"> 
             <p>При попытке прочитать или установить значение незагруженного (не включенного в представление) атрибута генерируется исключение. Проверить, загружен ли некоторый атрибут можно методом <code>PersistenceHelper.isLoaded()</code>.</p> 
            </div> </td> 
          </tr> 
         </tbody>
        </table> 
       </div> 
       <div class="paragraph"> 
        <p>Незагруженные атрибуты имеют значение <code>null</code>. По умолчанию попытка установки значения незагруженного атрибута (вызов setter) для <a href="/manual.html#entity_states">Detached</a> сущности вызывает исключение.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Следует иметь в виду, что незагруженные ссылочные атрибуты Detached сущности, соответствующие внешним ключам (т.е. many-to-one, one-to-one), можно установить в новое ненулевое значение в любом случае, и изменения будут сохранены при последующем <code>merge()</code>.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="views_creation"><a class="anchor" href="/manual.html#views_creation"></a>5.2.3.1. Создание представлений</h5> 
        <div class="paragraph"> 
         <p>Представление может быть создано двумя путями:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><strong>программно</strong> - созданием экземпляра <code>View</code>, например:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">View</span> view = <span class="keyword">new</span> <span class="predefined-type">View</span>(Order.class)
        .addProperty(<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>)
        .addProperty(<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span>)
        .addProperty(<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">View</span>(Customer.class)
            .addProperty(<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>)
        );</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Как правило, таким способом создаются представления, используемые только в каком-то одном месте бизнес-логики.</p> 
           </div> </li> 
          <li> <p><strong>декларативно</strong> - путем создания описателя на XML и его развертывания в репозитории представлений <code>ViewRepository</code>. При развертывании на основе XML-описателя создаются и кэшируются экземпляры <code>View</code>. В дальнейшем в любом месте кода приложения требуемое представление можно получить вызовом репозитория с указанием класса сущности и имени представления.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Рассмотрим подробнее декларативный способ создания и работы с представлениями.</p> 
        </div> 
        <div class="paragraph"> 
         <p><code>ViewRepository</code> является бином <strong>Spring</strong>, доступным для всех блоков приложения. Ссылка на <code>ViewRepository</code> может быть также получена через интерфейс инфраструктуры <a href="/manual.html#metadata">Metadata</a>. Для получения экземпляра <code>View</code>, содержащегося в репозитории, используются методы <code>getView()</code>. Для развертывания XML-описателей представлений в репозитории используются методы <code>deployViews()</code> базовой реализации <code>AbstractViewRepository</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В репозитории для каждой сущности по умолчанию доступны три представления с именами <code>_local</code>, <code>_minimal</code> и <code>_base</code>:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>_local</code> включает в себя все <a href="/manual.html#local_attribute">локальные</a> атрибуты сущности</p> </li> 
          <li> <p><code>_minimal</code> включает в себя атрибуты, входящие в имя экземпляра сущности, и задаваемые аннотацией <a href="/manual.html#namePattern_annotation">@NamePattern</a>. Если аннотация <code>@NamePattern</code> для сущности не указана, данное представление не включает никаких атрибутов.</p> </li> 
          <li> <p><code>_base</code> включает в себя все локальные несистемные атрибуты и атрибуты, заданные в аннотации <code>@NamePattern</code> (т.е. фактически <code>_minimal</code> + <code>_local</code>).</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Подробная структура XML-описателей изложена <a href="/manual.html#views.xml">здесь</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Пример описателя представления для сущности Заказ, которое должно обеспечить загрузку всех локальных атрибутов, ассоциированного Покупателя и коллекции Пунктов заказа:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;view</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span>
      <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderWithCustomer</span><span class="delimiter">"</span></span>
      <span class="attribute-name">extends</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_minimal</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">items</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">itemInOrder</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/view&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Рекомендуемый способ группировки и развертывания описателей представлений:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>В <a href="/manual.html#app_modules">модуле</a> <strong>global</strong> в корне <code>src</code> создать файл <code>views.xml</code> и поместить в него все описатели представлений, которые должны быть доступны глобально, т.е. на всех <a href="/manual.html#app_tiers">уровнях приложения</a>.</p> </li> 
          <li> <p>Зарегистрировать данный файл в свойстве <a href="/manual.html#cuba.viewsConfig">cuba.viewsConfig</a> блока Middleware и используемых клиентских блоков, т.е. в файле <code>app.properties</code> модуля <strong>core</strong>, в файле <code>web-app.properties</code> модуля <strong>web</strong> и так далее. Это обеспечит автоматическое развертывание представлений на старте приложения в репозитории Middleware и клиентских блоков (см. метод <code>AbstractViewRepository.init()</code>).</p> </li> 
          <li> <p>Если существуют представления, которые необходимы только какому-то одному клиентскому блоку приложения, то можно определить их в аналогичном файле данного блока, например, <code>web-views.xml</code>, и добавить этот файл в свойство <code>cuba.viewsConfig</code> этого блока, т.е. в данном случае в файл <code>web-app.properties</code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Если на момент развертывания некоторого представления в репозитории уже есть представление для этого же класса сущности и с таким же именем, то новое будет проигнорировано. Для того чтобы представление заменило имеющееся в репозитории и гарантированно было развернуто, в XML-описателе должен быть явно указан атрибут <code>overwrite = "true"</code>.</p> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Рекомендуется давать представлениям "описательные" имена. Например, не "browse", а "customerBrowse". Это упрощает поиск XML-описателей представлений по имени в процессе разработки приложения.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="managed_beans"><a class="anchor" href="/manual.html#managed_beans"></a>5.2.4. Управляемые бины</h4> 
       <div class="paragraph"> 
        <p><em>Управляемые бины (Managed Beans)</em> − это программные компоненты, предназначенные для реализации бизнес-логики приложения. Термин "управляемые" в данном случае означает, что созданием экземпляров и установкой связей между такими компонентами управляет <a href="/manual.html#container">контейнер</a> который является основной частью фреймворка <strong>Spring</strong>.</p> 
       </div> 
       <div class="admonitionblock tip"> 
        <table> 
         <tbody>
          <tr> 
           <td class="icon"> 
            <div class="title">
             Tip
            </div> </td> 
           <td class="content"> 
            <div class="paragraph"> 
             <p>Managed Bean представляет собой <em>singleton</em>, то есть в некотором блоке приложения существует только один экземпляр данного класса. Поэтому, если бин содержит изменяемые данные в полях (другими словами, имеет состояние), то обращение к таким данным необходимо синхронизировать.</p> 
            </div> </td> 
          </tr> 
         </tbody>
        </table> 
       </div> 
       <div class="sect4"> 
        <h5 id="managed_beans_creation"><a class="anchor" href="/manual.html#managed_beans_creation"></a>5.2.4.1. Создание бина</h5> 
        <div class="paragraph"> 
         <p>Для создания управляемого бина достаточно добавить классу Java аннотацию <code>@org.springframework.stereotype.Component</code>. Например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.sample.sales.core</span>;

<span class="keyword">import</span> <span class="include">com.sample.sales.entity.Order</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Component</span>;

<span class="annotation">@Component</span>(OrderWorker.NAME)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderWorker</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">"</span><span class="content">sales_OrderWorker</span><span class="delimiter">"</span></span>;

    <span class="directive">public</span> <span class="type">void</span> calculateTotals(Order order) {
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Рекомендуется присваивать бину уникальное имя вида <code>{имя_проекта}_{имя_класса}</code>, и определять его в константе <code>NAME</code>.</p> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Аннотация <code>@javax.annotation.ManagedBean</code> также может ипользоваться для определения бина, однако ее наличие может вызывать проблемы при развертывании в некоторые сервера приложений. Поэтому мы рекомендуем использовать только аннотацию <code>@Component</code> из Spring Framework.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="paragraph"> 
         <p>Класс управляемого бина должен находиться внутри дерева пакетов с корнем, заданным в элементе <code>context:component-scan</code> файла <a href="/manual.html#spring.xml">spring.xml</a>. В нашем случае файл <code>spring.xml</code> содержит элемент:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>что означает, что поиск аннотированных бинов для данного блока приложения будет происходить начиная с пакета <code>com.sample.sales</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Управляемые бины можно создавать на любом <a href="/manual.html#app_tiers">уровне</a>, так как контейнер Spring Framework используется во всех стандартных блоках приложения.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="managed_beans_usage"><a class="anchor" href="/manual.html#managed_beans_usage"></a>5.2.4.2. Использование бина</h5> 
        <div class="paragraph"> 
         <p>Ссылку на бин можно получить с помощью инжекции или класса <code>AppBeans</code>. В качестве примера использования бина рассмотрим реализацию <a href="/manual.html#services">сервиса</a> <code>OrderService</code>, делегирующего выполнение бину <code>OrderWorker</code>:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.sample.sales.core</span>;

<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.Persistence</span>;
<span class="keyword">import</span> <span class="include">com.sample.sales.entity.Order</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Service</span>;
<span class="keyword">import</span> <span class="include">org.springframework.transaction.annotation.Transactional</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;

<span class="annotation">@Service</span>(OrderService.NAME)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderServiceBean</span> <span class="directive">implements</span> OrderService {

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> Persistence persistence;

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> OrderWorker orderWorker;

    <span class="annotation">@Transactional</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> calculateTotals(Order order) {
        Order entity = persistence.getEntityManager().merge(order);
        orderWorker.calculateTotals(entity);
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>В данном примере сервис стартует <a href="/manual.html#transactions">транзакцию</a>, вносит полученный с клиентского уровня экземпляр сущности в <a href="/manual.html#entityManager">персистентный контекст</a>, и передает управление бину <code>OrderWorker</code>, который и содержит основную бизнес-логику.</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="jmx_beans"><a class="anchor" href="/manual.html#jmx_beans"></a>5.2.5. JMX-бины</h4> 
       <div class="paragraph"> 
        <p>Иногда требуется предоставить администратору системы возможность просматривать и изменять состояние некоторого <a href="/manual.html#managed_beans">управляемого бина</a> во время выполнения. В этом случае рекомендуется создать JMX-бин - программный компонент, имеющий <a href="/manual.html#jmx">JMX</a>-интерфейс. Такой бин, как правило, делегирует вызовы управляемому бину, содержащему кэш, конфигурационные данные или статистику, к которым нужно обеспечить доступ через JMX.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/JMXBeans.png" alt="JMXBeans"> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Как видно из диаграммы, JMX-бин состоит из интерфейса и класса реализации. Класс должен представлять собой <a href="/manual.html#managed_beans">управляемый бин</a>, то есть иметь аннотацию <code>@Component</code> и уникальное имя. Интерфейс JMX-бина специальным образом регистрируется в <a href="/manual.html#spring.xml">spring.xml</a> для создания в текущей JVM собственно JMX-интерфейса.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Вызовы всех методов интерфейса JMX-бина перехватываются с помощью <strong>Spring AOP</strong> классом−<a href="/manual.html#interceptor">интерцептором</a> <code>MBeanInterceptor</code>, который обеспечивает установку правильного <code>ClassLoader</code> в контексте потока выполнения, и журналирование необработанных исключений.</p> 
       </div> 
       <div class="admonitionblock warning"> 
        <table> 
         <tbody>
          <tr> 
           <td class="icon"> 
            <div class="title">
             Warning
            </div> </td> 
           <td class="content"> 
            <div class="paragraph"> 
             <p>Интерфейс JMX-бина обязательно должен иметь имя вида <code>{имя_класса}MBean</code>.</p> 
            </div> </td> 
          </tr> 
         </tbody>
        </table> 
       </div> 
       <div class="paragraph"> 
        <p>С JMX-интерфейсом можно работать из внешних инструментов, таких как <code>jconsole</code> или <code>jvisualvm</code>. Кроме того, в состав блока Web Client платформы входит <a href="/manual.html#jmx_console">JMX-консоль</a>, предоставляющая базовые средства просмотра состояния и вызова методов JMX-бинов.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="jmx_beans_creation"><a class="anchor" href="/manual.html#jmx_beans_creation"></a>5.2.5.1. Создание JMX-бина</h5> 
        <div class="paragraph"> 
         <p>Рассмотрим процесс создания JMX-бина на примере.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Интерфейс JMX-бина:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.sample.sales.core</span>;

<span class="keyword">import</span> <span class="include">org.springframework.jmx.export.annotation</span>.*;

<span class="annotation">@ManagedResource</span>(description = <span class="string"><span class="delimiter">"</span><span class="content">Performs operations on Orders</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">OrdersMBean</span> {

    <span class="annotation">@ManagedOperation</span>(description = <span class="string"><span class="delimiter">"</span><span class="content">Recalculates an order amount</span><span class="delimiter">"</span></span>)
    <span class="annotation">@ManagedOperationParameters</span>({<span class="annotation">@ManagedOperationParameter</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">orderId</span><span class="delimiter">"</span></span>, description = <span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span>)})
    <span class="predefined-type">String</span> calculateTotals(<span class="predefined-type">String</span> orderId);
}</code></pre> 
            </div> 
           </div> 
           <div class="ulist"> 
            <ul> 
             <li> <p>Интерфейс и его методы могут содержать аннотации для задания описания JMX-бина и его операций. Это описание будет отображаться во всех инструментах, работающих с данным JMX-интерфейсом, тем самым помогая администратору системы.</p> </li> 
             <li> <p>Аннотацию <code>@JmxRunAsync</code> можно использовать для указания длительных операций. Если такая операция запускается через встроенную <a href="/manual.html#jmx_console">консоль JMX</a>, платформа отображает диалог с неопределенным индикатором прогресса и кнопкой <strong>Cancel</strong>. Пользователь может прервать операцию и продолжить работу с приложением. Аннотация может также содержать параметр <code>timeout</code>, который устанавливает максимальное время выполнения в миллисекундах, например:</p> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@JmxRunAsync</span>(timeout = <span class="integer">30000</span>)
<span class="predefined-type">String</span> calculateTotals();</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Если таймаут превышен, диалог закрывается с сообщением об ошибке.</p> 
              </div> 
              <div class="admonitionblock warning"> 
               <table> 
                <tbody>
                 <tr> 
                  <td class="icon"> 
                   <div class="title">
                    Warning
                   </div> </td> 
                  <td class="content"> 
                   <div class="paragraph"> 
                    <p>Пожалуйста имейте в виду, что если операция прервана пользователем или по таймауту, она все равно продолжает работать в фоне, то есть данные действия не прерывают самого выполнения, а только возвращают управление пользователю.</p> 
                   </div> </td> 
                 </tr> 
                </tbody>
               </table> 
              </div> </li> 
             <li> <p>Так как инструменты JMX поддерживают ограниченный набор типов данных, параметры и результат метода желательно задавать типа <code>String</code>, и при необходимости выполнять конвертацию внутри метода. Помимо <code>String</code>, поддерживаются следующие типы параметров: <code>boolean</code>, <code>double</code>, <code>float</code>, <code>int</code>, <code>long</code>, <code>Boolean</code>, <code>Integer</code>.</p> </li> 
            </ul> 
           </div> </li> 
          <li> <p>Класс JMX-бина:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.sample.sales.core</span>;

<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core</span>.*;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.app</span>.*;
<span class="keyword">import</span> <span class="include">com.sample.sales.entity.Order</span>;
<span class="keyword">import</span> <span class="include">org.apache.commons.lang.exception.ExceptionUtils</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Component</span>;
<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.UUID</span>;

<span class="annotation">@Component</span>(<span class="string"><span class="delimiter">"</span><span class="content">sales_OrdersMBean</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Orders</span> <span class="directive">implements</span> OrdersMBean {

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> OrderWorker orderWorker;

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> Persistence persistence;

    <span class="annotation">@Authenticated</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> calculateTotals(<span class="predefined-type">String</span> orderId) {
        <span class="keyword">try</span> {
            <span class="keyword">try</span> (Transaction tx = persistence.createTransaction()) {
                Order entity = persistence.getEntityManager().find(Order.class, <span class="predefined-type">UUID</span>.fromString(orderId));
                orderWorker.calculateTotals(entity);
                tx.commit();
            };
            <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">Done</span><span class="delimiter">"</span></span>;
        } <span class="keyword">catch</span> (<span class="predefined-type">Throwable</span> e) {
            <span class="keyword">return</span> ExceptionUtils.getStackTrace(e);
        }
    }
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Аннотация <code>@Component</code> определяет, что данный класс является управляемым бином с именем <code>sales_OrdersMBean</code>. Имя указано напрямую в аннотации, а не в константе, так как доступ к JMX-бину из кода Java не требуется.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Рассмотрим реализацию метода <code>calculateTotals()</code>.</p> 
           </div> 
           <div class="ulist"> 
            <ul> 
             <li> <p>Метод имеет аннотацию <code>@Authenticated</code>, т.е. при входе в метод и при отсутствии в потоке выполнения <a href="/manual.html#userSession">пользовательской сессии</a> выполняется <a href="/manual.html#system_authentication">системная аутентификация</a>.</p> </li> 
             <li> <p>Тело метода обернуто в блок try/catch, так что метод в случае успешного выполнения возвращает строку "Done", а в случае ошибки - stacktrace исключения в виде строки.</p> 
              <div class="paragraph"> 
               <p>В данном случае все исключения обрабатываются, а значит, не попадают в <code>MBeanInterceptor</code> и не выводятся в журнал автоматически. Поэтому при необходимости логировать исключения здесь нужно добавить вызов логгера в секции <code>catch</code>.</p> 
              </div> </li> 
             <li> <p>Логика метода заключается в том, что он стартует транзакцию, загружает экземпляр сущности <code>Order</code> по идентификатору и передает управление бину <code>OrderWorker</code> для обработки.</p> </li> 
            </ul> 
           </div> </li> 
          <li> <p>Регистрация JMX-бина в <code>spring.xml</code>:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_MBeanExporter</span><span class="delimiter">"</span></span> <span class="attribute-name">lazy-init</span>=<span class="string"><span class="delimiter">"</span><span class="content">false</span><span class="delimiter">"</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.core.sys.jmx.MBeanExporter</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">beans</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">"</span><span class="content">${cuba.webContextName}.sales:type=Orders</span><span class="delimiter">"</span></span>
                   <span class="attribute-name">value-ref</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_OrdersMBean</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Все JMX-бины проекта объявляются в одном экземпляре <code>MBeanExporter</code> в элементах <code>map/entry</code> свойства <code>beans</code>. Ключом элемента здесь является JMX ObjectName, значением - имя бина, заданное в аннотации <code>@Component</code>. ObjectName начинается с имени веб-приложения, так как в одном экземпляре сервера приложения (т.е. в одной JVM) может быть развернуто несколько веб-приложений, экспортирующих одинаковые JMX-интерфейсы.</p> 
           </div> </li> 
         </ul> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="jmx_beans_platform"><a class="anchor" href="/manual.html#jmx_beans_platform"></a>5.2.5.2. JMX-бины платформы</h5> 
        <div class="paragraph"> 
         <p>В данном разделе описаны некоторые имеющиеся в платформе JMX-бины.</p> 
        </div> 
        <div class="sect5"> 
         <h6 id="cachingFacadeMBean"><a class="anchor" href="/manual.html#cachingFacadeMBean"></a>5.2.5.2.1. CachingFacadeMBean</h6> 
         <div class="paragraph"> 
          <p><code>CachingFacadeMBean</code> предоставляет методы очистки различных кэшей в блоках Middleware и Web Client.</p> 
         </div> 
         <div class="paragraph"> 
          <p>JMX ObjectName: <code>app-core.cuba:type=CachingFacade</code> и <code>app.cuba:type=CachingFacade</code></p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="configStorageMBean"><a class="anchor" href="/manual.html#configStorageMBean"></a>5.2.5.2.2. ConfigStorageMBean</h6> 
         <div class="paragraph"> 
          <p><code>ConfigStorageMBean</code> позволяет просматривать и задавать значения <a href="/manual.html#app_properties">свойствам приложения</a> в блоках Middleware, Web Client и Web Portal.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Данный интерфейс имеет отдельные наборы операций для работы с параметрами конфигурации и развертывания (<code>*AppProperties</code>) и с параметрами времени выполнения (<code>*DbProperties</code>). Эти операции отображают только свойства, явно заданные в хранилище. То есть если имеется конфигурационный интерфейс, определяющий некоторое свойство и его значение по умолчанию, но в базе данных или в файлах никакого значения не указано, данные операции не отобразят свойство и его текущее значение.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Заметьте, что изменения в свойствах, хранящихся в файлах, не персистентны и актуальны только до перезапуска блока приложения.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В отличие от операций, описанных выше, операция <code>getConfigValue()</code> всегда возвращает в точности то значение, какое вернул бы соответствующий метод конфигурационного интерфейса, вызванный из кода приложения.</p> 
         </div> 
         <div class="paragraph"> 
          <p>JMX ObjectName:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>app-core.cuba:type=ConfigStorage</code></p> </li> 
           <li> <p><code>app.cuba:type=ConfigStorage</code></p> </li> 
           <li> <p><code>app-portal.cuba:type=ConfigStorage</code></p> </li> 
          </ul> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="emailerMBean"><a class="anchor" href="/manual.html#emailerMBean"></a>5.2.5.2.3. EmailerMBean</h6> 
         <div class="paragraph"> 
          <p><code>EmailerMBean</code> позволяет просмотреть текущие значения параметров <a href="/manual.html#email_sending">отсылки email</a>, а также отправить тестовое сообщение.</p> 
         </div> 
         <div class="paragraph"> 
          <p>JMX ObjectName: <code>app-core.cuba:type=Emailer</code></p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="persistenceManagerMBean"><a class="anchor" href="/manual.html#persistenceManagerMBean"></a>5.2.5.2.4. PersistenceManagerMBean</h6> 
         <div class="paragraph"> 
          <p><code>PersistenceManagerMBean</code> предоставляет следующие возможности:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>управление механизмом <a href="/manual.html#entity_statistics">статистики сущностей</a></p> </li> 
           <li> <p>отображение новых скриптов обновления БД методом <code>findUpdateDatabaseScripts()</code> и запуск обновления методом <code>updateDatabase()</code></p> </li> 
           <li> <p>запуск произвольных JPQL запросов в контексте Middleware методами <code>jpqlLoadList()</code>, <code>jpqlExecuteUpdate()</code></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>JMX ObjectName: <code>app-core.cuba:type=PersistenceManager</code></p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="scriptingManagerMBean"><a class="anchor" href="/manual.html#scriptingManagerMBean"></a>5.2.5.2.5. ScriptingManagerMBean</h6> 
         <div class="paragraph"> 
          <p><code>ScriptingManagerMBean</code> является JMX-фасадом для интерфейса инфраструктуры <a href="/manual.html#scripting">Scripting</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>JMX ObjectName: <code>app-core.cuba:type=ScriptingManager</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>JMX-атрибуты:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>RootPath</code> - абсолютный путь к <a href="/manual.html#conf_dir">конфигурационному каталогу</a> <a href="/manual.html#app_tiers">блока приложения</a>, в котором запущен данный бин.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>JMX-операции:</p> 
         </div> 
         <div id="scripting.runGroovyScript" class="ulist"> 
          <ul> 
           <li> <p><code>runGroovyScript()</code> - выполнить скрипт Groovy в контексте Middleware и вернуть результат. В скрипт передаются следующие переменные:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>persistence</code> типа <a href="/manual.html#persistence">Persistence</a></p> </li> 
              <li> <p><code>metadata</code> типа <a href="/manual.html#metadata">Metadata</a></p> </li> 
              <li> <p><code>configuration</code> типа <a href="/manual.html#configuration">Configuration</a></p> </li> 
              <li> <p><code>dataManager</code> типа <a href="/manual.html#dataManager">DataManager</a></p> 
               <div class="paragraph"> 
                <p>Для отображения в JMX-интерфейсе результат должен быть типа <code>String</code>. В остальном аналогичен методу <code>Scripting.<a href="/manual.html#scripting.runGroovyScript">runGroovyScript()</a></code>.</p> 
               </div> 
               <div class="paragraph"> 
                <p>Пример скрипта, создающего набор тестовых пользователей:</p> 
               </div> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.*</span>
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.global.*</span>
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.security.entity.*</span>

PasswordEncryption passwordEncryption = AppBeans.get(PasswordEncryption.class)

Transaction tx = persistence.createTransaction()
<span class="keyword">try</span> {
    EntityManager em = persistence.getEntityManager()
    <span class="predefined-type">Group</span> group = em.getReference(<span class="predefined-type">Group</span>.class, <span class="predefined-type">UUID</span>.fromString(<span class="string"><span class="delimiter">'</span><span class="content">0fa2b1a5-1d68-4d69-9fbd-dff348347f93</span><span class="delimiter">'</span></span>))
    <span class="keyword">for</span> (i <span class="keyword">in</span> (<span class="integer">1</span>..<span class="integer">250</span>)) {
        User user = <span class="keyword">new</span> User()
        user.setGroup(group)
        user.setLogin(<span class="string"><span class="delimiter">"</span><span class="content">user_</span><span class="inline"><span class="inline-delimiter">${</span>i.toString().padLeft(<span class="integer">3</span>, <span class="string"><span class="delimiter">'</span><span class="content">0</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">"</span></span>)
        user.setName(user.login)
        user.setPassword(passwordEncryption.getPasswordHash(user.id, <span class="string"><span class="delimiter">'</span><span class="content">1</span><span class="delimiter">'</span></span>));
        em.persist(user)
    }
    tx.commit()
} <span class="keyword">finally</span> {
    tx.end()
}</code></pre> 
                </div> 
               </div> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="serverInfoMBean"><a class="anchor" href="/manual.html#serverInfoMBean"></a>5.2.5.2.6. ServerInfoMBean</h6> 
         <div class="paragraph"> 
          <p><code>ServerInfoMBean</code> предоставляет общую информацию о данном блоке Middleware: номер и дату сборки, <a href="/manual.html#serverId">идентификатор сервера</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>JMX ObjectName: <code>app-core.cuba:type=ServerInfo</code></p> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="infrastructure_interfaces"><a class="anchor" href="/manual.html#infrastructure_interfaces"></a>5.2.6. Интерфейсы инфраструктуры</h4> 
       <div class="paragraph"> 
        <p>Интерфейсы инфраструктуры обеспечивают доступ к часто используемой функциональности платформы. Большинство из этих интерфейсов расположены в <a href="/manual.html#app_modules">модуле</a> <strong>global</strong> и могут быть использованы как на среднем слое, так и в <a href="/manual.html#app_tiers">блоках</a> клиентского уровня, но некоторые (например, <a href="/manual.html#persistence">Persistence</a>) доступны только коду среднего слоя.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Интерфейсы инфраструктуры реализуются бинами Spring Framework, поэтому они могут быть инжектированы в любые другие управляемые компоненты (<a href="/manual.html#managed_beans">Managed Beans</a>, <a href="/manual.html#services">сервисы среднего слоя</a>, <a href="/manual.html#screen_controller">контроллеры</a> экранов универсального пользовательского интерфейса).</p> 
       </div> 
       <div class="paragraph"> 
        <p>Кроме того, как и любые другие бины, интерфейсы инфраструктуры могут быть получены с помощью статических методов класса <code>AppBeans</code> и использоваться в неуправляемых компонентах (POJO, вспомогательных классах и пр.).</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="configuration"><a class="anchor" href="/manual.html#configuration"></a>5.2.6.1. Configuration</h5> 
        <div class="paragraph"> 
         <p>Позволяет получать ссылки на <a href="/manual.html#config_interfaces">конфигурационные интерфейсы</a> там, где невозможна их инжекция.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Пример:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// field injection</span>

<span class="annotation">@Inject</span>
<span class="directive">protected</span> <span class="predefined-type">Configuration</span> configuration;
...
String tempDir = configuration.getConfig(GlobalConfig.class).getTempDir();</code></pre> 
         </div> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// setter injection</span>

<span class="directive">protected</span> GlobalConfig globalConfig;

<span class="annotation">@Inject</span>
<span class="directive">public</span> <span class="type">void</span> setConfiguration(<span class="predefined-type">Configuration</span> configuration) {
    <span class="local-variable">this</span>.globalConfig = configuration.getConfig(GlobalConfig.class);
}</code></pre> 
         </div> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// location</span>

<span class="predefined-type">String</span> tempDir = AppBeans.get(<span class="predefined-type">Configuration</span>.class).getConfig(GlobalConfig.class).getTempDir();</code></pre> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="messages"><a class="anchor" href="/manual.html#messages"></a>5.2.6.2. Messages</h5> 
        <div class="paragraph"> 
         <p>Интерфейс <code>Messages</code> обеспечивает получение <a href="/manual.html#localization">локализованных строк сообщений</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Рассмотрим методы интерфейса подробнее.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>getMessage()</code> - возвращает локализованное сообщение по ключу, имени пакета сообщений и требуемой локали. Существует несколько модификаций данного метода в зависимости от набора параметров. Если локаль не указана в параметре метода, используется локаль текущего пользователя.</p> 
           <div class="paragraph"> 
            <p>Примеры:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Messages messages;
...
String message1 = messages.getMessage(getClass(), <span class="string"><span class="delimiter">"</span><span class="content">someMessage</span><span class="delimiter">"</span></span>);
<span class="predefined-type">String</span> message2 = messages.getMessage(<span class="string"><span class="delimiter">"</span><span class="content">com.abc.sales.web.customer</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">someMessage</span><span class="delimiter">"</span></span>);
<span class="predefined-type">String</span> message3 = messages.getMessage(RoleType.STANDARD);</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>formatMessage()</code> - находит локализованное сообщение по ключу, имени пакета сообщений и требуемой локали, и использует его для форматирования переданных параметров. Формат задается по правилам метода <code>String.format()</code>. Существует несколько модификаций данного метода в зависимости от набора параметров. Если локаль не указана в параметре метода, используется локаль текущего пользователя.</p> 
           <div class="paragraph"> 
            <p>Пример:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> formattedValue = messages.formatMessage(getClass(), <span class="string"><span class="delimiter">"</span><span class="content">someFormat</span><span class="delimiter">"</span></span>, someValue);</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>getMainMessage()</code> - возвращает локализованное сообщение из <a href="/manual.html#main_message_pack">главного пакета</a> данного <a href="/manual.html#app_tiers">блока</a> приложения.</p> 
           <div class="paragraph"> 
            <p>Пример:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> Messages messages = AppBeans.get(Messages.class);
...
messages.getMainMessage(<span class="string"><span class="delimiter">"</span><span class="content">actions.Ok</span><span class="delimiter">"</span></span>);</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>getMainMessagePack()</code> - возвращает имя <a href="/manual.html#main_message_pack">главного пакета</a> сообщений данного блока приложения.</p> 
           <div class="paragraph"> 
            <p>Пример:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> formattedValue = messages.formatMessage(messages.getMainMessagePack(), <span class="string"><span class="delimiter">"</span><span class="content">someFormat</span><span class="delimiter">"</span></span>, someValue);</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>getTools()</code> - возвращает экземпляр интерфейса <code>MessageTools</code> (см. ниже).</p> </li> 
         </ul> 
        </div> 
        <div class="sect5"> 
         <h6 id="messageTools"><a class="anchor" href="/manual.html#messageTools"></a>5.2.6.2.1. MessageTools</h6> 
         <div class="paragraph"> 
          <p><a href="/manual.html#managed_beans">ManagedBean</a>, содержащий вспомогательные методы работы с <a href="/manual.html#localization">локализованными сообщениями</a>. Интерфейс <code>MessageTools</code> можно получить либо методом <code>Messages.getTools()</code>, либо как любой другой бин - инжекцией или через класс <code>AppBeans</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Методы <code>MessageTools</code>:</p> 
         </div> 
         <div id="messageTools.loadString" class="ulist"> 
          <ul> 
           <li> <p><code>loadString()</code> - возвращает локализованное сообщение, заданное ссылкой вида <code>msg://{messagePack}/{key}</code>.</p> 
            <div class="paragraph"> 
             <p>Составные части ссылки:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>msg://</code> - обязательный префикс.</p> </li> 
              <li> <p><code>{messagePack}</code> - необязательное имя пакета сообщения. Если не указано, предполагается, что имя пакета передается в <code>loadString()</code> отдельным параметром.</p> </li> 
              <li> <p><code>{key}</code> - ключ сообщения в пакете.</p> 
               <div class="paragraph"> 
                <p>Примеры ссылок на сообщения:</p> 
               </div> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="plain">msg://someMessage
msg://com.abc.sales.web.customer/someMessage</code></pre> 
                </div> 
               </div> </li> 
             </ul> 
            </div> </li> 
           <li> <p><code>getEntityCaption()</code> - возвращает локализованное название сущности.</p> </li> 
           <li> <p><code>getPropertyCaption()</code> - возвращает локализованное название атрибута сущности.</p> </li> 
           <li> <p><code>hasPropertyCaption()</code> - определяет, задано ли для атрибута сущности локализованное название.</p> </li> 
           <li> <p><code>getLocValue()</code> - возвращает локализованное значение атрибута сущности, основываясь на определении аннотации <a href="/manual.html#localizedValue_annotation">@LocalizedValue</a>.</p> </li> 
           <li> <p><code>getMessageRef()</code> - формирует для <a href="/manual.html#metaProperty">мета-свойства</a> ссылку на сообщение, по которой можно получить локализованное название атрибута сущности.</p> </li> 
           <li> <p><code>getDefaultLocale()</code> - возвращает локаль приложения по умолчанию, то есть указанную первой в списке свойства <a href="/manual.html#cuba.availableLocales">cuba.availableLocales</a>.</p> </li> 
           <li> <p><code>useLocaleLanguageOnly()</code> - возвращает <code>true</code>, если в списке поддерживаемых приложением локалей, заданном свойством <a href="/manual.html#cuba.availableLocales">cuba.availableLocales</a>, для всех локалей определен только язык, а <code>country</code> и <code>variant</code> не указаны. Этим методом пользуются механизмы платформы, которым необходимо найти наиболее подходящую локаль из списка поддерживаемых на основе локали, полученной из внешних источников, таких как операционная система или HTTP запрос.</p> </li> 
           <li> <p><code>trimLocale()</code> - удаляет из переданной локали все кроме языка, если метод <code>useLocaleLanguageOnly()</code> возвращает <code>true</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Для расширения набора вспомогательных методов в конкретном приложении бин <code>MessageTools</code> можно <a href="/manual.html#bean_extension">переопределить</a>. Примеры работы с расширенным интерфейсом:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">MyMessageTools tools = messages.getTools();
tools.foo();</code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">((MyMessageTools) messages.getTools()).foo();</code></pre> 
          </div> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="metadata"><a class="anchor" href="/manual.html#metadata"></a>5.2.6.3. Metadata</h5> 
        <div class="paragraph"> 
         <p>Интерфейс <code>Metadata</code> обеспечивает доступ к сессии <a href="/manual.html#metadata_framework">метаданных</a> и репозиторию <a href="/manual.html#views">представлений</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Методы интерфейса:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>getSession()</code> - возвращает экземпляр сессии <a href="/manual.html#metadata_framework">метаданных</a></p> </li> 
          <li> <p><code>getViewRepository()</code> - возвращает экземпляр репозитория <a href="/manual.html#views">представлений</a></p> </li> 
          <li> <p><code>getExtendedEntities()</code> - возвращает экземпляр <code>ExtendedEntities</code>, предназначенный для работы с расширенными сущностями. Подробнее см. <a href="/manual.html#entity_extension">Расширение сущности</a></p> </li> 
          <li> <p><code>create()</code> - создать экземпляр сущности, учитывая возможность расширения. Подробнее см. <a href="/manual.html#entity_extension">Расширение сущности</a></p> </li> 
          <li> <p><code>getTools()</code> - возвращает экземпляр интерфейса <code>MetadataTools</code> (см. ниже).</p> </li> 
         </ul> 
        </div> 
        <div class="sect5"> 
         <h6 id="metadataTools"><a class="anchor" href="/manual.html#metadataTools"></a>5.2.6.3.1. MetadataTools</h6> 
         <div class="paragraph"> 
          <p><a href="/manual.html#managed_beans">ManagedBean</a>, содержащий вспомогательные методы работы с метаданными. Интерфейс <code>MetadataTools</code> можно получить либо методом <code>Metadata.getTools()</code>, либо как любой другой бин - инжекцией или через класс <code>AppBeans</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Методы <code>MetadataTools</code>:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>getAllPersistentMetaClasses()</code> - возвращает коллекцию <a href="/manual.html#metaClass">мета-классов</a> персистентных сущностей</p> </li> 
           <li> <p><code>getAllEmbeddableMetaClasses()</code> - возвращает коллекцию <a href="/manual.html#metaClass">мета-классов</a> встраиваемых сущностей</p> </li> 
           <li> <p><code>getAllEnums()</code> - возвращает коллекцию классов перечислений, используемых в качестве типов атрибутов сущностей</p> </li> 
           <li> <p><code>format()</code> - форматирует переданное значение в соответствии с типом данных заданного <a href="/manual.html#metaProperty">мета-свойства</a></p> </li> 
           <li> <p><code>isSystem()</code> - определяет, является ли переданное <a href="/manual.html#metaProperty">мета-свойство</a> системным, т.е. заданным в одном из <a href="/manual.html#base_entity_classes">базовых интерфейсов сущностей</a></p> </li> 
           <li> <p><code>isPersistent()</code> - определяет, является ли переданное мета-свойство персистентным, т.е. хранимым в БД</p> </li> 
           <li> <p><code>isTransient()</code> - определяет, является ли переданное мета-свойство или произвольный атрибут неперсистентным</p> </li> 
           <li> <p><code>isEmbedded()</code> - определяет, является ли переданное мета-свойство встроенным объектом</p> </li> 
           <li> <p><code>isAnnotationPresent()</code> - определяет наличие указанной аннотации на классе или его предках</p> </li> 
           <li> <p><code>getNamePatternProperties()</code> - возвращает коллекцию мета-свойств атрибутов, входящих в имя экземпляра, возвращаемого методом <code>Instance.getInstanceName()</code>. См. <a href="/manual.html#namePattern_annotation">@NamePattern</a>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Для расширения набора вспомогательных методов в конкретном приложении бин <code>MetadataTools</code> можно <a href="/manual.html#bean_extension">переопределить</a>. Примеры работы с расширенным интерфейсом:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">MyMetadataTools tools = metadata.getTools();
tools.foo();</code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">((MyMetadataTools) metadata.getTools()).foo();</code></pre> 
          </div> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="resources"><a class="anchor" href="/manual.html#resources"></a>5.2.6.4. Resources</h5> 
        <div class="paragraph"> 
         <p>Обеспечивает загрузку ресурсов по следующим правилам:</p> 
        </div> 
        <div class="olist arabic"> 
         <ol class="arabic"> 
          <li> <p>если указанное местонахождение представляет собой URL, ресурс загружается из этого URL;</p> </li> 
          <li> <p>если указанное местонахождение начинается с префикса <code>classpath:</code>, ресурс загружается из classpath;</p> </li> 
          <li> <p>если не URL и не начинается с <code>classpath:</code>, то:</p> 
           <div class="olist loweralpha"> 
            <ol class="loweralpha" type="a"> 
             <li> <p>в <a href="/manual.html#conf_dir">каталоге конфигурации</a> приложения ищется файл, используя указанное местонахождение как относительный путь. Если файл найден, ресурс загружается из него;</p> </li> 
             <li> <p>если ресурс не найден на предыдущих этапах, он загружается из classpath.</p> </li> 
            </ol> 
           </div> </li> 
         </ol> 
        </div> 
        <div class="paragraph"> 
         <p>На практике явное указание URL или префикса <code>classpath:</code> используется редко, т.е. обычно ресурсы загружаются либо из <a href="/manual.html#conf_dir">конфигурационного каталога</a>, либо из classpath. Ресурс в конфигурационном каталоге замещает одноименный ресурс в classpath.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Методы <code>Resources</code>:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>getResourceAsStream()</code> - возвращает <code>InputStream</code> для указанного ресурса, либо <code>null</code>, если ресурс не найден. Поток должен быть закрыт после использования, например:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Resources resources;
...
InputStream stream = <span class="predefined-constant">null</span>;
<span class="keyword">try</span> {
    stream = resources.getResourceAsStream(resourceLocation);
    ...
} <span class="keyword">finally</span> {
    IOUtils.closeQuietly(stream);
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Возможно использование "try with resources":</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (<span class="predefined-type">InputStream</span> stream = resources.getResourceAsStream(resourceLocation)) {
    ...
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>getResourceAsString()</code> - возвращает указанный ресурс в виде строки, либо <code>null</code>, если ресурс не найден</p> </li> 
         </ul> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="scripting"><a class="anchor" href="/manual.html#scripting"></a>5.2.6.5. Scripting</h5> 
        <div class="paragraph"> 
         <p>Интерфейс <code>Scripting</code> позволяет динамически (т.е. во время работы приложения) компилировать и загружать классы Java и Groovy, а также выполнять скрипты и выражения на Groovy.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Методы <code>Scripting</code>:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>evaluateGroovy()</code> - выполняет выражение на Groovy и возвращает его результат.</p> 
           <div class="paragraph"> 
            <p>Свойство приложения <a href="/manual.html#cuba.groovyEvaluatorImport">cuba.groovyEvaluatorImport</a> позволяет определить общий набор импортируемых классов, подставляемых в каждое выполняемое выражение. По умолчанию все стандартные блоки приложения импортируют класс <a href="/manual.html#persistenceHelper">PersistenceHelper</a>.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Скомпилированные выражения кэшируются, что значительно ускоряет повторное выполнение.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Пример:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Scripting scripting;
...
Integer intResult = scripting.evaluateGroovy(<span class="string"><span class="delimiter">"</span><span class="content">2 + 2</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">Binding</span>());

<span class="predefined-type">Binding</span> binding = <span class="keyword">new</span> <span class="predefined-type">Binding</span>();
binding.setVariable(<span class="string"><span class="delimiter">"</span><span class="content">instance</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> User());
<span class="predefined-type">Boolean</span> boolResult = scripting.evaluateGroovy(<span class="string"><span class="delimiter">"</span><span class="content">return PersistenceHelper.isNew(instance)</span><span class="delimiter">"</span></span>, binding);</code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div id="scripting.runGroovyScript" class="ulist"> 
         <ul> 
          <li> <p><code>runGroovyScript()</code> - выполняет скрипт Groovy и возвращает его результат.</p> 
           <div class="paragraph"> 
            <p>Скрипт должен быть расположен либо в <a href="/manual.html#conf_dir">конфигурационном каталоге</a> приложения, либо в classpath (текущая реализация <code>Scripting</code> поддерживает ресурсы classpath только внутри JAR-файлов). Скрипт в конфигурационном каталоге замещает одноименный скрипт в classpath.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Путь к скрипту указывается с разделителями <code>/</code>, в начале пути символ <code>/</code> не требуется.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Пример:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Scripting scripting;
...
Binding binding = <span class="keyword">new</span> <span class="predefined-type">Binding</span>();
binding.setVariable(<span class="string"><span class="delimiter">"</span><span class="content">itemId</span><span class="delimiter">"</span></span>, itemId);
<span class="predefined-type">BigDecimal</span> amount = scripting.runGroovyScript(<span class="string"><span class="delimiter">"</span><span class="content">com/abc/sales/CalculatePrice.groovy</span><span class="delimiter">"</span></span>, binding);</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>loadClass()</code> - загружает Java или Groovy класс, используя следующую последовательность действий:</p> 
           <div class="olist arabic"> 
            <ol class="arabic"> 
             <li> <p>Если класс уже загружен, возвращает его.</p> </li> 
             <li> <p>Ищет исходный текст Groovy (файл <code>*.groovy</code>) в каталоге конфигурации. Если найден, компилирует его, загружает и возвращает класс.</p> </li> 
             <li> <p>Ищет исходный текст Java (файл <code>*.java</code>) в каталоге конфигурации. Если найден, компилирует его, загружает и возвращает класс.</p> </li> 
             <li> <p>Ищет скомпилированный класс в classpath, если найден - загружает и возвращает его.</p> </li> 
             <li> <p>Если ничего не найдено, возвращает <code>null</code>.</p> 
              <div class="paragraph"> 
               <p>Файлы исходных текстов Java и Groovy в каталоге конфигурации можно изменять во время работы приложения. При следующем вызове <code>loadClass()</code> соответствующий класс будет перекомпилирован и возвращен новый, однако существуют следующие ограничения:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p>нельзя изменять тип исходного текста с Groovy на Java</p> </li> 
                <li> <p>если существовал исходный текст Groovy, и был однажды скомпилирован, то удаление файла исходного текста не приведет к загрузке другого класса из classpath - будет по-прежнему возвращаться класс, скомпилированный из удаленного исходника.</p> 
                 <div class="paragraph"> 
                  <p>Пример:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Scripting scripting;
...
Class calculatorClass = scripting.loadClass(<span class="string"><span class="delimiter">"</span><span class="content">com.abc.sales.PriceCalculator</span><span class="delimiter">"</span></span>);</code></pre> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> </li> 
            </ol> 
           </div> </li> 
          <li> <p><code>getClassLoader()</code> - возвращает <code>ClassLoader</code>, способный работать по правилам, описанным выше для метода <code>loadClass()</code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Кэш скомпилированных классов можно очистить во время выполнения с помощью JMX-бина <a href="/manual.html#cachingFacadeMBean">CachingFacadeMBean</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>См. также <a href="/manual.html#scriptingManagerMBean">ScriptingManagerMBean</a>.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="security"><a class="anchor" href="/manual.html#security"></a>5.2.6.6. Security</h5> 
        <div class="paragraph"> 
         <p>Обеспечивает авторизацию - проверку прав пользователя на различные объекты системы. Перед вызовом соответствующих методов <a href="/manual.html#userSession">UserSession</a> выполняется поиск исходного мета-класса сущности, что является важным при наличии <a href="/manual.html#entity_extension">расширений</a>. Кроме методов, дублирующих методы <code>UserSession</code>, данный интерфейс имеет методы <code>isEntityAttrReadPermitted()</code> и <code>isEntityAttrUpdatePermitted()</code>, предназначенные для определения доступности пути к атрибуту с учетом доступности атрибутов и сущностей, входящих в этот путь.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Интерфейс <code>Security</code> рекомендуется использовать в прикладном коде вместо вызовов методов <code>UserSession.isXYXPermitted()</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Подробнее см. <a href="/manual.html#authentication">Аутентификация пользователей</a>.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="timeSource"><a class="anchor" href="/manual.html#timeSource"></a>5.2.6.7. TimeSource</h5> 
        <div class="paragraph"> 
         <p>Обеспечивает получение текущего времени. Применение <code>new Date()</code> и т.п. в прикладном коде не рекомендуется.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Примеры:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> TimeSource timeSource;
...
Date date = timeSource.currentTimestamp();</code></pre> 
         </div> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="type">long</span> startTime = AppBeans.get(TimeSource.class).currentTimeMillis();</code></pre> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="userSessionSource"><a class="anchor" href="/manual.html#userSessionSource"></a>5.2.6.8. UserSessionSource</h5> 
        <div class="paragraph"> 
         <p>Обеспечивает получение объекта сессии текущего пользователя. Подробнее см. <a href="/manual.html#authentication">Аутентификация пользователей</a>.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="uuidSource"><a class="anchor" href="/manual.html#uuidSource"></a>5.2.6.9. UuidSource</h5> 
        <div class="paragraph"> 
         <p>Обеспечивает получение значений <code>UUID</code>, в том числе для идентификаторов сущностей. Применение <code>UUID.randomUUID()</code> в прикладном коде не рекомендуется.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Для вызова из статического контекста можно использовать класс <code>UuidProvider</code>, который имеет также дополнительный метод <code>fromString()</code>, работающий быстрее, чем стандартный метод <code>UUID.fromString()</code>.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="dataManager"><a class="anchor" href="/manual.html#dataManager"></a>5.2.6.10. DataManager</h5> 
        <div class="paragraph"> 
         <p>Интерфейс <code>DataManager</code> является универсальным средством для загрузки графов сущностей из базы данных, и для сохранения изменений, произведенных в detached экземплярах сущностей.</p> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>В разделе <a href="/manual.html#dm_vs_em">DataManager vs. EntityManager</a> приведена информация о различиях между DataManager и <a href="/manual.html#entityManager">EntityManager</a>.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="paragraph"> 
         <p><code>DataManager</code> на самом деле делегирует выполнение реализациям <a href="/manual.html#data_store">DataStore</a>, и поддерживает ссылки между сущностями из разных хранилищ. Большинство деталей реализации, описанных ниже, актуальны только когда производится работа через <code>RdbmsStore</code> с сущностями, хранящимися в реляционной БД. Для другого типа хранилища все, кроме сигнатур методов, может отличаться. Для простоты изложения, далее, когда мы говорим просто "DataManager", мы будем иметь в ввиду "DataManager через RdbmsStore".</p> 
        </div> 
        <div class="paragraph"> 
         <p>Методы <code>DataManager</code>:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>load()</code>, <code>loadList()</code> - загружает граф сущностей в соответствии с параметрами переданного объекта <code>LoadContext</code>.</p> 
           <div class="paragraph"> 
            <p>В <code>LoadContext</code> обязательно должен быть передан либо JPQL-запрос, либо идентификатор сущности. Если передано и то и другое, используется запрос, а идентификатор игнорируется.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Правила создания запросов аналогичны описанным в разделе <a href="/manual.html#query">Выполнение JPQL-запросов</a>. Отличием является то, что в запросе <code>LoadContext</code> могут быть использованы только именованные параметры, позиционные не поддерживаются.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Примеры загрузки сущностей в контроллере экрана:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> DataManager dataManager;

<span class="directive">private</span> <span class="predefined-type">Book</span> loadBookById(<span class="predefined-type">UUID</span> bookId) {
    LoadContext&lt;<span class="predefined-type">Book</span>&gt; loadContext = LoadContext.create(<span class="predefined-type">Book</span>.class)
            .setId(bookId).setView(<span class="string"><span class="delimiter">"</span><span class="content">book.edit</span><span class="delimiter">"</span></span>);
    <span class="keyword">return</span> dataManager.load(loadContext);
}

<span class="directive">private</span> <span class="predefined-type">List</span>&lt;BookPublication&gt; loadBookPublications(<span class="predefined-type">UUID</span> bookId) {
    LoadContext&lt;BookPublication&gt; loadContext = LoadContext.create(BookPublication.class)
            .setQuery(LoadContext.createQuery(<span class="string"><span class="delimiter">"</span><span class="content">select p from library$BookPublication p where p.book.id = :bookId</span><span class="delimiter">"</span></span>)
                .setParameter(<span class="string"><span class="delimiter">"</span><span class="content">bookId</span><span class="delimiter">"</span></span>, bookId))
            .setView(<span class="string"><span class="delimiter">"</span><span class="content">bookPublication.full</span><span class="delimiter">"</span></span>);
    <span class="keyword">return</span> dataManager.loadList(loadContext);
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>loadValues()</code> - загружает список пар ключ-значение. Метод принимает <code>ValueLoadContext</code>, в котором задается запрос и список ключей. Возвращаемый список содержит экземпляры <code>KeyValueEntity</code>. Например:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java">ValueLoadContext context = ValueLoadContext.create()
        .setQuery(ValueLoadContext.createQuery(
                    <span class="string"><span class="delimiter">"</span><span class="content">select o.customer, sum(o.amount) from demo$Order o </span><span class="delimiter">"</span></span> +
                    <span class="string"><span class="delimiter">"</span><span class="content">where o.date &gt;= :date group by o.customer</span><span class="delimiter">"</span></span>)
            .setParameter(<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span>, orderDate))
        .addProperty(<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>)
        .addProperty(<span class="string"><span class="delimiter">"</span><span class="content">sum</span><span class="delimiter">"</span></span>);
<span class="predefined-type">List</span>&lt;KeyValueEntity&gt; list = dataManager.loadValues(context);</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>getCount()</code> - возвращает количество записей для запроса, переданного в метод. Когда возможно, для максимальной производительности, стандартная реализация в классе <code>RdbmsStore</code> выполняет запрос <code>select count()</code> с условиями исходного запроса.</p> </li> 
          <li> <p><code>commit()</code> - сохраняет в базе данных набор сущностей, переданный в объекте <code>CommitContext</code>. Отдельно указываются коллекции сущностей, которые нужно сохранить и которые нужно удалить.</p> 
           <div class="paragraph"> 
            <p>Метод возвращает набор экземпляров сущностей, возвращенных из метода <a href="/manual.html#entityManager">EntityManager</a>.merge(), то есть по сути свежие экземпляры, только что обновленные в БД. Дальнейшая работа должна производиться именно с этими возвращенными экземплярами, чтобы предотвратить потерю данных или исключения оптимистичной блокировки. Для того, чтобы обеспечить наличие нужных атрибутов у возвращенных сущностей, с помощью мэп <code>CommitContext.getViews()</code> можно указать <a href="/manual.html#views">представление</a> для каждого сохраняемого экземпляра.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Примеры сохранения коллекций сущностей:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> DataManager dataManager;

<span class="directive">private</span> <span class="type">void</span> saveBookInstances(<span class="predefined-type">List</span>&lt;BookInstance&gt; toSave, <span class="predefined-type">List</span>&lt;BookInstance&gt; toDelete) {
    CommitContext commitContext = <span class="keyword">new</span> CommitContext(toSave, toDelete);
    dataManager.commit(commitContext);
}

<span class="directive">private</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Entity</span>&gt; saveAndReturnBookInstances(<span class="predefined-type">List</span>&lt;BookInstance&gt; toSave, <span class="predefined-type">View</span> view) {
    CommitContext commitContext = <span class="keyword">new</span> CommitContext();
    <span class="keyword">for</span> (BookInstance bookInstance : toSave) {
        commitContext.addInstanceToCommit(bookInstance, view);
    }
    <span class="keyword">return</span> dataManager.commit(commitContext);
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>reload()</code> - удобный метод для перезагрузки экземпляра сущности с требуемым <a href="/manual.html#views">представлением</a>. Делегирует выполнение методу <code>load()</code>.</p> </li> 
          <li> <p><code>remove()</code> - удаляет экземпляр сущности из базы данных. Делегирует выполнение методу <code>commit()</code>.</p> </li> 
         </ul> 
        </div> 
        <div id="dm_transactions" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Транзакции
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p><code>DataManager</code> всегда стартует новую транзакцию и по завершении работы выполняет коммит, таким образом возвращая сущности в <a href="/manual.html#entity_states">detached состоянии</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="dm_partial_entities" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Частичные сущности
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>По умолчанию, DataManager загружает <em>частичные</em> сущности в соответствии с указанными <a href="/manual.html#views">представлениями</a>. В следующих случаях будут загружаться все локальные атрибуты и представление будет определять только загрузку связей:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p>Загружаемая сущность <a href="/manual.html#entity_cache">кэшируется</a>.</p> </li> 
               <li> <p>Для сущности заданы in-memory "read" <a href="/manual.html#constraints">ограничения</a>.</p> </li> 
               <li> <p>Атрибут <code>loadPartialEntities</code> класса <code>LoadContext</code> установлен в false.</p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div class="sect5"> 
         <h6 id="dm_security"><a class="anchor" href="/manual.html#dm_security"></a>5.2.6.10.1. Права доступа в DataManager</h6> 
         <div class="paragraph"> 
          <p>Методы <code>load()</code>, <code>loadList()</code>, <code>loadValues()</code> и <code>getCount()</code> проверяют наличие у пользователя <a href="/manual.html#permissions">права</a> READ на загружаемую сущность. Кроме того, при извлечении сущностей из БД накладываются <a href="/manual.html#constraints">ограничения</a> групп доступа.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Метод <code>commit()</code> проверяет наличие у пользователя права UPDATE на изменяемые сущности и DELETE на удаляемые.</p> 
         </div> 
         <div class="paragraph"> 
          <p>По умолчанию, <code>DataManager</code> проверяет права на операции (READ/CREATE/UPDATE/DELETE) с сущностями, когда вызывается с клиентской стороны, и игнорирует их, когда вызывается из кода middleware. Права на атрибуты по умолчанию не проверяются.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Если вы хотите, чтобы <code>DataManager</code> проверял права на операции и при вызове на среднем слое, получите методом <code>DataManager.secure()</code> специальный объект-обертку и вызывайте методы у него. В качестве альтернативы, вы можете установить свойство приложения <a href="/manual.html#cuba.dataManagerChecksSecurityOnMiddleware">cuba.dataManagerChecksSecurityOnMiddleware</a>, чтобы проверка прав работала для всего приложения.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Права на атрибуты будут проверяться только если вы дополнительно установите свойство приложения <a href="/manual.html#cuba.entityAttributePermissionChecking">cuba.entityAttributePermissionChecking</a> в true.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Имейте в ввиду, что <a href="/manual.html#constraints">ограничения</a> групп доступа (row-level security) применяются всегда, независимо от того, был ли вызов с клиентского или со среднего слоя.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="query_with_distinct"><a class="anchor" href="/manual.html#query_with_distinct"></a>5.2.6.10.2. Запросы с distinct</h6> 
         <div class="paragraph"> 
          <p>В JPQL запросах для экранов со списками сущностей, в которых включено постраничное отображение и возможна непредсказуемая модификация запроса <a href="/manual.html#gui_Filter">универсальным фильтром</a> или механизмом ограничений групп доступа, при отсутствии в запросе оператора <code>distinct</code> может возникать следующий эффект:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>при объединении с коллекцией на уровне извлечения из базы данных возникает набор с дубликатами строк</p> </li> 
           <li> <p>на клиентском уровне в источнике данных дубликаты исчезают, т.к. попадают в мэп (<code>java.util.Map</code>)</p> </li> 
           <li> <p>при постраничном отображении на одной странице оказывается меньшее количество строк, чем запрошено, общее количество строк наоборот завышено.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Таким образом, рекомендуется в JPQL запросы браузеров включать предложение <code>distinct</code>, которое гарантирует отсутствие дубликатов записей при выборке из базы данных. Однако в некоторых серверах БД (в частности <strong>PostgreSQL</strong>) при большом количестве извлекаемых записей (более 10000) SQL запрос с <code>distinct</code> выполняется недопустимо долго.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Для решения этой проблемы в платформе реализована возможность корректной работы без <code>distinct</code> на уровне SQL. Данный механизм включается свойством приложения <a href="/manual.html#cuba.inMemoryDistinct">cuba.inMemoryDistinct</a>, при активации которого выполняется следующее:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>В JPQL запросе должен по-прежнему присутствовать <code>select distinct</code></p> </li> 
           <li> <p>В <code>DataManager</code> из JPQL запроса перед отправкой в ORM <code>distinct</code> вырезается</p> </li> 
           <li> <p>После загрузки страницы данных на Middleware удаляются дубликаты и выполняются дополнительные запросы к БД для получения нужного количества строк, которые затем и возвращаются клиенту.</p> </li> 
          </ul> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="query_from_selected"><a class="anchor" href="/manual.html#query_from_selected"></a>5.2.6.10.3. Последовательная выборка</h6> 
         <div class="paragraph"> 
          <p><code>DataManager</code> может выполнять последовательную выборку данных из результатов предыдущего запроса. Эта возможность используется в <a href="/manual.html#gui_Filter">универсальном фильтре</a> при последовательном наложении фильтров.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Данный механизм работает следующим образом:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>При получении <code>LoadContext</code> с установленными атрибутами <code>prevQueries</code> и <code>queryKey</code> <code>DataManager</code> выполняет выборку по предыдущему запросу и сохраняет идентификаторы полученных сущностей в таблице <code>SYS_QUERY_RESULT</code> (соответствующей сущности <code>sys$QueryResult</code>), разделяя наборы записей по идентификаторам пользовательских сессий и ключу сеанса выборки <code>queryKey</code>.</p> </li> 
           <li> <p>Текущий запрос модифицируется для объединения с результатами предыдущего, так что в итоге возвращает данные, соответствующие условиям обоих запросов, объединенных по "И".</p> </li> 
           <li> <p>Далее процесс может повторяться, при этом уменьшающийся набор предыдущих результатов удаляется из таблицы <code>SYS_QUERY_RESULT</code> и заполняется заново.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Таблицу <code>SYS_QUERY_RESULT</code> необходимо периодически чистить от ненужных результатов запросов, оставленных завершенными пользовательскими сессиями. Для этого предназначен метод <code>deleteForInactiveSessions</code> бина <code>QueryResultsManagerAPI</code>. В прикладном проекте с включенным параметром <a href="/manual.html#cuba.allowQueryFromSelected">cuba.allowQueryFromSelected</a> необходимо вызывать этот метод из <a href="/manual.html#scheduled_tasks">назначенных заданий</a>, например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task:scheduled-tasks</span> <span class="attribute-name">scheduler</span>=<span class="string"><span class="delimiter">"</span><span class="content">scheduler</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;task:scheduled</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">"</span><span class="content">cuba_QueryResultsManager</span><span class="delimiter">"</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">"</span><span class="content">deleteForInactiveSessions</span><span class="delimiter">"</span></span> <span class="attribute-name">fixed-rate</span>=<span class="string"><span class="delimiter">"</span><span class="content">600000</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/task:scheduled-tasks&gt;</span></code></pre> 
          </div> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="events"><a class="anchor" href="/manual.html#events"></a>5.2.6.11. Events</h5> 
        <div class="paragraph"> 
         <p>Бин <code>Events</code> реализует функциональность публикации объектов-событий уровня приложения. События могут использоваться для передачи данных между слабо связанными компонентами приложения. Бин <code>Events</code> является простым фасадом для объекта <code>ApplicationEventPublisher</code> Spring Framework.</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Events</span> {
    <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">"</span><span class="content">cuba_Events</span><span class="delimiter">"</span></span>;

    <span class="type">void</span> publish(ApplicationEvent event);
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Этот бин имеет только один метод - <code>publish()</code>, принимающий объект события. Метод <code>Events.publish()</code> уведомляет все слушатели, зарегистрированные в приложении и подписанные на события того же типа, что и переданный объект. Вы может использовать класс-обёртку <code>PayloadApplicationEvent</code> для публикации любых объектов в качестве событий.</p> 
        </div> 
        <div class="paragraph"> 
         <p>См. также <a href="https://spring.io/blog/2015/02/11/better-application-events-in-spring-framework-4-2" target="_blank">руководство Spring Framework</a>.</p> 
        </div> 
        <div id="bean-events" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Обработка событий в компонентах приложения
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Прежде всего, необходимо создать класс события. Он должен быть наследником класса <code>ApplicationEvent</code>. Класс события может включать любые дополнительные данные. Например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DemoEvent</span> <span class="directive">extends</span> ApplicationEvent {
    <span class="directive">public</span> DemoEvent(User source) {
        <span class="local-variable">super</span>(source);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> User getSource() {
        <span class="keyword">return</span> (User) <span class="local-variable">super</span>.getSource();
    }
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Бины могут публиковать события, используя бин <code>Events</code>:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DemoBean</span> {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Events events;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> UserSessionSource userSessionSource;

    <span class="directive">public</span> <span class="type">void</span> demo() {
        UserSession userSession = userSessionSource.getUserSession();
        events.publish(<span class="keyword">new</span> DemoEvent(userSession.getUser()));
    }
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>По умолчанию все события обрабатываются синхронно.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Есть два способа обработки событий:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p>Реализовать интерфейс <code>ApplicationListener</code>.</p> </li> 
               <li> <p>Использовать аннотацию <code>@EventListener</code> для метода.</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>В первом случае, мы должны создать бин, реализующий интерфейс <code>ApplicationListener</code> с указанием типа события:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DemoEventListener</span> <span class="directive">implements</span> ApplicationListener&lt;DemoEvent&gt; {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">Logger</span> log;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onApplicationEvent(DemoEvent event) {
        log.debug(<span class="string"><span class="delimiter">"</span><span class="content">Demo event is published</span><span class="delimiter">"</span></span>);
    }
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Второй способ может использоваться для сокрытия деталей реализации обработчика событий и обработки множества различных событий в одном бине:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MultipleEventListener</span> {
    <span class="annotation">@Order</span>(<span class="integer">10</span>)
    <span class="annotation">@EventListener</span>
    <span class="directive">private</span> <span class="type">void</span> handleDemoEvent(DemoEvent event) {
        <span class="comment">// handle event</span>
    }

    <span class="annotation">@Order</span>(<span class="integer">1010</span>)
    <span class="annotation">@EventListener</span>
    <span class="directive">private</span> <span class="type">void</span> handleUserLoginEvent(UserLoggedInEvent event) {
        <span class="comment">// handle event</span>
    }
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Вы можете использовать интерфейс <code>Ordered</code> и аннотацию <code>@Order</code> Spring Framework для указания порядка исполнения обработчиков событий. Все бины и обработчики событий платформы используют значение <code>order</code> от 100 до 1000, таким образом, вы можете добавить обработчик событий как до, так и после обработчиков события платформы. Если вы хотите добавить свой обработчик события до обработчиков из платформы, то используйте значение меньше 100.</p> 
             </div> 
             <div class="paragraph"> 
              <p>См. также <a href="/manual.html#login-events">События логина</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="ui-events" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Обработка событий в экранах
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Обычно, бин <code>Events</code> делегирует публикацию события объекту <code>ApplicationContext</code>. Для блоков Web Client / Desktop Client это поведение отличается от стандартного, вы можете использовать дополнительный интерфейс для классов событий - <code>UiEvent</code>. Это интерфейс-маркер для событий, которые должны быть доставлены в экраны пользовательского интерфейса текущего экземпляра UI (текущей вкладки веб-браузера). Важно отметить, что экземпляры событий, реализующих <code>UiEvent</code>, не доставляются в бины Spring и не могут быть обработаны за пределами UI.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Пример класса события:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserRemovedEvent</span> <span class="directive">extends</span> ApplicationEvent <span class="directive">implements</span> UiEvent {
    <span class="directive">public</span> UserRemovedEvent(User source) {
        <span class="local-variable">super</span>(source);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> User getSource() {
        <span class="keyword">return</span> (User) <span class="local-variable">super</span>.getSource();
    }
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>События публикуются при помощи бина <code>Events</code> из контроллера экрана так же, как и из бинов Spring:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
Events events;
<span class="comment">// ...</span>
UserRemovedEvent event = <span class="keyword">new</span> UserRemovedEvent(removedUser);
events.publish(event);</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Чтобы обработать событие, вы должны объявить в экране метод с аннотацией <code>@EventListener</code> (Интерфейс <code>ApplicationListener</code> не поддерживается):</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Order</span>(<span class="integer">15</span>)
<span class="annotation">@EventListener</span>
<span class="directive">protected</span> <span class="type">void</span> onUserRemove(UserRemovedEvent event) {
    showNotification(<span class="string"><span class="delimiter">"</span><span class="content">User is removed </span><span class="delimiter">"</span></span> + event.getSource());
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Вы можете использовать аннотацию <code>@Order</code>, чтобы задать порядок вызова обработчиков события.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Если класс события реализует <code>UiEvent</code>, и объект такого события опубликован при помощи бина <code>Events</code> из потока UI, то будут вызваны обработчики событий этого типа в открытых на данный момент окнах и фреймах. Обработка событий синхронная. Только экраны и фреймы текущей активной вкладки веб-браузера получат уведомление о событии.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="persistenceHelper"><a class="anchor" href="/manual.html#persistenceHelper"></a>5.2.7. PersistenceHelper</h4> 
       <div class="paragraph"> 
        <p>Вспомогательный класс для получения информации о персистентных сущностях. В отличие от бинов <a href="/manual.html#persistence">Persistence</a> и <a href="/manual.html#persistenceTools">PersistenceTools</a> доступен на всех <a href="/manual.html#app_tiers">уровнях</a> приложения.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Методы <code>PersistenceHelper</code>:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>isLoaded()</code> - определяет, загружен ли данный атрибут сущности. Атрибут загружается, если он включен в <a href="/manual.html#views">представление</a>, или если это локальный атрибут и никакое представление не использовалось в процессе загрузки через <a href="/manual.html#entityManager">EntityManager</a> или <a href="/manual.html#dataManager">DataManager</a>. Данный метод поддерживает только непосредственные атрибуты сущностей.</p> </li> 
         <li> <p><code>isNew()</code> - определяет, является ли переданный экземпляр только что созданным, т.е. находящимся в состоянии <a href="/manual.html#entity_states">New</a>. Возвращает <code>true</code>, также если экземпляр не является персистентной сущностью.</p> </li> 
         <li> <p><code>isManaged()</code> - определяет, находится ли переданный экземпляр в состоянии <a href="/manual.html#entity_states">Managed</a>, то есть присоединен к персистентному контексту.</p> </li> 
         <li> <p><code>isDetached()</code> - определяет, находится ли переданный экземпляр в состоянии <a href="/manual.html#entity_states">Detached</a>. Возвращает <code>true</code>, также если экземпляр не является персистентной сущностью.</p> </li> 
         <li> <p><code>isSoftDeleted()</code> - определяет, поддерживает ли переданный класс сущности <a href="/manual.html#soft_deletion">мягкое удаление</a>.</p> </li> 
         <li> <p><code>getEntityName()</code> - возвращает имя сущности, заданное в <a href="/manual.html#entity_annotations">аннотации</a> <code>@Entity</code>.</p> </li> 
        </ul> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="appContext"><a class="anchor" href="/manual.html#appContext"></a>5.2.8. AppContext</h4> 
       <div class="paragraph"> 
        <p><code>AppContext</code> - системный класс, в статических полях которого хранятся ссылки на некоторые общие для любого <a href="/manual.html#app_tiers">блока</a> приложения компоненты:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>ApplicationContext</code> фреймворка <strong>Spring</strong></p> </li> 
         <li> <p>Набор <a href="/manual.html#app_properties">свойств приложения</a>, загруженных из файлов <code>app.properties</code></p> </li> 
         <li> <p><code>ThreadLocal</code> переменная, хранящая экземпляры <code>SecurityContext</code></p> </li> 
         <li> <p>Коллекция слушателей жизненного цикла приложения (<code>AppContext.Listener</code>)</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p><code>AppContext</code> инициализируется на запуске приложения классами-загрузчиками, специфичными для типа <a href="/manual.html#app_tiers">блока</a> приложения:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>загрузчик Middleware - <code>AppContextLoader</code></p> </li> 
         <li> <p>загрузчик Web Client - <code>WebAppContextLoader</code></p> </li> 
         <li> <p>загрузчик Web Portal - <code>PortalAppContextLoader</code></p> </li> 
         <li> <p>загрузчик Desktop Client - <code>DesktopAppContextLoader</code></p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p><code>AppContext</code> может быть использован в прикладном коде для решения следующих задач:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Регистрации слушателей, срабатывающих после полной инициализации и перед закрытием приложения, например:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java">AppContext.addListener(<span class="keyword">new</span> AppContext.Listener() {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> applicationStarted() {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">Application is ready</span><span class="delimiter">"</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> applicationStopped() {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">"</span><span class="content">Application is closing</span><span class="delimiter">"</span></span>);
    }
});</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>В момент вызова <code>applicationStarted()</code>:</p> 
          </div> 
          <div class="ulist"> 
           <ul> 
            <li> <p>Полностью инициализированы все <a href="/manual.html#managed_beans">бины</a>, в том числе выполнены их методы <code>@PostConstruct</code>.</p> </li> 
            <li> <p>Можно использовать статические методы получения бинов <code>AppBeans.get()</code>.</p> </li> 
            <li> <p>Метод <code>AppContext.isStarted()</code> возвращает <code>true</code>.</p> </li> 
            <li> <p>Метод <code>AppContext.isReady()</code> возвращает <code>false</code>.</p> </li> 
            <li> <p>В блоке Middleware: если свойство приложения <a href="/manual.html#cuba.automaticDatabaseUpdate">cuba.automaticDatabaseUpdate</a> включено, все скрипты обновления БД успешно выполнены.</p> 
             <div class="paragraph"> 
              <p>В момент вызова <code>applicationStopped()</code>:</p> 
             </div> </li> 
            <li> <p>Все бины работоспособны и доступны через статические методы <code>AppBeans.get()</code>.</p> </li> 
            <li> <p>Метод <code>AppContext.isStarted()</code> возвращает <code>false</code>.</p> </li> 
            <li> <p>Метод <code>AppContext.isReady()</code> возвращает <code>false</code>.</p> 
             <div class="paragraph"> 
              <p>Практический пример использования <code>AppContext.Listener</code> см. в <a href="/manual.html#app_start_recipe">Выполнение кода на старте приложения</a>.</p> 
             </div> </li> 
           </ul> 
          </div> </li> 
         <li> <p>Получения значений <a href="/manual.html#app_properties">свойств приложения</a>, хранимых в файлах <code>app.properties</code>, если они недоступны через <a href="/manual.html#config_interfaces">конфигурационные интерфейсы</a>.</p> </li> 
         <li> <p>Передачи <code>SecurityContext</code> в новые потоки выполнения, см. <a href="/manual.html#authentication">Аутентификация пользователей</a>.</p> </li> 
        </ul> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="app_properties"><a class="anchor" href="/manual.html#app_properties"></a>5.2.9. Свойства приложения</h4> 
       <div class="paragraph"> 
        <p>Свойства приложения − именованные значения различных типов, определяющие всевозможные аспекты конфигурации и функционирования приложения. Свойства приложения широко используются в платформе, и могут применяться в приложении для решения аналогичных задач.</p> 
       </div> 
       <div class="paragraph"> 
        <p>По назначению свойства приложения можно классифицировать следующим образом:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><em>Конфигурационные параметры</em> - задают наборы конфигурационных файлов и некоторые параметры пользовательского интерфейса, т.е. определяют функциональность приложения. Значения конфигурацинных параметров обычно задаются при разработке приложения.</p> 
          <div class="paragraph"> 
           <p>Например: <a href="/manual.html#cuba.springContextConfig">cuba.springContextConfig</a>.</p> 
          </div> </li> 
         <li> <p><em>Параметры развертывания</em> - различные URL для соединения <a href="/manual.html#app_tiers">блоков</a> приложения, тип используемой БД, настройки безопасности и т.д. Значения параметров развертывания обычно зависят от окружения, в котором устанавливается данный экземпляр приложения.</p> 
          <div class="paragraph"> 
           <p>Например: <a href="/manual.html#cuba.connectionUrlList">cuba.connectionUrlList</a>, <a href="/manual.html#cuba.dbmsType">cuba.dbmsType</a>, <a href="/manual.html#cuba.userSessionExpirationTimeoutSec">cuba.userSessionExpirationTimeoutSec</a>.</p> 
          </div> </li> 
         <li> <p><em>Параметры времени выполнения</em> - активность аудита, параметры отсылки email и т.д. Параметры времени выполнения могут быть изменены при необходимости во время работы приложения без его перезапуска.</p> 
          <div class="paragraph"> 
           <p>Например: <a href="/manual.html#cuba.entityLog.enabled">cuba.entityLog.enabled</a>, <a href="/manual.html#cuba.email._">cuba.email.smtpHost</a>.</p> 
          </div> </li> 
        </ul> 
       </div> 
       <div id="setting_app_properties" class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Задание свойств приложения
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Значения свойств приложения могут быть заданы в <a href="/manual.html#app_properties_db">базе данных</a>, в <a href="/manual.html#app_properties_files">файлах свойств</a>, или через системные свойства Java. Кроме того, значение, заданное в файле, переопределяет одноименное значение, заданное в БД. Значение, заданное системным свойством Java, переопределяет одноименные значения из файлов и из БД.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Некоторые свойства не поддерживают установку свойств в базе данных по причине того, что их значения требуются еще то того, как БД становится доступной приложению. Это параметры конфигурации и развертывания. Поэтому их можно устанавливать только в файлах свойств или через системные свойства Java. Параметры времени выполнения всегда могут быть установлены в базе данных (и, возможно, переопределены в файле или системными свойствами).</p> 
            </div> 
            <div class="paragraph"> 
             <p>Как правило, некоторое свойство используется только в одном или нескольких <a href="/manual.html#app_tiers">блоках</a> приложения. Например, <a href="/manual.html#cuba.persistenceConfig">cuba.persistenceConfig</a> необходимо только для Middleware, <a href="/manual.html#cuba.web.appWindowMode">cuba.web.appWindowMode</a> − только для Web Client, а <a href="/manual.html#cuba.springContextConfig">cuba.springContextConfig</a> − для всех блоков. Это означает, что если нужно задать значение некоторому свойству, это необходимо сделать <em>во всех блоках</em>, в которых данное свойство используется. Свойства, хранящиеся в БД, доступны всем блокам, поэтому они устанавливаются в одном месте (в таблице базы данных), независимо от того, в каких блоках они используются. Более того, платформа предоставляет экран <strong>Administration &gt; Application Properties</strong> для управления свойствами, хранящимися в БД. Свойства, хранящиеся в файлах, должны быть установлены одновременно в соответствующих файлах блоков приложения.</p> 
            </div> 
            <div class="admonitionblock tip"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Tip
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>Когда вам необходимо установить значение свойству приложения, определенному платформой, найдите это свойство в <a href="/manual.html#app_properties_reference">документации</a>. Если в документации сказано, что свойство хранится в БД, для установки значения используйте экран <strong>Administration &gt; Application Properties</strong>. В противном случае выясните в документации, какие блоки приложения используют свойство, и установите значение в файлах <code>app.properties</code> этих блоков. Например, если в документации сказано, что свойство используется во всех блоках, а ваше приложение состоит из Middleware и Web Client, установите свойство в файле <code>app.properties</code> модуля <strong>core</strong> и в файле <code>web-app.properties</code> модуля <strong>web</strong>. Параметры развертывания можно также установить вне проекта в <a href="/manual.html#conf_dir">конфигурационном</a> каталоге. Подробнее см. <a href="/manual.html#app_properties_files">Хранение свойств в файлах</a>.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
          </div> 
         </dd> 
        </dl> 
       </div> 
       <div id="component_app_properties" class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Свойства из компонентов приложения
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p><a href="/manual.html#app_components">Компонент приложения</a> может предоставлять свойства путем объявления их в файле <a href="/manual.html#app-component.xml">app-component.xml</a>. Тогда если приложение, использующее компонент, не задает собственное значение свойства, значение будет получено из компонента. Если приложение использует несколько компонентов, предоставляющих одно и то же свойство, значение будет получено из компонента, который является ближайшим предком в иерархии зависимостей между компонентами. Если существует несколько компонентов на одном уровне иерархии, то значение свойства непредсказуемо.</p> 
          </div> 
         </dd> 
        </dl> 
       </div> 
       <div id="additive_app_properties" class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Аддитивные свойства
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Иногда необходимо получить объединенное значение свойства из всех компонентов, используемых в приложении. Это особенно актуально для конфигурационных параметров, которые позволяют механизмам платформы конфигурировать приложение на основании свойств, предоставляемых компонентами приложения.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Такие свойства должны быть сделаны <em>аддитивными</em> путем добавления знака плюс в начале значения. Этот знак говорит о том, что значение свойства во время выполнения должно быть собрано из компонентов приложения. Например, <a href="/manual.html#cuba.persistenceConfig">cuba.persistenceConfig</a> - аддитивное свойство. В вашем проекте оно задает файл <code>persistence.xml</code>, определяющий модель данных проекта. Однако вследствие того, что реальное значение свойства будет также включать файлы <code>persistence.xml</code> компонентов приложения, полная модель данных вашего приложения будет включать также и сущности, определенные в компонентах.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если знак <code>+</code> опустить, то значение будет получено только из текущего проекта. Это может быть полезным в случае, если наследование некоторой конфигурации из компонентов не требуется, например, при определении структуры главного меню.</p> 
            </div> 
           </div> 
          </div> 
         </dd> 
        </dl> 
       </div> 
       <div id="app_properties_access" class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Программный доступ к свойствам приложения
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Доступ к свойствам из кода приложения можно получить следующими способами:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p>Через <a href="/manual.html#config_interfaces">конфигурационный интерфейс</a>. Если определить свойства с помощью аннотированных методов конфигурационного интерфейса, то код приложения будет иметь типизированный доступ к этим свойствам. Конфигурационные интерфейсы позволяют работать со свойствами всех типов хранения: в базе данных, в файлах и системных свойствах.</p> </li> 
              <li> <p>Методом <code>getProperty()</code> класса <a href="/manual.html#appContext">AppContext</a>. Если вы установили свойство в файле или в системном свойстве Java, то код приложения может прочитать значение с помощью этого метода. Данный подход имеет следующие недостатки:</p> 
               <div class="ulist"> 
                <ul> 
                 <li> <p>Не поддерживаются свойства, хранящиеся в базе данных.</p> </li> 
                 <li> <p>В отличие от вызова метода интерфейса, вам необходимо передавать имя свойства в строке.</p> </li> 
                 <li> <p>В отличие от получения результата нужного типа, вы можете получить только строковое значение свойства.</p> </li> 
                </ul> 
               </div> </li> 
             </ul> 
            </div> 
           </div> 
          </div> 
         </dd> 
        </dl> 
       </div> 
       <div class="sect4"> 
        <h5 id="app_properties_files"><a class="anchor" href="/manual.html#app_properties_files"></a>5.2.9.1. Хранение свойств в файлах</h5> 
        <div class="paragraph"> 
         <p>Свойства, определяющие конфигурацию и параметры развертывания, задаются в специальных файлах свойств, имеющих имя вида <code>*app.properties</code>. Каждый <a href="/manual.html#app_tiers">блок</a> приложения имеет набор таких файлов, который определяется следующим образом:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Для блоков, являющихся веб-приложениями (Middleware, Web Client, Web Portal) набор файлов свойств задается в <code>web.xml</code> в параметре <code>appPropertiesConfig</code>.</p> </li> 
          <li> <p>Для блока Desktop Client основной способ задания набора файлов свойств − переопределение в приложении метода <code>getDefaultAppPropertiesConfig()</code> в классе-наследнике <code>com.haulmont.cuba.desktop.App</code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Например, набор файлов свойств блока Middleware задается в файле <code>web/WEB-INF/web.xml</code> модуля <strong>core</strong>, и выглядит следующим образом:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>appPropertiesConfig<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>
        classpath:com/company/sample/app.properties
        /WEB-INF/local.app.properties
        "file:${catalina.base}/conf/app-core/local.app.properties"
    <span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Здесь префикс <code>classpath:</code> означает, что данный файл нужно искать в Java classpath, префикс <code>file:</code> − в файловой системе. Путь без такого префикса означает путь внутри веб-приложения относительно его корня. Возможно использование системных свойств Java, в данном случае это <code>catalina.home</code> − путь к каталогу установки Tomcat.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Порядок перечисления файлов важен, так как значения, указанные в каждом последующем файле, заменяют значения одноименных свойств, заданные в предыдущих файлах.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Последний файл в приведенном наборе − <code>local.app.properties</code>. Он может использоваться для переопределения свойств приложения при развертывании. Если этого файла нет, он игнорируется. Если же во время инсталляции системы требуется переопределение некоторых параметров (как правило, различных URL), достаточно создать этот файл и поместить в него переопределяемые свойства. При последующих обновлениях системы такой файл с локальными настройками легко сохранить. В разделе <a href="/manual.html#tomcat_in_prod">Использование Tomcat при эксплуатации приложения</a> приведен пример использования файла <code>local.app.properties</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Аналогом <code>local.app.properties</code> для Desktop Client служат аргументы командной строки запуска JVM. Загрузчик свойств данного блока воспринимает все аргументы, содержащие знак "=", как пары ключ-значение, и заменяет ими соответствующие свойства приложения, заданные в файлах <code>app.properties</code>.</p> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Правила задания информации в файлах <code>*.properties</code>:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p>Кодировка файла - <code>UTF-8</code></p> </li> 
               <li> <p>Ключ может состоять из латинских букв, цифр, точек и знаков подчеркивания</p> </li> 
               <li> <p>Значение пишется после знака равно (<code>=</code>)</p> </li> 
               <li> <p>Значение не нужно брать в кавычки " или '</p> </li> 
               <li> <p>Файловые пути записываются либо в UNIX-виде (<code>/opt/haulmont/</code>), либо в Windows-виде (<code>c:\\haulmont\\</code>)</p> </li> 
               <li> <p>Возможно использование кодов <code>\n \t \r</code>. Символ <code>\</code> является зарезервированным, для вставки в значение экранируется сам собой (<code>\\</code>). Подробнее см.: <a href="http://docs.oracle.com/javase/tutorial/java/data/characters.html" target="_blank"></a><a href="http://docs.oracle.com/javase/tutorial/java/data/characters.html" class="bare" target="_blank">http://docs.oracle.com/javase/tutorial/java/data/characters.html</a></p> </li> 
               <li> <p>Для ввода значения в нескольких строках файла используйте символ <code>\</code> в конце строки, для того чтобы данное значение продолжалось на следующей строке.</p> </li> 
              </ul> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="app_properties_db"><a class="anchor" href="/manual.html#app_properties_db"></a>5.2.9.2. Хранение свойств в базе данных</h5> 
        <div class="paragraph"> 
         <p>Свойства приложения, представляющие собой параметры времени выполнения, хранятся в таблице <code>SYS_CONFIG</code> базы данных.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Такие свойства имеют следующие особенности:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Так как значение свойства хранится в базе данных, оно задается в одном месте, независимо от того, в каких блоках приложения оно используется.</p> </li> 
          <li> <p>Значение может быть изменено и сохранено во время работы приложения следующими способами:</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p>Через экран <strong>Administration &gt; Application Properties</strong>.</p> </li> 
             <li> <p>Через JMX бин <a href="/manual.html#configStorageMBean">ConfigStorageMBean</a>.</p> </li> 
             <li> <p>Если <a href="/manual.html#config_interfaces">конфигурационный интерфейс</a>, содержащий это свойство, имеет соответствующий setter, то свойство может изменено кодом приложения.</p> </li> 
            </ul> 
           </div> </li> 
          <li> <p>Значение свойства может быть переопределено для конкретного блока приложения в его файле <code>app.properties</code> или одноименным системным свойством Java.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Следует иметь в виду, что на клиентском уровне чтение свойства, хранящегося в БД, приводит к запросу к Middleware, что менее эффективно, чем чтение свойства из локального файла <code>app.properties</code>. Для уменьшения количества таких запросов клиент кэширует все свойства, хранящиеся в БД, на время жизни экземпляра реализации конфигурационного интерфейса. Поэтому если, например, в некотором экране UI необходимо несколько раз обратиться к свойствам одного конфигурационного интерфейса, лучше получить ссылку на него при инициализации экрана, и сохранить в поле для последующих обращений к одному и тому же экземпляру.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="config_interfaces"><a class="anchor" href="/manual.html#config_interfaces"></a>5.2.9.3. Конфигурационные интерфейсы</h5> 
        <div class="paragraph"> 
         <p>Данный механизм позволяет работать со свойствами приложения через методы Java-интерфейсов, что дает следующие преимущества:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Типизированность - прикладной код работает с нужными типами (String, Boolean, Integer и пр.), а не только со строками.</p> </li> 
          <li> <p>В прикладном коде вместо строковых идентификаторов свойств используются методы интерфейсов, имена которых проверяются компилятором и подсказываются средой разработки.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Пример получения значения таймаута транзакции в блоке Middleware:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> ServerConfig serverConfig;

<span class="directive">public</span> <span class="type">void</span> doSomething() {
    <span class="type">int</span> timeout = serverConfig.getDefaultQueryTimeoutSec();
    ...
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>При невозможности инжекции можно получить ссылку на конфигурационный интерфейс через <a href="/manual.html#configuration">Configuration</a>:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> timeout = AppBeans.get(<span class="predefined-type">Configuration</span>.class)
        .getConfig(ServerConfig.class)
        .getDefaultQueryTimeoutSec();</code></pre> 
         </div> 
        </div> 
        <div class="admonitionblock warning"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Warning
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Конфигурационные интерфейсы не являются нормальными бинами Spring, не пытайтесь получить их через <code>AppBeans.get()</code> - только непосредственной инжекцией самого интерфейса или через <code>Configuration.getConfig()</code>.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="sect5"> 
         <h6 id="config_interface_usage"><a class="anchor" href="/manual.html#config_interface_usage"></a>5.2.9.3.1. Использование</h6> 
         <div class="paragraph"> 
          <p>Для создания конфигурационного интерфейса необходимо:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Создать интерфейс, унаследованный от <code>com.haulmont.cuba.core.config.Config</code> (не путать с классом сущности <code>com.haulmont.cuba.core.entity.Config</code>)</p> </li> 
           <li> <p>Добавить интерфейсу аннотацию <code>@Source</code> для указания источника (способа хранения) параметров:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>SourceType.SYSTEM</code> - значение свойства будет взято из системных свойств данной JVM, т.е. методом <code>System.getProperty()</code>.</p> </li> 
              <li> <p><code>SourceType.APP</code> - значение свойства будет взято из файлов <code>app.properties</code>.</p> </li> 
              <li> <p><code>SourceType.DATABASE</code> - значение свойства будет взято из базы данных.</p> </li> 
             </ul> 
            </div> </li> 
           <li> <p>Создать методы доступа к свойству (getter / setter). Если значение свойства не предполагается изменять из кода приложения, метод доступа на запись не нужен. Тип, вовращаемый методом доступа на чтение, определяет тип свойства. Возможные типы рассмотрены <a href="/manual.html#config_interface_property_types">ниже</a>.</p> </li> 
           <li> <p>Добавить методу доступа на чтение аннотацию <code>@Property</code>, определяющую имя свойства.</p> </li> 
           <li> <p>Опционально аннотацию <code>@Source</code> можно задать для отдельного свойства в интерфейсе, если его источник отличается от заданного для всего интерфейса.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Source</span>(type = SourceType.DATABASE)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">SalesConfig</span> <span class="directive">extends</span> Config {

    <span class="annotation">@Property</span>(<span class="string"><span class="delimiter">"</span><span class="content">sales.companyName</span><span class="delimiter">"</span></span>)
    <span class="predefined-type">String</span> getCompanyName();
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Создавать класс реализации конфигурационного интерфейса не нужно - при получении ссылки на интерфейс инжекцией или через <a href="/manual.html#configuration">Configuration</a> будет автоматически создан необходимый прокси-объект.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="config_interface_property_types"><a class="anchor" href="/manual.html#config_interface_property_types"></a>5.2.9.3.2. Типы свойств</h6> 
         <div class="paragraph"> 
          <p>"Из коробки" платформой поддерживаются следующие типы свойств:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>String</code>, простые типы и их объектные обертки (<code>boolean</code>, <code>Boolean</code>, <code>int</code>, <code>Integer</code>, etc.).</p> </li> 
           <li> <p>Перечисления (<code>enum</code>). Значение свойства сохраняется в файле или БД в виде имени значения перечисления.</p> 
            <div class="paragraph"> 
             <p>Если перечисление реализует интерфейс <code>EnumClass</code> и имеет статический метод <code>fromId()</code> для получения значения по идентификатору, с помощью аннотации <code>@EnumStore</code> можно задать хранение значения в виде идентификатора. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Property</span>(<span class="string"><span class="delimiter">"</span><span class="content">myapp.defaultCustomerGrade</span><span class="delimiter">"</span></span>)
<span class="annotation">@DefaultInteger</span>(<span class="integer">10</span>)
<span class="annotation">@EnumStore</span>(EnumStoreMode.ID)
CustomerGrade getDefaultCustomerGrade();

<span class="annotation">@EnumStore</span>(EnumStoreMode.ID)
<span class="type">void</span> setDefaultCustomerGrade(CustomerGrade grade);</code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Классы персистентных <a href="/manual.html#data_model">сущностей</a>. При обращении к свойству типа сущности происходит загрузка из БД экземпляра, заданного значением свойства.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Для поддержки произвольного типа необходимо реализовать классы <code>TypeStringify</code> и <code>TypeFactory</code> для преобразования значения в строку и из нее, и указать эти классы для свойства с помощью аннотаций <code>@Stringify</code> и <code>@Factory</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Рассмотрим этот процесс на примере типа <code>UUID</code>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Создаем класс <code>com.haulmont.cuba.core.config.type.UuidTypeFactory</code> унаследованный от <code>com.haulmont.cuba.core.config.type.TypeFactory</code> и реализуем в нем метод:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Object</span> build(<span class="predefined-type">String</span> string) {
    <span class="keyword">if</span> (string == <span class="predefined-constant">null</span>) {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
    <span class="keyword">return</span> <span class="predefined-type">UUID</span>.fromString(string);
}</code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>TypeStringify</code> создавать не нужно, т.к. по умолчанию будет использован метод <code>toString()</code> − в данном случае он нам подходит.</p> </li> 
           <li> <p>Аннотируем свойство в конфигурационном интерфейсе:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Factory</span>(factory = UuidTypeFactory.class)
<span class="predefined-type">UUID</span> getUuidProp();
<span class="type">void</span> setUuidProp(<span class="predefined-type">UUID</span> value);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В платформе определены реализации <code>TypeFactory</code> для следующих типов:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>UUID</code> - <code>UuidTypeFactory</code>, описано выше.</p> </li> 
           <li> <p><code>java.util.Date</code> - <code>DateFactory</code>. Значение даты должно быть указано в формате <code>yyyy-MM-dd HH:mm:ss.SSS</code>, например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="properties">cuba.test.dateProp = 2013-12-12 00:00:00.000</code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>List&lt;Integer&gt;</code> (список целых чисел) - <code>IntegerListTypeFactory</code>. Значение свойства должно быть указано в виде списка чисел, разделенных пробелами, например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="properties">cuba.test.integerListProp = 1 2 3</code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>List&lt;String&gt;</code> (список строк) - <code>StringListTypeFactory</code>. Значение свойства должно быть указано в виде списка строк, разделенных символом "|", например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="properties">cuba.test.stringListProp = aaa|bbb|ccc</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="config_interface_default_values"><a class="anchor" href="/manual.html#config_interface_default_values"></a>5.2.9.3.3. Значения по умолчанию</h6> 
         <div class="paragraph"> 
          <p>Для свойств конфигурационных интерфейсов могут быть заданы значения по умолчанию. Эти значения будут возвращаться вместо <code>null</code>, если данный параметр не задан в месте хранения - в БД или в файле <code>app.properties</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Значение по умолчанию может быть задано в виде строки с помощью аннотации <code>@Default</code>, либо в виде конкретного типа с помощью других аннотаций пакета <code>com.haulmont.cuba.core.config.defaults</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Property</span>(<span class="string"><span class="delimiter">"</span><span class="content">cuba.email.adminAddress</span><span class="delimiter">"</span></span>)
<span class="annotation">@Default</span>(<span class="string"><span class="delimiter">"</span><span class="content">address@company.com</span><span class="delimiter">"</span></span>)
<span class="predefined-type">String</span> getAdminAddress();

<span class="annotation">@Property</span>(<span class="string"><span class="delimiter">"</span><span class="content">cuba.email.delayCallCount</span><span class="delimiter">"</span></span>)
<span class="annotation">@Default</span>(<span class="string"><span class="delimiter">"</span><span class="content">2</span><span class="delimiter">"</span></span>)
<span class="type">int</span> getDelayCallCount();

<span class="annotation">@Property</span>(<span class="string"><span class="delimiter">"</span><span class="content">cuba.email.defaultSendingAttemptsCount</span><span class="delimiter">"</span></span>)
<span class="annotation">@DefaultInt</span>(<span class="integer">10</span>)
<span class="type">int</span> getDefaultSendingAttemptsCount();

<span class="annotation">@Property</span>(<span class="string"><span class="delimiter">"</span><span class="content">cuba.test.dateProp</span><span class="delimiter">"</span></span>)
<span class="annotation">@Default</span>(<span class="string"><span class="delimiter">"</span><span class="content">2013-12-12 00:00:00.000</span><span class="delimiter">"</span></span>)
<span class="annotation">@Factory</span>(factory = DateFactory.class)
<span class="predefined-type">Date</span> getDateProp();

<span class="annotation">@Property</span>(<span class="string"><span class="delimiter">"</span><span class="content">cuba.test.integerList</span><span class="delimiter">"</span></span>)
<span class="annotation">@Default</span>(<span class="string"><span class="delimiter">"</span><span class="content">1 2 3</span><span class="delimiter">"</span></span>)
<span class="annotation">@Factory</span>(factory = IntegerListTypeFactory.class)
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; getIntegerList();

<span class="annotation">@Property</span>(<span class="string"><span class="delimiter">"</span><span class="content">cuba.test.stringList</span><span class="delimiter">"</span></span>)
<span class="annotation">@Default</span>(<span class="string"><span class="delimiter">"</span><span class="content">aaa|bbb|ccc</span><span class="delimiter">"</span></span>)
<span class="annotation">@Factory</span>(factory = StringListTypeFactory.class)
<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getStringList();</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Для сущностей значение по умолчанию задается строкой вида <code>{entity_name}-{id}-{optional_view_name}</code>, например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Default</span>(<span class="string"><span class="delimiter">"</span><span class="content">sec$User-98e5e66c-3ac9-11e2-94c1-3860770d7eaf-browse</span><span class="delimiter">"</span></span>)
User getAdminUser();

<span class="annotation">@Default</span>(<span class="string"><span class="delimiter">"</span><span class="content">sec$Role-a294aef0-3ac9-11e2-9433-3860770d7eaf</span><span class="delimiter">"</span></span>)
<span class="predefined-type">Role</span> getAdminRole();</code></pre> 
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="localization"><a class="anchor" href="/manual.html#localization"></a>5.2.10. Локализация сообщений</h4> 
       <div class="paragraph"> 
        <p>Приложение на основе платформы CUBA поддерживает локализацию сообщений, то есть вывод всех элементов пользовательского интерфейса на языке, выбранном пользователем.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Возможности выбора языка пользователем определяются комбинацией свойств приложения <a href="/manual.html#cuba.localeSelectVisible">cuba.localeSelectVisible</a> и <a href="/manual.html#cuba.availableLocales">cuba.availableLocales</a>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Для того, чтобы некоторое сообщение могло быть локализовано, т.е. представлено пользователю на нужном языке, его необходимо поместить в так называемый <em>пакет сообщений</em>. Ниже рассмотрены принципы работы механизма локализации и правила создания сообщений.</p> 
       </div> 
       <div class="paragraph"> 
        <p><a href="/manual.html#getting_messages">Получение локализованных сообщений</a> содержит информацию о способах получения локализованных сообщений в различных компонентах системы.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="message_packs"><a class="anchor" href="/manual.html#message_packs"></a>5.2.10.1. Пакеты сообщений</h5> 
        <div class="paragraph"> 
         <p>Пакет сообщений представляет собой набор файлов свойств с именами вида <code>messages{_XX}.properties</code>, расположенных в одном Java-пакете. Суффикс <code>XX</code> определяет язык, для которого в данном файле содержатся сообщения, и соответствует коду языка в <code>Locale.getLanguage()</code>. Возможно также использование остальных атрибутов <code>Locale</code>, например, <code>country</code>. В этом случая файл пакета будет иметь вид <code>messages{<em>XX_YY}.properties</em></code><em>. Один из файлов пакета может быть без суффикса языка - это _файл по умолчанию</em>. Именем пакета сообщений считается имя Java-пакета, в котором расположены файлы пакета.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Рассмотрим пример:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="plain">/com/abc/sales/gui/customer/messages.properties
/com/abc/sales/gui/customer/messages_fr.properties
/com/abc/sales/gui/customer/messages_ru.properties</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Данный пакет состоит из 3-х файлов - один для русского языка, один для французского, и один по умолчанию. Имя пакета - <code>com.abc.sales.gui.customer</code></p> 
        </div> 
        <div class="paragraph"> 
         <p>Файлы сообщений содержат пары ключ-значение, где ключ - это идентификатор сообщения, на который ссылается код приложения, а значение - само сообщение на языке данного файла. Правила задания пар аналогичны правилам файлов свойств <code>java.util.Properties</code>, со следующими особенностями:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Кодировка файла - обязательно <code>UTF-8</code></p> </li> 
          <li> <p>Поддерживается включение других пакетов сообщений с помощью ключа <code>@include</code>, в том числе нескольких сразу - перечислением через запятую. При этом если некоторый ключ сообщения встречается и во включаемом пакете, и в текущем, будет использовано сообщение из текущего. Пример включения пакетов:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="plain">@include=com.haulmont.cuba.web, com.abc.sales.web

someMessage=Some Message
...</code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Получение сообщений из пакетов производится с помощью методов интерфейса <a href="/manual.html#messages">Messages</a> по следующим правилам:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Сначала производится поиск в <a href="/manual.html#conf_dir">конфигурационном каталоге</a> приложения</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p>Ищется файл <code>messages_XX.properties</code> в каталоге, задаваемом именем пакета сообщений, где <code>XX</code> - код требуемого языка</p> </li> 
             <li> <p>Если такого файла нет, в этом же каталоге ищется файл по умолчанию <code>messages.properties</code></p> </li> 
             <li> <p>Если найден или файл нужного языка, или файл по умолчанию, он загружается вместе со всеми <code>@include</code>, и в нем ищется ключ сообщения</p> </li> 
             <li> <p>Если файл не найден, либо нужный ключ в нем отсутствует, производится смена каталога на родительский, и процедура поиска повторяется. И так до достижения корня конфигурационного каталога.</p> </li> 
            </ul> 
           </div> </li> 
          <li> <p>Если в конфигурационном каталоге сообщение не найдено, производится поиск в classpath по такому же алгоритму.</p> </li> 
          <li> <p>Если сообщение найдено, оно кэшируется и возвращается. Если не найдено - кэшируется факт отсутствия сообщения и возвращается ключ, который был передан для поиска. Таким образом, сложная процедура поиска выполняется только один раз, в дальнейшем результат загружается из локального для блока приложения кэша.</p> </li> 
         </ul> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Рекомендуется организовывать пакеты сообщений следующим образом:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p>Если приложение не предполагает интернационализации, то можно не использовать пакеты и включать строки сообщений прямо в код приложения, либо пользоваться файлами по умолчанию <code>messages.properties</code> для отделения ресурсов от кода.</p> </li> 
               <li> <p>Если приложение интернациональное, логично файлы по умолчанию использовать для языка основной аудитории приложения, либо для английского языка. Именно сообщения из файлов по умолчанию будут показаны пользователю, если сообщений для нужного языка не найдено.</p> </li> 
              </ul> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="main_message_pack"><a class="anchor" href="/manual.html#main_message_pack"></a>5.2.10.2. Главный пакет сообщений</h5> 
        <div class="paragraph"> 
         <p>Каждый стандартный <a href="/manual.html#app_tiers">блок</a> приложения определяет для себя один <em>главный</em> пакет сообщений. Для блоков клиентского уровня этот пакет содержит названия пунктов главного меню и общих элементов UI (например, названия кнопок <strong>OK</strong> и <strong>Cancel</strong>). Для всех блоков приложения, включая Middleware, главный пакет определяет форматы преобразований <a href="/manual.html#datatype">Datatype</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Для указания главного пакета сообщений используется свойство приложения <a href="/manual.html#cuba.mainMessagePack">cuba.mainMessagePack</a>. Значением свойства может быть либо один пакет, либо список пакетов, разделенный пробелами. Например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="properties">cuba.mainMessagePack=com.haulmont.cuba.web com.abc.sales.web</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>В данном случае сообщения, заданные во втором пакете списка, будут перекрывать сообщения из первого пакета. Таким образом, в проекте приложения можно переопределять сообщения, заданные в пакетах <a href="/manual.html#app_components">компонентов приложения</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Сообщения, заданные в пакетах базовых проектов CUBA, также можно переопределять в главном пакете сообщений проекта:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="plain">com.haulmont.cuba.gui.backgroundwork/backgroundWorkProgress.timeoutMessage = Новое сообщение об ошибке</code></pre> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="entity_localization"><a class="anchor" href="/manual.html#entity_localization"></a>5.2.10.3. Локализация названий сущностей и атрибутов</h5> 
        <div class="paragraph"> 
         <p>Для отображения в UI локализованных названий сущностей и их атрибутов необходимо создать специальные пакеты сообщений в тех же Java-пакетах, что и сами сущности. Формат файлов сообщений должен быть следующим:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Ключ названия сущности - простое имя класса (без пакета)</p> </li> 
          <li> <p>Ключ названия атрибута - простое имя класса, затем через точку имя атрибута</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Пример русской локализации сущности <code>com.abc.sales.entity.Customer</code> - файл <code>/com/abc/sales/entity/messages_ru.properties</code>:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="plain">Customer=Покупатель
Customer.name=Имя
Customer.email=Email

Order=Заказ
Order.customer=Покупатель
Order.date=Дата
Order.amount=Сумма</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Такие пакеты сообщений, как правило, используются неявно для разработчика, например, визуальными компонентами <a href="/manual.html#gui_Table">Table</a> и <a href="/manual.html#gui_FieldGroup">FieldGroup</a>. Кроме того, названия сущностей и атрибутов могут быть также получены следующими методами:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>программно - методами <a href="/manual.html#messageTools">MessageTools</a> <code>getEntityCaption()</code>, <code>getPropertyCaption()</code></p> </li> 
          <li> <p>в XML-дескрипторе экрана - указанием ссылки на сообщение по правилам <code>MessageTools.loadString</code>: <code>msg://{entity_package}/{key}</code>, например,</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml">caption="msg://com.abc.sales.entity/Customer.name"</code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="enum_localization"><a class="anchor" href="/manual.html#enum_localization"></a>5.2.10.4. Локализация enum</h5> 
        <div class="paragraph"> 
         <p>Для локализации названий и значений перечислений необходимо в пакет сообщений, находящийся в Java-пакете класса перечисления добавить сообщения со следующими ключами:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Ключ названия перечисления - простое имя класса (без пакета)</p> </li> 
          <li> <p>Ключ значения - простое имя класса, затем через точку имя значения</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Например, для перечисления</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.abc.sales</span>;

<span class="directive">public</span> <span class="type">enum</span> CustomerGrade { PREMIUM, HIGH, STANDARD }</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>файл русской локализации <code>/com/abc/sales/messages_ru.properties</code> должен содержать строки:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="plain">CustomerGrade=Уровень покупателя
CustomerGrade.PREMIUM=Премиум
CustomerGrade.HIGH=Высокий
CustomerGrade.STANDARD=Стандартный</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Локализованные значения перечислений автоматически используются различными визуальными компонентами, например, <a href="/manual.html#gui_LookupField">LookupField</a>. Для программного получения локализованного значения перечисления можно использовать метод <code>getMessage()</code> интерфейса <a href="/manual.html#messages">Messages</a>, просто передавая в него экземпляр <code>enum</code>.</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="authentication"><a class="anchor" href="/manual.html#authentication"></a>5.2.11. Аутентификация пользователей</h4> 
       <div class="paragraph"> 
        <p>В данном разделе рассмотрены некоторые аспекты управления доступом с точки зрения разработчика приложения. Для получения полной информации о возможностях и настройке ограничения доступа пользователей к данным см. <a href="/manual.html#security_subsystem">Подсистема безопасности</a>.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="userSession"><a class="anchor" href="/manual.html#userSession"></a>5.2.11.1. UserSession</h5> 
        <div class="paragraph"> 
         <p>Основной элемент подсистемы контроля доступа в CUBA-приложении - пользовательская сессия. Это объект класса <code>UserSession</code>, который ассоциирован с аутентифицированным в данный момент в системе пользователем, и содержит информацию о правах доступа пользователя к данным. Объект текущей сессии может быть получен в любом <a href="/manual.html#app_tiers">блоке</a> приложения через интерфейс инфраструктуры <a href="/manual.html#userSessionSource">UserSessionSource</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Пользовательская сессия создается на Middleware при выполнении метода <code>AuthenticationManager.login()</code> после аутентификации пользователя по переданному имени и паролю. Объект <code>UserSession</code> затем кэшируется в данном блоке Middleware, и возвращается на клиентский уровень. При работе в кластере объект сессии реплицируется на соседние узлы кластера Middleware. Клиентский блок, получив объект сессии, также сохраняет его у себя, так или иначе ассоциируя с активным пользователем (например, в HTTP сессии). Далее все вызовы Middleware для данного пользователя сопровождаются передачей идентификатора сессии (типа <code>UUID</code>), причем прикладному коду не нужно об этом заботиться - идентификатор сессии передается автоматически, независимо от сигнатуры вызываемых методов среднего слоя. Обработка вызовов клиентов на Middleware начинается с извлечения из кэша сессии по полученному идентификатору и установки ее в потоке выполнения. Объект сессии удаляется из кэша при вызове метода <code>LoginService.logout()</code>, либо при истечении времени бездействия, определяемого свойством приложения <a href="/manual.html#cuba.userSessionExpirationTimeoutSec">cuba.userSessionExpirationTimeoutSec</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Таким образом, идентификатор сессии, создаваемой при входе пользователя в систему, служит для аутентификации пользователя при каждом вызове среднего слоя.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Объект <code>UserSession</code> содержит также методы для <em>авторизации</em> текущего пользователя, т.е. проверки его прав на объекты системы: <code>isScreenPermitted()</code>, <code>isEntityOpPermitted()</code>, <code>isEntityAttrPermitted()</code>, <code>isSpecificPermitted()</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>С объектом <code>UserSession</code> могут быть ассоциированы именованные атрибуты произвольного сериализуемого типа. Атрибуты устанавливаются методом <code>setAttribute()</code> и возвращаются методом <code>getAttribute()</code>. Последний может также возвращать следующие параметры сессии, как если бы они были атрибутами:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>userId</code> - ID текущего зарегистрированного или замещенного пользователя;</p> </li> 
          <li> <p><code>userLogin</code> - логин текущего зарегистрированного или <a href="/manual.html#user_substitution">замещенного</a> пользователя в нижнем регистре.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Атрибуты реплицируются в кластере Middleware так же, как и все остальные данные сессии.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="login"><a class="anchor" href="/manual.html#login"></a>5.2.11.2. Вход в систему</h5> 
        <div class="paragraph"> 
         <p>Платформа предоставляет встроенные механизмы аутентификации, функциональность которых может быть расширена в приложениях. Они включают в себя различные схемы аутентификации, такие как вход по паролю, функциональность "Запомнить меня", доверенный и анонимный вход в систему.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Платформа включает следующие механизмы среднего слоя:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>AuthenticationManager</code> реализованный классом <code>AuthenticationManagerBean</code></p> </li> 
          <li> <p>Реализации интерфейса <code>AuthenticationProvider</code></p> </li> 
          <li> <p><code>AuthenticationService</code> реализованный классом <code>AuthenticationServiceBean</code></p> </li> 
          <li> <p><code>UserSessionLog</code> - см. <a href="/manual.html#userSession_log">журналирование пользовательских сессий</a>.</p> </li> 
         </ul> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/MiddlewareAuthenticationStructure.png" alt="MiddlewareAuthenticationStructure"> 
         </div> 
         <div class="title">
          Рисунок 11. Механизмы аутентификации среднего слоя
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Также, платформа включает следующие дополнительные компоненты:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>TrustedClientService</code> реализованный классом <code>TrustedClientServiceBean</code> - предоставляет анонимную/системную сессию для доверенных приложений-клиентов.</p> </li> 
          <li> <p><code>AnonymousSessionHolder</code> - создаёт и хранит анонимную сессю для доверенных приложений-клиентов.</p> </li> 
          <li> <p><code>UserCredentialsChecker</code> - проверяет, могут ли быть использованы переданные <code>Credentials</code>, например, для защиты от атак типа brute-force.</p> </li> 
          <li> <p><code>UserAccessChecker</code> - проверяет, может ли пользователь выполнять вход из данного контекста, например, в REST API или с указанного IP адреса.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Основной интерфейс аутентификации - <code>AuthenticationManager</code>, включающий 4 метода:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AuthenticationManager</span> {

    AuthenticationDetails authenticate(Credentials credentials) <span class="directive">throws</span> <span class="exception">LoginException</span>;

    AuthenticationDetails login(Credentials credentials) <span class="directive">throws</span> <span class="exception">LoginException</span>;

    UserSession substituteUser(User substitutedUser);

    <span class="type">void</span> logout();
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Здесь есть два метода с похожей ответственностью: <code>authentucate()</code> и <code>login()</code>. Оба метода проверяют, являются ли переданные аутентификационные данные валидными и соответствуют ли они активному пользователю системы, затем возвращают объект <code>AuthenticationDetails</code>. Основное отличие в работе этих методов в том, что метод <code>login()</code> активирует сессию пользователя, так что она может использоваться в дальнейшем для вызова сервисов.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Объект <code>Credentials</code> представляет собой набор аутентификационных данных. Платформа поставляет несколько типов аутентификационных данных:</p> 
        </div> 
        <div class="paragraph"> 
         <p>Доступные на всех слоях:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>LoginPasswordCredentials</code></p> </li> 
          <li> <p><code>RememberMeCredentials</code></p> </li> 
          <li> <p><code>TrustedClientCredentials</code></p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Доступные только на среднем слое:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>SystemUserCredentials</code></p> </li> 
          <li> <p><code>AnonymousUserCredentials</code></p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Методы login / authenticate <code>AuthenticationManager</code> возвращают объект <code>AuthenticationDetails</code>, который содержит объект <a href="/manual.html#userSession">UserSession</a>. Этот объект может быть использован для проверки дополнительных разрешений, чтения свойств объекта <strong>User</strong> и атрибутов сессии. В платформе есть встроенная реализация интерфейса <code>AuthenticationDetails</code> - <strong>SimpleAuthenticationDetails</strong>, который хранит только объект сессии пользователя, приложения могут предоставлять свою реализацию <code>AuthenticationDetails</code> с дополнительной инфомацией для приложений-клиентов.</p> 
        </div> 
        <div class="paragraph"> 
         <p><strong>AuthenticationManager</strong> может выполнить метод <strong>authenticate()</strong> с одним из следующих результатов:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>вернуть объект <code>AuthenticationDetails</code> если он подтверждает, что переданные аутентификационные данные верны и соответствуют активному пользователю системы.</p> </li> 
          <li> <p>выбросить <code>LoginException</code> если невозможно аутентифицировать пользователя, неверны аутентификационные данные или если пользователю запрещён доступ к системе.</p> </li> 
          <li> <p>выбросить <code>UnsupportedCredentialsException</code> если переданный тип аутентификационных данных не поддерживается системой.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Реализация <code>AuthenticationManager</code> по умолчанию - <code>AuthenticationManagerBean</code>, который делегирует аутентификацию цепочке экземпляров <code>AuthenticationProvider</code>. <code>AuthenticationProvider</code> - это модуль аутентификации, который может обрабатывать объекты <code>Credentials</code> определённого типа. <code>AuthenticationProvider</code> также имеет специальный метод <code>supports()</code> позволяющий узнать поддерживается ли переданный тип аутентификационных данных.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/LoginProcedure.png" alt="LoginProcedure"> 
         </div> 
         <div class="title">
          Рисунок 12. Стандартный процесс входа пользователя
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Стандартный процесс входа пользователя:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>пользователь вводит свой логин и пароль</p> </li> 
          <li> <p>клиентский блок приложения хэширует пароль, вызывая метод <code>getPlainHash()</code> бина <code>PasswordEncryption</code> и вызывает на Middleware метод <code>LoginService.login()</code>, передавая ему логин пользователя и хэш пароля.</p> </li> 
          <li> <p><code>Connection</code> создаёт объект <code>Credentials</code> и вызывает метод <code>login()</code> сервиса <code>AuthenticationService</code>.</p> </li> 
          <li> <p><code>AuthenticationService</code> делегирует выполнение бину <code>AuthenticationManager</code>, который использует цепочку объектов <code>AuthenticationProvider</code>. В этой цепочке имеется бин <code>LoginPasswordAuthenticationProvider</code>, поддерживающий аутентификационные данные типа <code>LoginPasswordCredentials</code>. Он загружает объект <code>User</code> по полученному логину, хэширует полученный хэш пароля повторно, используя в качестве соли идентификатор пользователя, и сравнивает полученный хэш с сохраненным в БД хэшем пароля. В случае несовпадения выбрасывается исключение <code>LoginException</code>.</p> </li> 
          <li> <p>После успешной аутентификации в созданный экземпляр <a href="/manual.html#userSession">UserSession</a> загружаются все параметры доступа данного пользователя: список ролей, права, ограничения и атрибуты сессии.</p> </li> 
          <li> <p>Если <a href="/manual.html#userSession_log">журналирование пользовательских сессий</a> активировано, в базу данных сохраняется запись с информацией о текущей сессии.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Алгоритм хэширования паролей реализуется бином типа <code>EncryptionModule</code> и задается в свойстве приложения <a href="/manual.html#cuba.passwordEncryptionModule">cuba.passwordEncryptionModule</a>. По умолчанию - SHA-1.</p> 
        </div> 
        <div id="built-in-authentication-providers" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Встроенные провайдеры аутентификации
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Платформа включает следующие реализации интерфейса <code>AuthenticationProvider</code>:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>LoginPasswordAuthenticationProvider</code></p> </li> 
               <li> <p><code>RememberMeAuthenticationProvider</code></p> </li> 
               <li> <p><code>TrustedClientAuthenticationProvider</code></p> </li> 
               <li> <p><code>SystemAuthenticationProvider</code></p> </li> 
               <li> <p><code>AnonymousAuthenticationProvider</code></p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Все реализации загружают пользователя из базы данных, проверяют переданные аутентификационные данные и создают неактивный экземпляр пользовательской сессии при помощи <code>UserSessionManager</code>. Этот экземпляр может стать активным позднее, если вызывается метод <code>AuthenticationManager.login()</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Бины <code>LoginPasswordAuthenticationProvider</code>, <code>RememberMeAuthenticationProvider</code> и <code>TrustedClientAuthenticationProvider</code> используют дополнительные подключаемые проверки: бины, реализующие интерфейс <code>UserAccessChecker</code>. Если по крайней мере одна из таких проверок выбрасывает исключение <code>LoginException</code>, то аутентификация не выполняется и исключение <code>LoginException</code> передаётся вызывающему коду.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Кроме того, <code>LoginPasswordAuthenticationProvider</code> и <code>RememberMeAuthenticationProvider</code> проверяют аутентификационные данные при помощи бинов <strong>UserCredentialsChecker</strong>. Имеется одна встроенная реализация этого интерфейса - <strong>BruteForceUserCredentialsChecker</strong>, который проверяет, пытается ли пользователь подобрать верные аутентификационные данные при помощи атаки brute-force.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="login-exceptions" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Исключения
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p><code>AuthenticationManager</code> и <code>AuthenticationProvider</code> могут выбрасывать исключение <strong>LoginException</strong> или одного из его наследников из методов <code>authenticate()</code> и <code>login()</code>. Исключение <strong>UnsupportedCredentialsException</strong> выбрасывается, если переданный объект аутентификационных данных <code>Credentials</code> не может быть обработан имеющимися <code>AuthenticationProvider</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>См. следующие классы исключений:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>UnsupportedCredentialsException</code></p> </li> 
               <li> <p><code>LoginException</code></p> </li> 
               <li> <p><code>AccountLockedException</code></p> </li> 
               <li> <p><code>UserIpRestrictedException</code></p> </li> 
               <li> <p><code>RestApiAccessDeniedException</code></p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="login-events" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           События
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Стандартная реализация <code>AuthenticationManager</code> - <code>AuthenticationManagerBean</code> публикует следующие <a href="/manual.html#events">события</a> во время аутентификации / входа пользователей:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>BeforeAuthenticationEvent</code> / <code>AfterAuthenticationEvent</code></p> </li> 
               <li> <p><code>BeforeLoginEvent</code> / <code>AfterLoginEvent</code></p> </li> 
               <li> <p><code>AuthenticationSuccessEvent</code> / <code>AuthenticationFailureEvent</code></p> </li> 
               <li> <p><code>UserLoggedInEvent</code> / <code>UserLoggedOutEvent</code></p> </li> 
               <li> <p><code>UserSubstitutedEvent</code></p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Бины Spring на среднем слое приложения могут обрабатывать эти события при помощи механизма подписок <code><code>@EventListener</code></code>:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoginEventListener</span> {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">Logger</span> log;

    <span class="annotation">@EventListener</span>
    <span class="directive">private</span> <span class="type">void</span> onUserLoggedIn(UserLoggedInEvent event) {
        User user = event.getSource().getUser();
        log.info(<span class="string"><span class="delimiter">"</span><span class="content">Logged in user {}</span><span class="delimiter">"</span></span>, user.getInstanceName());
    }
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Обработчики всех событий, перечисленных выше (кроме <code>AfterLoginEvent</code>, <code>UserSubstitutedEvent</code> и <code>UserLoggedInEvent</code>), могут выбросить <code>LoginException</code>, чтобы прервать процесс аутентификации / входа пользователя.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Например, мы можем реализовать механизм режима обслуживания системы, который позволит запретить вход в систему на время её обслуживания.</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MaintenanceModeValve</span> {
    <span class="directive">private</span> <span class="directive">volatile</span> <span class="type">boolean</span> maintenance = <span class="predefined-constant">true</span>;

    <span class="directive">public</span> <span class="type">boolean</span> isMaintenance() {
        <span class="keyword">return</span> maintenance;
    }

    <span class="directive">public</span> <span class="type">void</span> setMaintenance(<span class="type">boolean</span> maintenance) {
        <span class="local-variable">this</span>.maintenance = maintenance;
    }

    <span class="annotation">@EventListener</span>
    <span class="directive">private</span> <span class="type">void</span> onBeforeLogin(BeforeLoginEvent event) <span class="directive">throws</span> <span class="exception">LoginException</span> {
        <span class="keyword">if</span> (maintenance &amp;&amp; event.getCredentials() <span class="keyword">instanceof</span> AbstractClientCredentials) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">LoginException</span>(<span class="string"><span class="delimiter">"</span><span class="content">Sorry, system is unavailable</span><span class="delimiter">"</span></span>);
        }
    }
}</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="login-extension-points" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Точки расширения
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Вы можете расширить механизм аутентификации, используя следующие точки расширения:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>AuthenticationService</code> - заменить существующий <code>AuthenticationServiceBean</code>.</p> </li> 
               <li> <p><code>AuthenticationManager</code> - заменить существующий <code>AuthenticationManagerBean</code>.</p> </li> 
               <li> <p><code>AuthenticationProvider</code> - реализовать новый или заменить существующий бин <code>AuthenticationProvider</code>.</p> </li> 
               <li> <p>Events - реализовать обработчик одного из доступных событий.</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Вы можете заменить существующие бины, задействуя механизмы Spring Framework, например, зарегистрировав новую реализацию в XML конфигурации Spring модуля <strong>core</strong>:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">cuba_LoginPasswordAuthenticationProvider</span><span class="delimiter">"</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.authext.core.CustomLoginPasswordAuthenticationProvider</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
              </div> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomLoginPasswordAuthenticationProvider</span> <span class="directive">extends</span> LoginPasswordAuthenticationProvider {
    <span class="annotation">@Inject</span>
    <span class="directive">public</span> CustomLoginPasswordAuthenticationProvider(Persistence persistence, Messages messages) {
        <span class="local-variable">super</span>(persistence, messages);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> AuthenticationDetails authenticate(Credentials credentials) <span class="directive">throws</span> <span class="exception">LoginException</span> {
        LoginPasswordCredentials loginPassword = (LoginPasswordCredentials) credentials;
        <span class="comment">// for instance, add new check before login</span>
        <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">demo</span><span class="delimiter">"</span></span>.equals(loginPassword.getLogin())) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">LoginException</span>(<span class="string"><span class="delimiter">"</span><span class="content">Demo account is disabled</span><span class="delimiter">"</span></span>);
        }

        <span class="keyword">return</span> <span class="local-variable">super</span>.authenticate(credentials);
    }
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Обработчики событий могут быть упорядочены при помощи аннотации <code>@Order</code>. Все бины и обработчики событий платформы используют значение <code>order</code> из диапазона 100 и 1000, что позволяет добавлять обработчики на уровне проект как до, так и после кода платформы. Если вы хотите добавить свой обработчик до обработчиков/бинов платформы - используйте значение меньше 100.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Задание <code>order</code> для обработчика события:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DemoEventListener</span> {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">Logger</span> log;

    <span class="annotation">@Order</span>(<span class="integer">10</span>)
    <span class="annotation">@EventListener</span>
    <span class="directive">private</span> <span class="type">void</span> onUserLoggedIn(UserLoggedInEvent event) {
        log.info(<span class="string"><span class="delimiter">"</span><span class="content">Demo</span><span class="delimiter">"</span></span>);
    }
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Бины <code>AuthenticationProvider</code> могут реализовать интерфейс <strong>Ordered</strong> и метод <code>getOrder()</code> для определения очерёдности исполнения.</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DemoAuthenticationProvider</span> <span class="directive">extends</span> AbstractAuthenticationProvider
        <span class="directive">implements</span> AuthenticationProvider, Ordered {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> UserSessionManager userSessionManager;

    <span class="annotation">@Inject</span>
    <span class="directive">public</span> DemoAuthenticationProvider(Persistence persistence, Messages messages) {
        <span class="local-variable">super</span>(persistence, messages);
    }

    <span class="annotation">@Nullable</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> AuthenticationDetails authenticate(Credentials credentials) <span class="directive">throws</span> <span class="exception">LoginException</span> {
        <span class="comment">// ...</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> supports(<span class="predefined-type">Class</span>&lt;?&gt; credentialsClass) {
        <span class="keyword">return</span> LoginPasswordCredentials.class.isAssignableFrom(credentialsClass);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getOrder() {
        <span class="keyword">return</span> <span class="integer">10</span>;
    }
}</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="login-additional-features" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Дополнительные возможности
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="ulist"> 
              <ul> 
               <li> <p>В платформе имеется механизм защиты от взлома пароля методом перебора. Для его включения необходимо установить свойство приложения <a href="/manual.html#cuba.bruteForceProtection.enabled">cuba.bruteForceProtection.enabled</a> для блока Middleware. В этом случае после определенного количества неуспешных попыток входа для определенного имени пользователя с определенного IP-адреса вход для пары логин + IP-адрес блокируется на некоторое время. Допустимое количество попыток входа для пары логин + IP-адрес определяется свойством приложения <a href="/manual.html#cuba.bruteForceProtection.maxLoginAttemptsNumber">cuba.bruteForceProtection.maxLoginAttemptsNumber</a> (по умолчанию 5). Интервал блокировки пользователя в секундах задается свойством <a href="/manual.html#cuba.bruteForceProtection.blockIntervalSec">cuba.bruteForceProtection.blockIntervalSec</a> (по умолчанию 60).</p> </li> 
               <li> <p>Возможен вариант, когда пароль пользователя (точнее, хэш пароля) не хранится в базе данных, а проверяется внешними средствами, например, путем интеграции с <strong>ActiveDirectory</strong>. В этом случае фактически аутентификацию выполняет клиентский блок, а Middleware "доверяет" клиенту, создавая сессию по одному только логину пользователя без пароля методом <code>LoginService.loginTrusted()</code>. Метод <code>loginTrusted()</code> требует выполнения следующих условия:</p> 
                <div class="ulist"> 
                 <ul> 
                  <li> <p>клиентский блок должен передать так называемый доверенный пароль, задаваемый на Middleware и на клиентском блоке свойством приложения <a href="/manual.html#cuba.trustedClientPassword">cuba.trustedClientPassword</a></p> </li> 
                  <li> <p>IP-адрес клиентского блока должен быть в списке, задаваемой свойством приложения <a href="/manual.html#cuba.trustedClientPermittedIpList">cuba.trustedClientPermittedIpList</a></p> </li> 
                 </ul> 
                </div> </li> 
               <li> <p>Вход в систему требуется также для автоматических процессов, запускаемых по расписанию, а также при подключении к бинам Middleware через JMX-интерфейс. Строго говоря, такие действия считаются административными и не требуют аутентификации до тех пор, пока не выполняется каких-либо изменений сущностей в базе данных. При записи сущностей в БД требуется проставить логин пользователя, который выполнил изменения, поэтому для работы таких процессов должен быть указан пользователь, от лица которого выполняются изменения.</p> 
                <div class="paragraph"> 
                 <p>Дополнительным плюсом входа в систему для автоматического процесса и для JMX-вызова является то, что вывод в журнал сообщений от логгеров сопровождается указанием логина текущего пользователя, если пользовательская сессия установлена в потоке выполнения. Это упрощает поиск сообщений от конкретного процесса при разборе журнала.</p> 
                </div> 
                <div class="paragraph"> 
                 <p>Вход в систему для процессов внутри Middleware выполняется вызовом <code>AuthenticationManager.loginSystem()</code> с передачей объекта <code>SystemUserCredentials</code> , содержащего логин пользователя (без пароля), от имени которого будет работать данный процесс. В результате создается объект <a href="/manual.html#userSession">UserSession</a>, который будет закэширован в данном блоке Middleware и не будет реплицироваться в кластере.</p> 
                </div> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Более подробно аутентификация процессов внутри Middleware рассмотрена в разделе <a href="/manual.html#system_authentication">Системная аутентификация</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="login-obsolete" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Устаревшие механизмы
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Следующие компоненты считаются устаревшими:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>LoginService</code> делегирует исполнение методов сервису <code>AuthenticationService</code></p> </li> 
               <li> <p><code>LoginWorker</code> делегирует исполнение методов бину <code>AuthenticationManager</code></p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Не используйте эти компоненты в коде приложений. Они будут удалены в одной из следующих версий платформы.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="securityContext"><a class="anchor" href="/manual.html#securityContext"></a>5.2.11.3. SecurityContext</h5> 
        <div class="paragraph"> 
         <p>Экземпляр класса <code>SecurityContext</code> хранит информацию о пользовательской сессии для текущего потока выполнения. Он создается и передается в метод <code>AppContext.setSecurityContext()</code> в следующие моменты:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>для блоков Web Client и Web Portal - в начале обработки каждого HTTP-запроса от пользовательского браузера.</p> </li> 
          <li> <p>для блока Middleware - в начале обработки каждого запроса от клиентского уровня и от <a href="/manual.html#scheduled_tasks_cuba">назначенных заданий CUBA</a>.</p> </li> 
          <li> <p>для блока Desktop Client - один раз после входа пользователя, так как десктопное приложение является однопользовательским.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>По окончании выполнения запроса в первых двух случаях <code>SecurityContext</code> удаляется из потока выполнения.</p> 
        </div> 
        <div class="paragraph"> 
         <p>При создании прикладным кодом нового потока выполнения в него необходимо передать текущий экземпляр <code>SecurityContext</code>, например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> SecurityContext securityContext = AppContext.getSecurityContext();
executor.submit(<span class="keyword">new</span> <span class="predefined-type">Runnable</span>() {
    <span class="directive">public</span> <span class="type">void</span> run() {
        AppContext.setSecurityContext(securityContext);
        <span class="comment">// business logic here</span>
    }
});</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>То же самое можно сделать, используя обертки <code>SecurityContextAwareRunnable</code> или <code>SecurityContextAwareCallable</code>, например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java">executor.submit(<span class="keyword">new</span> SecurityContextAwareRunnable&lt;&gt;(() -&gt; {
     <span class="comment">// business logic here</span>
}));</code></pre> 
         </div> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; future = executor.submit(<span class="keyword">new</span> SecurityContextAwareCallable&lt;&gt;(() -&gt; {
    <span class="comment">// business logic here</span>
    <span class="keyword">return</span> some_string;
}));</code></pre> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="exception_handling"><a class="anchor" href="/manual.html#exception_handling"></a>5.2.12. Обработка исключений</h4> 
       <div class="paragraph"> 
        <p>В данном разделе рассмотрены различные аспекты генерации и обработки исключений в CUBA-приложениях.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="exception_classes"><a class="anchor" href="/manual.html#exception_classes"></a>5.2.12.1. Классы исключений</h5> 
        <div class="paragraph"> 
         <p>При создании собственных классов исключений следует придерживаться следующих правил:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Если исключение является нормальной частью бизнес-логики и при его возникновении требуется предпринимать некоторые нетривиальные действия, то класс исключения следует делать декларируемым (наследником <code>Exception</code>). Обработка таких исключений производится вызывающим кодом.</p> </li> 
          <li> <p>Если исключение сигнализирует об ошибочной ситуации, и реакцией на него должно быть прерывание хода выполнения и простое действие типа отображения информации об ошибке пользователю, то класс исключения следует делать недекларируемым (наследником <code>RuntimeException</code>). Обработка таких исключений производится специальными классами-обработчиками, зарегистрированными в клиентских блоках приложения.</p> </li> 
          <li> <p>Если исключение выбрасывается и обрабатывается в рамках одного <a href="/manual.html#app_tiers">блока</a> приложения, то класс исключения следует объявлять в соответствующем <a href="/manual.html#app_modules">модуле</a>. Если же исключение выбрасывается на Middleware, а обрабатывается на клиентском уровне, то класс исключения необходимо объявлять в модуле <strong>global</strong>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Платформа содержит специальный класс недекларируемого исключения <code>SilentException</code>, который можно использовать для прерывания хода выполнения без выдачи каких-либо сообщений пользователю или в лог. <code>SilentException</code> объявлен в модуле <strong>global</strong>, поэтому доступен как на Middleware, так и в клиентских блоках.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="remoteException"><a class="anchor" href="/manual.html#remoteException"></a>5.2.12.2. Передача исключений Middleware</h5> 
        <div class="paragraph"> 
         <p>Если при выполнении запроса от клиента на Middleware возникает исключение, выполнение прерывается и на клиента возвращается объект исключения, как правило, включающий цепочку порождающих друг друга исключений. Так как цепочка исключений может содержать классы, недоступные клиентскому блоку (например, исключения JDBC-драйвера), на клиента передается не сама эта цепочка, а ее представление внутри специального создаваемого исключения <code>RemoteException</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Информация об исключениях-причинах сохраняется в виде списка объектов <code>RemoteException.Cause</code>. Каждый объект <code>Cause</code> хранит обязательно имя класса исключения и его сообщение. Кроме того, если класс исключения "поддерживается клиентом", то <code>Cause</code> содержит также и сам объект исключения. Это дает возможность передать на клиента информацию в полях исключения.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Класс исключения, объекты которого нужно передавать на клиентский уровень именно в виде Java-объектов, нужно аннотировать <code>@SupportedByClient</code>, например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SupportedByClient</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WorkflowException</span> <span class="directive">extends</span> <span class="exception">RuntimeException</span> {
...</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Таким образом, при возникновении на Middleware исключения, не аннотированного <code>@SupportedByClient</code>, вызывающий клиентский код получит <code>RemoteException</code>, внутри которого будет находиться исходное исключение в виде строки. Если же исходное исключение аннотировано <code>@SupportedByClient</code>, то вызывающий код получит именно его. Это дает возможность в прикладном коде организовывать обработку декларируемых <a href="/manual.html#services">сервисами</a> Middleware исключений традиционным образом - с помощью блоков try/catch.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Следует иметь в виду, что чтобы поддерживаемое клиентом исключение было действительно передано на клиента в виде объекта, оно не должно содержать внутри себя в цепочке <code>getCause()</code> неподдерживаемых исключений. Поэтому если вы создаете на Middleware экземпляр исключения и хотите передать его на клиента, указывайте для него параметр <code>cause</code> только если вы уверены, что он содержит только исключения, известные клиенту.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Упаковку объектов исключений в <code>RemoteException</code> перед передачей на клиентский уровень выполняет перехватчик вызовов <a href="/manual.html#services">сервисов</a> - класс <code>ServiceInterceptor</code>. Кроме того, он же выполняет логирование исключений. По умолчанию в журнал выводится вся информация об исключении, включая полный stack trace. Если это нежелательно, можно добавить классу исключения аннотацию <code>@Logging</code>, указав в ней тип логирования:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>FULL</code> - (по умолчанию) полная информация, включая stacktrace</p> </li> 
          <li> <p><code>BRIEF</code> - только имя класса исключения и сообщение</p> </li> 
          <li> <p><code>NONE</code> - не выводить ничего</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SupportedByClient</span>
<span class="annotation">@Logging</span>(Logging.Type.BRIEF)
<span class="directive">public</span> <span class="type">class</span> <span class="class">FinancialTransactionException</span> <span class="directive">extends</span> <span class="exception">Exception</span> {
...</code></pre> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="exceptionHandlers"><a class="anchor" href="/manual.html#exceptionHandlers"></a>5.2.12.3. Обработчики исключений клиентского уровня</h5> 
        <div class="paragraph"> 
         <p>Необработанные исключения в <a href="/manual.html#app_tiers">блоках</a> Web Client и Desktop Client, возникшие на клиентском уровне или переданные с Middleware, попадают в специальный механизм обработчиков. Этот механизм реализован в <a href="/manual.html#app_modules">модуле</a> GUI и доступен обоим клиентам.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Обработчик должен быть <a href="/manual.html#managed_beans">управляемым бином</a>, реализовывать интерфейс <code>GenericExceptionHandler</code>, в методе <code>handle()</code> которого производить обработку и возвращать <code>true</code>, либо сразу возвращать <code>false</code>, если данный обработчик не может обработать переданное ему исключение. Такое поведение позволяет организовать "цепочку ответственности" обработчиков.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Рекомендуется наследовать классы своих обработчиков от базового класса <code>AbstractGenericExceptionHandler</code>, который умеет разбирать цепочку исключений (с учетом упакованных внутри <code>RemoteException</code>) и реагировать на конкретные типы исключений. Типы исключений, для которых предназначен данный обработчик, указываются в массиве строк, передаваемом в конструкторе обработчика базовому конструктору. Каждая строка массива должна содержать одно полное имя класса обрабатываемого исключения, например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>(<span class="string"><span class="delimiter">"</span><span class="content">cuba_EntityAccessExceptionHandler</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EntityAccessExceptionHandler</span> <span class="directive">extends</span> AbstractGenericExceptionHandler {

    <span class="directive">public</span> EntityAccessExceptionHandler() {
        <span class="local-variable">super</span>(EntityAccessException.class.getName());
    }
...</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Если класс исключения недоступен на клиенте, следует указывать его имя строковым литералом:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>(<span class="string"><span class="delimiter">"</span><span class="content">cuba_OptimisticExceptionHandler</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OptimisticExceptionHandler</span> <span class="directive">extends</span> AbstractGenericExceptionHandler <span class="directive">implements</span> Ordered {

    <span class="directive">public</span> OptimisticExceptionHandler() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">"</span><span class="content">javax.persistence.OptimisticLockException</span><span class="delimiter">"</span></span>);
    }
...</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>В случае использования в качестве базового класса <code>AbstractGenericExceptionHandler</code> логика обработки располагается в методе <code>doHandle()</code>, и может выглядеть следующим образом:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> doHandle(<span class="predefined-type">String</span> className, <span class="predefined-type">String</span> message, <span class="annotation">@Nullable</span> <span class="predefined-type">Throwable</span> throwable, WindowManager windowManager) {
    <span class="predefined-type">String</span> msg = messages.getMainMessage(<span class="string"><span class="delimiter">"</span><span class="content">zeroBalance.message</span><span class="delimiter">"</span></span>);
    windowManager.showNotification(msg, IFrame.NotificationType.ERROR);
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Если имени класса исключения недостаточно для того, чтобы принять решение о применимости данного обработчика к исключению, следует определить метод <code>canHandle()</code>, получающий кроме прочего текст исключения. Метод должен вернуть <code>true</code>, если данный обработчик применим для исключения. Например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>(<span class="string"><span class="delimiter">"</span><span class="content">cuba_NumericOverflowExceptionHandler</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">NumericOverflowExceptionHandler</span> <span class="directive">extends</span> AbstractGenericExceptionHandler {

    <span class="directive">public</span> NumericOverflowExceptionHandler() {
        <span class="local-variable">super</span>(EclipseLinkException.class.getName());
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">boolean</span> canHandle(<span class="predefined-type">String</span> className, <span class="predefined-type">String</span> message, <span class="annotation">@Nullable</span> <span class="predefined-type">Throwable</span> throwable) {
        <span class="keyword">return</span> StringUtils.containsIgnoreCase(message, <span class="string"><span class="delimiter">"</span><span class="content">Numeric field overflow</span><span class="delimiter">"</span></span>);
    }
...</code></pre> 
         </div> 
        </div> 
        <div id="dialogs_showExceptionDialog" class="paragraph"> 
         <p><code>WindowManager</code> предоставляет метод <code>showExceptionDialog()</code> для отображения диалогового окна с выброшенным исключением и его stacktrace. Метод принимает следующие параметры:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>throwable</code> - экземпляр <code>Throwable</code>.</p> </li> 
          <li> <p><code>caption</code> - заголовок диалога. Это необязательный параметр, если он не установлен, используется заголовок по умолчанию.</p> </li> 
          <li> <p><code>message</code> - сообщение диалога. Это необязательный параметр, если он не установлен, используется сообщение по умолчанию.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Пример вызова диалога в обработчике исключения:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> doHandle(<span class="predefined-type">String</span> className, <span class="predefined-type">String</span> message, <span class="annotation">@Nullable</span> <span class="predefined-type">Throwable</span> throwable, WindowManager windowManager) {
    <span class="keyword">if</span> (throwable != <span class="predefined-constant">null</span>)
        windowManager.showExceptionDialog(throwable, <span class="string"><span class="delimiter">"</span><span class="content">Exception is thrown</span><span class="delimiter">"</span></span>, message);
    <span class="keyword">else</span>
        windowManager.showNotification(message, IFrame.NotificationType.ERROR);
}</code></pre> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="bean_validation"><a class="anchor" href="/manual.html#bean_validation"></a>5.2.13. Bean Validation</h4> 
       <div class="paragraph"> 
        <p>Bean Validation - опциональный механизм, обеспечивающий единообразную валидацию данных на среднем слое, в <a href="/manual.html#gui_framework">Generic UI</a> и в <a href="/manual.html#rest_api_v2">REST API</a>. Он основан на спецификации JSR 349 - Bean Validation 1.1 и ее референсной имплементации: <a href="https://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/?v=5.3" target="_blank">Hibernate Validator</a>.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="bean_validation_constraints"><a class="anchor" href="/manual.html#bean_validation_constraints"></a>5.2.13.1. Задание ограничений</h5> 
        <div class="paragraph"> 
         <p>Ограничения bean validation задаются с помощью аннотаций пакета <code>javax.validation.constraints</code> или собственных аннотаций. Аннотации указываются на декларации класса сущности или POJO, на поле или getter-методе, а также на методе <a href="/manual.html#services">сервиса</a> middleware.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Пример использования стандартных аннотаций валидации на полях сущности:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DEMO_CUSTOMER</span><span class="delimiter">"</span></span>)
<span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">demo$Customer</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Customer</span> <span class="directive">extends</span> StandardEntity {

    <span class="annotation">@Size</span>(min = <span class="integer">3</span>) <span class="comment">// length of value must be longer then 3 characters</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">NAME</span><span class="delimiter">"</span></span>, nullable = <span class="predefined-constant">false</span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> name;

    <span class="annotation">@Min</span>(<span class="integer">1</span>) <span class="comment">// minimum value</span>
    <span class="annotation">@Max</span>(<span class="integer">5</span>) <span class="comment">// maximum value</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">GRADE</span><span class="delimiter">"</span></span>, nullable = <span class="predefined-constant">false</span>)
    <span class="directive">protected</span> <span class="predefined-type">Integer</span> grade;

    <span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">"</span><span class="char">\\</span><span class="content">S+@</span><span class="char">\\</span><span class="content">S+</span><span class="delimiter">"</span></span>) <span class="comment">// value must conform to the pattern</span>
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">EMAIL</span><span class="delimiter">"</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">String</span> email;

    <span class="comment">//...</span>
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Пример использования собственной аннотации уровня класса (см. <a href="/manual.html#bean_validation_custom_constraints">ниже</a>):</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CheckTaskFeasibility</span>(groups = {Default.class, UiCrossFieldChecks.class}) <span class="comment">// custom validation annotation</span>
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DEMO_TASK</span><span class="delimiter">"</span></span>)
<span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">demo$Task</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Task</span> <span class="directive">extends</span> StandardEntity {
    <span class="comment">//...</span>
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Пример валидации параметров и возвращаемого значения метода сервиса:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TaskService</span> {
    <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">"</span><span class="content">demo_TaskService</span><span class="delimiter">"</span></span>;

    <span class="annotation">@Validated</span> <span class="comment">// indicates that the method should be validated</span>
    <span class="annotation">@NotNull</span>
    <span class="predefined-type">String</span> completeTask(<span class="annotation">@Size</span>(min = <span class="integer">5</span>) <span class="predefined-type">String</span> comment, <span class="annotation">@NotNull</span> Task task);
}</code></pre> 
         </div> 
        </div> 
        <div id="bean_validation_constraint_groups" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Группы ограничений
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Группы ограничений позволяют применять подмножество всех заданных ограничений в зависисмости от логики приложения. Например, вы можете заставить пользователя ввести значение некоторого атрибута сущности в UI, и а то же время иметь возможность установить данный атрибут в null в некотором внутреннем механизме. Для этого необходимо указать атрибут <code>groups</code> в аннотации ограничения, и оно будет действовать только когда эта же группа передается в механизм валидации.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Платформа передает в механизм валидации следующие группы ограничений:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>RestApiChecks</code> - при валидации в <a href="/manual.html#rest_api_v2">REST API</a>.</p> </li> 
               <li> <p><code>ServiceParametersChecks</code> - при валидации параметров сервисов.</p> </li> 
               <li> <p><code>ServiceResultChecks</code> - при валидации возвращаемых значений сервисов.</p> </li> 
               <li> <p><code>UiComponentChecks</code> - при валидации отдельных полей в UI.</p> </li> 
               <li> <p><code>UiCrossFieldChecks</code> - при валидации ограничений уровня класса на коммите экрана редактора сущности.</p> </li> 
               <li> <p><code>javax.validation.groups.Default</code> - данная группа передается во всех случаях кроме коммита экрана редактора сущности.</p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="bean_validation_messages" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Сообщения валидации
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Ограничения могут иметь сообщения для отображения пользователям.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Сообщения могут быть указаны непосредственно в аннотациях валидации, например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">"</span><span class="char">\\</span><span class="content">S+@</span><span class="char">\\</span><span class="content">S+</span><span class="delimiter">"</span></span>, message = <span class="string"><span class="delimiter">"</span><span class="content">Invalid format</span><span class="delimiter">"</span></span>)
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">EMAIL</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">String</span> email;</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Сообщения можно также поместить в <a href="/manual.html#message_packs">пакет локализованных сообщений</a> и использовать следующий формат указания сообщения в аннотации: <code>{msg://message_pack/message_key}</code>. Например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">"</span><span class="char">\\</span><span class="content">S+@</span><span class="char">\\</span><span class="content">S+</span><span class="delimiter">"</span></span>, message = <span class="string"><span class="delimiter">"</span><span class="content">{msg://com.company.demo.entity/Customer.email.validationMsg}</span><span class="delimiter">"</span></span>)
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">EMAIL</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">String</span> email;</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Сообщения могут содержать параметры и выражения. Параметры заключаются в фигурные скобки <code>{}</code> и представляют собой либо указатели на локализованные сообщения (см. выше) или параметры аннотации, например <code>{min}</code>, <code>{max}</code>, <code>{value}</code>. Выражения заключаются в фигурные скобки со знаком доллара <code>${}</code> и могут включать валидируемое значение в виде переменной <code>validatedValue</code>, параметры аннотации типа <code>value</code> или <code>min</code>, и выражения JSR-341 (EL 3.0). Например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">"</span><span class="char">\\</span><span class="content">S+@</span><span class="char">\\</span><span class="content">S+</span><span class="delimiter">"</span></span>, message = <span class="string"><span class="delimiter">"</span><span class="content">Invalid email: ${validatedValue}, pattern: {regexp}</span><span class="delimiter">"</span></span>)
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">EMAIL</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> <span class="predefined-type">String</span> email;</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Значения локализованных сообщений также могут содержать параметры и выражения.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="bean_validation_custom_constraints" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Собственные ограничения
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>В проекте можно создать собственные ограничения с программной или декларативной валидацией.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Для создания ограничения с программной валидацией выполниет следующее:</p> 
             </div> 
             <div class="olist arabic"> 
              <ol class="arabic"> 
               <li> <p>Создайте аннотацию в модуле <strong>global</strong> проекта и добавьте ей аннотацию <code>@Constraint</code>. Ваша аннотация должна содержать атрибуты <code>message</code>, <code>groups</code> и <code>payload</code>:</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Target</span>({ <span class="predefined-type">ElementType</span>.TYPE })
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Constraint</span>(validatedBy = TaskFeasibilityValidator.class)
<span class="directive">public</span> <span class="annotation">@interface</span> CheckTaskFeasibility {

    <span class="predefined-type">String</span> message() <span class="keyword">default</span> <span class="string"><span class="delimiter">"</span><span class="content">{msg://com.company.demo.entity/CheckTaskFeasibility.message}</span><span class="delimiter">"</span></span>;

    <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> groups() <span class="keyword">default</span> {};

    <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Payload&gt;<span class="type">[]</span> payload() <span class="keyword">default</span> {};
}</code></pre> 
                 </div> 
                </div> </li> 
               <li> <p>Создайте класс валидатора в модуле <strong>global</strong> проекта:</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TaskFeasibilityValidator</span> <span class="directive">implements</span> ConstraintValidator&lt;CheckTaskFeasibility, Task&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(CheckTaskFeasibility constraintAnnotation) {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> isValid(Task value, ConstraintValidatorContext context) {
        <span class="predefined-type">Date</span> now = AppBeans.get(TimeSource.class).currentTimestamp();
        <span class="keyword">return</span> !(value.getDueDate().before(DateUtils.addDays(now, <span class="integer">3</span>)) &amp;&amp; value.getProgress() &lt; <span class="integer">90</span>);
    }
}</code></pre> 
                 </div> 
                </div> </li> 
               <li> <p>Используйте аннотацию:</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CheckTaskFeasibility</span>(groups = UiCrossFieldChecks.class)
<span class="annotation">@Table</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DEMO_TASK</span><span class="delimiter">"</span></span>)
<span class="annotation">@Entity</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">demo$Task</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Task</span> <span class="directive">extends</span> StandardEntity {

    <span class="annotation">@Future</span>
    <span class="annotation">@Temporal</span>(TemporalType.DATE)
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">DUE_DATE</span><span class="delimiter">"</span></span>)
    <span class="directive">protected</span> <span class="predefined-type">Date</span> dueDate;

    <span class="annotation">@Min</span>(<span class="integer">0</span>)
    <span class="annotation">@Max</span>(<span class="integer">100</span>)
    <span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">PROGRESS</span><span class="delimiter">"</span></span>, nullable = <span class="predefined-constant">false</span>)
    <span class="directive">protected</span> <span class="predefined-type">Integer</span> progress;

    <span class="comment">//...</span>
}</code></pre> 
                 </div> 
                </div> </li> 
              </ol> 
             </div> 
             <div class="paragraph"> 
              <p>Собственные аннотации могут также быть созданы как композиции имеющихся, например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotNull</span>
<span class="annotation">@Size</span>(min = <span class="integer">2</span>, max = <span class="integer">14</span>)
<span class="annotation">@Pattern</span>(regexp = <span class="string"><span class="delimiter">"</span><span class="char">\\</span><span class="content">d+</span><span class="delimiter">"</span></span>)
<span class="annotation">@Target</span>({METHOD, FIELD, ANNOTATION_TYPE})
<span class="annotation">@Retention</span>(RUNTIME)
<span class="annotation">@Constraint</span>(validatedBy = {})
<span class="directive">public</span> <span class="annotation">@interface</span> ValidProductCode {
    <span class="predefined-type">String</span> message() <span class="keyword">default</span> <span class="string"><span class="delimiter">"</span><span class="content">{msg://om.company.demo.entity/ValidProductCode.message}</span><span class="delimiter">"</span></span>;

    <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> groups() <span class="keyword">default</span> {};

    <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Payload&gt;<span class="type">[]</span> payload() <span class="keyword">default</span> {};
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>При использовании композитных ограничений результирующий набор нарушений <code>ConstraintViolation</code> будет содержать отдельные записи для каждого включенного ограничения. Для того, чтобы получить одну запись нарушения, добавьте <code>@ReportAsSingleViolation</code> классу вашей аннотации.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="bean_validation_related_objects" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Валидация связанных объектов
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Для каскадной валидации связанных объектов на ссылочные поля необходимо добавить аннотацию <code>@Valid</code>:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Cart</span> {

    <span class="annotation">@Size</span>(min = <span class="integer">1</span>)
    <span class="annotation">@Valid</span>
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Product&gt; products;

    <span class="comment">// ...</span>
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>В примере выше, при валидации экземпляра <code>Cart</code> список продуктов будет проверен на наличие хотя-бы одной записи, и все экземпляры <code>Product</code> в списке будут также провалидированы.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="bean_validation_cuba_annotations" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Аннотации валидации, заданные в CUBA
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Кроме стандартных аннотаций из пакета <code>javax.validation.constraints</code> можно использовать следующую аннотацию, определенную в платформе:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>@RequiredView</code> - может быть добавлена на методы сервисов для того, чтобы во время выполнения убедиться, что в сущностях загружены все атрибуты, заданные в требуемых <a href="/manual.html#views">представлениях</a>. Если аннотация задана на методе, то проверяется результат метода. Если аннотация задана на параметре, проверяется этот параметр. Если параметр или результат являются коллекцией, то проверяются все элементы этой коллекции. Пример использования:</p> </li> 
              </ul> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MyService</span> {
    <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">"</span><span class="content">sample_MyService</span><span class="delimiter">"</span></span>;

    <span class="annotation">@Validated</span>
    <span class="type">void</span> processFoo(<span class="annotation">@RequiredView</span>(<span class="string"><span class="delimiter">"</span><span class="content">foo-view</span><span class="delimiter">"</span></span>) Foo foo);

    <span class="annotation">@Validated</span>
    <span class="type">void</span> processFooList(<span class="annotation">@RequiredView</span>(<span class="string"><span class="delimiter">"</span><span class="content">foo-view</span><span class="delimiter">"</span></span>) <span class="predefined-type">List</span>&lt;Foo&gt; fooList);

    <span class="annotation">@Validated</span>
    <span class="annotation">@RequiredView</span>(<span class="string"><span class="delimiter">"</span><span class="content">bar-view</span><span class="delimiter">"</span></span>)
    Bar loadBar(<span class="annotation">@RequiredView</span>(<span class="string"><span class="delimiter">"</span><span class="content">foo-view</span><span class="delimiter">"</span></span>) Foo foo);
}</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="bean_validation_running"><a class="anchor" href="/manual.html#bean_validation_running"></a>5.2.13.2. Запуск валидации</h5> 
        <div id="bean_validation_in_ui" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Валидация в UI
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Компоненты Generic UI, соединенные с источником данных, получают экземпляр <code>BeanValidator</code> для проверки значения. Валидатор вызывается из метода <code>Component.Validatable.validate()</code>, реализуемого компонентом, и может выбрасывать исключение <code>CompositeValidationException</code>, содержащее набор объектов нарушений.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Стандартный валидатор может быть программно удален или проинициализирован другой <a href="/manual.html#bean_validation_constraint_groups">группой ограничений</a>:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Screen</span> <span class="directive">extends</span> AbstractWindow {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">TextField</span> field1;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">TextField</span> field2;

    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        <span class="comment">// Completely remove bean validation from the UI component</span>
        field1.getValidators().stream()
                .filter(validator -&gt; validator <span class="keyword">instanceof</span> BeanValidator)
                .forEach(textField::removeValidator);

        <span class="comment">// Here validators will check only constraints with explicitly set UiComponentChecks group, because</span>
        <span class="comment">// the Default group will not be passed</span>
        field2.getValidators().stream()
                .filter(validator -&gt; validator <span class="keyword">instanceof</span> BeanValidator)
                .forEach(validator -&gt; {
                    ((BeanValidator) validator).setValidationGroups(<span class="keyword">new</span> <span class="predefined-type">Class</span><span class="type">[]</span> {UiComponentChecks.class});
                });
    }
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>По умолчанию, <code>BeanValidator</code> содержит две группы: <code>Default</code> и <code>UiComponentChecks</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Если атрибут сущности аннотирован <code>@NotNull</code> без группы ограничений, он будет помечен как обязательный в метаданных, и UI-компоненты работающие с данным атрибутом через источник данных, будут иметь свойство <code>required = true</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Компоненты <a href="/manual.html#gui_DateField">DateField</a> и <a href="/manual.html#gui_DatePicker">DatePicker</a> автоматически устанавливают свои свойства <code>rangeStart</code> и <code>rangeEnd</code> в соответствии с аннотациями <code>@Past</code> и <code>@Future</code>, не учитывая текущее время.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Экраны <a href="/manual.html#abstractEditor">редактирования</a> выполняют валидацию ограничений уровня класса при коммите, если ограничения включают группу <code>UiCrossFieldChecks</code> и все проверки ограничений уровня атрибутов прошли успешно. Валидацию данного типа можно отключить с помощью свойства экрана <code>crossFieldValidate</code> в XML-дескрипторе или в контроллере:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;window</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://schemas.haulmont.com/cuba/window.xsd</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://editorCaption</span><span class="delimiter">"</span></span>
        <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.demo.web.task.TaskEdit</span><span class="delimiter">"</span></span>
        <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">taskDs</span><span class="delimiter">"</span></span>
        <span class="attribute-name">crossFieldValidate</span>=<span class="string"><span class="delimiter">"</span><span class="content">false</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- ... --&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
              </div> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TaskEdit</span> <span class="directive">extends</span> AbstractEditor&lt;Task&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        setCrossFieldValidate(<span class="predefined-constant">false</span>);
    }
}</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="bean_validation_in_services" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Валидация сервисов Middleware
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p><a href="/manual.html#services">Сервисы</a> среднего слоя выполняют валидацию параметров и результатов методов, если метод имеет аннотацию <code>@Validated</code> в интерфейсе сервиса. Например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">TaskService</span> {
    <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">"</span><span class="content">demo_TaskService</span><span class="delimiter">"</span></span>;

    <span class="annotation">@Validated</span>
    <span class="annotation">@NotNull</span>
    <span class="predefined-type">String</span> completeTask(<span class="annotation">@Size</span>(min = <span class="integer">5</span>) <span class="predefined-type">String</span> comment, <span class="annotation">@NotNull</span> Task task);
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Аннотация <code>@Validated</code> может содержать указание <a href="/manual.html#bean_validation_constraint_groups">групп ограничений</a> для применения подмножества имеющихся ограничений. Если группы не указаны, то по умолчанию используются следующие:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>Default</code> и <code>ServiceParametersChecks</code> - для параметров методов</p> </li> 
               <li> <p><code>Default</code> и <code>ServiceResultChecks</code> - для возвращаемых результатов методов</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>При возникновении ошибок валидации выбрасываются исключения <code>MethodParametersValidationException</code> и <code>MethodResultValidationException</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>При выполнении некоторой специфической программной валидации в сервисе, можно использовать исключение <code>CustomValidationException</code> для того, чтобы клиенты получали информацию об ошибках в том же формате что и от стандартной валидации. Это может быть особенно актуально для клиентов REST API.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="bean_validation_in_rest" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Валидация в REST API
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Универсальный <a href="/manual.html#rest_api_v2">REST API</a> автоматически выполняет bean validation для действий создания и изменения сущностей. Ошибки валидации передаются клиенту следующим образом:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>MethodResultValidationException</code> и <code>ValidationException</code> порождают HTTP статус <code>500 Server error</code></p> </li> 
               <li> <p><code>MethodParametersValidationException</code>, <code>ConstraintViolationException</code> и <code>CustomValidationException</code> порождают HTTP статус <code>400 Bad request</code></p> </li> 
               <li> <p>Тело ответа с <code>Content-Type: application/json</code> будет содержать список объектов со свойствами <code>message</code>, <code>messageTemplate</code>, <code>path</code> и <code>invalidValue</code>, например:</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="json">[
    {
        <span class="key"><span class="delimiter">"</span><span class="content">message</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">Invalid email: aaa</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">messageTemplate</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">{msg://com.company.demo.entity/Customer.email.validationMsg}</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">path</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">email</span><span class="delimiter">"</span></span>,
        <span class="key"><span class="delimiter">"</span><span class="content">invalidValue</span><span class="delimiter">"</span></span>: <span class="string"><span class="delimiter">"</span><span class="content">aaa</span><span class="delimiter">"</span></span>
    }
]</code></pre> 
                 </div> 
                </div> 
                <div class="ulist"> 
                 <ul> 
                  <li> <p><code>path</code> содержит путь к невалидному атрибуту в валидируемом графе объектов</p> </li> 
                  <li> <p><code>messageTemplate</code> содержит сторку, заданную в атрибуте <code>message</code> аннотации</p> </li> 
                  <li> <p><code>message</code> содержит сообщение ошибки валидации</p> </li> 
                  <li> <p><code>invalidValue</code> возвращается только если тип значения один из следующих: <code>String</code>, <code>Date</code>, <code>Number</code>, <code>Enum</code>, <code>UUID</code>.</p> </li> 
                 </ul> 
                </div> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="bean_validation_programmatic" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Программная валидация
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Bean validation можно запустить программно используя интерфейс инфраструктуры <code>BeanValidation</code>, доступный и на middleware и на клиентском уровне. Через данный интерфейс необходимо получить реализацию <code>javax.validation.Validator</code>, которая и запускает валидацию. Результатом валидации является набор объектов типа <code>ConstraintViolation</code>. Например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> BeanValidation beanValidation;

<span class="directive">public</span> <span class="type">void</span> save(Foo foo) {
    <span class="predefined-type">Validator</span> validator = beanValidation.getValidator();
    <span class="predefined-type">Set</span>&lt;ConstraintViolation&lt;Foo&gt;&gt; violations = validator.validate(foo);
    <span class="comment">// ...</span>
}</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="entity_attribute_access"><a class="anchor" href="/manual.html#entity_attribute_access"></a>5.2.14. Контроль доступа к атрибутам сущностей</h4> 
       <div class="paragraph"> 
        <p><a href="/manual.html#security">Подсистема безопасности</a> позволяет управлять доступом к атрибутам сущностей в соответствии с правами пользователя. Т.е. фреймворк может сделать атрибут read-only или скрыть его в зависимости от набора ролей, назначенных текущему пользователю. Однако, иногда может потребоваться изменять доступ к атрибуту в зависимости также от текущего состояния экземпляра сущности или связанных сущностей.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Механизм контроля доступа к атрибутам позволяет создавать правила того, какие атрибуты должны быть скрыты, нередактируемы или обязательны к заполнению для некоторого экземпляра сущности, и применять эти правила к компонентам <a href="/manual.html#gui_framework">Generic UI</a> и в <a href="/manual.html#rest_api_v2">REST API</a>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Данный механизм работает следующим образом:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Когда <a href="/manual.html#dataManager">DataManager</a> загружает сущность, он посылает Spring application event типа <code>SetupAttributeAccessEvent</code>. Объект события содержит загруженный экземпляр в состоянии managed и три коллекции имен атрибутов: read-only, hidden и required (изначально они пустые).</p> </li> 
         <li> <p>Вам необходимо создать event listener, который будет анализировать состояние сущности и заполнять списки имен атрибутов соответствующим образом. Данный event listener является по сути контейнером правил, задающих доступ к атрибутам экземпляров.</p> </li> 
         <li> <p>Описываемый механизм сохраняет имена атрибутов, заданные правилами, в самом экземпляре (в связанном объекте <code>SecurityState</code>).</p> </li> 
         <li> <p>На клиентском уровне, Generic UI и REST API используют объект <code>SecurityState</code> для управления доступом к атрибутам сущностей.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Для создания правил для некоторого типа сущностей, необходимо выполнить следующее:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Создайте <a href="/manual.html#managed_beans">управляемый бин</a> в модуле <strong>core</strong> проекта. Бин должен иметь дефолтный singleton scope.</p> </li> 
         <li> <p>Создайте метод, принимающий единственный параметр типа <code>SetupAttributeAccessEvent</code>. Метод должен иметь аннотацию <code>org.springframework.context.event.EventListener</code>. Тип <code>SetupAttributeAccessEvent</code> является generic и должен быть параметризован типом сущности.</p> </li> 
         <li> <p>В данном методе необходимо заполнить коллекции скрываемых, только для чтения и обязательных атрибутов используя методы <code>addHidden()</code>, <code>addReadOnly()</code> и <code>addRequired()</code> объекта события. Экземпляр сущности, доступный через метод <code>getEntity()</code>, находится в состоянии managed, поэтому можно безопасно обращаться ко всем его атрибутам и атрибутам связанных сущностей.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Рассмотрим пример сущности <code>Order</code>, имеющей атрибуты <code>customer</code> и <code>amount</code>. Для ограничения доступа к атрибуту <code>amount</code> в зависимости от <code>customer</code> можно создать следующее правило:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.sample.core</span>;

<span class="keyword">import</span> <span class="include">com.company.sample.entity.Order</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.app.events.SetupAttributeAccessEvent</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.event.EventListener</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Component</span>;

<span class="annotation">@Component</span>(<span class="string"><span class="delimiter">"</span><span class="content">sample_AttributeAccessRules</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AttributeAccessRules</span> {

    <span class="annotation">@EventListener</span>
    <span class="directive">public</span> <span class="type">void</span> orderAccess(SetupAttributeAccessEvent&lt;Order&gt; event) {
        Order order = event.getEntity();
        <span class="keyword">if</span> (order.getCustomer() != <span class="predefined-constant">null</span>) {
            <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">PLATINUM</span><span class="delimiter">"</span></span>.equals(order.getCustomer().getGrade().getCode())) {
                event.addHidden(<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span>);
            } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">GOLD</span><span class="delimiter">"</span></span>.equals(order.getCustomer().getGrade().getCode())) {
                event.addReadOnly(<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span>);
            }
        }
    }
}</code></pre> 
        </div> 
       </div> 
       <div id="entity_attribute_access_gui" class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Контроль доступа к атрибутам в Generic UI
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Фреймворк автоматически применяет ограничения доступа к экрану перед вызовом метода <code>ready()</code> его контроллера. Если вы не хотите этого для некоторого экрана, переопределите метод <code>isAttributeAccessControlEnabled()</code> его контроллера и верните из него <code>false</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Пересчитать и применить ограничения к экрану можно и когда он уже открыт, в ответ на действия пользователя. Для этого необходимо использовать бин <code>AttributeAccessSupport</code>, передавая ему текущий экран и сущность, состояние которой изменилось. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.company.sample.web.order</span>;

<span class="keyword">import</span> <span class="include">com.company.sample.entity.Order</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.AttributeAccessSupport</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.AbstractEditor</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.data.Datasource</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderEdit</span> <span class="directive">extends</span> AbstractEditor&lt;Order&gt; {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Datasource&lt;Order&gt; orderDs;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> AttributeAccessSupport attributeAccessSupport;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        orderDs.addItemPropertyChangeListener(e -&gt; {
            <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>.equals(e.getProperty())) {
                attributeAccessSupport.applyAttributeAccess(<span class="local-variable">this</span>, <span class="predefined-constant">true</span>, getItem());
            }
        });
    }
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Второй параметр метода <code>applyAttributeAccess()</code> - булевское значение, которое указывает, нужно ли сбрасывать ограничения доступа к компонентам в дефолтные настройки перед тем, как применить новые. Если передано true, возможные программные изменения в этих настройках будут потеряны. Когда данный метод вызывается автоматически перед открытием окна, передается false. Когда же вы вызываете данный метод в ответ на UI-события, передавайте true, иначе ограничения компонентов будут суммироваться, а не заменяться.</p> 
            </div> 
            <div class="admonitionblock warning"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Warning
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>Ограничения доступа к атрибутам применяются только к компонентам, связанным с одним атрибутом сущности, например <a href="/manual.html#gui_TextField">TextField</a> или <a href="/manual.html#gui_LookupField">LookupField</a>. <a href="/manual.html#gui_Table">Table</a> и другие компоненты, реализующие интерфейс <code>ListComponent</code>, не затрагиваются. Поэтому если вы пишете правило, скрывающее атрибут для некоторых экземпляров, рекомендуется не показывать этот атрибут в таблицах совсем.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
          </div> 
         </dd> 
        </dl> 
       </div> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="dbms"><a class="anchor" href="/manual.html#dbms"></a>5.3. Компоненты работы с базой данных</h3> 
      <div class="paragraph"> 
       <p>В данном разделе приведена информация о возможных типах СУБД приложений на платформе CUBA. Кроме того, описан механизм на основе скриптов, с помощью которого можно создать новую базу данных, и в дальнейшем поддерживать ее в актуальном состоянии на протяжении всего цикла разработки и эксплуатации приложения.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Компоненты работы с базой данных принадлежат <a href="/manual.html#app_tiers">блоку</a> Middleware, другие блоки приложения не имеют прямого доступа к БД.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Дополнительная практическая информация по работе с базой данных приведена в <a href="/manual.html#databases">секции</a> ниже.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="dbms_types"><a class="anchor" href="/manual.html#dbms_types"></a>5.3.1. Типы СУБД</h4> 
       <div class="paragraph"> 
        <p>Тип используемой СУБД определяется свойствами приложения <a href="/manual.html#cuba.dbmsType">cuba.dbmsType</a> и (опционально) <a href="/manual.html#cuba.dbmsVersion">cuba.dbmsVersion</a>, которые влияют на поведение механизмов, зависящих от типа базы данных.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Приложение обращается к БД через источник данных <code>javax.sql.DataSource</code>, который извлекается из JNDI по имени, заданному в свойстве приложения <a href="/manual.html#cuba.dataSourceJndiName">cuba.dataSourceJndiName</a> (по умолчанию <code>java:comp/env/jdbc/CubaDS</code>). Конфигурация источника данных в случае <a href="/manual.html#fast_deployment">стандартного развертывания</a> задается в файле <a href="/manual.html#context.xml">context.xml</a> модуля <strong>core</strong>. Источник данных должен использовать JDBC-драйвер, соответствующий выбранной СУБД.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Платформа "из коробки" поддерживает следующие СУБД:</p> 
       </div> 
       <table class="tableblock frame-all grid-all spread"> 
        <colgroup> 
         <col style="width: 33%;"> 
         <col style="width: 16%;"> 
         <col style="width: 16%;"> 
         <col style="width: 33%;"> 
        </colgroup> 
        <thead> 
         <tr> 
          <th class="tableblock halign-left valign-top"></th> 
          <th class="tableblock halign-center valign-top">cuba.dbmsType</th> 
          <th class="tableblock halign-center valign-top">cuba.dbmsVersion</th> 
          <th class="tableblock halign-center valign-top">JDBC driver</th> 
         </tr> 
        </thead> 
        <tbody> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">HSQLDB</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">hsql</p></td> 
          <td class="tableblock halign-left valign-top"></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">org.hsqldb.jdbc.JDBCDriver</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">PostgreSQL 8.4+</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td> 
          <td class="tableblock halign-left valign-top"></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">org.postgresql.Driver</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft SQL Server 2005</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">2005</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">net.sourceforge.jtds.jdbc.Driver</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft SQL Server 2008</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td> 
          <td class="tableblock halign-left valign-top"></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">com.microsoft.sqlserver.jdbc.SQLServerDriver</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Microsoft SQL Server 2012+</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">2012</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">com.microsoft.sqlserver.jdbc.SQLServerDriver</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Oracle Database 11g+</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td> 
          <td class="tableblock halign-left valign-top"></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">oracle.jdbc.OracleDriver</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">MySQL 5.6+</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td> 
          <td class="tableblock halign-left valign-top"></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">com.mysql.jdbc.Driver</p></td> 
         </tr> 
        </tbody> 
       </table> 
       <div class="paragraph"> 
        <p>Таблица ниже описывает рекомендованное соответствие типов данных между атрибутами сущностей в Java и колонками таблиц различных СУБД. Эти типы автоматически выбираются Studio при генерации скриптов создания и обновления БД, и для них гарантируется работоспособность всех механизмов платформы.</p> 
       </div> 
       <table class="tableblock frame-all grid-all spread"> 
        <colgroup> 
         <col style="width: 16%;"> 
         <col style="width: 16%;"> 
         <col style="width: 16%;"> 
         <col style="width: 16%;"> 
         <col style="width: 16%;"> 
         <col style="width: 16%;"> 
        </colgroup> 
        <thead> 
         <tr> 
          <th class="tableblock halign-center valign-top">Java</th> 
          <th class="tableblock halign-center valign-top">HSQL</th> 
          <th class="tableblock halign-center valign-top">PostgreSQL</th> 
          <th class="tableblock halign-center valign-top">MS SQL Server</th> 
          <th class="tableblock halign-center valign-top">Oracle</th> 
          <th class="tableblock halign-center valign-top">MySQL</th> 
         </tr> 
        </thead> 
        <tbody> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">UUID</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">varchar(36)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">uniqueidentifier</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">varchar2(32)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">varchar(32)</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">datetime(3)</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">java.sql.Date</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">java.sql.Time</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">time</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">datetime</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">time(3)</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">decimal(p, s)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">decimal(p, s)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">decimal(p, s)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">number(p, s)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">decimal(p, s)</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">double precision</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">double precision</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">double precision</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">double precision</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">number(19)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">bigint</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">tinyint</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">char(1)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">String (limited)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">varchar(n)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">varchar(n)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">varchar(n)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">varchar2(n)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">varchar(n)</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">String (unlimited)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">longvarchar</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">varchar(max)</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">clob</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">longtext</p></td> 
         </tr> 
         <tr> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">byte[]</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">longvarbinary</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">bytea</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">blob</p></td> 
          <td class="tableblock halign-left valign-top"><p class="tableblock">longblob</p></td> 
         </tr> 
        </tbody> 
       </table> 
       <div class="paragraph"> 
        <p>Как правило, всю работу по преобразованию данных между БД и кодом Java выполняет <a href="/manual.html#orm">слой ORM</a> совместно с соответствующим JDBC драйвером. Это означает, что при работе с данными через методы <a href="/manual.html#entityManager">EntityManager</a> и <a href="/manual.html#query">запросы на JPQL</a> никакой ручной конвертации выполнять не нужно - вы просто используете типы Java, перечисленные в левой колонке таблицы.</p> 
       </div> 
       <div class="paragraph"> 
        <p>При использовании native SQL через <a href="/manual.html#nativeQuery">EntityManager.createNativeQuery</a>() или через <a href="/manual.html#queryRunner">QueryRunner</a> для разных типов СУБД некоторые типы данных в Java коде будут отличаться от приведенных. В первую очередь это касается атрибутов типа <code>UUID</code> - только драйвер PostgreSQL возвращает значения соответствующих колонок в этом типе, для других серверов это будет <code>String</code>. Для обеспечения независимости кода от используемой СУБД рекомендуется конвертировать типы параметров и результатов запросов с помощью интерфейса <a href="/manual.html#dbTypeConverter">DbTypeConverter</a>.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="arbitrary_dbms"><a class="anchor" href="/manual.html#arbitrary_dbms"></a>5.3.1.1. Поддержка произвольных СУБД</h5> 
        <div class="paragraph"> 
         <p>На уровне прикладного проекта можно реализовать работу с любой СУБД, поддерживаемой фреймворком <a href="/manual.html#orm">ORM</a> (EclipseLink). Для этого достаточно выполнить следующее:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Указать тип СУБД в виде произвольного кода в свойстве <a href="/manual.html#cuba.dbmsType">cuba.dbmsType</a>. Код должен отличаться от используемых в платформе кодов <code>hsql</code>, <code>postgres</code>, <code>mssql</code>, <code>oracle</code>.</p> </li> 
          <li> <p>Реализовать интерфейсы <code>DbmsFeatures</code>, <code>SequenceSupport</code>, <code>DbTypeConverter</code> классами с именами соответственно <code>TypeDbmsFeatures</code>, <code>TypeSequenceSupport</code>, <code>TypeDbTypeConverter</code>, где <code>Type</code> - код типа СУБД. Пакет класса имплементации должен быть таким же, как у интерфейса.</p> </li> 
          <li> <p>Создать скрипты инициализации и обновления БД в каталогах с кодом СУБД. Скрипты инициализации должны включать создание всех объектов БД, необходимых для сущностей платформы (их можно скопировать из имеющихся в каталоге <code>10-cuba</code> и др. скриптов и исправить для данной СУБД).</p> </li> 
          <li> <p>Для создания и обновления БД задачами Gradle в build.gradle необходимо для этих задач указать дополнительные параметры:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java">task createDb(dependsOn: assemble, type: CubaDbCreation) {
    dbms = <span class="string"><span class="delimiter">'</span><span class="content">my</span><span class="delimiter">'</span></span>                                            <span class="comment">// DBMS code</span>
    driver = <span class="string"><span class="delimiter">'</span><span class="content">net.my.jdbc.Driver</span><span class="delimiter">'</span></span>                          <span class="comment">// JDBC driver class</span>
    dbUrl = <span class="string"><span class="delimiter">'</span><span class="content">jdbc:my:myserver://192.168.47.45/mydb</span><span class="delimiter">'</span></span>        <span class="comment">// Database URL</span>
    masterUrl = <span class="string"><span class="delimiter">'</span><span class="content">jdbc:my:myserver://192.168.47.45/master</span><span class="delimiter">'</span></span>  <span class="comment">// URL of a master DB to connect to for creating the application DB</span>
    dropDbSql = <span class="string"><span class="delimiter">'</span><span class="content">drop database mydb;</span><span class="delimiter">'</span></span>                      <span class="comment">// Drop database statement</span>
    createDbSql = <span class="string"><span class="delimiter">'</span><span class="content">create database mydb;</span><span class="delimiter">'</span></span>                  <span class="comment">// Create database statement</span>
    timeStampType = <span class="string"><span class="delimiter">'</span><span class="content">datetime</span><span class="delimiter">'</span></span>                             <span class="comment">// Date and time datatype - needed for SYS_DB_CHANGELOG table creation</span>
    dbUser = <span class="string"><span class="delimiter">'</span><span class="content">sa</span><span class="delimiter">'</span></span>
    dbPassword = <span class="string"><span class="delimiter">'</span><span class="content">saPass1</span><span class="delimiter">'</span></span>
}

task updateDb(dependsOn: assemble, type: CubaDbUpdate) {
    dbms = <span class="string"><span class="delimiter">'</span><span class="content">my</span><span class="delimiter">'</span></span>                                            <span class="comment">// DBMS code</span>
    driver = <span class="string"><span class="delimiter">'</span><span class="content">net.my.jdbc.Driver</span><span class="delimiter">'</span></span>                          <span class="comment">// JDBC driver class</span>
    dbUrl = <span class="string"><span class="delimiter">'</span><span class="content">jdbc:my:myserver://192.168.47.45/mydb</span><span class="delimiter">'</span></span>        <span class="comment">// Database URL</span>
    dbUser = <span class="string"><span class="delimiter">'</span><span class="content">sa</span><span class="delimiter">'</span></span>
    dbPassword = <span class="string"><span class="delimiter">'</span><span class="content">saPass1</span><span class="delimiter">'</span></span>
}</code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="dbms_version"><a class="anchor" href="/manual.html#dbms_version"></a>5.3.1.2. Версия СУБД</h5> 
        <div class="paragraph"> 
         <p>В дополнение к свойству приложения <a href="/manual.html#cuba.dbmsType">cuba.dbmsType</a> существует опциональное свойство <a href="/manual.html#cuba.dbmsVersion">cuba.dbmsVersion</a>. Оно влияет на выбор имплементаций интерфейсов <code>DbmsFeatures</code>, <code>SequenceSupport</code>, <code>DbTypeConverter</code>, и на поиск скриптов создания и обновления БД.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Имя класса имплементации интеграционного интерфейса формируется следующим образом: <code>TypeVersionName</code>. Здесь <code>Type</code> - значение <code>cuba.dbmsType</code> с заглавной буквы, <code>Version</code> - значение <code>cuba.dbmsVersion</code>, <code>Name</code> - имя интерфейса. Пакет класса должен быть таким же, как у интерфейса. Если класс с таким именем отсутствует, предпринимается попытка найти класс с именем без версии: <code>TypeName</code>. Если и такого класса нет, выдается исключение.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Например, в платформе определен класс <code>com.haulmont.cuba.core.sys.persistence.Mssql2012SequenceSupport</code>, который вступит в силу, если в проекте указаны следующие свойства:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="properties">cuba.dbmsType = mssql
cuba.dbmsVersion = 2012</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>При поиске <a href="/manual.html#db_scripts">скриптов создания и обновления БД</a> каталог с именем <code>type-version</code> имеет приоритет над каталогом с именем <code>type</code>. Это значит, что скрипты каталога <code>type-version</code> заменяют одноименные скрипты каталога <code>type</code>. В каталоге <code>type-version</code> могут быть и скрипты с собственными именами, они будут также добавлены в общий набор скриптов для выполнения. Сортировка скриптов производится по пути начиная с каталога, вложенного в <code>type</code> или <code>type-version</code>, то есть без учета того, в каком каталоге (с версией или без) находится скрипт.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Например, следующим образом можно определить скрипты создания БД для Microsoft SQL Server для версий ниже и выше 2012:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="plain">modules/core/db/init/
   mssql/
       10.create-db.sql
       20.create-db.sql
       30.create-db.sql
   mssql-2012/
       10.create-db.sql</code></pre> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="db_scripts"><a class="anchor" href="/manual.html#db_scripts"></a>5.3.2. Скрипты создания и обновления БД</h4> 
       <div class="paragraph"> 
        <p>Проект CUBA-приложения всегда содержит два набора скриптов:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Скрипты <em>создания</em> БД, предназначенные для создания базы данных с нуля. Они содержат набор DDL и DML операторов, после выполнения которых на пустой БД схема базы данных полностью соответствует текущему состоянию <a href="/manual.html#data_model">модели данных</a> приложения. Скрипты создания могут также наполнять БД необходимыми первичными данными.</p> </li> 
         <li> <p>Скрипты <em>обновления</em> БД - предназначены для поэтапного приведения структуры БД к текущему состоянию модели данных.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>При изменении модели данных необходимо отразить соответствующее изменение схемы БД и в скриптах создания, и в скриптах обновления. Например, при добавлении атрибута <code>address</code> в сущность <code>Customer</code>, нужно:</p> 
       </div> 
       <div class="olist arabic"> 
        <ol class="arabic"> 
         <li> <p>Изменить оператор создания таблицы в скрипте создания:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">create</span> <span class="type">table</span> SALES_CUSTOMER (
  ID <span class="predefined-type">varchar</span>(<span class="integer">36</span>) <span class="keyword">not</span> <span class="predefined-constant">null</span>,
  CREATE_TS <span class="predefined-type">timestamp</span>,
  CREATED_BY <span class="predefined-type">varchar</span>(<span class="integer">50</span>),
  NAME <span class="predefined-type">varchar</span>(<span class="integer">100</span>),
  ADDRESS <span class="predefined-type">varchar</span>(<span class="integer">200</span>), <span class="comment">-- added column</span>
  <span class="directive">primary</span> <span class="type">key</span> (ID)
)</code></pre> 
           </div> 
          </div> </li> 
         <li> <p>Добавить скрипт обновления, содержащий оператор модификации таблицы:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">alter</span> <span class="type">table</span> SALES_CUSTOMER <span class="class">add</span> ADDRESS <span class="predefined-type">varchar</span>(<span class="integer">200</span>)</code></pre> 
           </div> 
          </div> </li> 
        </ol> 
       </div> 
       <div class="paragraph"> 
        <p>Скрипты создания располагаются в каталоге <code>/db/init</code> модуля <strong>core</strong>. Для каждого типа СУБД, поддерживаемой приложением, создается свой набор скриптов и располагается в подкаталоге с именем, соответствующим свойству приложения <a href="/manual.html#cuba.dbmsType">cuba.dbmsType</a>, например, <code>/db/init/postgres</code>. Имена скриптов создания должны иметь вид <code>{optional_prefix}create-db.sql</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Скрипты обновления располагаются в каталоге <code>/db/update</code> модуля <strong>core</strong>. Для каждого типа СУБД, поддерживаемой приложением, создается свой набор скриптов и располагается в подкаталоге с именем, соответствующим свойству приложения <a href="/manual.html#cuba.dbmsType">cuba.dbmsType</a>, например, <code>/db/update/postgres</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Скрипты обновления могут быть двух типов: с расширением <code>*.sql</code> или с расширением <code>*.groovy</code>. SQL-скрипты являются основным средством обновления базы данных. Groovy-скрипты выполняются только <a href="/manual.html#db_update_server">механизмом запуска скриптов БД сервером</a>, поэтому применяются в основном на этапе эксплуатации приложения - как правило, это процессы миграции или импорта данных, которые невозможно реализовать на SQL.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Скрипты обновления должны иметь имена, которые при сортировке в алфавитном порядке образуют правильную последовательность их выполнения (обычно это хронологическая последовательность их создания). Поэтому при ручном создании рекомендуется задавать имя скрипта обновления в виде <code>{yymmdd}-{description}.sql</code>, где <code>yy</code> - год, <code>mm</code> - месяц, <code>dd</code> - день, <code>description</code> - краткое описание скрипта. Например, <code>121003-addCodeToCategoryAttribute.sql</code>. Studio при автоматической генерации скриптов также придерживается этого формата.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Чтобы groovy-скрипты также выполнялись командой <code>updateDb</code>, они обязательно должны иметь расширение <code>.upgrade.groovy</code> и ту же логику именования, что и sql-скрипты. Действия из набора <code>Post update</code> в этих скриптах не поддерживаются, для привязки к данным используются стандартные <a href="/manual.html#db_scripts_groovy">переменные</a> <code>ds</code> (доступ к источнику данных) и <code>log</code> (доступ к журналу сервера). Выполнение groovy-скриптов можно запретить, прописа <code>executeGroovy = false</code> в команде <code>updateDb</code> в <code>build.gradle</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Скрипты обновления можно группировать в подкаталоги, главное, чтобы путь к скрипту с учетом подкаталога не нарушал хронологической последовательности. Например, можно создавать подкаталоги по номеру года или по году и месяцу.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В развернутом приложении скрипты создания и обновления БД располагаются в специальном <a href="/manual.html#db_dir">каталоге скриптов базы данных</a>, задаваемым свойством приложения <a href="/manual.html#cuba.dbDir">cuba.dbDir</a>.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="db_scripts_sql"><a class="anchor" href="/manual.html#db_scripts_sql"></a>5.3.2.1. Структура SQL-скриптов</h5> 
        <div class="paragraph"> 
         <p>SQL-скрипты создания и обновления представляют собой текстовые файлы с набором DDL и DML команд, разделенных символом “^”. Символ “^” применяется для того, чтобы можно было применять разделитель “;” в составе сложных команд, например, при создании функций или триггеров. Механизм исполнения скриптов разделяет входной файл на команды по разделителю “^” и выполняет каждую команду в отдельной транзакции. Это означает, что при необходимости можно сгруппировать несколько простых операторов (например, <code>insert</code>), разделенных точкой с запятой, и обеспечить их выполнение в одной транзакции.</p> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Разделитель "^" может быть заэкранирован путем его удвоения. Например, если вам нужно передать значение <code>^[0-9\s]+$</code>, скрипт должен содержать строку <code>^^[0-9\s]+$</code>.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="paragraph"> 
         <p>Пример SQL-скрипта обновления:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">create</span> <span class="type">table</span> LIBRARY_COUNTRY (
  ID <span class="predefined-type">varchar</span>(<span class="integer">36</span>) <span class="keyword">not</span> <span class="predefined-constant">null</span>,
  CREATE_TS <span class="predefined-type">time</span>,
  CREATED_BY <span class="predefined-type">varchar</span>(<span class="integer">50</span>),
  NAME <span class="predefined-type">varchar</span>(<span class="integer">100</span>) <span class="keyword">not</span> <span class="predefined-constant">null</span>,
  <span class="directive">primary</span> <span class="type">key</span> (ID)
)^

<span class="class">alter</span> <span class="type">table</span> LIBRARY_TOWN <span class="class">add</span> <span class="type">column</span> COUNTRY_ID <span class="predefined-type">varchar</span>(<span class="integer">36</span>) ^
<span class="class">alter</span> <span class="type">table</span> LIBRARY_TOWN <span class="class">add</span> <span class="type">constraint</span> FK_LIBRARY_TOWN_COUNTRY_ID <span class="directive">foreign</span> <span class="type">key</span> (COUNTRY_ID) <span class="keyword">references</span> LIBRARY_COUNTRY(ID)^
<span class="class">create</span> <span class="type">index</span> IDX_LIBRARY_TOWN_COUNTRY <span class="keyword">on</span> LIBRARY_TOWN (COUNTRY_ID)^</code></pre> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="db_scripts_groovy"><a class="anchor" href="/manual.html#db_scripts_groovy"></a>5.3.2.2. Структура Groovy-скриптов</h5> 
        <div class="paragraph"> 
         <p>Groovy-скрипты обновления имеют следующую структуру:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><em>Основная</em> часть, содержащая код, выполняемый до старта <a href="/manual.html#appContext">контекста приложения</a>. В этой части можно использовать любые классы Java, Groovy и блока <strong>Middleware</strong> приложения, но при этом необходимо иметь в виду, что никакие бины, интерфейсы инфраструктуры и прочие объекты приложения еще не инстанциированы, и с ними работать нельзя.</p> 
           <div class="paragraph"> 
            <p>Основная часть предназначена в первую очередь, как и обычные SQL-скрипты, для обновления схемы данных.</p> 
           </div> </li> 
          <li> <p><em>PostUpdate</em> часть - набор замыканий, которые будут выполнены после завершения процесса обновления и после старта контекста приложения. Внутри этих замыканий можно оперировать любыми объектами <strong>Middleware</strong> приложения.</p> 
           <div class="paragraph"> 
            <p>В этой части скрипта удобно, например, выполнять импорт данных, так как в ней можно использовать интерфейс <a href="/manual.html#persistence">Persistence</a> и объекты модели данных.</p> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>На вход Groovy-скриптов механизм выполнения передает следующие переменные:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>ds</code> - экземпляр <code>javax.sql.DataSource</code> для базы данных приложения.</p> </li> 
          <li> <p><code>log</code> - экземпляр <code>org.apache.commons.logging.Log</code> для вывода сообщений в журнал сервера</p> </li> 
          <li> <p><code>postUpdate</code> - объект, содержащий метод <code>add(Closure closure)</code> для добавления замыканий, выполняющихся после старта контекста сервера.</p> </li> 
         </ul> 
        </div> 
        <div class="admonitionblock warning"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Warning
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Groovy-скрипты выполняются только <a href="/manual.html#db_update_server">механизмом запуска скриптов БД сервером</a>.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="paragraph"> 
         <p>Пример Groovy-скрипта обновления:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.Persistence</span>
<span class="include">import</span> <span class="include">com.haulmont.cuba.core.global.AppBeans</span>
<span class="include">import</span> <span class="include">com.haulmont.refapp.core.entity.Colour</span>
<span class="include">import</span> <span class="include">groovy.sql.Sql</span>

<span class="include">log.info</span>(<span class="string"><span class="delimiter">'</span><span class="content">Executing actions in update phase</span><span class="delimiter">'</span></span>)

<span class="include">Sql</span> <span class="include">sql</span> = <span class="include">new</span> <span class="include">Sql</span>(<span class="include">ds</span>)
<span class="include">sql.execute</span> <span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span><span class="string"><span class="delimiter">"</span><span class="content"> alter table MY_COLOR add DESCRIPTION varchar(100); </span><span class="delimiter">"</span></span><span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span>

<span class="comment">// Add post update action</span>
<span class="include">postUpdate.add</span>({
    <span class="include">log.info</span>(<span class="string"><span class="delimiter">'</span><span class="content">Executing post update action using fully functioning server</span><span class="delimiter">'</span></span>)

    <span class="include">def</span> <span class="include">p</span> = <span class="include">AppBeans.get</span>(<span class="include">Persistence.class</span>)
    <span class="include">def</span> <span class="include">tr</span> = <span class="include">p.createTransaction</span>()
    <span class="include">try</span> {
        <span class="include">def</span> <span class="include">em</span> = <span class="include">p.getEntityManager</span>()

        <span class="include">Colour</span> <span class="include">c</span> = <span class="include">new</span> <span class="include">Colour</span>()
        <span class="include">c.name</span> = <span class="string"><span class="delimiter">'</span><span class="content">yellow</span><span class="delimiter">'</span></span>
        <span class="include">c.description</span> = <span class="string"><span class="delimiter">'</span><span class="content">a description</span><span class="delimiter">'</span></span>

        <span class="include">em.persist</span>(<span class="include">c</span>)
        <span class="include">tr.commit</span>()
    } <span class="include">finally</span> {
        <span class="include">tr.end</span>()
    }
})</code></pre> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="db_update_gradle"><a class="anchor" href="/manual.html#db_update_gradle"></a>5.3.3. Выполнение скриптов БД задачами Gradle</h4> 
       <div class="paragraph"> 
        <p>Данный механизм применяется обычно разработчиками приложения для собственного экземпляра базы данных. Выполнение скриптов в этом случае сводится к запуску специальных задач Gradle, описанных в скрипте сборки <a href="/manual.html#build.gradle">build.gradle</a>. Это можно сделать как из командной строки, так и с помощью интерфейса Studio.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Для запуска скриптов <em>создания</em> БД служит задача <code>createDb</code>. В Studio ей соответствует команда главного меню <strong>Run</strong> → <strong>Create database</strong>. При запуске задачи происходит следующее:</p> 
       </div> 
       <div class="olist arabic"> 
        <ol class="arabic"> 
         <li> <p>В каталоге <code>modules/core/build/db</code> собираются скрипты <a href="/manual.html#app_components">компонентов</a> платформы и скрипты <code>db/**/*.sql</code> модуля <strong>core</strong> текущего проекта. Наборы скриптов располагаются в подкаталогах с числовыми префиксами. Числовые префиксы необходимы для соблюдения алфавитного порядка выполнения скриптов - сначала выполняются скрипты <strong>cuba</strong>, затем других компонентов, затем текущего проекта.</p> </li> 
         <li> <p>Если БД существует, она полностью очищается. Если не существует, то создается новая пустая БД.</p> </li> 
         <li> <p>Последовательно в алфавитном порядке выполняются все скрипты создания <code>modules/core/build/db/init/**/*create-db.sql</code>, и их имена вместе с путем относительно каталога <code>db</code> регистрируются в таблице <code>SYS_DB_CHANGELOG</code>.</p> </li> 
         <li> <p>В таблице <code>SYS_DB_CHANGELOG</code> аналогично регистрируются все имеющиеся на данный момент скрипты обновления <code>modules/core/build/db/update/**/*.sql</code>. Это необходимо для будущего инкрементального обновления БД новыми скриптами.</p> </li> 
        </ol> 
       </div> 
       <div class="paragraph"> 
        <p>Для запуска скриптов <em>обновления</em> БД служит задача <code>updateDb</code>. В Studio ей соответствует команда главного меню <strong>Run</strong> → <strong>Update database</strong>. При запуске задачи происходит следующее:</p> 
       </div> 
       <div class="olist arabic"> 
        <ol class="arabic"> 
         <li> <p>Производится сборка скриптов аналогично описанному выше.</p> </li> 
         <li> <p>Производится проверка, выполнены ли все скрипты создания схемы компонентов приложения (путем выборки из таблицы <code>SYS_DB_CHANGELOG</code>). Если обнаруживается, что БД не инициализирована для работы некоторого компонента, выполняются его скрипты создания.</p> </li> 
         <li> <p>В каталогах <code>modules/core/build/db/update/**</code> производится поиск скриптов обновления, не зарегистрированных в таблице <code>SYS_DB_CHANGELOG</code>, то есть не выполненных ранее и содержимое которых не отражено в БД при ее инициализации.</p> </li> 
         <li> <p>Последовательно в алфавитном порядке выполняются все найденные на предыдущем шаге скрипты, и их имена вместе с путем относительно каталога <code>db</code> регистрируются в таблице <code>SYS_DB_CHANGELOG</code>.</p> </li> 
        </ol> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="db_update_server"><a class="anchor" href="/manual.html#db_update_server"></a>5.3.4. Выполнение скриптов БД сервером</h4> 
       <div class="paragraph"> 
        <p>Механизм выполнения скриптов сервером предназначен для приведения БД в актуальное состояние на старте сервера приложения, и активируется во время инициализации блока <strong>Middleware</strong>. Понятно, что при этом приложение должно быть собрано и развернуто на сервере, будь то собственный Tomcat разработчика или сервер в режиме эксплуатации.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Данный механизм в зависимости от описанных ниже условий выполняет либо скрипты создания, либо скрипты обновления, то есть он может и инициализировать БД с нуля, и обновлять ее. Однако, в отличие от описанной в предыдущем разделе задачи Gradle <code>createDb</code>, для выполнения инициализации базы она должна существовать - сервер не создает БД автоматически, а только прогоняет на ней скрипты.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Механизм выполнения скриптов сервером действует следующим образом:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Скрипты извлекаются из <a href="/manual.html#db_dir">каталога скриптов базы данных</a>, определяемого свойством приложения <a href="/manual.html#cuba.dbDir">cuba.dbDir</a>. В стандартном варианте развертывания в Tomcat это <code>tomcat/webapps/app-core/WEB-INF/db</code>.</p> </li> 
         <li> <p>Если в БД отсутствует таблица <code>SEC_USER</code>, то считается, что база данных пуста, и запускается полная инициализация с помощью скриптов создания БД. После выполнения инициализирующих скриптов их имена запоминаются в таблице <code>SYS_DB_CHANGELOG</code>. Кроме того, там же сохраняются имена всех доступных скриптов обновления, <em>без их выполнения</em>.</p> </li> 
         <li> <p>Если в БД имеется таблица <code>SEC_USER</code>, но отсутствует таблица <code>SYS_DB_CHANGELOG</code> (это случай, когда в первый раз запускается описываемый механизм на имеющейся рабочей БД), никакие скрипты <em>не запускаются</em>. Вместо этого создается таблица <code>SYS_DB_CHANGELOG</code> и в ней сохраняются имена всех доступных на данный момент скриптов создания и обновления.</p> </li> 
         <li> <p>Если в БД имеются и таблица <code>SEC_USER</code> и таблица <code>SYS_DB_CHANGELOG</code>, то производится запуск скриптов обновления, и их имена запоминаются в таблице <code>SYS_DB_CHANGELOG</code>. Причем запускаются только те скрипты, имен которых до этого не было в таблице <code>SYS_DB_CHANGELOG</code>, т.е. не запускавшиеся ранее. Последовательность запуска скриптов определяется двумя факторами: приоритетом базового проекта (см. содержимое <a href="/manual.html#db_dir">каталога скриптов базы данных</a>: <code>10-cuba</code>, <code>20-workflow</code>, …​) и именем файла скрипта (с учетом подкаталогов внутри каталога <code>update</code>) в алфавитном порядке.</p> 
          <div class="paragraph"> 
           <p>Перед выполнением скриптов обновления производится проверка, все ли скрипты создания схемы компонентов приложения выполнены (путем выборки из таблицы <code>SYS_DB_CHANGELOG</code>). Если обнаруживается, что БД не инициализирована для работы некоторого компонента, выполняются его скрипты создания.</p> 
          </div> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Механизм выполнения скриптов на старте сервера включается свойством приложения <a href="/manual.html#cuba.automaticDatabaseUpdate">cuba.automaticDatabaseUpdate</a>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В запущенном приложении механизм выполнения скриптов можно стартовать с помощью JMX-бина <code>app-core.cuba:type=PersistenceManager</code>, вызвав его метод <code>updateDatabase()</code> с параметром <code><strong>update</strong></code>. Понятно, что таким способом можно только обновить БД, а не проинициализировать новую, так как войти в систему для запуска метода JMX-бина при пустой БД невозможно. При этом следует иметь в виду, что если на старте <strong>Middleware</strong> или при входе пользователя в систему начнется инициализация той части модели данных, которая уже не соответствует устаревшей схеме БД, то произойдет ошибка, и продолжение работы станет невозможным. Именно поэтому универсальным является только автоматическое обновление БД на старте сервера перед инициализацией модели данных.</p> 
       </div> 
       <div class="paragraph"> 
        <p>JMX-бин <code>app-core.cuba:type=PersistenceManager</code> имеет еще один метод, относящийся к механизму обновления БД: <code>findUpdateDatabaseScripts()</code>. Он возвращает список новых скриптов обновления, имеющихся в каталоге и не зарегистрированных в БД.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Практические рекомендации по использованию механизма обновления БД сервером приведены в <a href="/manual.html#db_update_in_prod">Создание и обновление БД при эксплуатации приложения</a>.</p> 
       </div> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="middleware"><a class="anchor" href="/manual.html#middleware"></a>5.4. Компоненты среднего слоя</h3> 
      <div class="paragraph"> 
       <p>На следующем рисунке приведены основные компоненты среднего слоя CUBA-приложения.</p> 
      </div> 
      <div class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/Middleware.png" alt="Middleware"> 
       </div> 
       <div class="title">
        Рисунок 13. Компоненты среднего слоя
       </div> 
      </div> 
      <div class="paragraph"> 
       <p><a href="/manual.html#services">Services</a> – управляемые <a href="/manual.html#container">контейнером</a> компоненты, формирующие границу приложения и предоставляющие интерфейс клиентскому <a href="/manual.html#app_tiers">уровню</a> приложения. Сервисы могут содержать бизнес-логику сами, либо делегировать выполнение <a href="/manual.html#managed_beans">Managed Beans</a>.</p> 
      </div> 
      <div class="paragraph"> 
       <p><a href="/manual.html#managed_beans">Managed Beans</a> – управляемые <a href="/manual.html#container">контейнером</a> компоненты, содержащие бизнес-логику приложения. Вызываются <a href="/manual.html#services">сервисами</a>, другими бинами или через опциональный <a href="/manual.html#jmx">JMX</a>-интерфейс.</p> 
      </div> 
      <div class="paragraph"> 
       <p><a href="/manual.html#persistence">Persistence</a> − инфраструктурный интерфейс для доступа к функциональности хранения данных: управлению <a href="/manual.html#transactions">транзакциями</a> и <a href="/manual.html#orm">ORM</a>.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="services"><a class="anchor" href="/manual.html#services"></a>5.4.1. Сервисы</h4> 
       <div class="paragraph"> 
        <p>Сервисы образуют слой компонентов, определяющий множество операций Middleware, доступных клиентскому <a href="/manual.html#app_tiers">уровню</a> приложения. Другими словами, сервис представляет собой точку входа в бизнес-логику среднего слоя. В сервисе можно управлять <a href="/manual.html#transactions">транзакциями</a>, проверять <a href="/manual.html#permissions">права</a> пользователей, работать с базой данных или делегировать выполнение другим <a href="/manual.html#managed_beans">управляемым бинам</a> среднего слоя.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Диаграмма классов сервиса, отображающая основные компоненты сервиса:</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/MiddlewareServices.png" alt="MiddlewareServices"> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Интерфейс сервиса располагается в модуле <strong>global</strong> и доступен на клиентском уровне и на Middleware. Во время выполнения, на клиентском уровне для интерфейса сервиса создается прокси-объект, который обеспечивает вызовы методов бина, реализующего сервис, с помощью механизма Spring HTTP Invoker.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Бин, реализующий сервис, располагается в модуле <strong>core</strong> и доступен только на среднем слое.</p> 
       </div> 
       <div class="paragraph"> 
        <p><code>ServiceInterceptor</code> автоматически вызывается для каждого метода сервиса через Spring AOP. Он провеяет наличие в потоке выполнения пользовательской сессии, а также трансформирует и логирует исключения, если сервис вызван с клиентского уровня.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="service_creation"><a class="anchor" href="/manual.html#service_creation"></a>5.4.1.1. Создание сервиса</h5> 
        <div class="paragraph"> 
         <p>Имена интерфейсов сервисов должны заканчиваться на <code>Service</code>, имена классов реализации на <code>ServiceBean</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>При создании сервиса необходимо выполнить следующее:</p> 
        </div> 
        <div class="olist arabic"> 
         <ol class="arabic"> 
          <li> <p>Создать интерфейс в <a href="/manual.html#app_modules">модуле</a> <strong>global</strong> (т.к. интерфейс сервиса должен быть доступен на всех <a href="/manual.html#app_tiers">уровнях</a>) и задать в нем имя сервиса. Имя рекомендуется задавать в формате <code>{имя_проекта}_{имя_интерфейса}</code>. Например:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.sample.sales.core</span>;

<span class="keyword">import</span> <span class="include">com.sample.sales.entity.Order</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">OrderService</span> {
    <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">"</span><span class="content">sales_OrderService</span><span class="delimiter">"</span></span>;

    <span class="type">void</span> calculateTotals(Order order);
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Создать класс сервиса в модуле <strong>core</strong> и добавить ему аннотацию <code>@org.springframework.stereotype.Service</code> с именем, заданным в интерфейсе</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.sample.sales.core</span>;

<span class="keyword">import</span> <span class="include">com.sample.sales.entity.Order</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Service</span>;

<span class="annotation">@Service</span>(OrderService.NAME)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderServiceBean</span> <span class="directive">implements</span> OrderService {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> calculateTotals(Order order) {
    }
}</code></pre> 
            </div> 
           </div> </li> 
         </ol> 
        </div> 
        <div class="paragraph"> 
         <p>Класс сервиса, как и класс любого другого <a href="/manual.html#managed_beans">управляемого бина</a>, должен находиться внутри дерева пакетов с корнем, заданным в элементе <code>context:component-scan</code> файла <a href="/manual.html#spring.xml">spring.xml</a>. В нашем случае файл <code>spring.xml</code> содержит элемент:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>что означает, что поиск аннотированных бинов для данного блока приложения будет происходить начиная с пакета <code>com.sample.sales</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Если некоторую бизнес-логику требуется вызывать из разных сервисов либо других компонентов Middleware, ее необходимо выделить и инкапсулировать внутри соответствующего <a href="/manual.html#managed_beans">Managed Bean</a>. Например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// service interface</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">SalesService</span> {
    <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">"</span><span class="content">sample_SalesService</span><span class="delimiter">"</span></span>;

    <span class="predefined-type">BigDecimal</span> calculateSales(<span class="predefined-type">UUID</span> customerId);
}</code></pre> 
         </div> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// service implementation</span>
<span class="annotation">@Service</span>(SalesService.NAME)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SalesServiceBean</span> <span class="directive">implements</span> SalesService {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> SalesCalculator salesCalculator;

    <span class="annotation">@Transactional</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> calculateSales(<span class="predefined-type">UUID</span> customerId) {
        <span class="keyword">return</span> salesCalculator.calculateSales(customerId);
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// managed bean encapsulating business logic</span>
<span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SalesCalculator</span> {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Persistence persistence;

    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> calculateSales(<span class="predefined-type">UUID</span> customerId) {
        <span class="predefined-type">Query</span> query = persistence.getEntityManager().createQuery(
                <span class="string"><span class="delimiter">"</span><span class="content">select sum(o.amount) from sample$Order o where o.customer.id = :customerId</span><span class="delimiter">"</span></span>);
        query.setParameter(<span class="string"><span class="delimiter">"</span><span class="content">customerId</span><span class="delimiter">"</span></span>, customerId);
        <span class="keyword">return</span> (<span class="predefined-type">BigDecimal</span>) query.getFirstResult();
    }
}</code></pre> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="service_import"><a class="anchor" href="/manual.html#service_import"></a>5.4.1.2. Использование сервиса</h5> 
        <div class="paragraph"> 
         <p>Для того чтобы вызывать сервис, в клиентском блоке приложения для него должен быть создан соответствующий прокси-объект. Делается это путем объявления имени и интерфейса сервиса в параметрах фабрики прокси-объектов. Для блока Web Client это бин класса <code>WebRemoteProxyBeanCreator</code>, для Web Portal - <code>PortalRemoteProxyBeanCreator</code>, для Desktop Client - <code>RemoteProxyBeanCreator</code> .</p> 
        </div> 
        <div class="paragraph"> 
         <p>Фабрика прокси-объектов конфигурируется в файле <a href="/manual.html#spring.xml">spring.xml</a> соответствующего клиентского блока.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Например, чтобы в приложении <strong>sales</strong> вызвать с веб-клиента сервис <code>sales_OrderService</code>, необходимо добавить в файл <code>web-spring.xml</code> модуля <strong>web</strong> следующее:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_proxyCreator</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.web.sys.remoting.WebRemoteProxyBeanCreator</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">serverSelector</span><span class="delimiter">"</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">"</span><span class="content">cuba_ServerSelector</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">remoteServices</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales_OrderService</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.core.OrderService</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Все импортируемые сервисы объявляются в одном свойстве <code>remoteServices</code> в элементах <code>map/entry</code>.</p> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>CUBA Studio автоматически регистрирует сервисы во всех клиентских блоках приложения.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="paragraph"> 
         <p>С точки зрения прикладного кода прокси-объект сервиса на клиентском уровне является обычным бином Spring и может быть получен либо инжекцией, либо с помощью класса <code>AppBeans</code>, например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> OrderService orderService;

<span class="directive">public</span> <span class="type">void</span> calculateTotals() {
    orderService.calculateTotals(order);
}</code></pre> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="dataService"><a class="anchor" href="/manual.html#dataService"></a>5.4.1.3. DataService</h5> 
        <div class="paragraph"> 
         <p><code>DataService</code> является фасадом для вызова серверной релизации <a href="/manual.html#dataManager">DataManager</a> с клиентского уровня. <code>DataService</code> не рекомендуется использовать в прикладном коде. Вместо него и на клиентском уровне, и на Middleware следует использовать <code>DataManager</code>.</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="data_store"><a class="anchor" href="/manual.html#data_store"></a>5.4.2. Data Stores</h4> 
       <div class="paragraph"> 
        <p>Предпочтительный способ работы с данными в CUBA-приложениях - использование сущностей: либо декларативно в <a href="/manual.html#datasources">источниках данных</a> и связанных с данными компонентах, либо программно через <a href="/manual.html#dataManager">DataManager</a> или <a href="/manual.html#entityManager">EntityManager</a>. Сущности отображаются на данные в хранилище, которое обычно представляет собой реляционную БД. Приложение может работать с несколькими хранилищами, так что его <a href="/manual.html#data_model">модель данных</a> будет содержать сущности, отображаемые на данные из разных БД.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Некоторая сущность может принадлежать только одному хранилищу. Сущности из разных хранилищ можно отображать на одном экране UI, при этом <code>DataManager</code> обеспечивает их чтение и запись в соответствующее хранилище. В зависимости от типа сущности, <code>DataManager</code> выбирает зарегистрированное хранилище, представленное реализацией интерфейса <code>DataStore</code>, и делегирует ему загрузку или сохранение. При управлении транзакциями и работе с сущностями через <code>EntityManager</code> необходимо явно указывать, какое хранилище использовать. Подробнее см. методы интерфейса <a href="/manual.html#persistence">Persistence</a> и параметры аннотации <a href="/manual.html#transactions_decl">@Transactional</a>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Платформа содержит единственную реализацию интерфейса <code>DataStore</code>: <code>RdbmsStore</code>, предназначенную для работы с реляционными СУБД через слой <a href="/manual.html#orm">ORM</a>. Кроме того, в проекте приложения можно реализовать <code>DataStore</code> для интеграции, например, с нереляционной СУБД или внешней системой, имеющей REST интерфейс.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Каждое CUBA-приложение имеет основное хранилище, которое содержит системные сущности и используется для входа пользователей в приложение. В данном руководстве под базой данных всегда имеется в виду основное хранилище, если явно не оговорено другое. Основное хранилище должно представлять собой реляционную БД, подключенную через источник данных JDBC. Источник данных основного хранилища находится в JNDI с именем, указанным в свойстве приложения <a href="/manual.html#cuba.dataSourceJndiName">cuba.dataSourceJndiName</a> (по умолчанию <code>jdbc/CubaDS</code>).</p> 
       </div> 
       <div class="paragraph"> 
        <p>Имена дополнительных хранилищ указываются в свойстве приложения <a href="/manual.html#cuba.additionalStores">cuba.additionalStores</a>. Если дополнительное хранилище является реляционной БД (<code>RdbmsStore</code>), необходимо указать для него следующие свойства приложения:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>cuba.dataSourceJndiName_{store_name}</code> - JNDI-имя соответствующего источника данных JDBC.</p> </li> 
         <li> <p><code>cuba.dbmsType_{store_name}</code> - тип базы данных хранилища.</p> </li> 
         <li> <p><code>cuba.persistenceConfig_{store_name}</code> - путь к фалу <code>persistence.xml</code> хранилища.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Если вы реализовали интерфейс <code>DataStore</code> в проекте, укажите имя бина реализации в свойстве приложения <code>cuba.storeImpl_{store_name}</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Предположим, что в вашем проекте два дополнительных хранилища: <code>db1</code> (база данных PostgreSQL) and <code>mem1</code> (некоторое in-memory хранилище, реализованное бином проекта). Тогда необходимо указать следующие свойства приложения в файле <code>app.properties</code> модуля <strong>core</strong>:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="properties">cuba.additionalStores = db1, mem1
cuba.dataSourceJndiName_db1 = jdbc/db1
cuba.dbmsType_db1 = postgres
cuba.persistenceConfig_db1 = com/company/sample/db1-persistence.xml
cuba.storeImpl_mem1 = sample_InMemoryStore</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Свойства <code>cuba.additionalStores</code> и <code>cuba.persistenceConfig_db1</code> необходимо также указать в файлах свойств всех используемых блоков приложения (<code>web-app.properties</code>, <code>portal-app.properties</code>, и т.д.).</p> 
       </div> 
       <div class="admonitionblock tip"> 
        <table> 
         <tbody>
          <tr> 
           <td class="icon"> 
            <div class="title">
             Tip
            </div> </td> 
           <td class="content"> 
            <div class="paragraph"> 
             <p>CUBA Studio позволяет настраивать дополнительные хранилища на вкладке <strong>Project properties &gt; Advanced</strong>. Studio автоматически создает все необходимые свойства приложения и поддерживает соответствующие файлы <code>persistence.xml</code>. После этого хранилище можно будет указать в поле <strong>Data store</strong> редактора сущности. Кроме того, хранилище можно будет выбрать при запуске мастера <strong>Generate model</strong> для создания сущностей, отображенных на существующую схему БД.</p> 
            </div> </td> 
          </tr> 
         </tbody>
        </table> 
       </div> 
       <div id="cross_datastore_ref" class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Ссылки между сущностями из разных хранилищ
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p><a href="/manual.html#dataManager">DataManager</a> может автоматически поддерживать TO-ONE ссылки между сущностями из разных хранилищ, если они объявлены нужным образом. Например, рассмотрим случай, когда необходимо в сущности <code>Order</code>, находящейся в главном хранилище, иметь ссылку на сущность <code>Customer</code> из дополнительного хранилища. Необходимо сделать следующее:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p>В сущности <code>Order</code> определить атрибут типа, соответствующего идентификатору <code>Customer</code>. Атрибут должен быть аннотирован как <code>@SystemLevel</code> чтобы исключить его из различных списков, доступных пользователям, в частности из атрибутов в <a href="/manual.html#gui_Filter">Filter</a>:</p> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SystemLevel</span>
<span class="annotation">@Column</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">CUSTOMER_ID</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> <span class="predefined-type">Long</span> customerId;</code></pre> 
                </div> 
               </div> </li> 
              <li> <p>В сущности <code>Order</code> определить неперсистентный атрибут-ссылку на <code>Customer</code> и указать атрибут <code>customerId</code> как "related":</p> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transient</span>
<span class="annotation">@MetaProperty</span>(related = <span class="string"><span class="delimiter">"</span><span class="content">customerId</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> Customer customer;</code></pre> 
                </div> 
               </div> </li> 
              <li> <p>Включите неперсистентный атрибут <code>customer</code> в нужные <a href="/manual.html#views">представления</a>.</p> </li> 
             </ul> 
            </div> 
            <div class="paragraph"> 
             <p>После этого, когда <code>Order</code> будет загружается с представление, включающим атрибут <code>customer</code>, <code>DataManager</code> будет автоматически загружать связанные экземпляры <code>Customer</code> из дополнительного хранилища. Загрузка коллекций оптимизирована по производительности: после загрузки списка заказов загрузка покупателей из доп. хранилища производится пакетами. Размер пакета определяется свойством приложения <a href="/manual.html#cuba.crossDataStoreReferenceLoadingBatchSize">cuba.crossDataStoreReferenceLoadingBatchSize</a>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>При коммите графа объектов, включающего <code>Order</code> со ссылкой на <code>Customer</code>, <code>DataManager</code> сохранит сущности через соответствующие имплементации <code>DataStore</code>, а затем сохранит идентификатор <code>Customer</code> в атрибуте <code>customerId</code> сущности <code>Order</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Ссылки между сущностями из разных хранилищ поддерживаются компонентом <a href="/manual.html#gui_Filter">Filter</a>.</p> 
            </div> 
            <div class="admonitionblock tip"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Tip
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>CUBA Studio автоматически поддерживает набор атрибутов для ссылок между сущностями из разных хранилищ, если в качестве ассоциации выбирается сущность из другого хранилища.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
          </div> 
         </dd> 
        </dl> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="persistence"><a class="anchor" href="/manual.html#persistence"></a>5.4.3. Интерфейс Persistence</h4> 
       <div class="paragraph"> 
        <p>Интерфейс <code>Persistence</code> является точкой входа в функциональность хранения данных, предоставляемую слоем <a href="/manual.html#orm">ORM</a>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Методы интерфейса:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>createTransaction()</code>, <code>getTransaction()</code> - получить интерфейс управления <a href="/manual.html#transactions">транзакциями</a>. Методы могут принимать имя <a href="/manual.html#data_store">хранилища данных</a>. Если хранилище не указано, подразумевается основная база данных.</p> </li> 
         <li> <p><code>callInTransaction()</code>, <code>runInTransaction()</code> - выполнить код в новой транзакции с возвратом значения или без возврата значения. Методы могут принимать имя <a href="/manual.html#data_store">хранилища данных</a>. Если хранилище не указано, подразумевается основная база данных.</p> </li> 
         <li> <p><code>isInTransaction()</code> - определяет, существует ли в данный момент активная транзакция.</p> </li> 
         <li> <p><code>getEntityManager()</code> - возвращает экземпляр <a href="/manual.html#entityManager">EntityManager</a> для текущей транзакции. Метод может принимать имя <a href="/manual.html#data_store">хранилища данных</a>. Если хранилище не указано, подразумевается основная база данных.</p> </li> 
         <li> <p><code>isSoftDeletion()</code> - позволяет определить, активен ли режим <a href="/manual.html#soft_deletion">мягкого удаления</a></p> </li> 
         <li> <p><code>setSoftDeletion()</code> - устанавливает или отключает режим мягкого удаления. Влияет на аналогичный признак всех создаваемых экземпляров <code>EntityManager</code>. По умолчанию мягкое удаление включено.</p> </li> 
         <li> <p><code>getDbTypeConverter()</code> - возвращает экземпляр <a href="/manual.html#dbTypeConverter">DbTypeConverter</a> для основной базы данных или для дополнительного хранилища.</p> </li> 
         <li> <p><code>getDataSource()</code> - получить <code>javax.sql.DataSource</code> для основной базы данных или для дополнительного хранилища.</p> 
          <div class="admonitionblock warning"> 
           <table> 
            <tbody>
             <tr> 
              <td class="icon"> 
               <div class="title">
                Warning
               </div> </td> 
              <td class="content"> 
               <div class="paragraph"> 
                <p>Для всех объектов <code>javax.sql.Connection</code>, получаемых методом <code>getDataSource().getConnection()</code>, необходимо после использования соединения вызвать метод <code>close()</code> в секции <code>finally</code>. В противном случае соединение не вернется в пул, через какое-то время пул переполнится, и приложение не сможет выполнять запросы к базе данных.</p> 
               </div> </td> 
             </tr> 
            </tbody>
           </table> 
          </div> </li> 
         <li> <p><code>getTools()</code> - возвращает экземпляр интерфейса <code>PersistenceTools</code> (см. ниже).</p> </li> 
        </ul> 
       </div> 
       <div class="sect4"> 
        <h5 id="persistenceTools"><a class="anchor" href="/manual.html#persistenceTools"></a>5.4.3.1. PersistenceTools</h5> 
        <div class="paragraph"> 
         <p><a href="/manual.html#managed_beans">ManagedBean</a>, содержащий вспомогательные методы работы с хранилищем данных. Интерфейс <code>PersistenceTools</code> можно получить либо методом <code>Persistence.getTools()</code>, либо как любой другой бин - инжекцией или через класс <code>AppBeans</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Методы <code>PersistenceTools</code>:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>getDirtyFields()</code> - возвращает коллекцию имен атрибутов сущности, измененных со времени последней загрузки экземпляра из БД. Для новых экземпляров возвращает пустую коллекцию.</p> </li> 
          <li> <p><code>isLoaded()</code> - определяет, загружен ли из БД указанный атрибут экземпляра. Атрибут может быть <em>не</em> загружен, если он не указан в примененном при загрузке <a href="/manual.html#views">представлении</a>.</p> 
           <div class="paragraph"> 
            <p>Данный метод работает только для экземпляров в состоянии <a href="/manual.html#entity_states">Managed</a>.</p> 
           </div> </li> 
          <li> <p><code>getReferenceId()</code> - возвращает идентификатор связанной сущности без загрузки ее из БД.</p> 
           <div class="paragraph"> 
            <p>Предположим, в <a href="/manual.html#persistence_context">персистентный контекст</a> загружен экземпляр <code>Order</code>, и нужно получить значение идентификатора экземпляра <code>Customer</code>, связанного с данным Заказом. Стандартное решение <code>order.getCustomer().getId()</code> приведет к выполнению SQL запроса к БД для загрузки экземпляра <code>Customer</code>, что в данном случае избыточно, так как значение идентификатора Покупателя физически находится также и в таблице Заказов. Выполнение же</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java">persistence.getTools().getReferenceId(order, <span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>)</code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>не вызовет никаких дополнительных запросов к базе данных.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Данный метод работает только для экземпляров в состоянии <a href="/manual.html#entity_states">Managed</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Для расширения набора вспомогательных методов в конкретном приложении бин <code>PersistenceTools</code> можно <a href="/manual.html#bean_extension">переопределить</a>. Примеры работы с расширенным интерфейсом:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java">MyPersistenceTools tools = persistence.getTools();
tools.foo();</code></pre> 
         </div> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java">((MyPersistenceTools) persistence.getTools()).foo();</code></pre> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="dbTypeConverter"><a class="anchor" href="/manual.html#dbTypeConverter"></a>5.4.3.2. DbTypeConverter</h5> 
        <div class="paragraph"> 
         <p>Интерфейс, определяющий методы для конвертации данных между значениями атрибутов <a href="/manual.html#data_model">модели данных</a> и параметрами и результатами запросов JDBC. Объект данного интерфейса можно получить методом <code><a href="/manual.html#persistence">Persistence</a>.getDbTypeConverter()</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Методы <code>DbTypeConverter</code>:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>getJavaObject()</code> - конвертирует результат JDBC запроса в тип, подходящий для присвоения атрибуту сущности.</p> </li> 
          <li> <p><code>getSqlObject()</code> - конвертирует значение атрибута сущности в тип, подходящий для присвоения параметру JDBC запроса.</p> </li> 
          <li> <p><code>getSqlType()</code> - возвращает константу из <code>java.sql.Types</code>, соответствующую переданному типу атрибута сущности.</p> </li> 
         </ul> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="orm"><a class="anchor" href="/manual.html#orm"></a>5.4.4. Слой ORM</h4> 
       <div class="paragraph"> 
        <p>Object-Relational Mapping - объектно-реляционное отображение - технология связывания таблиц реляционной базы данных с объектами языка программирования.</p> 
       </div> 
       <div class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Преимущества использования ORM
         </dt> 
         <dd> 
          <div class="ulist"> 
           <ul> 
            <li> <p>Позволяет работать с данными реляционной СУБД, манипулируя объектами Java.</p> </li> 
            <li> <p>Упрощает программирование, избавляя от рутины написания тривиальных SQL-запросов.</p> </li> 
            <li> <p>Упрощает программирование, позволяя извлекать и сохранять целые графы объектов одной командой.</p> </li> 
            <li> <p>Обеспечивает легкое портирование приложения на различные СУБД.</p> </li> 
            <li> <p>Позволяет использовать лаконичный язык запросов <a href="/manual.html#jpql">JPQL</a>.</p> </li> 
           </ul> 
          </div> 
         </dd> 
         <dt class="hdlist1">
          Недостатки
         </dt> 
         <dd> 
          <div class="ulist"> 
           <ul> 
            <li> <p>Требует понимания особенностей работы с ORM.</p> </li> 
            <li> <p>Усложняет оптимизацию SQL и использование особенности применяемой СУБД.</p> </li> 
           </ul> 
          </div> 
         </dd> 
        </dl> 
       </div> 
       <div class="paragraph"> 
        <p>В платформе CUBA используется реализация ORM основе фреймворка <strong>EclipseLink</strong>.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="entityManager"><a class="anchor" href="/manual.html#entityManager"></a>5.4.4.1. EntityManager</h5> 
        <div class="paragraph"> 
         <p><code>EntityManager</code> - основной интерфейс ORM, служит для управления персистентными <a href="/manual.html#data_model">сущностями</a>.</p> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>В разделе <a href="/manual.html#dm_vs_em">DataManager vs. EntityManager</a> приведена информация о различиях между EntityManager и <a href="/manual.html#dataManager">DataManager</a>.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="paragraph"> 
         <p>Ссылку на <code>EntityManager</code> можно получить через интерфейс <code>Persistence</code>, вызовом метода <code>getEntityManager()</code>. Полученный экземпляр <code>EntityManager</code> привязан к текущей <a href="/manual.html#transactions">транзакции</a>, то есть все вызовы <code>getEntityManager()</code> в рамках одной транзакции возвращают один и тот же экземпляр <code>EntityManager</code>. После завершения транзакции обращения к данному экземпляру невозможны.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Экземпляр <code>EntityManager</code> содержит в себе <em>персистентный контекст</em> – набор экземпляров сущностей, загруженных из БД или только что созданных. Персистентный контекст является своего рода кэшем данных в рамках транзакции.<code>EntityManager</code> автоматически сбрасывает в БД все изменения, сделанные в его персистентном контексте, в момент коммита транзакции, либо при явном вызове метода <code>flush()</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Интерфейс <code>EntityManager</code>, используемый в CUBA-приложениях, в основном повторяет стандартный <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/EntityManager.html" target="_blank">javax.persistence.EntityManager</a>. Рассмотрим его основные методы:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>persist()</code> - вводит <a href="/manual.html#entity_states">новый экземпляр</a> сущности в персистентный контекст. При коммите транзакции командой SQL <code>INSERT</code> в БД будет создана соответствующая запись.</p> </li> 
          <li> <p><code>merge()</code> - переносит состояние <a href="/manual.html#entity_states">отсоединенного экземпляра</a> сущности в персистентный контекст следующим образом: из БД загружается экземпляр с тем же идентификатором, в него переносится состояние переданного Detached экземпляра и возвращается загруженный Managed экземпляр. Далее надо работать именно с возвращенным Managed экземпляром. При коммите транзакции командой SQL <code>UPDATE</code> в БД будет сохранено состояние данного экземпляра.</p> </li> 
          <li> <p><code>remove()</code> - удалить объект из базы данных, либо, если включен режим <a href="/manual.html#soft_deletion">мягкого удаления</a>, установить атрибуты <code>deleteTs</code> и <code>deletedBy</code>.</p> 
           <div class="paragraph"> 
            <p>Если переданный экземпляр находится в Detached состоянии, сначала выполняется <code>merge()</code>.</p> 
           </div> </li> 
          <li> <p><code>find()</code> - загружает экземпляр сущности по идентификатору.</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>При формировании запроса к БД учитывается <a href="/manual.html#views">представление</a>, переданное в параметре данного метода. В результате в персистентном контексте окажется граф объектов, для которого загружены все атрибуты представления.</p> 
             </div> 
             <div class="admonitionblock tip"> 
              <table> 
               <tbody>
                <tr> 
                 <td class="icon"> 
                  <div class="title">
                   Tip
                  </div> </td> 
                 <td class="content"> 
                  <div class="paragraph"> 
                   <p>В отличие от <a href="/manual.html#dataManager">DataManager</a>, все локальные атрибуты сущностей загружаются наезависимо от того, указаны ли они в представлении или нет. В <code>EntityManager</code> представление влияет только на загрузку атрибутов-ссылок.</p> 
                  </div> </td> 
                </tr> 
               </tbody>
              </table> 
             </div> 
            </div> 
           </div> </li> 
          <li> <p><code>createQuery()</code> - создать объект <code>Query</code> или <code>TypedQuery</code> для выполнения <a href="/manual.html#query">JPQL запроса</a>.</p> </li> 
          <li> <p><code>createNativeQuery()</code> - создать объект <code>Query</code> для выполнения <a href="/manual.html#nativeQuery">SQL запроса</a>.</p> </li> 
          <li> <p><code>addView()</code> - аналогичен методу <code>setView()</code>, но в случае наличия уже установленного в <code>EntityManager</code> представления, не заменяет его, а добавляет атрибуты переданного представления.</p> </li> 
          <li> <p><code>reload()</code> - перезагрузить экземпляр сущности с указанным <a href="/manual.html#views">представлением</a>.</p> </li> 
          <li> <p><code>isSoftDeletion()</code> - проверяет, находится ли данный <code>EntityManager</code> в режиме <a href="/manual.html#soft_deletion">мягкого удаления</a>.</p> </li> 
          <li> <p><code>setSoftDeletion()</code> - устанавливает режим <a href="/manual.html#soft_deletion">мягкого удаления</a> для данного экземпляра <code>EntityManager</code>.</p> </li> 
          <li> <p><code>getConnection()</code> - возвращает <code>java.sql.Connection</code>, через который выполняет запросы данный экземпляр <code>EntityManager</code>, и, соответственно, текущая транзакция. Закрывать такое соединение не нужно, оно будет закрыто при завершении транзакции.</p> </li> 
          <li> <p><code>getDelegate()</code> - возвращает <code>javax.persistence.EntityManager</code>, предоставляемый реализацией ORM.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Пример использования <code>EntityManager</code> в <a href="/manual.html#services">сервисе</a>:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Service</span>(SalesService.NAME)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SalesServiceBean</span> <span class="directive">implements</span> SalesService {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Persistence persistence;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">BigDecimal</span> calculateSales(<span class="predefined-type">UUID</span> customerId) {
        <span class="predefined-type">BigDecimal</span> result;
        <span class="comment">// start transaction</span>
        <span class="keyword">try</span> (Transaction tx = persistence.createTransaction()) {
            <span class="comment">// get EntityManager for the current transaction</span>
            EntityManager em = persistence.getEntityManager();
            <span class="comment">// create and execute Query</span>
            <span class="predefined-type">Query</span> query = em.createQuery(
                    <span class="string"><span class="delimiter">"</span><span class="content">select sum(o.amount) from sample$Order o where o.customer.id = :customerId</span><span class="delimiter">"</span></span>);
            query.setParameter(<span class="string"><span class="delimiter">"</span><span class="content">customerId</span><span class="delimiter">"</span></span>, customerId);
            result = (<span class="predefined-type">BigDecimal</span>) query.getFirstResult();
            <span class="comment">// commit transaction</span>
            tx.commit();
        }
        <span class="keyword">return</span> result != <span class="predefined-constant">null</span> ? result : <span class="predefined-type">BigDecimal</span>.ZERO;
    }
}</code></pre> 
         </div> 
        </div> 
        <div id="em_partial_entities" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Частичные сущности
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>По умолчанию, представления в EntityManager влияют только на загрузку связей, т.е. все локальные атрибуты всегда загружаются.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Вы можете заставить EntityManager загружать <em>частичные</em> сущности, если установите атрибут <code>loadPartialEntities</code> представления в true. Однако, если загружаемая сущность <a href="/manual.html#entity_cache">кэшируется</a>, данный признак игнорируется, и сущность все равно будет загружена со всеми локальными атрибутами.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="entity_states"><a class="anchor" href="/manual.html#entity_states"></a>5.4.4.2. Состояния сущности</h5> 
        <div class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           New
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Только что созданный в памяти экземпляр, например: <code>Car car = new Car()</code>. Новый экземпляр может быть передан в <code>EntityManager.persist()</code> для сохранения в БД, при этом он переходит в состояние Managed.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Managed
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Загруженный из БД или новый, переданный в EntityManager.persist(), экземпляр. Принадлежит некоторому экземпляру <code>EntityManager</code>, другими словами, находится в его персистентном контексте.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Любые изменения экземпляра в состоянии Managed будут сохранены в БД в случае коммита транзакции, к которой принадлежит данный <code>EntityManager</code>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Detached
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Экземпляр, загруженный из БД и отсоединенный от своего персистентного контекста (вследствие завершения транзакции или сериализации).</p> 
             </div> 
             <div class="paragraph"> 
              <p>Изменения, вносимые в Detached экземпляр, запоминаются в самом этом экземпляре (в полях, добавленных с помощью bytecode enhancement). Эти изменения будут сохранены в БД, только если данный экземпляр будет снова переведен в состояние Managed путем передачи в метод <code>EntityManager.merge()</code>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="lazy_loading"><a class="anchor" href="/manual.html#lazy_loading"></a>5.4.4.3. Загрузка по требованию</h5> 
        <div class="paragraph"> 
         <p>Загрузка по требованию (lazy loading) позволяет загружать связанные сущности отложенно, т.е. только в момент первого обращения к их свойствам.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Загрузка по требованию в сумме порождает больше запросов к БД, чем <a href="/manual.html#eager_fetching">жадная загрузка</a> (eager fetching), однако нагрузка при этом растянута во времени.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Например, при извлечении списка N экземпляров сущности A, содержащих ссылку на экземпляр сущности B, в случае загрузки по требованию будет выполнено N+1 запросов к базе данных.</p> </li> 
          <li> <p>Как правило, для минимизации времени отклика и снижения нагрузки необходимо стремиться к меньшему количеству обращений к БД. Для этого в платформе используется механизм <a href="/manual.html#views">представлений</a>, с помощью которого в вышеописанном случае ORM может сформировать один запрос к БД с объединением таблиц.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Загрузка по требованию работает только для экземпляра в состоянии <a href="/manual.html#entity_states">Managed</a>, то есть внутри транзакции, загрузившей данный экземпляр.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="query"><a class="anchor" href="/manual.html#query"></a>5.4.4.4. Выполнение JPQL запросов</h5> 
        <div class="paragraph"> 
         <p>Для выполнения <a href="/manual.html#jpql">JPQL</a> запросов предназначен интерфейс <code>Query</code>, ссылку на который можно получить у текущего экземпляра <code>EntityManager</code> вызовом метода <code>createQuery()</code>. Если запрос предполагается использовать для извлечения сущностей, рекомендуется вызывать <code>createQuery()</code> с передачей типа результата, что приведет к созданию <code>TypedQuery</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Методы <code>Query</code> в основном соответствуют методам стандартного интерфейса JPA <a href="http://docs.oracle.com/javaee/7/api/javax/persistence/Query.html" target="_blank"><code>javax.persistence.Query</code></a>. Рассмотрим отличия.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>setParameter()</code> - устанавливает значение параметра запроса. При передаче в данный метод экземпляра сущности выполняет неявное преобразование экземпляра в его идентификатор. Например:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java">Customer customer = ...;
TypedQuery&lt;Order&gt; query = entityManager.createQuery(
    <span class="string"><span class="delimiter">"</span><span class="content">select o from sales$Order o where o.customer.id = ?1</span><span class="delimiter">"</span></span>, Order.class);
query.setParameter(<span class="integer">1</span>, customer);</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Обратите внимание на сравнение в запросе по идентификатору, но передачу в качестве параметра самого экземпляра сущности.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Вариант метода с передачей <code>implicitConversions = false</code> не выполняет такого преобразования.</p> 
           </div> </li> 
          <li> <p><code>setView()</code>, <code>addView()</code> - устанавливают <a href="/manual.html#views">представление</a>, используемое при загрузке данных.</p> </li> 
          <li> <p><code>getDelegate()</code> - возвращает экземпляр <code>javax.persistence.Query</code>, предоставляемый реализацией ORM.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Если для <code>Query</code> установлено <a href="/manual.html#views">представление</a>, то по умолчанию <code>Query</code> имеет <code>FlushModeType.AUTO</code>, что влияет на случай, когда в текущем персистентном контексте содержатся измененные экземпляры сущностей: эти экземпляры будут сохранены в БД перед выполнением запроса. Другими словами, ORM сначала синхронизирует состояние сущностей в персистентном контексте и в БД, а уже потом выполняет запрос. Этим гарантируется, что в результаты запроса попадут все соответствующие экземпляры, даже если они еще не были сохранены в базе данных явно. Обратной стороной этого является неявный flush, т.е. выполнение команд SQL update для всех измененных в данном контексте сущностей, что может повлиять на производительность.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Если же <code>Query</code> выполняется без представления, то по умолчанию <code>Query</code> имеет <code>FlushModeType.COMMIT</code>, что означает, что неявный flush вызван не будет, и запрос не будет учитывать содержимое текущего персистентного контекста.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В большинстве случаев игнорирование текущего персистентного контекста допустимо, и является предпочтительным поведением, так как не вызывает дополнительных команд SQL. Однако, при использовании представлений существует следующая проблема: если в персистентном контексте есть измененный экземпляр сущности, и выполняется запрос с представлением и <code>FlushModeType.COMMIT</code>, загружающий этот же экземпляр, то изменения будут потеряны. Поэтому по умолчанию мы используем <code>FlushModeType.AUTO</code> для запросов с представлением.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Вы также можете явно установить flush mode с помощью метода <code>setFlushMode()</code> интерфейса <code>Query</code>, чтобы переопределить режим по умолчанию.</p> 
        </div> 
        <div class="sect5"> 
         <h6 id="jpql_functions"><a class="anchor" href="/manual.html#jpql_functions"></a>5.4.4.4.1. Функции JPQL</h6> 
         <div class="paragraph"> 
          <p>В таблице ниже описаны функции JPQL, поддерживаемые и не поддерживаемые платформой CUBA.</p> 
         </div> 
         <table class="tableblock frame-all grid-all spread"> 
          <colgroup> 
           <col style="width: 14%;"> 
           <col style="width: 14%;"> 
           <col style="width: 71%;"> 
          </colgroup> 
          <thead> 
           <tr> 
            <th class="tableblock halign-left valign-top">Функция</th> 
            <th class="tableblock halign-left valign-top">Поддерживается</th> 
            <th class="tableblock halign-left valign-top">Пример запроса</th> 
           </tr> 
          </thead> 
          <tbody> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Агрегатные функции</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT AVG(o.quantity) FROM app$Order o</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: агрегатные функции со скалярными выражениями (особенность EclipseLink)</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT AVG(o.quantity)/2.0 FROM app$Order o</em> </code></p><p class="tableblock"><code><em>SELECT AVG(o.quantity * o.price) FROM app$Order o</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ALL, ANY, SOME</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT emp FROM app$Employee emp WHERE emp.salary &gt; ALL (SELECT m.salary FROM app$Manager m WHERE m.department = emp.department)</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">Арифметические функции (INDEX, SIZE, ABS, SQRT, MOD)</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT w.name FROM app$Course c JOIN c.studentWaitlist w WHERE c.name = 'Calculus' AND INDEX(w) = 0 </code></p><p class="tableblock"><code> SELECT w.name FROM app$Course c WHERE c.name = 'Calculus' AND SIZE(c.studentWaitlist) = 1 </code></p><p class="tableblock"><code> SELECT w.name FROM app$Course c WHERE c.name = 'Calculus' AND ABS(c.time) = 10 </code></p><p class="tableblock"><code> SELECT w.name FROM app$Course c WHERE c.name = 'Calculus' AND SQRT(c.time) = 10.5 </code></p><p class="tableblock"><code> SELECT w.name FROM app$Course c WHERE c.name = 'Calculus' AND MOD(c.time, c.time1) = 2</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CASE</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT e.name, f.name, CONCAT(CASE WHEN f.annualMiles &gt; 50000 THEN 'Platinum ' WHEN f.annualMiles &gt; 25000 THEN 'Gold ' ELSE '' END, 'Frequent Flyer') FROM app$Employee e JOIN e.frequentFlierPlan f</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: CASE в UPDATE-запросе</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>UPDATE app$Employee e SET e.salary = CASE e.rating WHEN 1 THEN e.salary * 1.1 WHEN 2 THEN e.salary * 1.05 ELSE e.salary * 1.01 END</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">Функции даты и времени (CURRENT_DATE, CURRENT_TIME, CURRENT_TIMESTAMP)</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT e FROM app$Order e WHERE e.date = CURRENT_DATE</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Функции EclipseLink (CAST, REGEXP, EXTRACT)</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT EXTRACT(YEAR FROM e.createTs) FROM app$MyEntity e WHERE EXTRACT(YEAR FROM e.createTs) &gt; 2012 </code></p><p class="tableblock"><code> SELECT e FROM app$MyEntity e WHERE e.name REGEXP '.*' </code></p><p class="tableblock"><code> SELECT CAST(e.number text) FROM app$MyEntity e WHERE e.path LIKE CAST(:ds$myEntityDs.id text)</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: CAST в запросе GROUP BY</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT e FROM app$Order e WHERE e.amount &gt; 100 GROUP BY CAST(e.orderDate date)</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Операторы типов сущности</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА: тип сущности передаётся как параметр</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT e FROM app$Employee e WHERE TYPE(e) IN (:empType1, :empType2)</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: прямая ссылка на сущность</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT e FROM app$Employee e WHERE TYPE(e) IN (app$Exempt, app$Contractor)</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Вызов функций</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА: результат с операторами сравнения</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT u FROM sec$User u WHERE function('DAYOFMONTH', u.createTs) = 1</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: прямое использование результата функции</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT u FROM sec$User u WHERE function('hasRoles', u.createdBy, u.login)</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">IN</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT e FROM Employee e, IN(e.projects) p WHERE p.budget &gt; 1000000</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">IS EMPTY для коллекций</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT e FROM Employee e WHERE e.projects IS EMPTY</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">KEY/VALUE</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT v.location.street, KEY(i).title, VALUE(i) FROM app$VideoStore v JOIN v.videoInventory i WHERE v.location.zipcode = '94301' AND VALUE(i) &gt; 0</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Литералы</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT e FROM app$Employee e WHERE e.name = 'Bob' </code></p><p class="tableblock"><code> SELECT e FROM app$Employee e WHERE e.id = 1234 </code></p><p class="tableblock"><code> SELECT e FROM app$Employee e WHERE e.id = 1234L </code></p><p class="tableblock"><code> SELECT s FROM app$Stat s WHERE s.ratio &gt; 3.14F </code></p><p class="tableblock"><code> SELECT s FROM app$Stat s WHERE s.ratio &gt; 3.14e32D </code></p><p class="tableblock"><code> SELECT e FROM app$Employee e WHERE e.active = TRUE</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: литералы даты и времени</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT e FROM app$Employee e WHERE e.startDate = {d'2012-01-03'}</em> </code></p><p class="tableblock"><code> <em>SELECT e FROM app$Employee e WHERE e.startTime = {t'09:00:00'}</em> </code></p><p class="tableblock"><code> <em>SELECT e FROM app$Employee e WHERE e.version = {ts'2012-01-03 09:00:00.000000001'}</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">MEMBER OF</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА: для полей и запросов</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT d FROM app$Department d WHERE (select e from app$Employee e where e.id = :eParam) MEMBER OF e.employees</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: для литералов</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT e FROM app$Employee e WHERE 'write code' MEMBER OF e.codes</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">NEW в SELECT</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT NEW com.acme.example.CustomerDetails(c.id, c.status, o.count) FROM app$Customer c JOIN c.orders o WHERE o.count &gt; 100</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">NULLIF/COALESCE</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT NULLIF(emp.salary, 10) FROM app$Employee emp </code></p><p class="tableblock"><code> SELECT COALESCE(emp.salary, emp.salaryOld, 10) FROM app$Employee emp</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">NULLS FIRST, NULLS LAST в order by</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT h FROM sec$GroupHierarchy h ORDER BY h.level DESC NULLS FIRST</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Строковые функции (CONCAT, SUBSTRING, TRIM, LOWER, UPPER, LENGTH, LOCATE)</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT x FROM app$Magazine x WHERE CONCAT(x.title, 's') = 'JDJs' </code></p><p class="tableblock"><code> SELECT x FROM app$Magazine x WHERE SUBSTRING(x.title, 1, 1) = 'J' </code></p><p class="tableblock"><code> SELECT x FROM app$Magazine x WHERE LOWER(x.title) = 'd' </code></p><p class="tableblock"><code> SELECT x FROM app$Magazine x WHERE UPPER(x.title) = 'D' </code></p><p class="tableblock"><code> SELECT x FROM app$Magazine x WHERE LENGTH(x.title) = 10 </code></p><p class="tableblock"><code> SELECT x FROM app$Magazine x WHERE LOCATE('A', x.title, 4) = 6 </code></p><p class="tableblock"><code> SELECT x FROM app$Magazine x WHERE TRIM(TRAILING FROM x.title) = 'D'</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: TRIM не поддерживается с trim char</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT x FROM app$Magazine x WHERE TRIM(TRAILING 'J' FROM x.title) = 'D'</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Вложенные запросы</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT goodCustomer FROM app$Customer goodCustomer WHERE goodCustomer.balanceOwed &lt; (SELECT AVG(c.balanceOwed) FROM app$Customer c)</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: path-выражения вместо имени сущности в FROM подзапроса</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT c FROM app$Customer c WHERE (SELECT AVG(o.price) FROM c.orders o) &gt; 100</em></code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TREAT</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock">ДА</p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code>SELECT e FROM app$Employee e JOIN TREAT(e.projects AS app$LargeProject) p WHERE p.budget &gt; 1000000</code></p></td> 
           </tr> 
           <tr> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><em>НЕТ: TREAT в WHERE-выражениях</em></p></td> 
            <td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>SELECT e FROM Employee e JOIN e.projects p WHERE TREAT(p as LargeProject).budget &gt; 1000000</em></code></p></td> 
           </tr> 
          </tbody> 
         </table> 
        </div> 
        <div class="sect5"> 
         <h6 id="query_case_insensitive"><a class="anchor" href="/manual.html#query_case_insensitive"></a>5.4.4.4.2. Поиск подстроки без учета регистра</h6> 
         <div class="paragraph"> 
          <p>Для удобного формирования условия поиска без учета регистра символов и по любой части строки можно использовать префикс <code>(?i)</code> в значении параметра запроса. Например, имеется запрос:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="jpql">select c from sales$Customer c where c.name like :name</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Если в значении параметра <code>name</code> передать строку <code>(?i)%doe%</code>, то при наличии в БД записи со значением <code>John Doe</code> она будет найдена, несмотря на раличие в регистре символа. Это произойдет потому, что ORM выполнит SQL с условием вида <code>lower(C.NAME) like ?</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Следует иметь в виду, что при таком поиске индекс, созданный в БД по полю <code>NAME</code>, не используется.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="jpql_macro"><a class="anchor" href="/manual.html#jpql_macro"></a>5.4.4.4.3. Макросы в JPQL</h6> 
         <div class="paragraph"> 
          <p>Текст JPQL запроса может включать макросы, которые обрабатываются перед выполнением и превращаются в исполняемый JPQL, дополнительно модифицируя набор параметров.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Макросы решают следующие задачи:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Позволяют обойти принципиальную невозможность средствами JPQL выразить условие зависимости значения поля от текущего момента времени (не работает арифметика типа current_date-1)</p> </li> 
           <li> <p>Позволяют сравнивать с датой поля типа Timestamp (содержащие дату+время)</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Рассмотрим их подробно:</p> 
         </div> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            @between
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Имеет вид <code>@between(field_name, moment1, moment2, time_unit)</code>, где</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>field_name</code> - имя атрибута для сравнения</p> </li> 
                <li> <p><code>moment1</code>, <code>moment2</code> - моменты времени, в которые должно попасть значение атрибута <code>field_name</code>. Каждый из моментов должен быть определен выражением с участием переменной <code>now</code>, к которой может быть прибавлено или отнято целое число</p> </li> 
                <li> <p><code>time_unit</code> - определяет единицу измерения времени, которое прибавляется или вычитается из <code>now</code> в выражениях моментов, а также точность округления моментов. Может быть следующим: <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>minute</code>, <code>second</code>.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Макрос преобразуется в следующее выражение JPQL: <code>field_name &gt;= :moment1 and field_name &lt; :moment2</code></p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример 1. Покупатель создан сегодня:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="jpql">select c from sales$Customer where @between(c.createTs, now, now+1, day)</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Пример 2. Покупатель создан в течение последних 10 минут:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="jpql">select c from sales$Customer where @between(c.createTs, now-10, now, minute)</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Пример 3. Документы, датированные последними 5 рабочими днями (для проектов, включающих <strong>workflow</strong>):</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="jpql">select d from sales$Doc where @between(d.createTs, now-5, now, workday)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
           <dt class="hdlist1">
            @today
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Имеет вид <code>@today(field_name)</code> и обеспечивает формирование условия попадания значения атрибута в текущий день. По сути это частный случай макроса <code>@between</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример. Пользователь создан сегодня:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="jpql">select d from sales$Doc where @today(d.createTs)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
           <dt class="hdlist1">
            @dateEquals
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Имеет вид <code>@dateEquals(field_name, parameter)</code> и позволяет сформировать условие попадания значения поля <code>field_name</code> типа <code>Timestamp</code> в дату, задаваемую параметром <code>parameter</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="jpql">select d from sales$Doc where @dateEquals(d.createTs, :param)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
           <dt class="hdlist1">
            @dateBefore
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Имеет вид <code>@dateBefore(field_name, parameter</code>) и позволяет сформировать условие, что дата значения поля <code>field_name</code> типа <code>Timestamp</code> меньше даты, задаваемой параметром <code>parameter</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="jpql">select d from sales$Doc where @dateBefore(d.createTs, :param)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
           <dt class="hdlist1">
            @dateAfter
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Имеет вид <code>@dateAfter(field_name, parameter</code>) и позволяет сформировать условие, что дата значения поля <code>field_name</code> типа <code>Timestamp</code> больше или равна дате, задаваемой параметром <code>parameter</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="jpql">select d from sales$Doc where @dateAfter(d.createTs, :param)</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
           <dt class="hdlist1">
            @enum
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Позволяет использовать полное имя константы enum вместо ее идентификатора в БД. Это упрощает поиск использований enum в коде приложения.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="jpql">select r from sec$Role where r.type = @enum(com.haulmont.cuba.security.entity.RoleType.SUPER) order by r.name</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="nativeQuery"><a class="anchor" href="/manual.html#nativeQuery"></a>5.4.4.5. Выполнение SQL запросов</h5> 
        <div class="paragraph"> 
         <p>ORM позволяет выполнять SQL запросы к базе данных, возвращая как списки отдельных полей, так и экземпляры сущностей. Для этого необходимо создать объект <code>Query</code> или <code>TypedQuery</code> вызовом одного из методов <code>EntityManager.createNativeQuery()</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Если выполняется выборка отдельных колонок таблицы, то результирующий список будет содержать строки в виде <code>Object[]</code>. Например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query = persistence.getEntityManager().createNativeQuery(
        <span class="string"><span class="delimiter">"</span><span class="content">select ID, NAME from SALES_CUSTOMER where NAME like ?1</span><span class="delimiter">"</span></span>);
query.setParameter(<span class="integer">1</span>, <span class="string"><span class="delimiter">"</span><span class="content">%Company%</span><span class="delimiter">"</span></span>);
<span class="predefined-type">List</span> list = query.getResultList();
<span class="keyword">for</span> (<span class="predefined-type">Iterator</span> it = list.iterator(); it.hasNext(); ) {
    <span class="predefined-type">Object</span><span class="type">[]</span> row = (<span class="predefined-type">Object</span><span class="type">[]</span>) it.next();
    <span class="predefined-type">UUID</span> id = (<span class="predefined-type">UUID</span>) row[<span class="integer">0</span>];
    <span class="predefined-type">String</span> name = (<span class="predefined-type">String</span>) row[<span class="integer">1</span>];
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Если выполняется выборка единственной колонки или агрегатной функции, то результирующий список будет содержать эти значения непосредственно:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Query</span> query = persistence.getEntityManager().createNativeQuery(
        <span class="string"><span class="delimiter">"</span><span class="content">select count(*) from SEC_USER where login = #login</span><span class="delimiter">"</span></span>);
query.setParameter(<span class="string"><span class="delimiter">"</span><span class="content">login</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">admin</span><span class="delimiter">"</span></span>);
<span class="type">long</span> count = (<span class="type">long</span>) query.getSingleResult();</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Если вместе с текстом запроса передан класс результирующей сущности, то возвращается <code>TypedQuery</code> и после выполнения производится попытка отображения результатов запроса на атрибуты сущности. Например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java">TypedQuery&lt;Customer&gt; query = em.createNativeQuery(
    <span class="string"><span class="delimiter">"</span><span class="content">select * from SALES_CUSTOMER where NAME like ?1</span><span class="delimiter">"</span></span>,
    Customer.class);
query.setParameter(<span class="integer">1</span>, <span class="string"><span class="delimiter">"</span><span class="content">%Company%</span><span class="delimiter">"</span></span>);
<span class="predefined-type">List</span>&lt;Customer&gt; list = query.getResultList();</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Следует иметь в виду, что при использовании SQL колонки, соответствующие атрибутам сущностей типа <code>UUID</code>, возвращаются в виде <code>UUID</code> или в виде <code>String</code>, в зависимости от используемой СУБД:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><strong>HSQLDB</strong> - <code>String</code></p> </li> 
          <li> <p><strong>PostgreSQL</strong> - <code>UUID</code></p> </li> 
          <li> <p><strong>Microsoft SQL Server</strong> - <code>String</code></p> </li> 
          <li> <p><strong>Oracle</strong> - <code>String</code></p> </li> 
          <li> <p><strong>MySQL</strong> – <code>String</code></p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Параметры этого типа также должны задаваться либо как <code>UUID</code>, либо своим строковым представлением, в зависимости от используемой СУБД. Для обеспечения независимости кода от используемой СУБД рекомендуется использовать <a href="/manual.html#dbTypeConverter">DbTypeConverter</a>, который обеспечивает конвертацию данных между объектами Java и параметрами и результатами JDBC.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В SQL запросах можно использовать позиционные или именованные параметры. Позиционные параметры обозначаются ? с последующим номером параметра начиная с 1. Именованные параметры обозначаются знаком #. См. примеры выше.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Поведение SQL запросов, возвращающих сущности, и модифицирующих запросов (<code>update</code>, <code>delete</code>), по отношению к текущему персистентному контексту аналогично описанному для <a href="/manual.html#query">JPQL запросов</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>См. также <a href="/manual.html#queryRunner">Выполнение SQL с помощью QueryRunner</a>.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="entity_listeners"><a class="anchor" href="/manual.html#entity_listeners"></a>5.4.4.6. Entity Listeners</h5> 
        <div class="paragraph"> 
         <p><em>Entity Listeners</em> предназначены для реакции на события жизненного цикла экземпляров сущностей на уровне Middleware.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Слушатель представляет собой класс, реализующий один или несколько интерфейсов пакета <code>com.haulmont.cuba.core.listener</code>. Слушатель будет реагировать на события типов, соответствующих реализуемым интерфейсам.</p> 
        </div> 
        <div class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           BeforeDetachEntityListener
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Метод <code>onBeforeDetach()</code> вызывается перед отделением объекта от <a href="/manual.html#entityManager">EntityManager</a> при коммите транзакции.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Данный слушатель можно использовать, например, для заполнения неперсистентных атрибутов сущности перед отправкой ее на клиентский уровень.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           BeforeAttachEntityListener
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Метод <code>onBeforeAttach()</code> вызывается перед введением объекта в персистентный контекст при выполнении операции <code>EntityManager.merge()</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Данный слушатель можно использовать, например, для заполнения персистентных атрибутов сущности перед сохранением ее в базе данных.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           BeforeInsertEntityListener
          </dt> 
          <dd> 
           <p>Метод <code>onBeforeInsert()</code> вызывается перед выполнением вставки записи в БД. В данном методе возможны любые операции с текущим <code>EntityManager</code>.</p> 
          </dd> 
          <dt class="hdlist1">
           AfterInsertEntityListener
          </dt> 
          <dd> 
           <p>Метод <code>onAfterInsert()</code> вызывается после выполнения вставки записи в БД, но до коммита транзакции. В данном методе нельзя модифицировать текущий персистентный контекст, однако можно производить изменения в БД с помощью <a href="/manual.html#queryRunner">QueryRunner</a>.</p> 
          </dd> 
          <dt class="hdlist1">
           BeforeUpdateEntityListener
          </dt> 
          <dd> 
           <p>Метод <code>onBeforeUpdate()</code> вызывается перед изменением записи в БД. В данном методе возможны любые операции с текущим <code>EntityManager</code>.</p> 
          </dd> 
          <dt class="hdlist1">
           AfterUpdateEntityListener
          </dt> 
          <dd> 
           <p>Метод <code>onAfterUpdate()</code> вызывается после изменения записи в БД, но до коммита транзакции. В данном методе нельзя модифицировать текущий персистентный контекст, однако можно производить изменения в БД с помощью <code>QueryRunner</code>.</p> 
          </dd> 
          <dt class="hdlist1">
           BeforeDeleteEntityListener
          </dt> 
          <dd> 
           <p>Метод <code>onBeforeDelete()</code> вызывается перед удалением записи из БД (или в случае <a href="/manual.html#soft_deletion">мягкого удаления</a> - перед изменением записи). В данном методе возможны любые операции с текущим <code>EntityManager</code>.</p> 
          </dd> 
          <dt class="hdlist1">
           AfterDeleteEntityListener
          </dt> 
          <dd> 
           <p>Метод <code>onAfterDelete()</code> вызывается после удаления записи из БД (или в случае мягкого удаления - после изменения записи), но до коммита транзакции. В данном методе нельзя модифицировать текущий персистентный контекст, однако можно производить изменения в БД с помощью <code>QueryRunner</code>.</p> 
          </dd> 
         </dl> 
        </div> 
        <div class="paragraph"> 
         <p>Entity Listener должен являться управляемым бином, поэтому в нем можно использовать инжекцию:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>(<span class="string"><span class="delimiter">"</span><span class="content">sample_MyEntityListener</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyEntityListener</span> <span class="directive">implements</span>
        BeforeInsertEntityListener&lt;MyEntity&gt;,
        BeforeUpdateEntityListener&lt;MyEntity&gt; {

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> Metadata metadata;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onBeforeInsert(MyEntity entity, EntityManager entityManager) {
        Foo foo = metadata.create(Foo.class);
        ...
        entity.setFoo(foo);
        entityManager.persist(foo);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onBeforeUpdate(MyEntity entity, EntityManager entityManager) {
        Foo foo = entityManager.find(Foo.class, entity.getFoo().getId());
        ...
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Entity Listener может быть задан двумя способами:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Статически - имена бинов слушателей указываются в аннотации <a href="/manual.html#listeners_annotation">@Listeners</a> на классе сущности:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Entity</span>(...)
<span class="annotation">@Table</span>(...)
<span class="annotation">@Listeners</span>(<span class="string"><span class="delimiter">"</span><span class="content">sample_MyEntityListener</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyEntity</span> <span class="directive">extends</span> StandardEntity {
    ...
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Динамически - имя бина слушателя передается в метод <code>addListener()</code> бина <code>EntityListenerManager</code>. Пример динамического добавления слушателя рассматривается в разделе рецептов разработки: <a href="/manual.html#app_start_recipe">Выполнение кода на старте приложения</a>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Для всех экземпляров некоторого класса сущности создается <em>один</em> экземпляр слушателя определенного типа, поэтому слушатель <em>не должен иметь состояния</em>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Если для сущности объявлены несколько слушателей одного типа (например, аннотациями класса сущности и его предков, плюс динамически), то их вызов будет выполняться в следующем порядке:</p> 
        </div> 
        <div class="olist arabic"> 
         <ol class="arabic"> 
          <li> <p>Для каждого предка, начиная с самого дальнего, вызываются его динамически добавленные слушатели, затем статически назначенные.</p> </li> 
          <li> <p>После всех предков вызываются динамически добавленные слушатели данного класса, затем статически назначенные.</p> </li> 
         </ol> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Если требуются некоторые вычисления и изменение атрибутов сразу <em>нескольких</em> экземпляров сущностей при коммите транзакции, рассмотрите также возможность использования <a href="/manual.html#transaction_listeners">transaction listener</a>.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="transactions"><a class="anchor" href="/manual.html#transactions"></a>5.4.5. Управление транзакциями</h4> 
       <div class="paragraph"> 
        <p>В данном разделе рассмотрены различные аспекты управления транзакциями в CUBA-приложениях.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="transactions_prog"><a class="anchor" href="/manual.html#transactions_prog"></a>5.4.5.1. Программное управление транзакциями</h5> 
        <div class="paragraph"> 
         <p>Программное управление транзакциями осуществляется с помощью интерфейса <code>com.haulmont.cuba.core.Transaction</code>, ссылку на который можно получить методами <code>createTransaction()</code> или <code>getTransaction()</code> интерфейса инфраструктуры <a href="/manual.html#persistence">Persistence</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Метод <code>createTransaction()</code> создает новую транзакцию и возвращает интерфейс <code>Transaction</code>. Последующие вызовы методов <code>commit()</code>, <code>commitRetaining()</code>, <code>end()</code> этого интерфейса управляют созданной транзакцией. Если в момент создания существовала другая транзакция, то она будет приостановлена, и возобновлена после завершения созданной.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Метод <code>getTransaction()</code> вызывает либо создание новой, либо присоединение к текущей транзакции. Если в момент вызова существовала активная транзакция, то метод успешно завершается, и последующие вызовы <code>commit()</code>, <code>commitRetaining()</code>, <code>end()</code> не оказывают никакого влияния на существующую транзакцию. Однако если <code>end()</code> вызван без предварительного вызова <code>commit()</code>, то текущая транзакция помечается как <code>RollbackOnly</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Примеры программного управления транзакцией:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Metadata metadata;
<span class="annotation">@Inject</span>
<span class="directive">private</span> Persistence persistence;
...
<span class="comment">// try-with-resources style</span>
try (Transaction tx = persistence.createTransaction()) {
    Customer customer = metadata.create(Customer.class);
    customer.setName(<span class="string"><span class="delimiter">"</span><span class="content">John Smith</span><span class="delimiter">"</span></span>);
    persistence.getEntityManager().persist(customer);
    tx.commit();
}
<span class="comment">// plain style</span>
Transaction tx = persistence.createTransaction();
<span class="keyword">try</span> {
    Customer customer = metadata.create(Customer.class);
    customer.setName(<span class="string"><span class="delimiter">"</span><span class="content">John Smith</span><span class="delimiter">"</span></span>);
    persistence.getEntityManager().persist(customer);
    tx.commit();
} <span class="keyword">finally</span> {
    tx.end();
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Интерфейс Transaction имеет также метод <code>execute()</code>, принимающий на вход класс-действие или lambda-выражение, которое нужно выполнить в данной транзакции. Это позволяет организовать управление транзакциями в функциональном стиле, например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">UUID</span> customerId = persistence.createTransaction().execute((EntityManager em) -&gt; {
    Customer customer = metadata.create(Customer.class);
    customer.setName(<span class="string"><span class="delimiter">"</span><span class="content">ABC</span><span class="delimiter">"</span></span>);
    em.persist(customer);
    <span class="keyword">return</span> customer.getId();
});

Customer customer = persistence.createTransaction().execute(em -&gt;
        em.find(Customer.class, customerId, <span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span>));</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Следует иметь в виду, что метод <code>execute()</code> у некоторого экземпляра <code>Transaction</code> можно вызвать только один раз, так как после выполнения кода действия транзакция завершается.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="transactions_decl"><a class="anchor" href="/manual.html#transactions_decl"></a>5.4.5.2. Декларативное управление транзакциями</h5> 
        <div class="paragraph"> 
         <p>Любой метод <a href="/manual.html#managed_beans">управляемого бина</a> Middleware можно пометить аннотацией <code>@org.springframework.transaction.annotation.Transactional</code>, что вызовет автоматическое создание транзакции при вызове этого метода. В таком методе не нужно вызывать <code>Persistence.createTransaction()</code>, а можно сразу получать <code>EntityManager</code> и работать с ним.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Для аннотации <code>@Transactional</code> можно указать параметры, в том числе:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>propagation</code> - режим создания транзакции. Значение <code>REQUIRED</code> соответствует <code>getTransaction()</code>, значение <code>REQUIRES_NEW</code> - <code>createTransaction()</code>. По умолчанию <code>REQUIRED</code>.</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>(propagation = Propagation.REQUIRES_NEW)
<span class="directive">public</span> <span class="type">void</span> doSomething() {
}</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>value</code> - имя <a href="/manual.html#data_store">хранилища данных</a>. Если опущено, подразумевается основная БД. Например:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>(<span class="string"><span class="delimiter">"</span><span class="content">db1</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">void</span> doSomething() {
}</code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Декларативное управление транзакциями позволяет уменьшить количество <a href="http://en.wikipedia.org/wiki/Boilerplate_code" target="_blank">boilerplate кода</a>, однако имеет следующий недостаток: коммит транзакции происходит вне прикладного кода, что часто затрудняет отладку, т.к. скрывается момент отправки изменений в БД и перехода сущностей в состояние <a href="/manual.html#entity_states">Detached</a>. Кроме того, следует иметь в виду, что декларативная разметка сработает только в случае вызова метода контейнером, т.е. вызов транзакционного метода из другого метода того же самого объекта не приведет к старту транзакции.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В связи с этим рекомендуется применять декларативное управление транзакциями только для простых случаев, таких как методы сервисов, читающих некоторый объект и возвращающих его клиенту.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="transactions_interaction"><a class="anchor" href="/manual.html#transactions_interaction"></a>5.4.5.3. Примеры взаимодействия транзакций</h5> 
        <div class="sect5"> 
         <h6 id="transactions_interaction_rollback_nested"><a class="anchor" href="/manual.html#transactions_interaction_rollback_nested"></a>5.4.5.3.1. Откат вложенной транзакции</h6> 
         <div class="paragraph"> 
          <p>Если вложенная транзакция создана через <code>getTransaction()</code>, то ее откат приведет к невозможности коммита охватывающей транзакции. Например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> methodA() {
    Transaction tx = persistence.createTransaction();
    <span class="keyword">try</span> {
        <span class="comment">// (1) calling a method creating a nested transaction</span>
        methodB();

        <span class="comment">// (4) at this point an exception will be thrown, because transaction</span>
        <span class="comment">// is marked as rollback only</span>
        tx.commit();
    } <span class="keyword">finally</span> {
        tx.end();
    }
}

<span class="type">void</span> methodB() {
    Transaction tx = persistence.getTransaction();
    <span class="keyword">try</span> {
        <span class="comment">// (2) let us assume the exception occurs here</span>
        tx.commit();
    } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
        <span class="comment">// (3) handle it and exit</span>
        <span class="keyword">return</span>;
    } <span class="keyword">finally</span> {
        tx.end();
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Если же транзакция в <code>methodB()</code> будет создана через <code>createTransaction()</code>, то ее откат не окажет никакого влияния на коммит охватывающей транзакции в <code>methodA()</code>.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="transactions_interaction_modify_nested"><a class="anchor" href="/manual.html#transactions_interaction_modify_nested"></a>5.4.5.3.2. Чтение и изменение данных во вложенной транзакции</h6> 
         <div class="paragraph"> 
          <p>Рассмотрим сначала зависимую вложенную транзакцию, создаваемую через <code>getTransaction()</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> methodA() {
    Transaction tx = persistence.createTransaction();
    <span class="keyword">try</span> {
        EntityManager em = persistence.getEntityManager();

        <span class="comment">// (1) loading an entity with name == "old name"</span>
        Employee employee = em.find(Employee.class, id);
        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">old name</span><span class="delimiter">"</span></span>, employee.getName());

        <span class="comment">// (2) setting new value to the field</span>
        employee.setName(<span class="string"><span class="delimiter">"</span><span class="content">name A</span><span class="delimiter">"</span></span>);

        <span class="comment">// (3) calling a method creating a nested transaction</span>
        methodB();

        <span class="comment">// (8) the changes are committed to DB, and</span>
        <span class="comment">// it will contain "name B"</span>
        tx.commit();
    } <span class="keyword">finally</span> {
      tx.end();
    }
}

<span class="type">void</span> methodB() {
    Transaction tx = persistence.getTransaction();
    <span class="keyword">try</span> {
        <span class="comment">// (4) retrieving the same instance of EntityManager as methodA</span>
        EntityManager em = persistence.getEntityManager();

        <span class="comment">// (5) loading an entity with the same identifier</span>
        Employee employee = em.find(Employee.class, id);

        <span class="comment">// (6) the field value is the new one since we are working with the same</span>
        <span class="comment">// persistent context, and there are no calls to DB at all</span>
        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">name A</span><span class="delimiter">"</span></span>, employee.getName());
        employee.setName(<span class="string"><span class="delimiter">"</span><span class="content">name B</span><span class="delimiter">"</span></span>);

        <span class="comment">// (7) no actual commit is done at this point</span>
        tx.commit();
    } <span class="keyword">finally</span> {
      tx.end();
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Теперь рассмотрим тот же самый пример с независимой вложенной транзакцией, создаваемой через <code>createTransaction()</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> methodA() {
    Transaction tx = persistence.createTransaction();
    <span class="keyword">try</span> {
        EntityManager em = persistence.getEntityManager();

        <span class="comment">// (1) loading an entity with name == "old name"</span>
        Employee employee = em.find(Employee.class, id);
        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">old name</span><span class="delimiter">"</span></span>, employee.getName());

        <span class="comment">// (2) setting new value to the field</span>
        employee.setName(<span class="string"><span class="delimiter">"</span><span class="content">name A</span><span class="delimiter">"</span></span>);

        <span class="comment">// (3) calling a method creating a nested transaction</span>
        methodB();

        <span class="comment">// (8) an exception occurs due to optimistic locking</span>
        <span class="comment">// and commit will fail</span>
        tx.commit();
    } <span class="keyword">finally</span> {
      tx.end();
    }
}

<span class="type">void</span> methodB() {
    Transaction tx = persistence.createTransaction();
    <span class="keyword">try</span> {
        <span class="comment">// (4) creating a new instance of EntityManager,</span>
        <span class="comment">// as this is a new transaction</span>
        EntityManager em = persistence.getEntityManager();

        <span class="comment">// (5) loading an entity with the same identifier</span>
        Employee employee = em.find(Employee.class, id);

        <span class="comment">// (6) the field value is old because an old instance of the entity</span>
        <span class="comment">// has been loaded from DB</span>
        assertEquals(<span class="string"><span class="delimiter">"</span><span class="content">old name</span><span class="delimiter">"</span></span>, employee.getName());

        employee.setName(<span class="string"><span class="delimiter">"</span><span class="content">name B</span><span class="delimiter">"</span></span>);

        <span class="comment">// (7) the changes are commited to DB, and the value of</span>
        <span class="comment">// "name B" will now be in DB</span>
        tx.commit();
    } <span class="keyword">finally</span> {
      tx.end();
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В последнем случае исключение в точке (8) возникнет, только если сущность является оптимистично блокируемой, т.е. если она реализует интерфейс <code>Versioned</code>.</p> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="transaction_params"><a class="anchor" href="/manual.html#transaction_params"></a>5.4.5.4. Параметры транзакций</h5> 
        <div id="transaction_timeout" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Таймаут транзакции
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Для создаваемой транзакции может быть указан таймаут в секундах, при превышении которого транзакция будет прервана и откачена. Таймаут транзакции ограничивает максимальную длительность запросов к базе данных.</p> 
             </div> 
             <div class="paragraph"> 
              <p>При программном управлении транзакциями таймаут включается путем передачи объекта <code>TransactionParams</code> в метод <code>Persistence.createTransaction()</code>. Например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java">Transaction tx = persistence.createTransaction(<span class="keyword">new</span> TransactionParams().setTimeout(<span class="integer">2</span>));</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>При декларативном управлении транзакциями используется параметр <code>timeout</code> аннотации <code>@Transactional</code>, например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>(timeout = <span class="integer">2</span>)
<span class="directive">public</span> <span class="type">void</span> someServiceMethod() {
...</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Таймаут по умолчанию может быть задан в свойстве приложения <a href="/manual.html#cuba.defaultQueryTimeoutSec">cuba.defaultQueryTimeoutSec</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="transaction_read_only" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Read-only транзации
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Транзакцию можно пометить как read-only если она предназначена только для чтения данных из БД. Например, все методы <code>load</code> в <a href="/manual.html#dataManager">DataManager</a> используют read-only транзакции по умолчанию. Read-only транзакции улучшают производительность системы, потому что платформа не выполняет код, обрабатывающий возможные изменения в сущностях. Кроме того, не вызываются <code>BeforeCommit</code> <a href="/manual.html#transaction_listeners">transaction listeners</a>.</p> 
             </div> 
             <div class="admonitionblock warning"> 
              <table> 
               <tbody>
                <tr> 
                 <td class="icon"> 
                  <div class="title">
                   Warning
                  </div> </td> 
                 <td class="content"> 
                  <div class="paragraph"> 
                   <p>Если персистентный контекст read-only транзакции содержит измененные сущности, то при попытке коммита транзакции будет выброшено исключение <code>IllegalStateException</code>. Это означает, что помечать транзакцию как read-only следует только если вы уверены, что она не модифицирует никакие сущности.</p> 
                  </div> </td> 
                </tr> 
               </tbody>
              </table> 
             </div> 
             <div class="paragraph"> 
              <p>При программном управлении транзакциями признак read-only включается путем передачи объекта <code>TransactionParams</code> в метод <code>Persistence.createTransaction()</code>. Например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java">Transaction tx = persistence.createTransaction(<span class="keyword">new</span> TransactionParams().setReadOnly(<span class="predefined-constant">true</span>));</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>При декларативном управлении транзакциями используется параметр <code>readOnly</code> аннотации <code>@Transactional</code>, например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">void</span> someServiceMethod() {
...</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="transaction_listeners"><a class="anchor" href="/manual.html#transaction_listeners"></a>5.4.5.5. Transaction Listeners</h5> 
        <div class="paragraph"> 
         <p>Transaction listeners предназначены для реакции на события жизненного цикла транзакций. В отличие от <a href="/manual.html#entity_listeners">entity listeners</a>, они не привязаны к типу сущности и вызываются для каждой транзакции.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Слушатель должен быть <a href="/manual.html#managed_beans">управляемым бином</a>, реализующим один или оба интерфейса <code>BeforeCommitTransactionListener</code> и <code>AfterCompleteTransactionListener</code>.</p> 
        </div> 
        <div class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           BeforeCommitTransactionListener
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Метод <code>beforeCommit()</code> вызывается перед коммитом транзакции после всех <a href="/manual.html#entity_listeners">entity listeners</a> если транзакция не является read-only. Метод принимает текущий <a href="/manual.html#entityManager">EntityManager</a> и коллекцию сущностей текущего персистентного контекста.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Данный слушатель можно использовать для обеспечения сложных бизнес-правил, вовлекающих различные сущности. В примере ниже атрибут <code>amount</code> сущности <code>Order</code> должен рассчитываться на основе значения <code>discount</code>, находящегося в заказе, и атрибутов <code>price</code> и <code>quantity</code> экземпляров сущности <code>OrderLine</code>, составляющих заказ.</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>(<span class="string"><span class="delimiter">"</span><span class="content">demo_OrdersTransactionListener</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrdersTransactionListener</span> <span class="directive">implements</span> BeforeCommitTransactionListener {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> PersistenceTools persistenceTools;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeCommit(EntityManager entityManager, <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Entity</span>&gt; managedEntities) {
        <span class="comment">// gather all orders affected by changes in the current transaction</span>
        <span class="predefined-type">Set</span>&lt;Order&gt; affectedOrders = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;();

        <span class="keyword">for</span> (<span class="predefined-type">Entity</span> entity : managedEntities) {
            <span class="comment">// skip not modified entities</span>
            <span class="keyword">if</span> (!persistenceTools.isDirty(entity))
                <span class="keyword">continue</span>;

            <span class="keyword">if</span> (entity <span class="keyword">instanceof</span> Order)
                affectedOrders.add((Order) entity);
            <span class="keyword">else</span> <span class="keyword">if</span> (entity <span class="keyword">instanceof</span> OrderLine) {
                Order order = ((OrderLine) entity).getOrder();
                <span class="comment">// a reference can be detached, so merge it into current persistence context</span>
                affectedOrders.add(entityManager.merge(order));
            }
        }
        <span class="comment">// calculate amount for each affected order by its lines and discount</span>
        <span class="keyword">for</span> (Order order : affectedOrders) {
            <span class="predefined-type">BigDecimal</span> amount = <span class="predefined-type">BigDecimal</span>.ZERO;
            <span class="keyword">for</span> (OrderLine orderLine : order.getOrderLines()) {
                <span class="keyword">if</span> (!orderLine.isDeleted()) {
                    amount = amount.add(orderLine.getPrice().multiply(orderLine.getQuantity()));
                }
            }
            <span class="predefined-type">BigDecimal</span> discount = order.getDiscount().divide(<span class="predefined-type">BigDecimal</span>.valueOf(<span class="integer">100</span>), <span class="integer">2</span>, <span class="predefined-type">BigDecimal</span>.ROUND_DOWN);
            order.setAmount(amount.subtract(amount.multiply(discount)));
        }
    }
}</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           AfterCompleteTransactionListener
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Метод <code>afterComplete()</code> вызывается после завершения транзакции. Метод принимает параметр, указывающий, была ли транзакция успешно закоммичена, и коллекцию detached сущностей, содержавшихся в персистентном контексте завершенной транзакции.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Пример использования:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>(<span class="string"><span class="delimiter">"</span><span class="content">demo_OrdersTransactionListener</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">OrdersTransactionListener</span> <span class="directive">implements</span> AfterCompleteTransactionListener {

    <span class="directive">private</span> <span class="predefined-type">Logger</span> log = LoggerFactory.getLogger(OrdersTransactionListener.class);

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterComplete(<span class="type">boolean</span> committed, <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Entity</span>&gt; detachedEntities) {
        <span class="keyword">if</span> (!committed)
            <span class="keyword">return</span>;

        <span class="keyword">for</span> (<span class="predefined-type">Entity</span> entity : detachedEntities) {
            <span class="keyword">if</span> (entity <span class="keyword">instanceof</span> Order) {
                log.info(<span class="string"><span class="delimiter">"</span><span class="content">Order: </span><span class="delimiter">"</span></span> + entity);
            }
        }
    }
}</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="entity_cache"><a class="anchor" href="/manual.html#entity_cache"></a>5.4.6. Кэши сущностей и запросов</h4> 
       <div class="dlist"> 
        <dl> 
         <dt class="hdlist1">
          Кэш сущностей (Entity Cache)
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Кэш сущностей предоставляется <a href="/manual.html#orm">ORM</a> фреймворком EclipseLink. Он хранит в памяти недавно прочитанные или записанные экземпляры сущностей, тем самым сокращая доступ к базе данных и увеличивая производительность.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Кэш сущностей используется только при извлечении сущностей по идентификатору, поэтому запросы по другим атрибутам по прежнему выполняются на базе данных. Тем не менее, эти запросы могут стать проще и быстрее, если связанные сущности находятся в кэше. Например, если вы запрашиваете Заказы вместе со связанными Заказчиками, и не используете кэш, то SQL-запрос будет содержать JOIN с таблицей заказчиков. Если же сущность Заказчик закэширована, SQL-запрос будет только по таблице заказов, а связанные заказчики будут извлечены из кэша.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Для того, чтобы включить кэш сущностей, установите следующие свойства приложения в файле <a href="/manual.html#app_properties_files">app.properties</a> модуля <strong>core</strong> вашего проекта:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>eclipselink.cache.shared.sales$Customer = true</code> - включает кэширование сущности <code>sales$Customer</code>.</p> </li> 
              <li> <p><code>eclipselink.cache.size.sales$Customer = 500</code> - устанавливает размер кэша для сущности <code>sales$Customer</code> в 500 экземпляров. Размер по умолчанию - 100.</p> </li> 
             </ul> 
            </div> 
            <div class="paragraph"> 
             <p>Факт кэширования сущности влияет на то, какой <a href="/manual.html#views">fetch mode</a> выбирается платформой при загрузке графов сущностей. Если некоторый ссылочный атрибут представляет собой кэшируемую сущность, то fetch mode всегда будет <code>UNDEFINED</code>, что позволяет ORM извлекать ссылку из кэша вместо добавления в запрос JOIN или выполнения отдельного batch-запроса.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Платформа обеспечивает координацию кэша сущностей в <a href="/manual.html#cluster_mw_server">кластере middleware</a>. Когда кэшированный экземпляр сущности обновляется или удаляется на одном узле кластера, тот же экземпляр на других узлах (если он загружен) будет инвалидирован, что приведет к загрузке свежего состояния из БД при следующей операции с данным экземпляром.</p> 
            </div> 
           </div> 
          </div> 
         </dd> 
         <dt class="hdlist1">
          Кэш запросов (Query Cache)
         </dt> 
         <dd> 
          <div class="openblock"> 
           <div class="content"> 
            <div class="paragraph"> 
             <p>Кэш запросов сохраняет идентификаторы экземпляров сущностей, возвращаемых JPQL-запросами, тем самым естественно дополняя кэш сущностей.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Например, если для сущности <code>sales$Customer</code> разрешен entity cache, и запрос <code>select c from sales$Customer c where c.grade = :grade</code> выполняется первый раз, происходит следующее:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p>ORM выполняет запрос в базе данных.</p> </li> 
              <li> <p>Загруженные экземпляры сущности <code>Customer</code> помещаются в entity cache.</p> </li> 
              <li> <p>В кэш запросов помещается соответствие между текстом запроса вместе с параметрами и списком идентификаторов загруженных экземпляров.</p> </li> 
             </ul> 
            </div> 
            <div class="paragraph"> 
             <p>Когда этот же запрос с такими же параметрами выполняется второй раз, платформа находит запрос в кэше запросов и загружает экземпляры сущностей по идентификаторам из кэша сущностей, не обращаясь к базе данных.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Запросы по умолчанию не кэшируются. Указать, что запрос должен кэшироваться, можно на различных уровнях приложения:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p>Методом <code>setCacheable()</code> интерфейса <a href="/manual.html#query">Query</a> при работе с <a href="/manual.html#entityManager">EntityManager</a>.</p> </li> 
              <li> <p>Методом <code>setCacheable()</code> интерфейса <code>LoadContext.Query</code> при работе с <a href="/manual.html#dataManager">DataManager</a>.</p> </li> 
              <li> <p>Методом <code>setCacheable()</code> интерфейса <code>CollectionDatasource</code> или в XML-атрибуте <code>cacheable</code> при работе с <a href="/manual.html#datasources">источниками данных</a>.</p> </li> 
             </ul> 
            </div> 
            <div class="admonitionblock warning"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Warning
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>Кэшируемые запросы следует использовать только если для возвращаемой сущности разрешен entity cache. В противном случае при каждом запросе экземпляры сущности будут загружаться из базы данных по идентификаторам по одному.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
            <div class="paragraph"> 
             <p>Кэш запросов автоматически инвалидируется, когда через <a href="/manual.html#orm">ORM</a> выполняются операции создания, изменения или удаления с сущностями соответствующего типа. Инвалидация работает по всему <a href="/manual.html#cluster_mw">кластеру среднего слоя</a>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>JMX-бин <code>app-core.cuba:type=QueryCacheSupport</code> можно использовать для мониторинга состояния кэша и для удаления запросов из кэша. Например, если вы изменили некоторый экземпляр сущности <code>sales$Customer</code> напрямую в БД, необходимо удалить все закэшированные запросы по этой сущности с помощью операции <code>evict()</code> с аргументом <code>sales$Customer</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>На поведение кэша запросов оказывают влияние следующие свойства приложения:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p><a href="/manual.html#cuba.queryCache.enabled">cuba.queryCache.enabled</a></p> </li> 
              <li> <p><a href="/manual.html#cuba.queryCache.maxSize">cuba.queryCache.maxSize</a></p> </li> 
             </ul> 
            </div> 
           </div> 
          </div> 
         </dd> 
        </dl> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="system_authentication"><a class="anchor" href="/manual.html#system_authentication"></a>5.4.7. Системная аутентификация</h4> 
       <div class="paragraph"> 
        <p>При выполнении пользовательских запросов программному коду Middleware через интерфейс <a href="/manual.html#userSessionSource">UserSessionSource</a> всегда доступна информация о текущем пользователе. Это возможно потому, что при получении запроса с клиентского уровня в потоке выполнения автоматически устанавливается соответствующий объект <code><a href="/manual.html#securityContext">SecurityContext</a></code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Однако существуют ситуации, когда текущий поток выполнения не связан ни с каким пользователем системы: например, при вызове метода бина из <a href="/manual.html#scheduled_tasks_spring">планировщика</a>, либо через JMX-интерфейс. Если при этом бин выполняет изменение сущностей в базе данных, то ему потребуется информация о том, кто выполняет изменения, то есть аутентификация.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Такого рода аутентификация называется системной, так как не требует участия пользователя - средний слой приложения просто создает (или использует имеющуюся) пользовательскую сессию, и устанавливает в потоке выполнения соответствующий объект <code>SecurityContext</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Обеспечить системную аутентификацию некоторого участка кода можно следующими способами:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>явно используя бин <code>com.haulmont.cuba.security.app.Authentication</code>, например:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Authentication authentication;
...
authentication.begin();
<span class="keyword">try</span> {
    <span class="comment">// authenticated code</span>
} <span class="keyword">finally</span> {
    authentication.end();
}</code></pre> 
           </div> 
          </div> </li> 
         <li> <p>добавив методу бина аннотацию <code>@Authenticated</code>, например:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Authenticated</span>
<span class="directive">public</span> <span class="predefined-type">String</span> foo(<span class="predefined-type">String</span> value) {
    <span class="comment">// authenticated code</span>
}</code></pre> 
           </div> 
          </div> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Во втором случае также используется бин <code>Authentication</code>, но неявно, через интерцептор <code>AuthenticationInterceptor</code>, который перехватывает вызовы всех методов бинов с аннотацией <code>@Authenticated</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>В приведенных примерах пользовательская сессия будет создаваться от лица пользователя, логин которого указан в свойстве приложения <a href="/manual.html#cuba.jmxUserLogin">cuba.jmxUserLogin</a>. Если требуется аутентификация от имени другого пользователя, нужно воспользоваться первым вариантом и передать в метод <code>begin()</code> логин нужного пользователя.</p> 
       </div> 
       <div class="admonitionblock warning"> 
        <table> 
         <tbody>
          <tr> 
           <td class="icon"> 
            <div class="title">
             Warning
            </div> </td> 
           <td class="content"> 
            <div class="paragraph"> 
             <p>Если в момент выполнения <code>Authentication.begin()</code> в текущем потоке выполнения присутствует активная пользовательская сессия, то она не заменяется - соответственно, код, требующий аутентификации, будет выполняться с имеющейся сессией, и последующий метод <code>end()</code> не будет очищать поток.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Например, вызов метода JMX-бина из встроенной в <strong>Web Client</strong> консоли JMX, если бин находится в той же JVM, что и блок WebClient, к которому в данный момент подключен пользователь, будет выполнен от имени текущего зарегистрированного в системе пользователя, независимо от наличия системной аутентификации.</p> 
            </div> </td> 
          </tr> 
         </tbody>
        </table> 
       </div> 
      </div> 
     </div> 
     <div class="sect2"> 
      <h3 id="gui_framework"><a class="anchor" href="/manual.html#gui_framework"></a>5.5. Универсальный пользовательский интерфейс</h3> 
      <div class="paragraph"> 
       <p>Подсистема универсального пользовательского интерфейса (Generic UI, GUI) позволяет разрабатывать экраны пользовательского интерфейса, используя XML и Java. Созданные таким образом экраны одинаково работоспособны в двух стандартных клиентских <a href="/manual.html#app_tiers">блоках</a>: <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
      </div> 
      <div class="imageblock" style="text-align: center"> 
       <div class="content"> 
        <img src="assets/ClientStructure.png" alt="ClientStructure"> 
       </div> 
       <div class="title">
        Рисунок 14. Структура универсального пользовательского интерфейса
       </div> 
      </div> 
      <div class="paragraph"> 
       <p>Здесь в центре изображены основные составляющие экранов универсального пользовательского интерфейса:</p> 
      </div> 
      <div class="ulist"> 
       <ul> 
        <li> <p><a href="/manual.html#screen_xml">XML-дескрипторы</a> - файлы XML, содержащие информацию об источниках данных и компоновке экрана</p> </li> 
        <li> <p><a href="/manual.html#screen_controller">Контроллеры</a> - классы Java, содержащие логику инициализации экрана и обработки событий от элементов пользовательского интерфейса.</p> </li> 
       </ul> 
      </div> 
      <div class="paragraph"> 
       <p>Код экранов приложения, расположенный в <a href="/manual.html#app_modules">модуле</a> <strong>gui</strong>, взаимодействует с интерфейсами визуальных компонентов (VCL Interfaces), реализованными по-отдельности в модулях <strong>web</strong> и <strong>desktop</strong> <a href="/manual.html#app_components">базового проекта</a> <strong>cuba</strong>. Для <strong>Web Client</strong> реализация основана на фреймворке <strong>Vaadin</strong>, для <strong>Desktop Client</strong> – на фреймворке <strong>Java Swing</strong>.</p> 
      </div> 
      <div class="paragraph"> 
       <p><a href="/manual.html#gui_vcl">Библиотека визуальных компонентов</a> (Visual Components Library, VCL) содержит большой набор готовых компонентов для отображения данных.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Механизм <a href="/manual.html#datasources">источников данных</a> (Datasources) предоставляет унифицированный интерфейс, обеспечивающий функционирование связанных с данными визуальных компонентов.</p> 
      </div> 
      <div class="paragraph"> 
       <p>Инфраструктура клиента (Infrastructure) включает в себя главное окно приложения, механизмы отображения и взаимодействия экранов UI, а также средства взаимодействия со средним слоем.</p> 
      </div> 
      <div class="sect3"> 
       <h4 id="screens"><a class="anchor" href="/manual.html#screens"></a>5.5.1. Экраны</h4> 
       <div class="paragraph"> 
        <p>Экран универсального пользовательского интерфейса состоит из <a href="/manual.html#screen_xml">XML-дескриптора</a> и класса <a href="/manual.html#screen_controller">контроллера</a>. Дескриптор содержит ссылку на класс контроллера.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Для того чтобы экран можно было вызывать из главного меню или из Java кода (например, из контроллера другого экрана), XML-дескриптор должен быть зарегистрирован в файле <a href="/manual.html#screens.xml">screens.xml</a> проекта.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Главное меню приложения формируется отдельно для <strong>Web Client</strong> и <strong>Desktop Client</strong> на основе файлов <a href="/manual.html#menu.xml">menu.xml</a>, расположенных соответственно в модулях <strong>web</strong> и <strong>desktop</strong> проекта.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="screen_types"><a class="anchor" href="/manual.html#screen_types"></a>5.5.1.1. Типы экранов</h5> 
        <div class="paragraph"> 
         <p>В данном разделе рассматриваются основные типы экранов:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="/manual.html#frame">Фрейм</a></p> </li> 
          <li> <p><a href="/manual.html#screen_simple">Простой экран</a></p> </li> 
          <li> <p><a href="/manual.html#screen_lookup">Экран выбора</a></p> </li> 
          <li> <p><a href="/manual.html#screen_edit">Экран редактирования</a></p> </li> 
          <li> <p><a href="/manual.html#screen_combined">Комбинированный экран</a></p> </li> 
         </ul> 
        </div> 
        <div class="sect5"> 
         <h6 id="frame"><a class="anchor" href="/manual.html#frame"></a>5.5.1.1.1. Фрейм</h6> 
         <div class="paragraph"> 
          <p>Фреймы представляют собой части экранов, которые применяются для декомпозиции и многократного использования. Для подключения фрейма в XML экрана используется элемент <a href="/manual.html#gui_Frame">frame</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Контроллер фрейма должен быть унаследован от класса <a href="/manual.html#abstractFrame">AbstractFrame</a>.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Фрейм можно создать в Studio с помощью шаблона <strong>Blank frame</strong>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>Правила взаимодействия экрана и вложенного в него фрейма:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Из экрана обращаться к компонентам фрейма можно через точку: <code>frame_id.component_id</code></p> </li> 
           <li> <p>Из контроллера фрейма получить компонент экрана можно обычным вызовом <code>getComponent(component_id)</code>, но только в том случае, если компонент с таким именем не объявлен в самом фрейме. То есть компоненты фрейма маскируют компоненты экрана.</p> </li> 
           <li> <p>Из фрейма получить <a href="/manual.html#datasources">источник данных</a> экрана можно простым вызовом <code>getDsContext().get(ds_id)</code> или <a href="/manual.html#screen_controller_injection">инжекцией</a>, либо в <a href="/manual.html#datasource_query">запросе</a> <code>ds$ds_id</code>, но только в том случае, если источник данных с таким именем не объявлен в самом фрейме (аналогично компонентам).</p> </li> 
           <li> <p>Из экрана получить источник данных фрейма можно только через итерацию по <code>getDsContext().getChildren()</code></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>При коммите экрана вызывается также коммит измененных источников данных всех вложенных фреймов.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="screen_simple"><a class="anchor" href="/manual.html#screen_simple"></a>5.5.1.1.2. Простой экран</h6> 
         <div class="paragraph"> 
          <p>Простой экран предназначен для отображения и редактирования произвольной информации, в том числе отдельных экземпляров и списков сущностей. Данный тип экрана имеет только базовую функциональность, позволяющую отобразить его в главном окне системы и работать с <a href="/manual.html#datasources">источниками данных</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Контроллер простого экрана должен быть унаследован от класса <a href="/manual.html#abstractWindow">AbstractWindow</a>.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Простой экран можно создать в Studio с помощью шаблона <strong>Blank screen</strong>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="screen_lookup"><a class="anchor" href="/manual.html#screen_lookup"></a>5.5.1.1.3. Экран выбора</h6> 
         <div class="paragraph"> 
          <p>Экран выбора (lookup) предназначен для выбора и возврата экземпляров и списков сущностей. Стандартное действие <a href="/manual.html#lookupAction">LookupAction</a> в таких визуальных компонентах, как <a href="/manual.html#gui_PickerField">PickerField</a> и <a href="/manual.html#gui_LookupPickerField">LookupPickerField</a>, вызывает экраны выбора для поиска связанных сущностей.</p> 
         </div> 
         <div class="paragraph"> 
          <p>При вызове экрана выбора методом <code>openLookup()</code> отображается панель с кнопками для выбора. Когда пользователь выбирает один или несколько экземпляров, экран вызывает переданный ему обработчик, тем самым возвращая вызывающему коду результаты выбора. При вызове методом <code>openWindow()</code> или, например, из главного меню, панель с кнопками выбора не отображается, что превращает экран выбора в <a href="/manual.html#screen_simple">простой экран</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Контроллер экрана выбора должен быть унаследован от класса <a href="/manual.html#abstractLookup">AbstractLookup</a>. В XML экрана в атрибуте <code>lookupComponent</code> должен быть указан компонент (например, <code><a href="/manual.html#gui_Table">Table</a></code>), из которого будет взят экземпляр сущности при выборе.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Экран выбора для сущности можно создать в Studio с помощью шаблонов <strong>Entity browser</strong> или <strong>Entity combined screen</strong>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>По умолчанию, действие <a href="/manual.html#lookupAction">LookupAction</a> использует экран, зарегистрованный в файле <a href="/manual.html#screens.xml">screens.xml</a> с идентификатором вида <code>{имя<em>сущности}.lookup</em></code><em> или <code>{имя</code></em><code>сущности}.browse</code>, например, <code>sales$Customer.lookup</code>. Поэтому при использовании вышеупомянутых компонентов убедитесь, что такой экран создан. Studio регистрирует browse-экраны с идентификаторами вида <code>{имя_сущности}.browse</code>, поэтому они автоматически вызываются в качестве экранов выбора.</p> 
         </div> 
         <div id="screen_lookup_customization" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Настройка вида и поведения экрана выбора
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p>Для того, чтобы заменить панель выбора (кнопки <strong>Select</strong> и <strong>Cancel</strong>) для всех экранов выбора в проекте, создайте фрейм и зарегистрируйте его с идентификатором <code>lookupWindowActions</code>. Стандартный фрейм расположен в файле <code>/com/haulmont/cuba/gui/lookup-window.actions.xml</code>. Новый фрейм должен содержать кнопку, связанную с действием <code>lookupSelectAction</code> (которое автоматически добавляется в экран, когда он открывается как экран выбора).</p> </li> 
                <li> <p>Чтобы заменить панель выбора в некотором экране, создайте в нем кнопку, связанную с действием <code>lookupSelectAction</code>. В этом случае стандартный фрейм не будет показан. Например:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;layout</span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">table</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hbox&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">selectBtn</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Select item</span><span class="delimiter">"</span></span>
                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">lookupSelectAction</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hbox&gt;</span>
    <span class="comment">&lt;!-- ... --&gt;</span>
<span class="tag">&lt;/layout&gt;</span></code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>Чтобы заменить стандартное действие выбора своим, просто добавьте его в контроллере:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    addAction(<span class="keyword">new</span> SelectAction(<span class="local-variable">this</span>) {
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="predefined-type">Collection</span> getSelectedItems(LookupComponent lookupComponent) {
            <span class="predefined-type">Set</span>&lt;MyEntity&gt; selected = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;();
            <span class="comment">// ...</span>
            <span class="keyword">return</span> selected;
        }
    });
}</code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>В качестве базового класса используйте <code>com.haulmont.cuba.gui.components.SelectAction</code>, переопределив требуемые методы.</p> 
                 </div> </li> 
               </ul> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="screen_edit"><a class="anchor" href="/manual.html#screen_edit"></a>5.5.1.1.4. Экран редактирования</h6> 
         <div class="paragraph"> 
          <p>Экран редактирования предназначен для отображения и редактирования экземпляра сущности. Поддерживает функциональность установки редактируемого экземпляра и <a href="/manual.html#gui_Action">действия</a> по коммиту изменений в базу данных. Экран редактирования должен вызываться методом <code>openEditor()</code> с передачей экземпляра сущности.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Стандартные действия <a href="/manual.html#createAction">CreateAction</a> и <a href="/manual.html#editAction">EditAction</a> открывают экран, зарегистрированный в файле <a href="/manual.html#screens.xml">screens.xml</a> с идентификатором вида <code>{имя_сущности}.edit</code>, например, <code>sales$Customer.edit</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Контроллер экрана редактирования должен быть унаследован от класса <a href="/manual.html#abstractEditor">AbstractEditor</a>.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Экран редактирования для сущности можно создать в Studio с помощью шаблона <strong>Entity editor</strong>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>В XML экрана в атрибуте <code>datasource</code> указывается источник данных, в который проставляется редактируемый экземпляр сущности. Для отображения действий, выполняющих коммит или отмену изменений, в XML можно использовать следующие стандартные фреймы с кнопками:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>editWindowActions</code> (файл <code>com/haulmont/cuba/gui/edit-window.actions.xml</code>) - содержит кнопки <strong>OK</strong> и <strong>Cancel</strong></p> </li> 
           <li> <p><code>extendedEditWindowActions</code> (файл <code>com/haulmont/cuba/gui/extended-edit-window.actions.xml</code>) - содержит кнопки <strong>OK &amp; Close</strong>, <strong>OK</strong> и <strong>Cancel</strong></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В экране редактирования неявно создаются следующие действия:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>windowCommitAndClose</code> (соответствует константе <code>Window.Editor.WINDOW_COMMIT_AND_CLOSE</code>) - действие, выполняющее коммит изменений в базу данных и закрывающее экран. Создается при наличии в экране визуального компонента с идентификатором <code>windowCommitAndClose</code>, в частности, при использовании вышеописанного стандартного фрейма <code>extendedEditWindowActions</code> отображается кнопкой <strong>OK &amp; Close</strong>.</p> </li> 
           <li> <p><code>windowCommit</code> (соответствует константе <code>Window.Editor.WINDOW_COMMIT</code>) - действие, выполняющее коммит изменений в базу данных. При отсутствии действия <code>windowCommitAndClose</code> после коммита закрывает экран. Создается всегда, и при наличии в экране вышеописанных стандартных фреймов отображается кнопкой <strong>OK</strong>.</p> </li> 
           <li> <p><code>windowClose</code> (соответствует константе <code>Window.Editor.WINDOW_CLOSE</code>) - действие, закрывающее экран без коммита изменений. Создается всегда, и при наличии в экране вышеописанных стандартных фреймов отображается кнопкой <strong>Cancel</strong>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Таким образом, если в экран добавлен фрейм <code>editWindowActions</code>, то кнопка <strong>OK</strong> коммитит изменения и закрывает экран, а кнопка <strong>Cancel</strong> - закрывает без коммита. Если же добавлен фрейм <code>extendedEditWindowActions</code>, то кнопка <strong>OK</strong> только коммитит изменения, оставляя экран открытым, кнопка <strong>OK &amp; Close</strong> коммитит и закрывает экран, кнопка <strong>Cancel</strong> - закрывает без коммита.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Вместо стандартных фреймов для отображения действий можно использовать произвольные компоненты, например, <a href="/manual.html#gui_LinkButton">LinkButton</a>.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="screen_combined"><a class="anchor" href="/manual.html#screen_combined"></a>5.5.1.1.5. Комбинированный экран</h6> 
         <div class="paragraph"> 
          <p>Комбинированный экран позволяет отобразить список сущностей слева и форму редактирования выбранного экземпляра справа. Таким образом, это комбинация экранов <a href="/manual.html#screen_lookup">выбора</a> и <a href="/manual.html#screen_edit">редактирования</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Контроллер экрана редактирования должен быть унаследован от класса <a href="/manual.html#entityCombinedScreen">EntityCombinedScreen</a>.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Комбинированный экран для сущности можно создать в Studio с помощью шаблона <strong>Entity combined screen</strong>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="screen_xml"><a class="anchor" href="/manual.html#screen_xml"></a>5.5.1.2. XML-дескриптор</h5> 
        <div class="paragraph"> 
         <p>XML-дескриптор - это файл формата XML, описывающий <a href="/manual.html#datasources">источники данных</a> и расположение визуальных компонентов экрана.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Схема XML доступна по адресу <a href="http://schemas.haulmont.com/cuba/6.7/window.xsd" class="bare" target="_blank">http://schemas.haulmont.com/cuba/6.7/window.xsd</a>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Рассмотрим структуру дескриптора.</p> 
        </div> 
        <div class="paragraph"> 
         <p><code>window</code> − корневой элемент.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Атрибуты <code>window</code>:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>class</code> − имя класса <a href="/manual.html#screen_controller">контроллера</a></p> </li> 
          <li> <p><code>messagesPack</code> − <a href="/manual.html#message_packs">пакет сообщений</a> данного экрана, который будет использован при получении локализованных строк без указания пакета из XML-дескриптора и из контроллера методом <code>getMessage()</code></p> </li> 
          <li> <p><code>caption</code> − заголовок экрана, может содержать <a href="/manual.html#messageTools.loadString">ссылку на сообщение</a> из вышеуказанного пакета, например,</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="properties">caption="msg://caption"</code></pre> 
            </div> 
           </div> </li> 
          <li> <p><code>focusComponent</code> − идентификатор компонента, который получит фокус ввода при отображении экрана</p> </li> 
          <li> <p><code>lookupComponent</code> - обязательный для <a href="/manual.html#screen_lookup">экрана выбора</a> атрибут, задающий идентификатор визуального компонента, из которого будет выбран экземпляр сущности. Поддерживаются компоненты следующих типов (и их наследников):</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p><code>Table</code></p> </li> 
             <li> <p><code>Tree</code></p> </li> 
             <li> <p><code>LookupField</code></p> </li> 
             <li> <p><code>PickerField</code></p> </li> 
             <li> <p><code>OptionsGroup</code></p> </li> 
            </ul> 
           </div> </li> 
          <li> <p><code>datasource</code> - обязательный для <a href="/manual.html#screen_edit">экрана редактирования</a> атрибут, задающий идентификатор <a href="/manual.html#datasources">источника данных</a>, в который будет проставлен экземпляр редактируемой сущности.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Элементы <code>window</code>:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>metadataContext</code> − элемент для инициализации <a href="/manual.html#views">представлений</a> (views), необходимых данному экрану. Предпочтительным является определение всех представлений в одном общем файле <code><a href="/manual.html#views.xml">views.xml</a></code>, так как все описатели представлений разворачиваются в один общий репозиторий, и при рассредоточении описателей по разным файлам трудно обеспечить уникальность имен.</p> </li> 
          <li> <p><code>dsContext</code> − определяет <a href="/manual.html#datasources">источники данных</a> данного экрана.</p> </li> 
          <li> <p><code>dialogMode</code> - определяет параметры геометрии и поведения экрана при открытии его в виде диалогового окна.</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибуты <code>dialogMode</code>:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>closeable</code> - определяет наличие в диалоговом окне кнопки закрытия. Возможные значения: <code>true</code>, <code>false</code>.</p> </li> 
               <li> <p><code>closeOnClickOutside</code> - определяет возможность закрыть окно кликом по окружающей области, если диалог открыт в модальном режиме. Возможные значения: <code>true</code>, <code>false</code>.</p> </li> 
               <li> <p><code>forceDialog</code> - указывает, что экран должен всегда открываться в режиме диалога, независимо от того, какой <code>WindowManager.OpenType</code> был выбран в вызывающем коде. Возможные значения: <code>true</code>, <code>false</code>.</p> </li> 
               <li> <p><code>height</code> - устанавливает высоту диалогового окна.</p> </li> 
               <li> <p><code>maximized</code> - если выбрано значение <code>true</code>, диалог будет развёрнут во весь экран. Возможные значения: <code>true</code>, <code>false</code>.</p> </li> 
               <li> <p><code>modal</code> - устанавливает модальный режим дилогового окна. Возможные значения: <code>true</code>, <code>false</code>.</p> </li> 
               <li> <p><code>positionX</code> - задаёт положение левого верхнего угла диалога по оси <code>x</code>.</p> </li> 
               <li> <p><code>positionY</code> - задаёт положение левого верхнего угла диалога по оси <code>y</code>.</p> </li> 
               <li> <p><code>resizable</code> - определяет возможность пользователя изменять размеры диалога. Возможные значения: <code>true</code>, <code>false</code>.</p> </li> 
               <li> <p><code>width</code> - устанавливает ширину диалогового окна.</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Пример использования <code>dialogMode</code>:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dialogMode</span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">600</span><span class="delimiter">"</span></span>
            <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">800</span><span class="delimiter">"</span></span>
            <span class="attribute-name">positionX</span>=<span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>
            <span class="attribute-name">positionY</span>=<span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span>
            <span class="attribute-name">forceDialog</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
            <span class="attribute-name">closeOnClickOutside</span>=<span class="string"><span class="delimiter">"</span><span class="content">false</span><span class="delimiter">"</span></span>
            <span class="attribute-name">resizable</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
              </div> 
             </div> 
            </div> 
           </div> </li> 
          <li> <p><code>actions</code> - определяет список <a href="/manual.html#gui_Action">действий</a> данного экрана.</p> </li> 
          <li> <p><code>timers</code> - определяет список таймеров данного экрана.</p> </li> 
          <li> <p><code>companions</code> - определяет список классов-<a href="/manual.html#companions">компаньонов</a> данного контроллера</p> 
           <div class="paragraph"> 
            <p>Элементы <code>companions</code>:</p> 
           </div> 
           <div class="ulist"> 
            <ul> 
             <li> <p><code>web</code> - задает компаньон, реализованный в модуле <strong>web</strong></p> </li> 
             <li> <p><code>desktop</code> - задает компаньон, реализованный в модуле <strong>desktop</strong></p> 
              <div class="paragraph"> 
               <p>Каждый из этих элементов содержит атрибут <code>class</code>, задающий класс компаньона.</p> 
              </div> </li> 
            </ul> 
           </div> </li> 
          <li> <p><code>layout</code> − корневой элемент компоновки экрана. Является сам по себе контейнером с вертикальным расположением компонентов, аналогичным <a href="/manual.html#gui_BoxLayout">vbox</a>.</p> 
           <div class="paragraph"> 
            <p>Атрибуты <code>layout</code>:</p> 
           </div> 
           <div class="ulist"> 
            <ul> 
             <li> <p><a href="/manual.html#gui_attr_spacing">spacing</a></p> </li> 
             <li> <p><a href="/manual.html#gui_attr_margin">margin</a></p> </li> 
             <li> <p><a href="/manual.html#gui_attr_expand">expand</a></p> </li> 
             <li> <p><a href="/manual.html#gui_attr_stylename">stylename</a></p> </li> 
             <li> <p><a href="/manual.html#gui_attr_height">height</a></p> </li> 
             <li> <p><a href="/manual.html#gui_attr_width">width</a></p> </li> 
            </ul> 
           </div> </li> 
         </ul> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="screen_controller"><a class="anchor" href="/manual.html#screen_controller"></a>5.5.1.3. Контроллер экрана</h5> 
        <div class="paragraph"> 
         <p>Контроллер экрана - это <code>Java</code> или <code>Groovy</code> класс, связанный с <a href="/manual.html#screen_xml">XML-дескриптором</a>, и содержащий логику инициализации и обработки событий экрана.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Контроллер должен быть унаследован от одного из следующих базовых классов:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="/manual.html#abstractFrame">AbstractFrame</a> − предназначен для реализации <a href="/manual.html#frame">фреймов</a>.</p> </li> 
          <li> <p><a href="/manual.html#abstractWindow">AbstractWindow</a> − предназначен для реализации <a href="/manual.html#screen_simple">простых экранов</a>.</p> </li> 
          <li> <p><a href="/manual.html#abstractLookup">AbstractLookup</a> − предназначен для реализации <a href="/manual.html#screen_lookup">экранов выбора</a>.</p> </li> 
          <li> <p><a href="/manual.html#abstractEditor">AbstractEditor</a> − предназначен для реализации <a href="/manual.html#screen_edit">экранов редактирования</a>.</p> </li> 
         </ul> 
        </div> 
        <div class="admonitionblock tip"> 
         <table> 
          <tbody>
           <tr> 
            <td class="icon"> 
             <div class="title">
              Tip
             </div> </td> 
            <td class="content"> 
             <div class="paragraph"> 
              <p>Если экрану не нужна никакая дополнительная логика, то в качестве контроллера можно использовать сам базовый класс <code>AbstractWindow</code>, <code>AbstractLookup</code> или <code>AbstractEditor</code>, указав его в XML-дескрипторе (эти классы на самом деле не являются абстрактными в смысле невозможности создания экземпляров). Для фрейма класс контроллера можно не указывать вообще.</p> 
             </div> </td> 
           </tr> 
          </tbody>
         </table> 
        </div> 
        <div class="paragraph"> 
         <p>Класс контроллера должен быть зарегистрирован в XML-дескрипторе экрана в атрибуте <code>class</code> корневого элемента <code>window</code>.</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/Controllers.png" alt="Controllers"> 
         </div> 
         <div class="title">
          Рисунок 15. Базовые классы контроллеров
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="abstractFrame"><a class="anchor" href="/manual.html#abstractFrame"></a>5.5.1.3.1. AbstractFrame</h6> 
         <div class="paragraph"> 
          <p><code>AbstractFrame</code> является корнем иерархии классов контроллеров. Рассмотрим его основные методы:</p> 
         </div> 
         <div id="abstractFrame_init" class="ulist"> 
          <ul> 
           <li> <p><code>init()</code> - вызывается фреймворком после создания всего дерева компонентов, описанного XML-дескриптором, но до отображения экрана.</p> 
            <div class="paragraph"> 
             <p>В метод <code>init()</code> из вызывающего кода передается мэп параметров, которые могут быть использованы внутри контроллера. Эти параметры могут быть переданы как из кода контроллера вызывающего экрана (в методе <code>openWindow()</code>, <code>openLookup()</code> или <code>openEditor()</code>), так и установлены в файле регистрации экранов <code><a href="/manual.html#screens.xml">screens.xml</a></code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Метод <code>init()</code> следует имплементировать при необходимости инициализации компонентов экрана, например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Table someTable;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    someTable.addGeneratedColumn(<span class="string"><span class="delimiter">"</span><span class="content">someColumn</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> Table.ColumnGenerator&lt;Colour&gt;() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Component</span> generateCell(Colour entity) {
            ...
        }
    });
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractFrame_getMessage" class="ulist"> 
          <ul> 
           <li> <p><code>getMessage()</code>, <code>formatMessage()</code> - методы получения локализованных сообщений из <a href="/manual.html#message_packs">пакета</a>, заданного для экрана в XML-дескрипторе. Представляют собой просто короткие варианты вызова одноименных методов интерфейса <code><a href="/manual.html#messages">Messages</a></code>.</p> </li> 
          </ul> 
         </div> 
         <div id="abstractFrame_openFrame" class="ulist"> 
          <ul> 
           <li> <p><code>openFrame()</code> - загрузить фрейм по идентификатору, зарегистрированному в <a href="/manual.html#screens.xml">screens.xml</a>, и, если в метод передан компонент-контейнер, отобразить его внутри контейнера. Возвращается контроллер фрейма. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> <span class="predefined-type">BoxLayout</span> container;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    SomeFrame frame = openFrame(container, <span class="string"><span class="delimiter">"</span><span class="content">someFrame</span><span class="delimiter">"</span></span>);
    frame.setHeight(<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>);
    frame.someInitMethod();
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Контейнер не обязательно сразу передавать в метод <code>openFrame()</code>, вместо этого можно загрузить фрейм, а затем добавить его в нужный контейнер:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> <span class="predefined-type">BoxLayout</span> container;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    SomeFrame frame = openFrame(<span class="predefined-constant">null</span>, <span class="string"><span class="delimiter">"</span><span class="content">someFrame</span><span class="delimiter">"</span></span>);
    frame.setHeight(<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>);
    frame.someInitMethod();
    container.add(frame);
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractFrame_openWindow" class="ulist"> 
          <ul> 
           <li> <p><code>openWindow()</code>, <code>openLookup()</code>, <code>openEditor()</code> - открыть соответственно простой экран, экран выбора или редактирования. Методы возвращают контроллер созданного экрана.</p> 
            <div class="paragraph"> 
             <p>При открытии экрана в режиме диалога метод <code>openWindow()</code> может быть вызван с параметрами, к примеру:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> actionPerform(<span class="predefined-type">Component</span> component) {
    openWindow(<span class="string"><span class="delimiter">"</span><span class="content">sec$User.browse</span><span class="delimiter">"</span></span>, WindowManager.OpenType.DIALOG.width(<span class="integer">800</span>).height(<span class="integer">300</span>).closeable(<span class="predefined-constant">true</span>).resizable(<span class="predefined-constant">true</span>).modal(<span class="predefined-constant">false</span>));
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Эти параметры будут учитываться, если они не конфликтуют с более приоритетными параметрами самого вызываемого экрана. Последние могут быть заданы в методе <a href="/manual.html#dialogOptions">getDialogOptions()</a> контроллера экрана или в <a href="/manual.html#screen_xml">XML-дескрипторе</a> этого экрана:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">&lt;dialogMode forceDialog=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> width=<span class="string"><span class="delimiter">"</span><span class="content">300</span><span class="delimiter">"</span></span> height=<span class="string"><span class="delimiter">"</span><span class="content">200</span><span class="delimiter">"</span></span> closeable=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> modal=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> closeOnClickOutside=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>/&gt;</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Для выполнения действий после закрытия вызываемого экрана необходимо добавить слушатель типа <code>CloseListener</code>, например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">CustomerEdit editor = openEditor(<span class="string"><span class="delimiter">"</span><span class="content">sales$Customer.edit</span><span class="delimiter">"</span></span>, customer, WindowManager.OpenType.THIS_TAB);
editor.addCloseListener((<span class="predefined-type">String</span> actionId) -&gt; {
    <span class="comment">// do something</span>
});</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p><code>CloseWithCommitListener</code> можно использовать в случае, если необходимо реагировать только при закрытии экрана действием с именем <code>Window.COMMIT_ACTION_ID</code> (то есть кнопкой <strong>OK</strong>), например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">CustomerEdit editor = openEditor(<span class="string"><span class="delimiter">"</span><span class="content">sales$Customer.edit</span><span class="delimiter">"</span></span>, customer, WindowManager.OpenType.THIS_TAB);
editor.addCloseWithCommitListener(() -&gt; {
    <span class="comment">// do something</span>
});</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractFrame_showMessageDialog" class="ulist"> 
          <ul> 
           <li> <p><code>showMessageDialog()</code> - отобразить диалоговое окно с сообщением.</p> </li> 
          </ul> 
         </div> 
         <div id="abstractFrame_showOptionDialog" class="ulist"> 
          <ul> 
           <li> <p><code>showOptionDialog()</code> - отобразить диалоговое окно с сообщением и возможностью выбора пользователем некоторых действий. Действия задаются массивом объектов типа <code><a href="/manual.html#gui_Action">Action</a></code>, которые в диалоге отображаются посредством соответствующих кнопок.</p> 
            <div class="paragraph"> 
             <p>Для отображения стандартных кнопок типа <strong>OK</strong>, <strong>Cancel</strong> и других рекомендуется использовать объекты типа <code>DialogAction</code>, например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">showOptionDialog(<span class="string"><span class="delimiter">"</span><span class="content">PLease confirm</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Are you sure?</span><span class="delimiter">"</span></span>,
        MessageType.CONFIRMATION,
        <span class="keyword">new</span> <span class="predefined-type">Action</span><span class="type">[]</span> {
            <span class="keyword">new</span> DialogAction(DialogAction.Type.YES) {
                <span class="annotation">@Override</span>
                <span class="directive">public</span> <span class="type">void</span> actionPerform(<span class="predefined-type">Component</span> component) {
                    <span class="comment">// do something</span>
                }
            },
            <span class="keyword">new</span> DialogAction(DialogAction.Type.NO)
        });</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractFrame_showNotification" class="ulist"> 
          <ul> 
           <li> <p><code>showNotification()</code> - отобразить всплывающее окно с сообщением.</p> </li> 
          </ul> 
         </div> 
         <div id="abstractFrame_showWebPage" class="ulist"> 
          <ul> 
           <li> <p><code>showWebPage()</code> - открыть указанную веб-страницу в браузере.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#abstractFrame_getMessage">formatMessage()</a> - <a href="/manual.html#abstractFrame_getMessage">getMessage()</a> - <a href="/manual.html#abstractFrame_init">init()</a> - <a href="/manual.html#abstractFrame_openFrame">openFrame()</a> - <a href="/manual.html#abstractFrame_openWindow">openEditor()</a> - <a href="/manual.html#abstractFrame_openWindow">openLookup()</a> - <a href="/manual.html#abstractFrame_openWindow">openWindow()</a> - <a href="/manual.html#abstractFrame_showMessageDialog">showMessageDialog()</a> - <a href="/manual.html#abstractFrame_showNotification">showNotification()</a> - <a href="/manual.html#abstractFrame_showOptionDialog">showOptionDialog()</a> - <a href="/manual.html#abstractFrame_showWebPage">showWebPage()</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="abstractWindow"><a class="anchor" href="/manual.html#abstractWindow"></a>5.5.1.3.2. AbstractWindow</h6> 
         <div class="paragraph"> 
          <p><code>AbstractWindow</code> является наследником <code><a href="/manual.html#abstractFrame">AbstractFrame</a></code>, и определяет следующие собственные методы:</p> 
         </div> 
         <div id="dialogOptions" class="ulist"> 
          <ul> 
           <li> <p><code>getDialogOptions()</code> - получить объект <code>DialogOptions</code> для управления геометрией и поведением экрана когда он открывается в режиме диалога (<code>WindowManager.OpenType.DIALOG</code>). Эти параметры могут быть заданы при инициализации экрана, а также могут изменяться на лету.</p> 
            <div class="paragraph"> 
             <p>Установка ширины и высоты:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    getDialogOptions().setWidth(<span class="string"><span class="delimiter">"</span><span class="content">480px</span><span class="delimiter">"</span></span>).setHeight(<span class="string"><span class="delimiter">"</span><span class="content">320px</span><span class="delimiter">"</span></span>);
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Установка положения диалога на экране:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">getDialogOptions()
        .setPositionX(<span class="integer">100</span>)
        .setPositionY(<span class="integer">100</span>);</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Возможность закрыть диалог кликом по окружающей области:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">getDialogOptions().setModal(<span class="predefined-constant">true</span>).setCloseOnClickOutside(<span class="predefined-constant">true</span>);</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Указание того, что диалог должен быть немодальным и с изменяемыми размерами:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    getDialogOptions().setModal(<span class="predefined-constant">false</span>).setResizable(<span class="predefined-constant">true</span>);
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Указание того, что диалог должен быть развёрнут во весь экран:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">getDialogOptions().setMaximized(<span class="predefined-constant">true</span>);</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Указание того, что экран должен всегда открываться в режиме диалога, независимо от того, какой <code>WindowManager.OpenType</code> был выбран в вызывающем коде:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    getDialogOptions().setForceDialog(<span class="predefined-constant">true</span>);
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_contentSwitchMode" class="ulist"> 
          <ul> 
           <li> <p><code>setContentSwitchMode()</code> - определяет режим переключения вкладок <a href="/manual.html#cuba.web.mainTabSheetMode">главного TabSheet</a> для вкладки, содержащей данное окно: скрывать содержимое или полностью выгружать его.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Доступны следующие режимы:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>DEFAULT</code> - режим переключения определяется режимом главного TabSheet, установленном в свойстве приложения <a href="/manual.html#cuba.web.managedMainTabSheetMode">cuba.web.managedMainTabSheetMode</a>.</p> </li> 
                <li> <p><code>HIDE</code> - содержимое вкладки должно быть только скрыто, независимо от режима главного TabSheet.</p> </li> 
                <li> <p><code>UNLOAD</code> - содержимое вкладки должно быть выгружено, независимо от режима главного TabSheet.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_saveSettings" class="ulist"> 
          <ul> 
           <li> <p><code>saveSettings()</code> - сохраняет настройки экрана для текущего пользователя в базе данных при закрытии экрана.</p> 
            <div class="paragraph"> 
             <p>К примеру, на экране имеется чекбокс <strong>showPanel</strong>, управляющий отображением некой панели. Мы переопределяем метод <code>saveSettings()</code>: создаём в нём XML-элемент для этого чекбокса, добавляем ему атрибут <code>showPanel</code>, содержащий текущее значение чекбокса, а затем сохраняем элемент <code>settings</code> в XML-файл для текущего пользователя в базе данных.</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> CheckBox showPanel;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> saveSettings() {
    <span class="type">boolean</span> showPanelValue = showPanel.getValue();
    <span class="predefined-type">Element</span> xmlDescriptor = getSettings().get(showPanel.getId());
    xmlDescriptor.addAttribute(<span class="string"><span class="delimiter">"</span><span class="content">showPanel</span><span class="delimiter">"</span></span>, <span class="predefined-type">String</span>.valueOf(showPanelValue));
    <span class="local-variable">super</span>.saveSettings();
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_applySettings" class="ulist"> 
          <ul> 
           <li> <p><code>applySettings()</code> - восстанавливает настройки экрана для текущего пользователя из базы данных при открытии экрана.</p> 
            <div class="paragraph"> 
             <p>Переопределим метод для восстановления настроек из предыдущего примера. Получаем XML-элемент чекбокса, проверяем, что нужный нам атрибут <code>showPanel</code> не равен <code>null</code>, а затем восстанавливаем для чекбокса предыдущее сохранённое значение:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> applySettings(Settings settings) {
    <span class="local-variable">super</span>.applySettings(settings);
    <span class="predefined-type">Element</span> xmlDescriptor = settings.get(showPanel.getId());
    <span class="keyword">if</span> (xmlDescriptor.attribute(<span class="string"><span class="delimiter">"</span><span class="content">showPanel</span><span class="delimiter">"</span></span>) != <span class="predefined-constant">null</span>) {
        showPanel.setValue(<span class="predefined-type">Boolean</span>.parseBoolean(xmlDescriptor.attributeValue(<span class="string"><span class="delimiter">"</span><span class="content">showPanel</span><span class="delimiter">"</span></span>)));
    }
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Другой пример управления настройками экрана можно увидеть на стандартном экране <strong>Server Log</strong> в меню <strong>Administration</strong> приложения CUBA, который автоматически сохраняет и восстанавливает последние открытые пользователем лог-файлы.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_ready" class="ulist"> 
          <ul> 
           <li> <p><code>ready()</code> - шаблонный метод, который можно имплементировать в контроллере для перехвата момента открытия экрана. Метод <code>ready()</code> вызывается фреймворком после метода <code>init()</code> непосредственно перед показом экрана в главном окне приложения.</p> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_validateAll" class="ulist"> 
          <ul> 
           <li> <p><code>validateAll()</code> - валидация экрана. Реализация по умолчанию вызывает метод <code>validate()</code> у всех компонентов экрана, реализующих интерфейс <code>Component.Validatable</code>, накапливает информацию об исключениях, и если таковые имеются, выводит соответствующее сообщение и возвращает <code>false</code>, иначе возвращает <code>true</code>.</p> 
            <div class="paragraph"> 
             <p>Данный метод следует переопределять только в том случае, если необходимо полностью заменить стандартную процедуру валидации экрана. Если же нужно только дополнить ее, достаточно определить специальный шаблонный метод <code>postValidate()</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_postValidate" class="ulist"> 
          <ul> 
           <li> <p><code>postValidate()</code> - шаблонный метод, который можно имплементировать в контроллере для дополнительной валидации экрана. Получаемый методом объект <code>ValidationErrors</code> используется для добавления информации об ошибках валидации, которая будет отображена совместно с ошибками стандартной валидации. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Pattern</span> pattern = <span class="predefined-type">Pattern</span>.compile(<span class="string"><span class="delimiter">"</span><span class="char">\\</span><span class="content">d</span><span class="delimiter">"</span></span>);

<span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> postValidate(ValidationErrors errors) {
    <span class="keyword">if</span> (getItem().getAddress().getCity() != <span class="predefined-constant">null</span>) {
        <span class="keyword">if</span> (pattern.matcher(getItem().getAddress().getCity()).find()) {
            errors.add(<span class="string"><span class="delimiter">"</span><span class="content">City name can't contain digits</span><span class="delimiter">"</span></span>);
        }
    }
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_close" class="ulist"> 
          <ul> 
           <li> <p><code>close()</code> - закрыть данный экран.</p> 
            <div class="paragraph"> 
             <p>Метод принимает строковое значение, передаваемое далее в шаблонный метод <code>preClose()</code> и слушателям <code>CloseListener</code>. Таким образом, заинтересованный код может получить информацию о причине закрытия экрана от кода, инициирующего закрытие. В частности, в экранах редактирования сущностей при закрытии экрана после коммита изменений рекомендуется использовать константу <code>Window.COMMIT_ACTION_ID</code>, без коммита изменений - константу <code>Window.CLOSE_ACTION_ID</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если какой-либо из источников данных содержит несохраненные изменения, перед закрытием экрана будет выдано диалоговое окно с соответствующим предупреждением. Тип предупреждения можно выбрать с помощью свойства приложения <code><a href="/manual.html#cuba.gui.useSaveConfirmation">cuba.gui.useSaveConfirmation</a></code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Вариант метода <code>close()</code> с параметром <code>force = true</code> закрывает экран без вызова <code>preClose()</code> и без предупреждения, независимо от наличия несохраненных изменений.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Метод <code>close()</code> возвращает <code>true</code>, если экран был успешно закрыт, и <code>false</code> - если закрытие было прервано.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_preClose" class="ulist"> 
          <ul> 
           <li> <p><code>preClose()</code> - шаблонный метод, который можно имплементировать в контроллере для перехвата момента закрытия экрана. Метод получает строковое значение, указанное инициатором закрытия при вызове метода <code>close()</code>.</p> 
            <div class="paragraph"> 
             <p>Если метод <code>preClose()</code> возвращает <code>false</code>, то процесс закрытия экрана прерывается.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_addBeforeCloseWithCloseButtonListener" class="ulist"> 
          <ul> 
           <li> <p><code>addBeforeCloseWithCloseButtonListener()</code> - добавляет слушатель, который отслеживает закрытие окна одним из следующих способов: кнопка закрытия окна, панель breadcrumbs или действия для закрытия вкладок <code>TabSheet</code> (Close, Close All, Close Others). Чтобы предотвратить случайное закрытие окна пользователем, можно вызвать метод <code>preventWindowClose()</code> события <code>BeforeCloseEvent</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">addBeforeCloseWithCloseButtonListener(BeforeCloseEvent::preventWindowClose);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractWindow_addBeforeCloseWithShortcutListener" class="ulist"> 
          <ul> 
           <li> <p><code>addBeforeCloseWithShortcutListener</code> - добавляет слушатель, который отслеживает закрытие окна горячими клавишами (например, нажатием <code>Esc</code>). Чтобы предотвратить случайное закрытие окна пользователем, можно вызвать метод <code>preventWindowClose()</code> события <code>BeforeCloseEvent</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">addBeforeCloseWithShortcutListener(BeforeCloseEvent::preventWindowClose);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#abstractWindow_addBeforeCloseWithCloseButtonListener">addBeforeCloseWithCloseButtonListener()</a> - <a href="/manual.html#abstractWindow_addBeforeCloseWithShortcutListener">addBeforeCloseWithShortcutListener()</a> - <a href="/manual.html#abstractWindow_applySettings">applySettings()</a> - <a href="/manual.html#abstractWindow_close">close()</a> - <a href="/manual.html#abstractWindow_contentSwitchMode">setContentSwitchMode()</a> - <a href="/manual.html#dialogOptions">getDialogOptions()</a> - <a href="/manual.html#abstractWindow_postValidate">postValidate()</a> - <a href="/manual.html#abstractWindow_preClose">preClose()</a> - <a href="/manual.html#abstractWindow_ready">ready()</a> - <a href="/manual.html#abstractWindow_saveSettings">saveSettings()</a> - <a href="/manual.html#abstractWindow_validateAll">validateAll()</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="abstractLookup"><a class="anchor" href="/manual.html#abstractLookup"></a>5.5.1.3.3. AbstractLookup</h6> 
         <div class="paragraph"> 
          <p><code>AbstractLookup</code> базовый класс контроллеров <a href="/manual.html#screen_lookup">экранов выбора</a>, является наследником <code><a href="/manual.html#abstractWindow">AbstractWindow</a></code>, и определяет следующие собственные методы:</p> 
         </div> 
         <div id="abstractLookup_setLookupComponent" class="ulist"> 
          <ul> 
           <li> <p><code>setLookupComponent()</code> - установить компонент, из которого будет производиться выбор экземпляров сущности.</p> 
            <div class="paragraph"> 
             <p>Как правило, компонент выбора устанавливается в XML-дескрипторе экрана, и вызывать данный метод в прикладном коде нет необходимости.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractLookup_setLookupValidator" class="ulist"> 
          <ul> 
           <li> <p><code>setLookupValidator()</code> - установить для экрана объект типа <code>Window.Lookup.Validator</code>, метод <code>validate()</code> которого вызывается фреймворком перед тем как вернуть выбранные экземпляры сущностей. Если <code>validate()</code> возвращает <code>false</code>, процесс выбора и закрытия экрана прерывается.</p> 
            <div class="paragraph"> 
             <p>По умолчанию валидатор не установлен.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#abstractLookup_setLookupComponent">setLookupComponent()</a> - <a href="/manual.html#abstractLookup_setLookupValidator">setLookupValidator()</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="abstractEditor"><a class="anchor" href="/manual.html#abstractEditor"></a>5.5.1.3.4. AbstractEditor</h6> 
         <div class="paragraph"> 
          <p><code>AbstractEditor</code> − базовый класс контроллеров <a href="/manual.html#screen_edit">экранов редактирования</a>, является наследником <code><a href="/manual.html#abstractWindow">AbstractWindow</a></code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>При создании конкретного класса контроллера рекомендуется параметризовать <code>AbstractEditor</code> типом редактируемой сущности. При этом методы <code>getItem()</code> и <code>initNewItem()</code> будут работать с конкретным типом сущности и прикладному коду не потребуется дополнительных приведений типов. Например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerEdit</span> <span class="directive">extends</span> AbstractEditor&lt;Customer&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> initNewItem(Customer item) {
        ...</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p><code>AbstractEditor</code> определяет следующие собственные методы:</p> 
         </div> 
         <div id="abstractEditor_getItem" class="ulist"> 
          <ul> 
           <li> <p><code>getItem()</code> - возвращает экземпляр редактируемой сущности, установленный в главном источнике данных экрана (т.е. указанном в атрибуте <code>datasource</code> корневого элемента XML-дескриптора).</p> 
            <div class="paragraph"> 
             <p>Если редактируется не новый экземпляр, то в момент открытия экрана он перезагружается из базы данных с необходимым <a href="/manual.html#views">представлением</a>, указанным для главного источника данных.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Изменения, вносимые в экземпляр, возвращаемый <code>getItem()</code>, отражаются на состоянии источника данных, и будут отправлены на <strong>Middleware</strong> при коммите экрана.</p> 
            </div> 
            <div class="admonitionblock warning"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Warning
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>Следует иметь в виду, что <code>getItem()</code> возвращает значение только после инициализации экрана методом <code>setItem()</code>. До этого момента, например, в методах <code>init()</code> и <code>initNewItem()</code>, данный метод возвращает <code>null</code>.</p> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Однако в методе <code>init()</code> экземпляр сущности, переданный в <code>openEditor()</code>, можно получить из параметров следующим образом:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    Customer item = WindowParams.ITEM.getEntity(params);
    <span class="comment">// do something</span>
}</code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>В метод <code>initNewItem()</code> экземпляр передается явно и нужного типа.</p> 
                 </div> 
                 <div class="paragraph"> 
                  <p>В обоих случаях полученный экземпляр сущности, если он не новый, будет впоследствии перезагружен, и вносить в него изменения или сохранять в поле для последующего использования не имеет смысла.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractEditor_setItem" class="ulist"> 
          <ul> 
           <li> <p><code>setItem()</code> - вызывается фреймворком при открытии экрана методом <code>openEditor()</code> для установки редактируемого экземпляра сущности в главном источнике данных. В момент вызова созданы все компоненты и источники данных экрана, и отработал метод <code>init()</code> контроллера.</p> 
            <div class="paragraph"> 
             <p>Для инициализации экрана редактирования вместо переопределения <code>setItem()</code> рекомендуется имплементировать специальные шаблонные методы <code>initNewItem()</code> и <code>postInit()</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="initNewItem" class="ulist"> 
          <ul> 
           <li> <p><code>initNewItem()</code> - шаблонный метод, вызываемый фреймворком перед установкой редактируемого экземпляра сущности в главном источнике данных.</p> 
            <div class="admonitionblock tip"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Tip
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>Метод <code>initNewItem()</code> вызывается только для нового, только что созданного экземпляра сущности. Если редактируется <a href="/manual.html#entity_states">detached</a> экземпляр, метод не вызывается.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
            <div class="paragraph"> 
             <p>Данный метод можно имплементировать в контроллере при необходимости инициализации нового экземпляра сущности перед его установкой в источник данных, например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> UserSession userSession;

<span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> initNewItem(Complaint item) {
    item.setOpenedBy(userSession.getUser());
    item.setStatus(ComplaintStatus.OPENED);
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Более сложный пример использования <code>initNewItem()</code> приведен в разделе <a href="/manual.html#init_values_in_initNewItem">рецептов разработки</a>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractEditor_postInit" class="ulist"> 
          <ul> 
           <li> <p><code>postInit()</code> - шаблонный метод, вызываемый фреймворком сразу после установки редактируемого экземпляра сущности в главном источнике данных. Во время выполнения данного метода можно вызывать <code>getItem()</code>, который будет возвращать новый или перезагруженный при инициализации экрана экземпляр сущности.</p> 
            <div class="paragraph"> 
             <p>Данный метод можно имплементировать в контроллере для окончательной инициализации экрана, например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> EntityDiffViewer diffFrame;

<span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> postInit() {
    <span class="keyword">if</span> (!PersistenceHelper.isNew(getItem())) {
        diffFrame.loadVersions(getItem());
    }
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractEditor_commit" class="ulist"> 
          <ul> 
           <li> <p><code>commit()</code> - валидировать экран и отправить изменения через <code><a href="/manual.html#dataSupplier">DataSupplier</a></code> на <strong>Middleware</strong>.</p> 
            <div class="paragraph"> 
             <p>Если используется вариант метода с параметром <code>validate = false</code>, то валидация перед коммитом не производится.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Данный метод не рекомендуется переопределять, лучше использовать специальные шаблонные методы <code>postValidate()</code>, <code>preCommit()</code> и <code>postCommit()</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractEditor_commitAndClose" class="ulist"> 
          <ul> 
           <li> <p><code>commitAndClose()</code> - валидировать экран, отправить изменения на <strong>Middleware</strong> и закрыть экран. В метод <code>preClose()</code> и зарегистрированным слушателям <code>CloseListener</code> будет передано значение константы <code>Window.COMMIT_ACTION_ID</code>.</p> 
            <div class="paragraph"> 
             <p>Данный метод не рекомендуется переопределять, лучше использовать специальные шаблонные методы <code>postValidate()</code>, <code>preCommit()</code> и <code>postCommit()</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractEditor_preCommit" class="ulist"> 
          <ul> 
           <li> <p><code>preCommit()</code> - шаблонный метод, вызываемый фреймворком в процессе коммита изменений, после того как валидация завершена успешно и перед отправкой данных на <strong>Middleware</strong>.</p> 
            <div class="paragraph"> 
             <p>Данный метод можно имплементировать в контроллере. Если метод возвращает <code>false</code>, процесс коммита (и закрытия экрана, если был вызван <code>commitAndClose()</code>), прерывается. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">boolean</span> preCommit() {
    <span class="keyword">if</span> (somethingWentWrong) {
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Something went wrong</span><span class="delimiter">"</span></span>, NotificationType.WARNING);
        <span class="keyword">return</span> <span class="predefined-constant">false</span>;
    }
    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="abstractEditor_postCommit" class="ulist"> 
          <ul> 
           <li> <p><code>postCommit()</code> - шаблонный метод, вызываемый фреймворком на финальной стадии коммита изменений. Параметры метода:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>committed</code> - установлен в <code>true</code>, если в экране действительно были изменения, и они отправлены на <strong>Middleware</strong>;</p> </li> 
              <li> <p><code>close</code> - установлен в <code>true</code>, если экран после коммита будет закрыт.</p> 
               <div class="paragraph"> 
                <p>Реализация метода по умолчанию, если экран не закрывается, отображает сообщение об успешном коммите изменений и вызывает метод <code>postInit()</code>.</p> 
               </div> 
               <div class="paragraph"> 
                <p>Данный метод можно переопределить в контроллере для выполнения некоторых действий после успешного коммита, например:</p> 
               </div> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Datasource&lt;<span class="predefined-type">Driver</span>&gt; driverDs;
<span class="annotation">@Inject</span>
<span class="directive">private</span> EntitySnapshotService entitySnapshotService;

<span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">boolean</span> postCommit(<span class="type">boolean</span> committed, <span class="type">boolean</span> close) {
    <span class="keyword">if</span> (committed) {
        entitySnapshotService.createSnapshot(driverDs.getItem(), driverDs.getView());
    }
    <span class="keyword">return</span> <span class="local-variable">super</span>.postCommit(committed, close);
}</code></pre> 
                </div> 
               </div> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Далее приведены диаграммы последовательностей инициализации и различных вариантов коммита экрана редактирования.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/EditorInit.png" alt="EditorInit"> 
          </div> 
          <div class="title">
           Рисунок 16. Инициализация экрана редактирования
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/EditorCommit.png" alt="EditorCommit"> 
          </div> 
          <div class="title">
           Рисунок 17. Коммит и закрытие экрана с фреймом editWindowActions
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/ExtendedEditorCommit.png" alt="ExtendedEditorCommit"> 
          </div> 
          <div class="title">
           Рисунок 18. Коммит экрана с фреймом extendedEditWindowActions
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/ExtendedEditorCommitAndClose.png" alt="ExtendedEditorCommitAndClose"> 
          </div> 
          <div class="title">
           Рисунок 19. Коммит и закрытие экрана с фреймом extendedEditWindowActions
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#abstractEditor_commit">commit()</a> - <a href="/manual.html#abstractEditor_commitAndClose">commitAndClose()</a> - <a href="/manual.html#abstractEditor_getItem">getItem()</a> - <a href="/manual.html#initNewItem">initNewItem()</a> - <a href="/manual.html#abstractEditor_postCommit">postCommit()</a> - <a href="/manual.html#abstractEditor_postInit">postInit()</a> - <a href="/manual.html#abstractEditor_preCommit">preCommit()</a> - <a href="/manual.html#abstractEditor_setItem">setItem()</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="entityCombinedScreen"><a class="anchor" href="/manual.html#entityCombinedScreen"></a>5.5.1.3.5. EntityCombinedScreen</h6> 
         <div class="paragraph"> 
          <p><code>EntityCombinedScreen</code> − базовый класс контроллеров <a href="/manual.html#screen_combined">комбинированных экранов</a>, является наследником <a href="/manual.html#abstractLookup">AbstractLookup</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Класс <code>EntityCombinedScreen</code> ищет ключевые компоненты экрана, такие как таблица, field group и некоторые другие, по зашитым в код идентификаторам. Если эти компоненты в вашем экране названы по другому, переопределите protected-методы класса и возвращайте из них ваши идентификаторы, чтобы контроллер мог найти нужные компоненты. См. JavaDocs класса для более подробной информации.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="screen_controller_injection"><a class="anchor" href="/manual.html#screen_controller_injection"></a>5.5.1.3.6. Инжекция зависимостей контроллеров</h6> 
         <div class="paragraph"> 
          <p>В контроллерах можно использовать Dependency Injection для получения ссылок на используемые объекты. Для этого нужно объявить либо поле соответствующего типа, либо метод доступа на запись (setter) с соответствующим типом результата, и добавить ему одну из следующих аннотаций:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>@Inject</code> - простейший вариант, поиск объекта для инжекции будет произведен по типу поля/метода и по имени, эквивалентному имени поля либо имени атрибута (по правилам JavaBeans) для метода</p> </li> 
           <li> <p><code>@Named("someName")</code> - вариант с явным указанием имени искомого объекта</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Инжектировать в контроллеры можно следующие объекты:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Визуальные компоненты данного экрана, определенные в XML-дескрипторе. Если тип атрибута унаследован от <code>Component</code>, в текущем экране будет произведен поиск компонента с соответствующим именем.</p> </li> 
           <li> <p>Действия, определенные в XML-дескрипторе - см. <a href="/manual.html#gui_Action">Действия. Интерфейс Action</a></p> </li> 
           <li> <p><a href="/manual.html#datasources">Источники данных</a>, определенные в XML-дескрипторе. Если тип атрибута унаследован от <code>Datasource</code>, в текущем экране будет произведен поиск источника данных с соответствующим именем.</p> </li> 
           <li> <p><code>UserSession</code>. Если тип атрибута - <code><a href="/manual.html#userSession">UserSession</a></code>, будет инжектирован объект текущей пользовательской сессии.</p> </li> 
           <li> <p><code>DsContext</code>. Если тип атрибута - <code>DsContext</code>, будет инжектирован <code>DsContext</code> текущего экрана.</p> </li> 
           <li> <p><code>WindowContext</code>. Если тип атрибута - <code>WindowContext</code>, будет инжектирован <code>WindowContext</code> текущего экрана.</p> </li> 
           <li> <p><code>DataSupplier</code>. Если тип атрибута - <code><a href="/manual.html#dataSupplier">DataSupplier</a></code>, будет инжектирован соответствующий экземпляр.</p> </li> 
           <li> <p>Любой бин, определенный в контексте данного клиентского блока приложения, в том числе:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p>импортируемые клиентом <a href="/manual.html#services">сервисы</a> <strong>Middleware</strong></p> </li> 
              <li> <p><a href="/manual.html#config_interfaces">конфигурационные интерфейсы</a></p> </li> 
              <li> <p><code>ComponentsFactory</code></p> </li> 
              <li> <p><code>WindowConfig</code></p> </li> 
              <li> <p><code>ExportDisplay</code></p> </li> 
              <li> <p><code><a href="/manual.html#background_tasks">BackgroundWorker</a></code></p> </li> 
             </ul> 
            </div> </li> 
           <li> <p>Если ничего из вышеперечисленного не подошло и контроллер имеет <a href="/manual.html#companions">компаньонов</a>, в случае совпадения типов будет инжектирован компаньон для текущего типа клиента.</p> </li> 
          </ul> 
         </div> 
         <div id="screen_controller_injection_params" class="paragraph"> 
          <p>С помощью специальной аннотации <code>@WindowParam</code> можно инжектировать в контроллер параметры, передаваемые в мэп метода <code>init()</code>. Аннотация имеет атрибут <code>name</code>, в котором указывается имя параметра (ключ в мэп), и опциональный атрибут <code>required</code>. Если <code>required = true</code>, то при отсутствии в мэп соответствующего параметра в лог выводится сообщение с уровнем <code>WARNING</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример инжекции объекта типа <code>Job</code>, передаваемого в метод <code>init()</code> контроллера:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WindowParam</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">job</span><span class="delimiter">"</span></span>, required = <span class="predefined-constant">true</span>)
<span class="directive">protected</span> Job job;</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="companions"><a class="anchor" href="/manual.html#companions"></a>5.5.1.3.7. Компаньоны контроллеров</h6> 
         <div class="paragraph"> 
          <p>Базовые классы контроллеров расположены в <a href="/manual.html#app_modules">модуле</a> <strong>gui</strong> <a href="/manual.html#app_components">базового проекта</a> <strong>cuba</strong> и не содержат ссылок на классы реализации визуальных компонентов (<strong>Swing</strong> или <strong>Vaadin</strong>), что дает возможность использовать их в клиентах обоих типов.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В то же время конкретные классы контроллеров могут быть расположены как в модуле <strong>gui</strong>, так и в <strong>web</strong> или <strong>desktop</strong>, в зависимости от применяемых в проекте клиентских <a href="/manual.html#app_tiers">блоков</a> и специфики экрана. Если контроллер является универсальным, но для разных типов клиента требуется дополнительная функциональность, ее можно определить в так называемых <em>классах-компаньонах</em>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Класс-компаньон располагается в модуле клиента соответствующего типа (<strong>web</strong> или <strong>desktop</strong>) и реализует интерфейс, задаваемый в использующем его контроллере. Класс компаньона задается в элементе <code>companions</code> XML-дескриптора экрана. Контроллер может получить ссылку на экземпляр компаньона с помощью инжекции или вызовом <code>getCompanion()</code>, и в нужный момент передать ему управление, например, для дополнительной инициализации визуальных компонентов специфичным для данного типа клиента способом.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Например, необходимо раздельно для веб и десктоп клиентов проинициализировать таблицу некоторого экрана. Тогда в контроллере экрана, расположенном в модуле <strong>gui</strong>, определяем интерфейс компаньона и делегируем ему инициализацию таблицы:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomerBrowse</span> <span class="directive">extends</span> AbstractLookup {

    <span class="directive">public</span> <span class="type">interface</span> <span class="class">Companion</span> {
        <span class="type">void</span> initTable(Table&lt;Customer&gt; table);
    }

    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> Table&lt;Customer&gt; table;
    <span class="annotation">@Inject</span>
    <span class="directive">protected</span> Companion companion;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        <span class="keyword">if</span> (companion != <span class="predefined-constant">null</span>) {
            companion.initTable(table);
        }
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В модулях <strong>web</strong> и <strong>desktop</strong> создаем соответствующие классы реализации компаньона:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">WebCustomerBrowseCompanion</span> <span class="directive">implements</span> CustomerBrowse.Companion {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initTable(Table&lt;Customer&gt; table) {
        com.vaadin.ui.Table webTable = (com.vaadin.ui.Table) WebComponentsHelper.unwrap(table);
        <span class="comment">// do something specific to Vaadin table</span>
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DesktopCustomerBrowseCompanion</span> <span class="directive">implements</span> CustomerBrowse.Companion {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initTable(Table&lt;Customer&gt; table) {
        javax.swing.JTable desktopTable = (javax.swing.JTable) DesktopComponentsHelper.unwrap(table);
        <span class="comment">// do something specific to Swing table</span>
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>И регистрируем классы реализации компаньона в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;window</span> <span class="attribute-name">...</span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.gui.customers.CustomerBrowse</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;companions&gt;</span>
      <span class="tag">&lt;web</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.web.customers.WebCustomerBrowseCompanion</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;desktop</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.desktop.customers.DesktopCustomerBrowseCompanion</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/companions&gt;</span>
  <span class="tag">&lt;dsContext&gt;</span>...<span class="tag">&lt;/dsContext&gt;</span>
  <span class="tag">&lt;layout&gt;</span>...<span class="tag">&lt;/layout&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Так как классы-компаньоны расположены в <strong>web</strong> и <strong>desktop</strong> модулях, в них можно использовать метод <code>unwrap()</code> классов <a href="/manual.html#webComponentsHelper">WebComponentsHelper</a> и <a href="/manual.html#desktopComponentsHelper">DesktopComponentsHelper</a> для извлечения из интерфейса <a href="/manual.html#gui_Table">Table</a> ссылок на реализующие таблицу Vaadin и Swing компоненты, и работать с ними непосредственно.</p> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="screen_agent"><a class="anchor" href="/manual.html#screen_agent"></a>5.5.1.4. Screen Agent</h5> 
        <div class="paragraph"> 
         <p>Указание агента позволяет выбрать экран в зависимости от текущего устройства и параметров его дисплея. Например, можно создать два экрана с различной компоновкой (и, возможно, различной функциональностью), и зарегистрировать их в файле <a href="/manual.html#screens.xml">screens.xml</a> с одним идентификатором. Тогда во время выполнения платформа выберет экран, который лучше подходит для дисплея, с которого пользователь работает с приложением.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В платформе предопределены три агента: <code>DESKTOP</code>, <code>TABLET</code>, <code>PHONE</code>. Они заданы следующими классами: <code>DesktopScreenAgent</code>, <code>TabletScreenAgent</code>, <code>PhoneScreenAgent</code>. В проекте приложения можно определить собственные агенты путем создания <a href="/manual.html#managed_beans">бинов</a>, реализующих интерфейс <code>ScreenAgent</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Агент указывается для экрана в файле <a href="/manual.html#screens.xml">screens.xml</a>. Значением атрибута <code>agent</code> должна быть либо одна из вышеперечисленных констант, либо имя бина, реализующего <code>ScreenAgent</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В Studio агент задается на вкладке <strong>Properties</strong> дизайнера экранов.</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="gui_vcl"><a class="anchor" href="/manual.html#gui_vcl"></a>5.5.2. Библиотека визуальных компонентов</h4> 
       <div class="paragraph"> 
        <p><a href="/manual.html#gui_components">Компоненты</a></p> 
       </div> 
       <div class="paragraph"> 
        <p><a href="/manual.html#gui_layouts">Контейнеры</a></p> 
       </div> 
       <div class="paragraph"> 
        <p><a href="/manual.html#gui_misc">Разное</a></p> 
       </div> 
       <div class="sect4"> 
        <h5 id="gui_components"><a class="anchor" href="/manual.html#gui_components"></a>5.5.2.1. Компоненты</h5> 
        <table class="tableblock frame-none grid-none" style="width: 60%;"> 
         <colgroup> 
          <col style="width: 20%;"> 
          <col style="width: 80%;"> 
         </colgroup> 
         <tbody> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Меню</strong></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_AppMenu">AppMenu</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_AppMenu.png" alt="gui_AppMenu"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_SideMenu">SideMenu</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_sidemenu.png" alt="gui_sidemenu"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Кнопки</strong></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_Button">Button</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/Button.png" alt="Button"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_PopupButton">PopupButton</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/PopupButton.png" alt="PopupButton"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_LinkButton">LinkButton</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/LinkButton.png" alt="LinkButton"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Текст</strong></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_Label">Label</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_label.png" alt="gui_label"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Ввод текста</strong></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TextField">TextField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_textField_data.png" alt="gui_textField_data"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_PasswordField">PasswordField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_PasswordField.png" alt="gui_PasswordField"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_MaskedField">MaskedField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_MaskedField.png" alt="gui_MaskedField"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TextArea">TextArea</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_TextArea.png" alt="gui_TextArea"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_RichTextArea">RichTextArea</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_RichTextArea.png" alt="gui_RichTextArea"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_SourceCodeEditor">SourceCodeEditor</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_SourceCodeEditor_1.png" alt="gui_SourceCodeEditor_1"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Ввод даты</strong></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_DateField">DateField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_dateField.png" alt="gui_dateField"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_DatePicker">DatePicker</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_datepicker_mini.png" alt="gui_datepicker_mini"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TimeField">TimeField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_timeField.png" alt="gui_timeField"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Поля выбора</strong></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_CheckBox">CheckBox</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/CheckBox.png" alt="CheckBox"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_OptionsGroup">OptionsGroup</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_optionsGroup.png" alt="gui_optionsGroup"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_OptionsGroup">OptionsList</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_optionsList.png" alt="gui_optionsList"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_PickerField">PickerField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/PickerField.png" alt="PickerField"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_LookupField">LookupField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/LookupField.png" alt="LookupField"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_LookupPickerField">LookupPickerField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/LookupPickerField.png" alt="LookupPickerField"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_SearchPickerField">SearchPickerField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_searchPickerField.png" alt="gui_searchPickerField"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_SuggestionPickerField">SuggestionPickerField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_suggestionPickerField_1.png" alt="gui_suggestionPickerField_1"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TwinColumn">TwinColumn</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/TwinColumn.png" alt="TwinColumn"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Загрузка</strong></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_FileUploadField">FileUploadField</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/Upload.png" alt="Upload"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_FileMultiUploadField">FileMultiUploadField</a></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Таблицы и деревья</strong></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_DataGrid">DataGrid</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_dataGrid.png" alt="gui_dataGrid"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_Table">Table</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_table.png" alt="gui_table"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_GroupTable">GroupTable</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_groupTable.png" alt="gui_groupTable"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TreeTable">TreeTable</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_treeTable.png" alt="gui_treeTable"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_Tree">Tree</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_Tree.png" alt="gui_Tree"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><strong>Другое</strong></p></td> 
           <td class="tableblock halign-left valign-middle"></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_BrowserFrame">BrowserFrame</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_browserFrame.png" alt="gui_browserFrame"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_Calendar">Calendar</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_calendar_1.png" alt="gui_calendar_1"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_ColorPicker">ColorPicker</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_color_picker.png" alt="gui_color_picker"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_FieldGroup">FieldGroup</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_fieldGroup.png" alt="gui_fieldGroup"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_Filter">Filter</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_filter_mini.png" alt="gui_filter_mini"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_Image">Image</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_Image_1.png" alt="gui_Image_1"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_PopupView">PopupView</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_popup_view_mini_open.png" alt="gui_popup_view_mini_open"></span></p></td> 
          </tr> 
          <tr> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TokenList">TokenList</a></p></td> 
           <td class="tableblock halign-left valign-middle"><p class="tableblock"><span class="image"><img src="assets/gui_tokenList.png" alt="gui_tokenList"></span></p></td> 
          </tr> 
         </tbody> 
        </table> 
        <div class="sect5"> 
         <h6 id="gui_AppMenu"><a class="anchor" href="/manual.html#gui_AppMenu"></a>5.5.2.1.1. AppMenu</h6> 
         <div class="paragraph"> 
          <p>Компонент <code>AppMenu</code> позволяет динамически управлять элементами главного меню в <a href="/manual.html#main_window_layout">главном окне приложения</a>.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_AppMenu.png" alt="gui AppMenu"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>CUBA Studio предоставляет готовый шаблон главного экрана на основе стандартного экрана <code>mainWindow</code> платформы. Шаблон расширяет класс <code>AppMainWindow</code> и обеспечивает прямой доступ к экземпляру компонента <code>AppMenu</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExtAppMainWindow</span> <span class="directive">extends</span> AppMainWindow {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        <span class="local-variable">super</span>.init(params);

        AppMenu.MenuItem item = mainMenu.createMenuItem(<span class="string"><span class="delimiter">"</span><span class="content">shop</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Shop</span><span class="delimiter">"</span></span>);
        AppMenu.MenuItem subItem = mainMenu.createMenuItem(<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Customers</span><span class="delimiter">"</span></span>, <span class="predefined-constant">null</span>, menuItem -&gt; {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Customers menu item clicked</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
        });
        item.addChildItem(subItem);
        mainMenu.addMenuItem(item, <span class="integer">0</span>);
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Методы интерфейса <code>AppMenu</code>:</p> 
         </div> 
         <div id="gui_AppMenu_addMenuItem" class="ulist"> 
          <ul> 
           <li> <p><code>addMenuItem()</code> - добавляет элемент меню в конец списка элементов или на позицию с указанным индексом.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_AppMenu_createMenuItem" class="ulist"> 
          <ul> 
           <li> <p><code>createMenuItem()</code> - фабричный метод для создания нового элемента меню. Не добавляет элемент к меню. <code>id</code> должен быть уникальным внутри всего меню.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_AppMenu_createSeparator" class="ulist"> 
          <ul> 
           <li> <p><code>createSeparator()</code> - создаёт разделитель элементов меню.</p> </li> 
           <li> <p><code>getMenuItem()/getMenuItemNN()</code> - возвращает объект элемента меню по его идентификатору.</p> </li> 
           <li> <p><code>getMenuItems()</code> - возвращает список элементов меню.</p> </li> 
           <li> <p><code>hasMenuItems()</code> - возвращает <code>true</code>, если меню содержит элементы.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Методы интерфейса <code>MenuItem</code>:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>addChildItem() / removeChildItem()</code> - добавляет/удаляет элемент меню в конец или на указанную позицию в списке дочерних элементов.</p> </li> 
           <li> <p><code>getCaption()</code> - возвращает строковый заголовок элемента меню.</p> </li> 
           <li> <p><code>getChildren()</code> - возвращает список дочерних элементов.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_AppMenu_setCommand" class="ulist"> 
          <ul> 
           <li> <p><code>setCommand()</code> - используется для описания действия, которое должно быть выполнено при выборе этого элемента меню кликом мыши.</p> </li> 
           <li> <p><code>setDescription()</code> - устанавливает строковое описание элемента меню, отображаемое в виде всплывающей подсказки.</p> </li> 
           <li> <p><code>setIcon()</code> - устанавливает пиктограмму элемента меню.</p> </li> 
           <li> <p><code>getId()</code> - возвращает идентификатор элемента меню.</p> </li> 
           <li> <p><code>getMenu()</code> - возвращает родительский экземпляр <code>AppMenu</code>.</p> </li> 
           <li> <p><code>setStylename()</code> - устанавливает один или более пользовательских стилей для компонента, заменяя все ранее заданные стили. Имена стилей при перечислении отделаются пробелами. Имя стиля должно быть названием существующего CSS-класса.</p> </li> 
           <li> <p><code>hasChildren()</code> - возвращает <code>true</code>, если у элемента меню есть дочерние элементы.</p> </li> 
           <li> <p><code>isSeparator()</code> - возвращает <code>true</code>, если элемент является разделителем.</p> </li> 
           <li> <p><code>setVisible()</code> - управляет видимостью элемента меню.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_AppMenu_addMenuItem">addMenuItem</a> - <a href="/manual.html#gui_AppMenu_createMenuItem">createMenuItem</a> - <a href="/manual.html#gui_AppMenu_createSeparator">createSeparator</a> - <a href="/manual.html#gui_AppMenu_setCommand">setCommand</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_BrowserFrame"><a class="anchor" href="/manual.html#gui_BrowserFrame"></a>5.5.2.1.2. BrowserFrame</h6> 
         <div class="paragraph"> 
          <p>Компонент <code>BrowserFrame</code> предназначен для включения веб-страницы на страницу приложения. Это аналог HTML-элемента <code>iframe</code>.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_browserFrame.png" alt="gui browserFrame"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>browserFrame</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования компонента <code>browserFrame</code> в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;browserFrame</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">browserFrame</span><span class="delimiter">"</span></span>
              <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span>
              <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">500px</span><span class="delimiter">"</span></span>
              <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;url</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">"</span><span class="content">https://doc.cuba-platform.com/manual-6.6/</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/browserFrame&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Подобно компоненту <a href="/manual.html#gui_Image">Image</a>, <code>BrowserFrame</code> также можно использовать для отображения графического содержимого из различных источников. Тип ресурса можно указать декларативно с помощью элементов <code>browserFrame</code>, перечисленных ниже:</p> 
         </div> 
         <div id="gui_BrowserFrame_classpath" class="ulist"> 
          <ul> 
           <li> <p><code>classpath</code> - ресурс, расположенный в classpath.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;browserFrame&gt;</span>
    <span class="tag">&lt;classpath</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">com/company/sample/web/screens/myPic.jpg</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/browserFrame&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_BrowserFrame_file" class="ulist"> 
          <ul> 
           <li> <p><code>file</code> - файл с изображением.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;browserFrame&gt;</span>
    <span class="tag">&lt;file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">D:\sample\modules\web\web\VAADIN\images\myImage.jpg</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/browserFrame&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_BrowserFrame_relativePath" class="ulist"> 
          <ul> 
           <li> <p><code>relativePath</code> - относительный путь к файлу в каталоге приложения.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;browserFrame&gt;</span>
    <span class="tag">&lt;relativePath</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">VAADIN/images/myImage.jpg</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/browserFrame&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_BrowserFrame_theme" class="ulist"> 
          <ul> 
           <li> <p><code>theme</code> - ресурс из <a href="/manual.html#web_theme">темы</a> приложения, например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;browserFrame&gt;</span>
    <span class="tag">&lt;theme</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">../halo/com.company.demo/myPic.jpg</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/browserFrame&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_BrowserFrame_url" class="ulist"> 
          <ul> 
           <li> <p><code>url</code> - ресурс, загружаемый по URL.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;browserFrame&gt;</span>
    <span class="tag">&lt;url</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.foobar2000.org/</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/browserFrame&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>browserFrame</code>:</p> 
         </div> 
         <div id="gui_BrowserFrame_alternateText" class="ulist"> 
          <ul> 
           <li> <p><code>alternateText</code> - устанавливает альтернативный текст на случай, если ресурс недоступен или не задан.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Параметры ресурсов <code>browserFrame</code>:</p> 
         </div> 
         <div id="gui_BrowserFrame_bufferSize" class="ulist"> 
          <ul> 
           <li> <p><code>bufferSize</code> - размер буфера, используемого для загрузки этого ресурса, в байтах.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;browserFrame&gt;</span>
    <span class="tag">&lt;file</span> <span class="attribute-name">bufferSize</span>=<span class="string"><span class="delimiter">"</span><span class="content">1024</span><span class="delimiter">"</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">C:/img.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/browserFrame&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_BrowserFrame_cacheTime" class="ulist"> 
          <ul> 
           <li> <p><code>cacheTime</code> - время хранения объекта в кэше в миллисекундах.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;browserFrame&gt;</span>
    <span class="tag">&lt;file</span> <span class="attribute-name">cacheTime</span>=<span class="string"><span class="delimiter">"</span><span class="content">2400</span><span class="delimiter">"</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">C:/img.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/browserFrame&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_BrowserFrame_mimeType" class="ulist"> 
          <ul> 
           <li> <p><code>mimeType</code> - MIME-тип ресурса.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;browserFrame&gt;</span>
    <span class="tag">&lt;url</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">"</span><span class="content">https://avatars3.githubusercontent.com/u/17548514?v=4</span><span class="entity">&amp;#38;</span><span class="content">s=200</span><span class="delimiter">"</span></span>
         <span class="attribute-name">mimeType</span>=<span class="string"><span class="delimiter">"</span><span class="content">image/png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/browserFrame&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Методы интерфейса <code>BrowserFrame</code>:</p> 
         </div> 
         <div id="gui_BrowserFrame_SourceChangeListener" class="ulist"> 
          <ul> 
           <li> <p><code>addSourceChangeListener()</code> - добавляет слушатель для отслеживания изменений источника содержимого.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">browserFrame.addSourceChangeListener(event -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Content updated</span><span class="delimiter">"</span></span>));</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_BrowserFrame_setSource" class="ulist"> 
          <ul> 
           <li> <p><code>setSource()</code> - устанавливает источник содержимого фрейма. Метод принимает тип ресурса и возвращает объект ресурса, который может быть сконфигурирован далее. Для каждого типа ресурсов есть свои методы, например, <code>setPath()</code> для <code>ThemeResource</code> или <code>setStreamSupplier()</code> для <code>StreamResource</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">BrowserFrame frame = componentsFactory.createComponent(BrowserFrame.class);
<span class="keyword">try</span> {
    frame.setSource(UrlResource.class).setUrl(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://www.foobar2000.org/</span><span class="delimiter">"</span></span>));
} <span class="keyword">catch</span> (<span class="exception">MalformedURLException</span> e) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Вы можете использовать те же <a href="/manual.html#gui_Image_setSource">типы ресурсов</a>, что и для компонента <code>Image</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_BrowserFrame_createResource" class="ulist"> 
          <ul> 
           <li> <p><code>createResource()</code> - создаёт ресурс фрейма указанного типа. Созданный объект может быть позже передан в метод <code>setSource()</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">UrlResource resource = browserFrame.createResource(UrlResource.class)
        .setUrl(<span class="keyword">new</span> <span class="predefined-type">URL</span>(fromString));
browserFrame.setSource(resource);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты browserFrame
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_BrowserFrame_alternateText">alternateText</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_colspan">colspan</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_responsive">responsive</a> - <a href="/manual.html#gui_attr_rowspan">rowspan</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты ресурсов browserFrame
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_BrowserFrame_bufferSize">bufferSize</a> - <a href="/manual.html#gui_BrowserFrame_cacheTime">cacheTime</a> - <a href="/manual.html#gui_BrowserFrame_mimeType">mimeType</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы browserFrame
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_BrowserFrame_classpath">classpath</a> - <a href="/manual.html#gui_BrowserFrame_file">file</a> - <a href="/manual.html#gui_BrowserFrame_relativePath">relativePath</a> - <a href="/manual.html#gui_BrowserFrame_theme">theme</a> - <a href="/manual.html#gui_BrowserFrame_url">url</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_BrowserFrame_SourceChangeListener">addSourceChangeListener</a> - <a href="/manual.html#gui_BrowserFrame_createResource">createResource</a> - <a href="/manual.html#gui_BrowserFrame_setSource">setSource</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Button"><a class="anchor" href="/manual.html#gui_Button"></a>5.5.2.1.3. Button</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-button" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопка (<code>Button</code>) − компонент, обеспечивающий выполнение действия при нажатии.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/Button.png" alt="Button"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>button</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент кнопки реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопка может содержать текст или пиктограмму (или и то и другое). На рисунке ниже отображены разные виды кнопок.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_buttonTypes.png" alt="gui buttonTypes"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Пример кнопки с названием, взятым из <a href="/manual.html#message_packs">пакета локализованных сообщений</a>, и с всплывающей подсказкой:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">textButton</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://someAction</span><span class="delimiter">"</span></span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">Press me</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Название кнопки задается с помощью атрибута <a href="/manual.html#gui_attr_caption">caption</a>, всплывающая подсказка − с помощью атрибута <a href="/manual.html#gui_attr_description">description</a>.</p> 
         </div> 
         <div id="gui_Button_disableOnClick" class="paragraph"> 
          <p>Если атрибут <code>disableOnClick</code> имеет значение <code>true</code>, кнопка будет автоматически отключена после клика по ней. Обычно это делается для того, чтобы предотвратить случайные повторные клики по кнопке. Впоследствии, вы можете снова включить кнопку с помощью вызова метода <code>setEnabled(true)</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибут <a href="/manual.html#gui_attr_icon">icon</a> указывает на местоположение пиктограммы в каталоге темы. Подробную информацию о том, где следует располагать файлы пиктограмм, можно прочитать в <a href="/manual.html#gui_themes">Создание темы приложения</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример создания кнопки с пиктограммой:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">iconButton</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span> <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">icons/save.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div id="gui_Button_invoke" class="paragraph"> 
          <p>Основная функция кнопки − выполнить некоторое действие при нажатии на нее. Определить метод контроллера, который будет вызываться при нажатии на кнопку, можно с помощью атрибута <code>invoke</code>. Значением атрибута должно быть имя метода контроллера, удовлетворяющего следующим условиям:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Метод должен быть <code>public</code>.</p> </li> 
           <li> <p>Метод должен возвращать <code>void</code>.</p> </li> 
           <li> <p>Метод должен либо не иметь аргументов, либо иметь один аргумент типа <code>Component</code>. Если метод имеет аргумент <code>Component</code>, то при вызове в него будет передан экземпляр вызвавшей кнопки.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В качестве примера показано описание кнопки, вызывающей метод <code>someMethod:</code></p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;button</span> <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">someMethod</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://someButton</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В контроллере экрана необходимо определить метод <code>someMethod</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> someMethod() {
    <span class="comment">//some actions</span>
}</code></pre> 
          </div> 
         </div> 
         <div id="gui_Button_action" class="paragraph"> 
          <p>Атрибут <code>invoke</code> игнорируется, если для кнопки задан атрибут <code>action</code>. Атрибут <code>action</code> содержит имя <a href="/manual.html#gui_Action">действия</a>, соответствующего данной кнопке.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример кнопки с атрибутом <code>action</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">someAction</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://someAction</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">someAction</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопке можно назначить любое действие, имеющееся в каком-либо компоненте, реализующем интерфейс <code>Component.ActionsHolder</code> (это актуально для <a href="/manual.html#gui_Table">Table</a>, <a href="/manual.html#gui_GroupTable">GroupTable</a>, <a href="/manual.html#gui_TreeTable">TreeTable</a>, <a href="/manual.html#gui_Tree">Tree</a>). Причем неважно, каким образом эти действия добавлены - декларативно в XML-дескрипторе или программно в контроллере. В любом случае для использования такого действия достаточно в атрибуте <code>action</code> указать через точку имя компонента и идентификатор нужного действия. Например, в следующем примере кнопке назначается действие <code>create</code> таблицы <code>coloursTable</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursTable.create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Действие для кнопки можно также создавать программно, в контроллере экрана, используя наследование от класса <a href="/manual.html#baseAction">BaseAction</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Если для <code>Button</code> установлен экземпляр <code>Action</code>, то кнопка возьмет из него следующие свои свойства: <a href="/manual.html#gui_attr_caption">caption</a>, <a href="/manual.html#gui_attr_description">description</a>, <a href="/manual.html#gui_attr_icon">icon</a>, <a href="/manual.html#gui_attr_enable">enable</a>, <a href="/manual.html#gui_attr_visible">visible</a>. Свойства <code>caption</code> и <code>description</code> будут проставлены из действия только в том случае, если они не установлены в самом <code>Button</code>. Остальные перечисленные свойства действия имеют безусловный приоритет над свойствами кнопки. Если свойства действия меняются уже после установки этого <code>Action</code> для <code>Button</code>, то соответственно меняться будут и свойства <code>Button</code>, то есть кнопка слушает изменение свойств действия. В этом случае меняется и свойства <code>caption</code> и <code>description</code>, причем даже если они изначально были назначены на саму кнопку.</p> 
         </div> 
         <div id="gui_Button_stylenames" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Стили компонента Button
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>В веб-клиенте с темой, основанной на Halo, к компоненту <code>Button</code> можно применить предопределенные стили. Стили задаются в XML-дексрипторе или контроллере экрана с помощью атрибута <code>stylename</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">button</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Friendly button</span><span class="delimiter">"</span></span>
        <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">friendly</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Чтобы применить стиль программно, выберите одну из констант класса <code>HaloTheme</code> с префиксом компонента <code>BUTTON_</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">button.setStyleName(HaloTheme.BUTTON_FRIENDLY);</code></pre> 
               </div> 
              </div> 
              <div id="gui_button_borderless" class="ulist"> 
               <ul> 
                <li> <p><code>borderless</code> - кнопка без полей.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_button_borderless-colored" class="ulist"> 
               <ul> 
                <li> <p><code>borderless-colored</code> - кнопка без полей с цветной надписью.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_button_danger" class="ulist"> 
               <ul> 
                <li> <p><code>danger</code> - выделенная кнопка, обозначающая действие, потенциально небезопасное для пользователя (которое может вызвать потерю данных и прочие необратимые изменения).</p> </li> 
               </ul> 
              </div> 
              <div id="gui_button_friendly" class="ulist"> 
               <ul> 
                <li> <p><code>friendly</code> - выделенная кнопка, обозначающая предпочтительное действие, безопасное для пользователя (не вызывающее потери данных и прочих необратимых изменений).</p> </li> 
               </ul> 
              </div> 
              <div id="gui_button_icon-align-right" class="ulist"> 
               <ul> 
                <li> <p><code>icon-align-right</code> - выравнивание пиктограммы по правому краю надписи.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_button_icon-align-top" class="ulist"> 
               <ul> 
                <li> <p><code>icon-align-top</code> - расположение пиктограммы над надписью.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_button_icon-only" class="ulist"> 
               <ul> 
                <li> <p><code>icon-only</code> - отображается только пиктограмма, кнопка квадратной формы.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_button_primary" class="ulist"> 
               <ul> 
                <li> <p><code>primary</code> - кнопка основного действия (т.е.кнопка, которая получает фокус при нажатии кнопки Enter в форме ввода). Используйте внимательно, не более одной основной кнопки на представление.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_button_quiet" class="ulist"> 
               <ul> 
                <li> <p><code>quiet</code> - "незаметная" кнопка, поля которой не видны до наведения указателя мыши.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты button
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Button_action">action</a> - <a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_Button_disableOnClick">disableOnClick</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Button_invoke">invoke</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили button
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_button_borderless">borderless</a> - <a href="/manual.html#gui_button_borderless-colored">borderless-colored</a> - <a href="/manual.html#gui_button_danger">danger</a> - <a href="/manual.html#gui_button_friendly">friendly</a> - <a href="/manual.html#gui_attr_stylename_huge">huge</a> - <a href="/manual.html#gui_button_icon-align-right">icon-align-right</a> - <a href="/manual.html#gui_button_icon-align-top">icon-align-top</a> - <a href="/manual.html#gui_button_icon-only">icon-only</a> - <a href="/manual.html#gui_attr_stylename_large">large</a> - <a href="/manual.html#gui_button_primary">primary</a> - <a href="/manual.html#gui_button_quiet">quiet</a> - <a href="/manual.html#gui_attr_stylename_small">small</a> - <a href="/manual.html#gui_attr_stylename_tiny">tiny</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_BulkEditor"><a class="anchor" href="/manual.html#gui_BulkEditor"></a>5.5.2.1.4. BulkEditor</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=bulk-editor" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>BulkEditor</code> - компонент, позволяющий менять значения атрибутов сразу нескольких выбранных экземпляров сущностей. Компонент представляет собой кнопку, добавляющуюся к <a href="/manual.html#gui_Table">таблице</a> или <a href="/manual.html#gui_Tree">дереву</a> и при нажатии открывающую редактор сущностей.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_bulkEdit.png" alt="gui bulkEdit"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>bulkEditor</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Для использования <code>BulkEditor</code> у таблицы или дерева должен быть задан атрибут <code>multiselect="true"</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Экран редактирования сущностей генерируется автоматически на основе заданного представления (содержащего только поля данной сущности, в том числе ссылки) и разрешений пользователя. Системные атрибуты в редакторе также не отображаются.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты сущности в редакторе сортируются по алфавиту. По умолчанию они пусты. При коммите экрана заданные на экране непустые значения атрибутов проставляются всем выбранным экземплярам сущности.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Редактор позволяет удалить значение определенного поля в БД у всех выбранных сущностей, установив его в <code>null</code>. Для этого необходимо нажать на кнопку <span class="image"><img src="assets/gui_bulkEditorSetNullButton.png" alt="gui_bulkEditorSetNullButton"></span> рядом с соответствующим полем. После этого поле становится нередактируемым. Разблокировать поле можно, нажав на кнопку эту же кнопку снова.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_invoiceBulkEdit.png" alt="gui invoiceBulkEdit"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания компонента <code>bulkEditor</code> для таблицы:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">invoiceTable</span><span class="delimiter">"</span></span>
       <span class="attribute-name">multiselect</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
       <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="comment">&lt;!-- ... --&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
    <span class="tag">&lt;buttonsPanel&gt;</span>
        <span class="comment">&lt;!-- ... --&gt;</span>
        <span class="tag">&lt;bulkEditor</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">"</span><span class="content">invoiceTable</span><span class="delimiter">"</span></span>
                    <span class="attribute-name">exclude</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/buttonsPanel&gt;</span></code></pre> 
          </div> 
         </div> 
         <div id="gui_BulkEditor_for" class="paragraph"> 
          <p>Атрибут <code>for</code> является обязательным. В нем указывается идентификатор таблицы или дерева, в данном случае - <code>invoiceTable</code>.</p> 
         </div> 
         <div id="gui_BulkEditor_exclude" class="paragraph"> 
          <p>Атрибут <code>exclude</code> может содержать регулярное выражения для явного исключения определенных полей из списка редактируемых. Например: <code>date|customer</code></p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_TableBulkEdit.png" alt="gui TableBulkEdit"> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты bulkEditor
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_BulkEditor_exclude">exclude</a> - <a href="/manual.html#gui_BulkEditor_for">for</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_openType">openType</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Calendar"><a class="anchor" href="/manual.html#gui_Calendar"></a>5.5.2.1.5. Calendar</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=month-calendar" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>Calendar</code> предназначен для организации и отображения событий календаря.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_calendar_1.png" alt="gui calendar 1"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>calendar</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания компонента в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;calendar</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">calendar</span><span class="delimiter">"</span></span>
          <span class="attribute-name">captionProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">caption</span><span class="delimiter">"</span></span>
          <span class="attribute-name">startDate</span>=<span class="string"><span class="delimiter">"</span><span class="content">2016-10-01</span><span class="delimiter">"</span></span>
          <span class="attribute-name">endDate</span>=<span class="string"><span class="delimiter">"</span><span class="content">2016-10-31</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
          <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Режим отображения определяется временным диапазоном календаря, который задаётся его начальной и конечной датой. По умолчанию используется режим отображения недели, работающий с диапазонами до семи дней. Для отображения календаря на один день используйте диапазон в пределах одной календарной даты. Режим отображения месяца применяется, если заданный диапазон превышает одну неделю (семь дней).</p> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопки навигации для перелистывания календаря на одну неделю вперёд/назад по умолчанию отключены. Чтобы кнопки были видны в режиме отображения недели, используйте атрибут <code>navigationButtonsVisible</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;calendar</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
          <span class="attribute-name">navigationButtonsVisible</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_calendar_2.png" alt="gui calendar 2"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>calendar</code>:</p> 
         </div> 
         <div id="gui_Calendar_endDate" class="ulist"> 
          <ul> 
           <li> <p><code>endDate</code> - конечная дата диапазона календаря.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_endDateProperty" class="ulist"> 
          <ul> 
           <li> <p><code>endDateProperty</code> - имя атрибута сущности, содержащего конечную дату события.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_descriptionProperty" class="ulist"> 
          <ul> 
           <li> <p><code>descriptionProperty</code> - имя атрибута сущности, содержащего описание события.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_isAllDayProperty" class="ulist"> 
          <ul> 
           <li> <p><code>isAllDayProperty</code> - имя атрибута сущности, отвечающего за отображение события в течение всего дня.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_startDate" class="ulist"> 
          <ul> 
           <li> <p><code>startDate</code> - начальная дата диапазона календаря.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_startDateProperty" class="ulist"> 
          <ul> 
           <li> <p><code>startDateProperty</code> - имя атрибута сущности, содержащего начальную дату события.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_stylenameProperty" class="ulist"> 
          <ul> 
           <li> <p><code>stylenameProperty</code> - имя атрибута сущности, содержащего имя стиля события.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_timeFormat" class="ulist"> 
          <ul> 
           <li> <p><code>timeFormat</code> - формат времени: 12H or 24H.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_addEvent" class="paragraph"> 
          <p>Для отображения событий в ячейках календаря их можно прямо добавлять в объект <code>Calendar</code> при помощи метода <code>addEvent()</code> или использовать интерфейс <code>CalendarEventProvider</code>. Пример добавления события напрямую:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> <span class="predefined-type">Calendar</span> calendar;

<span class="directive">public</span> <span class="type">void</span> generateEvent(<span class="predefined-type">String</span> caption, <span class="predefined-type">String</span> description, <span class="predefined-type">Date</span> start, <span class="predefined-type">Date</span> end, <span class="type">boolean</span> isAllDay, <span class="predefined-type">String</span> stylename) {
    SimpleCalendarEvent calendarEvent = <span class="keyword">new</span> SimpleCalendarEvent();
    calendarEvent.setCaption(caption);
    calendarEvent.setDescription(description);
    calendarEvent.setStart(start);
    calendarEvent.setEnd(end);
    calendarEvent.setAllDay(isAllDay);
    calendarEvent.setStyleName(stylename);
    calendar.getEventProvider().addEvent(calendarEvent);
}</code></pre> 
          </div> 
         </div> 
         <div id="gui_Calendar_setEventProvider" class="paragraph"> 
          <p>Интерфейс <code>CalendarEventProvider</code> имеет две готовые реализации: <code>ListCalendarEventProvider</code> (создаваемый по умолчанию) и <code>EntityCalendarEventProvider</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>ListCalendarEventProvider</code> заполняется данными с помощью метода <code>addEvent()</code>, принимающего объект <code>CalendarEvent</code> в качестве параметра:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> <span class="predefined-type">Calendar</span> calendar;

<span class="directive">public</span> <span class="type">void</span> addEvents() {
    ListCalendarEventProvider listCalendarEventProvider = <span class="keyword">new</span> ListCalendarEventProvider();
    calendar.setEventProvider(listCalendarEventProvider);
    listCalendarEventProvider.addEvent(generateEvent(
            <span class="string"><span class="delimiter">"</span><span class="content">Training</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Student training</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">2016-10-17 09:00</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">2016-10-17 14:00</span><span class="delimiter">"</span></span>, <span class="predefined-constant">false</span>, <span class="string"><span class="delimiter">"</span><span class="content">event-blue</span><span class="delimiter">"</span></span>));
    listCalendarEventProvider.addEvent(generateEvent(
            <span class="string"><span class="delimiter">"</span><span class="content">Development</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Platform development</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">2016-10-17 15:00</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">2016-10-17 18:00</span><span class="delimiter">"</span></span>, <span class="predefined-constant">false</span>, <span class="string"><span class="delimiter">"</span><span class="content">event-red</span><span class="delimiter">"</span></span>));
    listCalendarEventProvider.addEvent(generateEvent(
            <span class="string"><span class="delimiter">"</span><span class="content">Party</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Party with friends</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">2016-10-22 13:00</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">2016-10-22 18:00</span><span class="delimiter">"</span></span>, <span class="predefined-constant">false</span>, <span class="string"><span class="delimiter">"</span><span class="content">event-yellow</span><span class="delimiter">"</span></span>));
}

<span class="directive">private</span> SimpleCalendarEvent generateEvent(<span class="predefined-type">String</span> caption, <span class="predefined-type">String</span> description, <span class="predefined-type">String</span> start, <span class="predefined-type">String</span> end, <span class="predefined-type">Boolean</span> allDay, <span class="predefined-type">String</span> style) {
    SimpleCalendarEvent calendarEvent = <span class="keyword">new</span> SimpleCalendarEvent();
    <span class="predefined-type">SimpleDateFormat</span> df = <span class="keyword">new</span> <span class="predefined-type">SimpleDateFormat</span>(<span class="string"><span class="delimiter">"</span><span class="content">yyyy-MM-dd HH:mm</span><span class="delimiter">"</span></span>);
    calendarEvent.setCaption(caption);
    calendarEvent.setDescription(description);
    calendarEvent.setStart(df.parse(start));
    calendarEvent.setEnd(df.parse(end));
    calendarEvent.setAllDay(allDay);
    calendarEvent.setStyleName(style);
    <span class="keyword">return</span> calendarEvent;
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p><code>EntityCalendarEventProvider</code> получает данные напрямую из атрибутов сущности. Чтобы <code>EntityCalendarEventProvider</code> мог использовать сущность, она должна иметь <strong>как минимум</strong> следующие атрибуты: дата начала события (тип DateTime), дата окончания события (тип DateTime) и заголовок события (тип String).</p> 
         </div> 
         <div class="paragraph"> 
          <p>В следующем примере мы предположим, что сущность в источнике данных имеет все необходимые атрибуты: <code>eventCaption</code>, <code>eventDescription</code>, <code>eventStartDate</code>, <code>eventEndDate</code>, <code>eventStylename</code>, и укажем их имена в качестве значений атрибутов <code>calendar</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;calendar</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">calendar</span><span class="delimiter">"</span></span>
          <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">calendarEventsDs</span><span class="delimiter">"</span></span>
          <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
          <span class="attribute-name">startDate</span>=<span class="string"><span class="delimiter">"</span><span class="content">2016-10-01</span><span class="delimiter">"</span></span>
          <span class="attribute-name">endDate</span>=<span class="string"><span class="delimiter">"</span><span class="content">2016-10-31</span><span class="delimiter">"</span></span>
          <span class="attribute-name">captionProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">eventCaption</span><span class="delimiter">"</span></span>
          <span class="attribute-name">descriptionProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">eventDescription</span><span class="delimiter">"</span></span>
          <span class="attribute-name">startDateProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">eventStartDate</span><span class="delimiter">"</span></span>
          <span class="attribute-name">endDateProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">eventEndDate</span><span class="delimiter">"</span></span>
          <span class="attribute-name">stylenameProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">eventStylename</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Для пользовательского взаимодействия с элементами <code>Calendar</code>, такими как подписи даты и номера недель, выбор диапазона даты/времени, перетаскивание событий и изменение их размера, могут быть заданы различные слушатели. Слушатели также используются для кнопок навигации, листающих диапазон календаря вперёд и назад. Ниже приведён список слушателей по умолчанию:</p> 
         </div> 
         <div id="gui_Calendar_CalendarDateClickListener" class="ulist"> 
          <ul> 
           <li> <p><code>addDateClickListener(CalendarDateClickListener listener);</code> - добавляет слушатель кликов по дате.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">calendar.addDateClickListener(
        calendarDateClickEvent -&gt;
                showNotification(<span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">"</span><span class="content">Date clicked: %s</span><span class="delimiter">"</span></span>, calendarDateClickEvent.getDate().toString()),
                        NotificationType.HUMANIZED));</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_CalendarWeekClickListener" class="ulist"> 
          <ul> 
           <li> <p><code>addWeekClickListener()</code> - добавляет слушатель кликов по номеру недели.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_CalendarEventClickListener" class="ulist"> 
          <ul> 
           <li> <p><code>addEventClickListener()</code> - добавляет слушатель кликов по событию календаря.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_CalendarEventResizeListener" class="ulist"> 
          <ul> 
           <li> <p><code>addEventResizeListener()</code> - добавляет слушатель изменения размеров события календаря.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_CalendarEventMoveListener" class="ulist"> 
          <ul> 
           <li> <p><code>addEventMoveListener()</code> - добавляет слушатель перетаскивания события.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_CalendarForwardClickListener" class="ulist"> 
          <ul> 
           <li> <p><code>addForwardClickListener()</code> - добавляет слушатель перелистывания календаря вперёд во времени.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_CalendarBackwardClickListener" class="ulist"> 
          <ul> 
           <li> <p><code>addBackwardClickListener()</code> - добавляет слушатель перелистывания календаря назад во времени.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Calendar_CalendarRangeSelectListener" class="ulist"> 
          <ul> 
           <li> <p><code>addRangeSelectListener()</code> - добавляет слушатель выбора диапазона календаря.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Событиям календаря можно задавать стили с помощью CSS. Для настройки стиля задайте имя стиля и его параметры в файле <code>.scss</code>. Пример настройки цвета фона события:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="scss">.v-calendar-event.event-green {
  background-color: #c8f4c9;
  color: #00e026;
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Затем вызовите метод <code>setStyleName</code> для нужного события:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">calendarEvent.setStyleName(<span class="string"><span class="delimiter">"</span><span class="content">event-green</span><span class="delimiter">"</span></span>);</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В результате, цвет фона события стал зелёным:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_calendar_3.png" alt="gui calendar 3"> 
          </div> 
         </div> 
         <div id="gui_Calendar_setDayNames" class="paragraph"> 
          <p>Для компонента <code>Calendar</code> можно изменить названия дней недели и месяцев по умолчанию, используя методы <code>setDayNames()</code> и <code>setMonthNames()</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;DayOfWeek, <span class="predefined-type">String</span>&gt; days = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;(<span class="integer">7</span>);
days.put(DayOfWeek.MONDAY,<span class="string"><span class="delimiter">"</span><span class="content">Heavens and earth</span><span class="delimiter">"</span></span>);
days.put(DayOfWeek.TUESDAY,<span class="string"><span class="delimiter">"</span><span class="content">Sky</span><span class="delimiter">"</span></span>);
days.put(DayOfWeek.WEDNESDAY,<span class="string"><span class="delimiter">"</span><span class="content">Dry land</span><span class="delimiter">"</span></span>);
days.put(DayOfWeek.THURSDAY,<span class="string"><span class="delimiter">"</span><span class="content">Stars</span><span class="delimiter">"</span></span>);
days.put(DayOfWeek.FRIDAY,<span class="string"><span class="delimiter">"</span><span class="content">Fish and birds</span><span class="delimiter">"</span></span>);
days.put(DayOfWeek.SATURDAY,<span class="string"><span class="delimiter">"</span><span class="content">Animals and man</span><span class="delimiter">"</span></span>);
days.put(DayOfWeek.SUNDAY,<span class="string"><span class="delimiter">"</span><span class="content">Rest</span><span class="delimiter">"</span></span>);
calendar.setDayNames(days);</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты calendar
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_attr_colspan">colspan</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_Calendar_descriptionProperty">descriptionProperty</a> - <a href="/manual.html#gui_Calendar_endDateProperty">endDateProperty</a> - <a href="/manual.html#gui_Calendar_endDate">endDate</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Calendar_isAllDayProperty">isAllDayProperty</a> - <a href="/manual.html#gui_attr_rowspan">rowspan</a> - <a href="/manual.html#gui_Calendar_startDate">startDate</a> - <a href="/manual.html#gui_Calendar_startDateProperty">startDateProperty</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_Calendar_stylenameProperty">stylenameProperty</a> - <a href="/manual.html#gui_Calendar_timeFormat">timeFormat</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Calendar_addEvent">addEvent</a> - <a href="/manual.html#gui_Calendar_setEventProvider">setEventProvider</a> - <a href="/manual.html#gui_Calendar_setDayNames">setDayNames</a></p> 
           </dd> 
           <dt class="hdlist1">
            Слушатели calendar
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Calendar_CalendarBackwardClickListener">CalendarBackwardClickListener</a> - <a href="/manual.html#gui_Calendar_CalendarDateClickListener">CalendarDateClickListener</a> - <a href="/manual.html#gui_Calendar_CalendarEventClickListener">CalendarEventClickListener</a> - <a href="/manual.html#gui_Calendar_CalendarEventMoveListener">CalendarEventMoveListener</a> - <a href="/manual.html#gui_Calendar_CalendarEventResizeListener">CalendarEventResizeListener</a> - <a href="/manual.html#gui_Calendar_CalendarForwardClickListener">CalendarForwardClickListener</a> - <a href="/manual.html#gui_Calendar_CalendarRangeSelectListener">CalendarRangeSelectListener</a> - <a href="/manual.html#gui_Calendar_CalendarWeekClickListener">CalendarWeekClickListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_CheckBox"><a class="anchor" href="/manual.html#gui_CheckBox"></a>5.5.2.1.6. CheckBox</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-checkbox" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Флажок (<code>CheckBox</code>) − компонент, имеющий два состояния: выбран, не выбран.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/CheckBox.png" alt="CheckBox"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>checkBox</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>CheckBox</code> реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример флажка с надписью, взятой из <a href="/manual.html#message_packs">пакета локализованных сообщений</a>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;checkBox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">accessField</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://accessFieldCaption</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Сброс или установка флажка изменяет его значение: <code>Boolean.TRUE</code> или <code>Boolean.FALSE</code>. Значение может быть получено с помощью метода <code>getValue()</code> и установлено с помощью метода <code>setValue()</code>. Если в <code>setValue()</code> передать <code>null</code>, то устанавливается значение <code>Boolean.FALSE</code> и флажок снимается.</p> 
         </div> 
         <div id="gui_checkBox_ValueChangeListener" class="paragraph"> 
          <p>Изменение значения флажка, так же как и любого другого компонента, реализующего интерфейс <code>Field</code>, можно отслеживать с помощью слушателя <code>ValueChangeListener</code>. Например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> CheckBox accessField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    accessField.addValueChangeListener(event -&gt; {
        <span class="keyword">if</span> (<span class="predefined-type">Boolean</span>.TRUE.equals(event.getValue())) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">set</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
        } <span class="keyword">else</span> {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">not set</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
        }
    });
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Для создания флажка, связанного с данными, необходимо использовать атрибуты <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>.</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Customer</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;checkBox</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">active</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Как видно из примера, в экране описывается <a href="/manual.html#datasources">источник данных</a> <code>customerDs</code> для некоторой сущности Покупатель (<code>Customer</code>), имеющей атрибут <code>active</code>. В компоненте <code>checkBox</code> в атрибуте <code>datasource</code> указывается ссылка на источник данных, а в атрибуте <code>property</code> − название атрибута сущности, значение которого должно быть отображено флажком. Атрибут должен быть типа <code>Boolean</code>. Значением атрибута может быть <code>null</code>, при этом флажок снимается.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты checkBox
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_ColorPicker"><a class="anchor" href="/manual.html#gui_ColorPicker"></a>5.5.2.1.7. ColorPicker</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-colorpicker" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>ColorPicker</code> представляет собой поле для предпросмотра и выбора цвета. Компонент возвращает шестнадцатеричный (HEX) код цвета в виде строки.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_color_picker.png" alt="gui color picker"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования <code>ColorPicker</code> с надписью, взятой из пакета локализованных сообщений:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;colorPicker</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">colorPicker</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://colorPickerCaption</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Пример <code>ColorPicker</code> с закрытым окном палитры.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_color_picker_mini.png" alt="gui color picker mini"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Для создания <code>ColorPicker</code>, связанного с данными, необходимо использовать атрибуты <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>.</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Cars</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;colorPicker</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">colorPicker</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">color</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>colorPicker</code>:</p> 
         </div> 
         <div id="gui_ColorPicker_buttonCaption" class="ulist"> 
          <ul> 
           <li> <p><code>buttonCaption</code> - надпись кнопки компонента.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_ColorPicker_defaultCaptionEnabled" class="ulist"> 
          <ul> 
           <li> <p><code>defaultCaptionEnabled</code> - если установлено <code>true</code> и не задан атрибут <code>buttonCaption</code>, в качестве надписи кнопки используется HEX-код текущего цвета.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_ColorPicker_historyVisible" class="ulist"> 
          <ul> 
           <li> <p><code>historyVisible</code> - определяет видимость истории последних выбранных цветов в окне палитры.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_ColorPicker_tabVisibility" class="paragraph"> 
          <p>Видимость вкладок окна палитры можно определить с помощью атрибутов:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>swatchesVisible</code> - определяет видимость вкладки палитры.</p> </li> 
           <li> <p><code>rgbVisible</code> - определяет видимость вкладки селектора RGB.</p> </li> 
           <li> <p><code>hsvVisible</code> - определяет видимость вкладки селектора HSV.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>По умолчанию включена только вкладка селектора RGB.</p> 
         </div> 
         <div id="gui_ColorPicker_captions" class="paragraph"> 
          <p>Надписи окна палитры можно переопределить:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>popupCaption</code> - надпись заголовка окна палитры.</p> </li> 
           <li> <p><code>confirmButtonCaption</code> - надпись кнопки подтверждения.</p> </li> 
           <li> <p><code>cancelButtonCaption</code> - надпись кнопки отмены.</p> </li> 
           <li> <p><code>swatchesTabCaption</code> - заголовок вкладки палитры.</p> </li> 
           <li> <p><code>lookupAllCaption</code> - надпись элемента выпадающего списка, отвечающего за все цвета.</p> </li> 
           <li> <p><code>lookupRedCaption</code> - надпись элемента выпадающего списка, отвечающего за оттенки красного.</p> </li> 
           <li> <p><code>lookupGreenCaption</code> - надпись элемента выпадающего списка, отвечающего за оттенки зеленого.</p> </li> 
           <li> <p><code>lookupBlueCaption</code> - надпись элемента выпадающего списка, отвечающего за оттенки синего.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Метод компонента <code>getValue()</code> возвращает строку, содержащую HEX-код цвета.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты colorPicker
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_ColorPicker_buttonCaption">buttonCaption</a> - <a href="/manual.html#gui_ColorPicker_captions">cancelButtonCaption</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_ColorPicker_captions">confirmButtonCaption</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_ColorPicker_defaultCaptionEnabled">defaultCaptionEnabled</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_ColorPicker_historyVisible">historyVisible</a> - <a href="/manual.html#gui_ColorPicker_tabVisibility">hsvVisible</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_ColorPicker_captions">lookupAllCaption</a> - <a href="/manual.html#gui_ColorPicker_captions">lookupBlueCaption</a> - <a href="/manual.html#gui_ColorPicker_captions">lookupGreenCaption</a> - <a href="/manual.html#gui_ColorPicker_captions">lookupRedCaption</a> - <a href="/manual.html#gui_ColorPicker_captions">popupCaption</a> - <a href="/manual.html#gui_ColorPicker_tabVisibility">rgbVisible</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_ColorPicker_captions">swatchesTabCaption</a> - <a href="/manual.html#gui_ColorPicker_tabVisibility">swatchesVisible</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">ValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_CurrencyField"><a class="anchor" href="/manual.html#gui_CurrencyField"></a>5.5.2.1.8. CurrencyField</h6> 
         <div class="paragraph"> 
          <p><code>CurrencyField</code> - это разновидность текстового поля, предназначенная для ввода денежных единиц. Поле содержит ярлык с обозначением валюты и по умолчанию имеет выравнивание по правому краю.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_currencyField.png" alt="gui currencyField"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>currencyField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>CurrencyField</code> реализован только для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>CurrencyField</code> в основном повторяет функциональность <a href="/manual.html#gui_TextField">TextField</a>: вы так же можете указать <a href="/manual.html#datatype">тип данных</a> для поля, за исключением того, что <code>CurrencyField</code> поддерживает только числовые типы данных, унаследованные от <code>NumericDatatype</code>. Если установлен иной тип данных, будет выброшено исключение.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>CurrencyField</code> можно привязать к <a href="/manual.html#datasources">источнику данных</a> с помощью атрибутов <code>datasource</code> и <code>property</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;currencyField</span> <span class="attribute-name">currency</span>=<span class="string"><span class="delimiter">"</span><span class="content">$</span><span class="delimiter">"</span></span>
               <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span>
               <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>currencyField</code> имеет следующие специфические атрибуты:</p> 
         </div> 
         <div id="gui_CurrencyField_currency" class="ulist"> 
          <ul> 
           <li> <p><code>currency</code> - текст, который будет отображаться в ярлыке валюты.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;currencyField</span> <span class="attribute-name">currency</span>=<span class="string"><span class="delimiter">"</span><span class="content">USD</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_CurrencyField_currencyLabelPosition" class="ulist"> 
          <ul> 
           <li> <p><code>currencyLabelPosition</code> - определяет положение ярлыка внутри текстового поля:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>LEFT</code> - слева от поля ввода,</p> </li> 
                <li> <p><code>RIGHT</code> - справа от поля ввода (значение по умолчанию).</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_CurrencyField_showCurrencyLabel" class="ulist"> 
          <ul> 
           <li> <p><code>showCurrencyLabel</code> - управляет видимостью ярлыка со значком валюты.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты currencyField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_colspan">colspan</a> - <a href="/manual.html#gui_CurrencyField_currency">currency</a> - <a href="/manual.html#gui_CurrencyField_currencyLabelPosition">currencyLabelPosition</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_TextField_datatype">datatype</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_rowspan">rowspan</a> - <a href="/manual.html#gui_CurrencyField_showCurrencyLabel">showCurrencyLabel</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили currencyField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_stylename_huge">huge</a> - <a href="/manual.html#gui_attr_stylename_large">large</a> - <a href="/manual.html#gui_attr_stylename_small">small</a> - <a href="/manual.html#gui_attr_stylename_tiny">tiny</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">addValidator</a> - <a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a> - <a href="/manual.html#gui_CurrencyField_currency">setCurrency</a> - <a href="/manual.html#gui_CurrencyField_currencyLabelPosition">setCurrencyLabelPosition</a> - <a href="/manual.html#gui_CurrencyField_showCurrencyLabel">setShowCurrencyLabel</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_DataGrid"><a class="anchor" href="/manual.html#gui_DataGrid"></a>5.5.2.1.9. DataGrid</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=datagrid-basic-settings" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>DataGrid</code>, подобно компоненту <a href="/manual.html#gui_Table">Table</a>, позволяет выводить информацию в виде таблицы, сортировать её, вызывать действия для выбранных строк, а также более эффективно управлять строками и колонками таблицы за счёт отложенной загрузки данных при прокрутке.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_dataGrid_1.png" alt="gui dataGrid 1"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>dataGrid</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания компонента в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span>
                          <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span>
                          <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderWithCustomer</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>
            select o from sales$Order o order by o.date
        <span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;dataGrid</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDataGrid</span><span class="delimiter">"</span></span>
          <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
          <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;columns&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerName</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer.name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/columns&gt;</span>
<span class="tag">&lt;/dataGrid&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В данном примере атрибут <code>id</code> - это идентификатор колонки, а атрибут <code>property</code> содержит имя атрибута сущности, содержащейся в источнике данных, который следует использовать в качестве данных для колонки.</p> 
         </div> 
         <div class="paragraph"> 
          <p><strong>Элементы dataGrid:</strong></p> 
         </div> 
         <div id="gui_DataGrid_columns" class="ulist"> 
          <ul> 
           <li> <p><code>columns</code> - обязательный элемент, определяет набор колонок <code>DataGrid</code>. Каждая колонка описывается во вложенном элементе <code>column</code> со следующими атрибутами:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>id</code> - необязательный атрибут, содержит строковый идентификатор колонки. Если не задан, в качестве идентификатора колонки будет использоваться строковое значение атрибута <code>property</code>. В этом случае проставление атрибута <code>property</code> является обязательным, в противном случае будет брошено исключение <code>GuiDevelopmentException</code>. Атрибут <code>id</code> по-прежнему является обязательным для колонки, создаваемой программно.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_DataGrid_property" class="ulist"> 
               <ul> 
                <li> <p><code>property</code> - необязательный атрибут, содержит название атрибута сущности, выводимого в колонке. Может быть как непосредственным атрибутом сущности, находящейся в источнике данных, так и атрибутом связанной сущности; переход по графу объектов обозначается точкой. Например:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;columns&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerName</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer.name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerCountry</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer.address.country</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/columns&gt;</span></code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p><code>caption</code> - необязательный атрибут, содержит заголовок колонки. Если не задан, будет отображено <a href="/manual.html#entity_localization">локализованное название атрибута</a> сущности.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_DataGrid_expandRatio" class="ulist"> 
               <ul> 
                <li> <p><code>expandRatio</code> - необязательный атрибут, устанавливает соотношение, с которым столбец расширяется. По умолчанию все колонки расширяются равномерно (словно все колонки имеют <code>expandRatio = 1</code>). Если хотя бы одной колонке установлено иное значение, все неявные значения удаляются и учитываются только проставленные.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_DataGrid_collapsible" class="ulist"> 
               <ul> 
                <li> <p><code>collapsible</code> - необязательный атрибут, определяющий, может ли пользователь управлять отображением колонок с помощью меню (sidebar menu) в правой верхней части <code>DataGrid</code>. По умолчанию имеет значение <code>true</code>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_DataGrid_collapsed" class="ulist"> 
               <ul> 
                <li> <p><code>collapsed</code> - необязательный атрибут, при указании <code>true</code> колонка будет изначально скрыта. По умолчанию имеет значение <code>false</code>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_DataGrid_collapsingToggleCaption" class="ulist"> 
               <ul> 
                <li> <p><code>collapsingToggleCaption</code> - необязательный атрибут, задает имя колонки в меню в правой верхней части <code>DataGrid</code>. По умолчанию имеет значение <code>null</code>, и в этом случае берется значение из заголовка колонки, доступного из свойства <code>caption</code>.</p> 
                 <div class="imageblock" style="text-align: center"> 
                  <div class="content"> 
                   <img src="assets/gui_dataGrid_2.png" alt="gui dataGrid 2"> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_DataGrid_resizable" class="ulist"> 
               <ul> 
                <li> <p><code>resizable</code> - необязательный атрибут, определяет, может ли пользователь изменять размер колонки.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_DataGrid_sortable" class="ulist"> 
               <ul> 
                <li> <p><code>sortable</code> - необязательный атрибут, позволяющий запретить сортировку колонки. Вступает в действие, если атрибут <code>sortable</code> всего <code>DataGrid</code> установлен в <code>true</code> (что имеет место по умолчанию).</p> </li> 
                <li> <p><code>width</code> - необязательный атрибут, отвечает за изначальную ширину колонки. Может принимать только числовые значения в пикселах.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_DataGrid_minimumWidth" class="ulist"> 
               <ul> 
                <li> <p><code>minimumWidth</code> - необязательный атрибут, отвечает за минимальную ширину колонки. Может принимать только числовые значения в пикселах.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_DataGrid_maximumWidth" class="ulist"> 
               <ul> 
                <li> <p><code>maximumWidth</code> - необязательный атрибут, отвечает за максимальную ширину колонки. Может принимать только числовые значения в пикселах.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Элемент <code>column</code> может содержать вложенный элемент <a href="/manual.html#gui_formatter">formatter</a> для представления значения атрибута в виде, отличном от стандартного для данного <a href="/manual.html#datatype">DataType</a>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;formatter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.gui.components.formatters.DateFormatter</span><span class="delimiter">"</span></span>
               <span class="attribute-name">format</span>=<span class="string"><span class="delimiter">"</span><span class="content">yyyy-MM-dd HH:mm:ss</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/column&gt;</span></code></pre> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_actions" class="ulist"> 
          <ul> 
           <li> <p><code>actions</code> - необязательный элемент для описания <a href="/manual.html#gui_Action">действий</a>, связанных с <code>DataGrid</code>. Кроме описания произвольных действий, поддерживаются следующие <a href="/manual.html#standard_actions">стандартные действия</a>, определяемые перечислением <code>ListActionType</code>: create, edit, remove, refresh, add, exclude.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_buttonsPanel" class="ulist"> 
          <ul> 
           <li> <p><code>buttonsPanel</code> - необязательный элемент, создающий над <code>DataGrid</code> контейнер <code>ButtonsPanel</code> для отображения кнопок действий.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_rowsCount" class="ulist"> 
          <ul> 
           <li> <p><code>rowsCount</code> - необязательный элемент, создающий для <code>DataGrid</code> компонент <code>RowsCount</code>, который позволяет загружать в <code>DataGrid</code> данные постранично. Размер страницы задается путем ограничения количества записей в источнике данных методом <code>CollectionDatasource.setMaxResults()</code> в контроллере экрана. Также можно управлять количеством записей. используя универсальный компонент <code>Filter</code>, связанный с источником данных <code>DataGrid</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>RowsCount</code> может также отобразить общее число записей, возвращаемых текущим запросом в источнике данных, без извлечения этих записей. Для этого при щелчке пользователя на знаке "<strong>?</strong>" он вызывает метод <code>AbstractCollectionDatasource.getCount()</code>, что приводит к выполнению в БД запроса с такими же, как у текущего запроса, условиями, но с агрегатной функцией <code>COUNT(*)</code> вместо результатов. Полученное число отображается вместо знака "<strong>?</strong>".</p> 
         </div> 
         <div class="paragraph"> 
          <p><strong>Атрибуты dataGrid:</strong></p> 
         </div> 
         <div id="gui_DataGrid_columnResizeMode" class="ulist"> 
          <ul> 
           <li> <p><code>columnResizeMode</code> - устанавливает режим изменения размера колонок пользователем. Поддерживаются следующие режимы (по умолчанию ANIMATED):</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>AMINATED</code> - размер колонки меняется сразу вслед за курсором.</p> </li> 
                <li> <p><code>SIMPLE</code> - размер колонки меняется только после того как курсор будет отпущен.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> 
            <div id="gui_DataGrid_ColumnResizeListener" class="paragraph"> 
             <p>Изменение размера колонок можно отслеживать с помощью слушателя <code>ColumnResizeListener</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_columnsCollapsingAllowed" class="ulist"> 
          <ul> 
           <li> <p><code>columnsCollapsingAllowed</code> - разрешает или запрещает пользователю скрывать колонки с помощью меню (sidebar menu) в правой части шапки <code>DataGrid</code>. Флажками в меню отмечаются отображаемые в данный момент колонки. В момент установки перезаписывает значение <code>collapsed</code> каждой отдельной колонки. Установка значения в <code>false</code> не позволяет атрибуту <code>collapsed</code> отдельной колонки принять значение <code>true</code>.</p> 
            <div id="gui_DataGrid_ColumnCollapsingChangeListener" class="paragraph"> 
             <p>Скрытие и отображение колонок можно отслеживать с помощью слушателя <code>ColumnCollapsingChangeListener</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_contextMenuEnabled" class="ulist"> 
          <ul> 
           <li> <p><code>contextMenuEnabled</code> - включает или выключает контекстное меню в <code>DataGrid</code>. По умолчанию имеет значение <code>true</code>.</p> 
            <div id="gui_DataGrid_ContextClickListener" class="paragraph"> 
             <p>Щелчки правой кнопкой мыши по области компонента <code>DataGrid</code> можно отслеживать с помощью слушателя <code>ContextClickListener</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_editorBuffered" class="ulist"> 
          <ul> 
           <li> <p><code>editorBuffered</code> - включает буферизацию в режиме внутристрочного редатирования. По умолчанию буферизация разрешена (<code>true</code>).</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_editorCancelCaption" class="ulist"> 
          <ul> 
           <li> <p><code>editorCancelCaption</code> - устанавливает заголовок кнопки отмены в режиме редактирования <code>DataGrid</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_editorEnabled" class="ulist"> 
          <ul> 
           <li> <p><code>editorEnabled</code> - включает отображение UI для внутристрочного редактирования ячеек. Если <code>dataGrid</code> привязан к источнику данных с типом <a href="/manual.html#value_datasources">ValueCollectionDatasource</a>, предполагается, что он используется только для чтения, и использование атрибута <code>editorEnabled</code> в этом случае бессмысленно.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_editorSaveCaption" class="ulist"> 
          <ul> 
           <li> <p><code>editorSaveCaption</code> - устанавливает заголовок кнопки сохранения изменений в режиме редактирования <code>DataGrid</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_frozenColumnCount" class="ulist"> 
          <ul> 
           <li> <p><code>frozenColumnCount</code> - устанавливает количество фиксированных колонок в <code>DataGrid</code>. Значение <code>0</code> означает, что фиксированных колонок не будет, кроме встроенной колонки с чекбоксами для множественного выбора, если она используется. Значение <code>-1</code> означает, что фиксированных колонок не будет вообще.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_headerVisible" class="ulist"> 
          <ul> 
           <li> <p><code>headerVisible</code> - определяет видимость заголовка <code>DataGrid</code>. По умолчанию имеет значение <code>true</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_reorderingAllowed" class="ulist"> 
          <ul> 
           <li> <p><code>reorderingAllowed</code> - разрешает или запрещает пользователю менять местами колонки, перетаскивая их с помощью мыши. По умолчанию имеет значение <code>true</code>.</p> 
            <div id="gui_DataGrid_ColumnReorderListener" class="paragraph"> 
             <p>Изменение расположения колонок можно отслеживать с помощью слушателя <code>ColumnReorderListener</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_selectionMode" class="ulist"> 
          <ul> 
           <li> <p><code>selectionMode</code> - определяет режим выделения строк. Поддерживаются следующие режимы:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>SINGLE</code> - единичный выбор строки.</p> </li> 
                <li> <p><code>MULTI</code> - множественный выбор строк как в таблице.</p> </li> 
                <li> <p><code>MULTI_CHECK</code> - множественный выбор строк с использованием встроенной колонки с чекбоксами.</p> </li> 
                <li> <p><code>NONE</code> - выбор строк отключен.</p> 
                 <div id="gui_DataGrid_SelectionListener" class="paragraph"> 
                  <p>Выделение строк можно отслеживать с помощью слушателя <code>SelectionListener</code>.</p> 
                 </div> 
                 <div class="imageblock" style="text-align: center"> 
                  <div class="content"> 
                   <img src="assets/gui_dataGrid_3.png" alt="gui dataGrid 3"> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_sortable" class="ulist"> 
          <ul> 
           <li> <p><code>sortable</code> - разрешает или запрещает сортировку в <code>DataGrid</code>. По умолчанию имеет значение <code>true</code>. Если сортировка разрешена, то при нажатии на название колонки справа от названия появляется соответствующий значок. Сортировку некоторой отдельной колонки можно запретить с помощью атрибута <code>sortable</code> этой колонки.</p> 
            <div id="gui_DataGrid_SortListener" class="paragraph"> 
             <p>События сортировки <code>DataGrid</code> можно отслеживать с помощью слушателя <code>SortListener</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_textSelectionEnabled" class="ulist"> 
          <ul> 
           <li> <p><code>textSelectionEnabled</code> - разрешает или запрещает выделение текста в ячейках <code>DataGrid</code>. По умолчанию имеет значение <code>false</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p><strong>Методы интерфейса DataGrid:</strong></p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>getColumns()</code> - возвращет текущий набор колонок <code>DataGrid</code> в порядке их текущего отображения.</p> </li> 
           <li> <p><code>getSelected()</code>, <code>getSingleSelected()</code> - возвращают экземпляры сущностей, соответствующие выделенным в таблице строкам. Коллекцию можно получить вызовом метода <code>getSelected()</code>. Если ничего не выбрано, возвращается пустой набор. Если установлен <code>SelectionMode.SINGLE</code>, удобно пользоваться методом <code>getSingleSelected()</code>, возвращающим одну выбранную сущность или <code>null</code>, если ничего не выбрано.</p> </li> 
           <li> <p><code>getVisibleColumns()</code> - возвращет набор видимых колонок <code>DataGrid</code> в порядке их текущего отображения.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_scrollTo" class="ulist"> 
          <ul> 
           <li> <p><code>scrollTo()</code> - позволяет программно прокрутить <code>DataGrid</code> до нужной записи. Метод принимает экземпляр сущности, определяющий нужную строку в <code>DataGrid</code>. Перегруженный метод, помимо сущности, принимает <code>ScrollDestination</code>, имеющий следующие возможные значения:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>ANY</code> - прокрутить как можно меньше, чтобы показать нужную запись.</p> </li> 
                <li> <p><code>START</code> - прокрутить так, чтобы нужная запись оказалась в начале видимой области <code>DataGrid</code>.</p> </li> 
                <li> <p><code>MIDDLE</code> - прокрутить так, чтобы нужная запись оказалась в центре видимой области <code>DataGrid</code>.</p> </li> 
                <li> <p><code>END</code> - прокрутить так, чтобы нужная запись оказалась в конце видимой области <code>DataGrid</code>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
           <li> <p><code>scrollToStart()</code> and <code>scrollToEnd()</code> - позволяют прокрутить <code>DataGrid</code> в начало и конец соотвественно.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_setCellStyleProvider" class="ulist"> 
          <ul> 
           <li> <p><code>setCellStyleProvider()</code> - позволяет задать стиль отображения ячеек <code>DataGrid</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_setRowStyleProvider" class="ulist"> 
          <ul> 
           <li> <p><code>setRowStyleProvider()</code> - позволяет задать стиль отображения строк <code>DataGrid</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_setEnterPressAction" class="ulist"> 
          <ul> 
           <li> <p><code>setEnterPressAction()</code> - позволяет задать <a href="/manual.html#gui_Action">действие</a>, выполняемое при нажатии клавиши <strong>Enter</strong>. Если такое действие не задано, таблица пытается найти среди своих действий подходящее в следующем порядке:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p>действие, назначенное методом <code>setItemClickAction()</code>.</p> </li> 
                <li> <p>действие, назначенное на клавишу <strong>Enter</strong> посредством свойства <code>shortcut</code>.</p> </li> 
                <li> <p>действие с именем <code>edit</code>.</p> </li> 
                <li> <p>действие с именем <code>view</code>.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Если такое действие найдено и имеет свойство <code>enabled = true</code>, оно выполняется.</p> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_setItemClickAction" class="ulist"> 
          <ul> 
           <li> <p><code>setItemClickAction()</code> - позволяет задать <a href="/manual.html#gui_Action">действие</a>, выполняемое при двойном клике на строке таблицы. Если такое действие не задано, при двойном клике таблица пытается найти среди своих действий подходящее в следующем порядке:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p>действие, назначенное на клавишу <strong>Enter</strong> посредством свойства <code>shortcut</code>.</p> </li> 
                <li> <p>действие с именем <code>edit</code>.</p> </li> 
                <li> <p>действие с именем <code>view</code>.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Если такое действие найдено и имеет свойство <code>enabled = true</code>, оно выполняется.</p> 
              </div> 
              <div id="gui_DataGrid_ItemClickListener" class="paragraph"> 
               <p>События клика по элементу <code>DataGrid</code> можно отслеживать с помощью слушателя <code>ItemClickListener</code>.</p> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_sort" class="ulist"> 
          <ul> 
           <li> <p><code>sort()</code> - сортирует данные в переданной колонке в направлении, заданном одним из двух доступных значений перечисления <code>SortDirection</code>:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>ASCENDING</code> - сортировка по возрастанию (например, A-Z, 1..9).</p> </li> 
                <li> <p><code>DESCENDING</code> - сортировка по убыванию (например, Z-A, 9..1).</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_setCellDescriptionProvider" class="ulist"> 
          <ul> 
           <li> <p><code>setCellDescriptionProvider()</code> - принимает экземпляр <code>CellDescriptionProvider</code>, который будет использоваться для генерации всплывающих подсказок для отдельных ячеек DataGrid. Строка описания может содержать HTML-разметку.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">customersDataGrid.setRowDescriptionProvider(Instance::getInstanceName);</code></pre> 
               </div> 
              </div> 
              <div class="imageblock" style="text-align: center"> 
               <div class="content"> 
                <img src="assets/gui_dataGrid_10.png" alt="gui dataGrid 10"> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_setRowDescriptionProvider" class="ulist"> 
          <ul> 
           <li> <p><code>setRowDescriptionProvider()</code> - принимает экземпляр <code>RowDescriptionProvider</code>, который будет использоваться для генерации всплывающих подсказок для строк DataGrid. Если <code>CellDescriptionProvider</code> также установлен, подсказка, сгенерированная <code>RowDescriptionProvider</code>, будет использована только для тех ячеек, для которых не задана подсказка ячейки.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">customersDataGrid.setCellDescriptionProvider((entity,columnId)-&gt;{
    <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>.equals(columnId)||<span class="string"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>.equals(columnId)){
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }

    <span class="predefined-type">String</span> description=<span class="string"><span class="delimiter">"</span><span class="content">&lt;strong&gt;</span><span class="delimiter">"</span></span>+
            messages.getTools().getPropertyCaption(entity.getMetaClass(),columnId)+
            <span class="string"><span class="delimiter">"</span><span class="content">: &lt;/strong&gt;</span><span class="delimiter">"</span></span>;

    <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">grade</span><span class="delimiter">"</span></span>.equals(columnId)){
        description += messages.getMessage(entity.getGrade());
    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">active</span><span class="delimiter">"</span></span>.equals(columnId)){
        description += getMessage(entity.getActive() ? <span class="string"><span class="delimiter">"</span><span class="content">trueString</span><span class="delimiter">"</span></span>:<span class="string"><span class="delimiter">"</span><span class="content">falseString</span><span class="delimiter">"</span></span>);
    } <span class="keyword">else</span> {
        description += entity.getValue(columnId);
    }
        <span class="keyword">return</span> description;
});</code></pre> 
               </div> 
              </div> 
              <div class="imageblock" style="text-align: center"> 
               <div class="content"> 
                <img src="assets/gui_dataGrid_11.png" alt="gui dataGrid 11"> 
               </div> 
              </div> 
             </div> 
            </div> 
            <div id="gui_DataGrid_inline_editor" class="paragraph"> 
             <p><strong>Использование режима внутристрочного редактирования:</strong></p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>У компонента <code>DataGrid</code> есть API, позволяющий напрямую редактировать записи в ячейках. Во время редактирования ячейки будет отображён UI с кнопками для сохранения и отмены изменений.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Методы API встроенного редактора:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>getEditedItemId()</code> - возвращает <code>id</code> редактируемой записи.</p> </li> 
           <li> <p><code>isEditorActive()</code> - возвращает <code>true</code>, если в момент вызова редактируется какая-либо запись.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_editItem" class="ulist"> 
          <ul> 
           <li> <p><code>editItem()</code> - открывает интерфейс внутристрочного редактора для указанной записи. Пролистывает таблицу до нужной записи, если в момент вызова она не была видна на экране.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Вы также можете добавить к встроенному редактору или удалить слушатели, использовав следующие методы:</p> 
         </div> 
         <div id="gui_DataGrid_EditorOpenListener" class="ulist"> 
          <ul> 
           <li> <p><code>addEditorOpenListener()</code>, <code>removeEditorCloseListener()</code> - слушатель открытия встроенного редактора <code>DataGrid</code>.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Данный слушатель обрабатывает событие открытия встроенного редактора <code>DataGrid</code> по двойному щелчку и позволяет получить доступ к полям редактируемой строки. Это даёт возможность обновлять значения в отдельных полях в зависимости от изменения значений в других полях, не закрывая встроенный редактор.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Например:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">customersTable.addEditorOpenListener(event -&gt; {
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Field</span>&gt; fieldMap = event.getFields();
    <span class="predefined-type">Field</span> active = fieldMap.get(<span class="string"><span class="delimiter">"</span><span class="content">active</span><span class="delimiter">"</span></span>);
    <span class="predefined-type">Field</span> grade = fieldMap.get(<span class="string"><span class="delimiter">"</span><span class="content">grade</span><span class="delimiter">"</span></span>);

    ValueChangeListener listener = e -&gt;
            active.setValue(<span class="predefined-constant">true</span>);
    grade.addValueChangeListener(listener);
});</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_EditorCloseListener" class="ulist"> 
          <ul> 
           <li> <p><code>addEditorCloseListener()</code>, <code>removeEditorCloseListener()</code> - слушатель закрытия встроенного редактора <code>DataGrid</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_EditorPreCommitListener" class="ulist"> 
          <ul> 
           <li> <p><code>addEditorPreCommitListener()</code>, <code>removeEditorPreCommitListener()</code> - слушатель редактора <code>DataGrid</code>, срабатывающий в процессе коммита изменений.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_DataGrid_EditorPostCommitListener" class="ulist"> 
          <ul> 
           <li> <p><code>addEditorPostCommitListener()</code>, <code>removeEditorPostCommitListener()</code> - слушатель, срабатывающий на финальной стадии коммита изменений.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Коммит изменений сохраняет их в источнике данных. Логику сохранения изменений в базу данных необходимо задать отдельно.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Само поле редактирования также может быть изменено с помощью интерфейса <code>ColumnEditorFieldGenerator</code>. Используйте метод <code>setEditorFieldGenerator()</code> для определённой колонки таблицы, чтобы указать компонент для отображения в режиме редактирования этой колонки:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">ordersGrid.getColumnNN(<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span>).setEditorFieldGenerator((datasource, property) -&gt; {
    LookupField lookupField = componentsFactory.createComponent(LookupField.class);
    lookupField.setDatasource(datasource, property);
    lookupField.setOptionsList(<span class="predefined-type">Arrays</span>.asList(<span class="predefined-type">BigDecimal</span>.ZERO, <span class="predefined-type">BigDecimal</span>.ONE, <span class="predefined-type">BigDecimal</span>.TEN));

    <span class="keyword">return</span> lookupField;
});</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Результат:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_dataGrid_14.png" alt="gui dataGrid 14"> 
          </div> 
         </div> 
         <div id="gui_DataGrid_addGeneratedColumn" class="paragraph"> 
          <p><strong>Использование интерфейса ColumnGenerator:</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>DataGrd</code> имеет возможность добавлять генерируемые, или высчитываемые, колонки. Для этого существует два метода:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>addGeneratedColumn(String columnId, ColumnGenerator generator)</code></p> </li> 
           <li> <p><code>addGeneratedColumn(String columnId, ColumnGenerator generator, int index)</code></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p><code>ColumnGenerator</code> - это специальный интерфейс, который описывает генерируемую колонку:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>значение для каждой строки колонки,</p> </li> 
           <li> <p>тип значения - общий для всей колонки.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Например, для добавления генерируемой колонки, которая будет отображать логин пользователя в верхнем регистре, можно использовать следующий код:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params){
    DataGrid.Column column = usersGrid.addGeneratedColumn(<span class="string"><span class="delimiter">"</span><span class="content">loginUpperCase</span><span class="delimiter">"</span></span>,<span class="keyword">new</span> DataGrid.ColumnGenerator&lt;User, <span class="predefined-type">String</span>&gt;(){
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getValue(DataGrid.ColumnGeneratorEvent&lt;User&gt; event){
            <span class="keyword">return</span> event.getItem().getLogin().toUpperCase();
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">String</span>&gt; getType(){
            <span class="keyword">return</span> <span class="predefined-type">String</span>.class;
        }
    },<span class="integer">1</span>);
    column.setCaption(<span class="string"><span class="delimiter">"</span><span class="content">Login Upper Case</span><span class="delimiter">"</span></span>);
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Результат:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_dataGrid_7.png" alt="gui dataGrid 7"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p><code>ColumnGeneratorEvent</code>, который передается в <code>getValue</code>, хранит информацио о сущности, которая отображется в текущей строке <code>DataGrid</code>, и <code>propertyId</code> колонки.</p> 
         </div> 
         <div class="paragraph"> 
          <p>По умолчанию, генерируемая колонка добавляется в конец таблицы. Управлять расположением генерируемых колонок можно либо вставляя колонку по индексу, либо предварительно добавив колонку в XML с <code>id</code>, который потом передавать в метод <code>addGeneratedColumn</code>.</p> 
         </div> 
         <div id="gui_DataGrid_setRenderer" class="paragraph"> 
          <p><strong>Использование рендереров:</strong></p> 
         </div> 
         <div id="gui_DataGrid_createRenderer" class="paragraph"> 
          <p>Отображение данных в колонках может быть изменено с помощью рендереров. Предположим, что нам необходимо показывать изображение в строке. Тогда текстовое значение пути до изображения можно отобразить в виде изображения с помощью <code>ImageRenderer</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params){
    DataGrid.Column avatar = usersGrid.addGeneratedColumn(<span class="string"><span class="delimiter">"</span><span class="content">userAvatar</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> DataGrid.ColumnGenerator&lt;User, <span class="predefined-type">String</span>&gt;() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getValue(DataGrid.ColumnGeneratorEvent&lt;User&gt; event) {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">icons/user.png</span><span class="delimiter">"</span></span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">String</span>&gt; getType() {
            <span class="keyword">return</span> <span class="predefined-type">String</span>.class;
        }
    }, <span class="integer">0</span>);
    avatar.setCaption(<span class="string"><span class="delimiter">"</span><span class="content">Avatar</span><span class="delimiter">"</span></span>);
    avatar.setRenderer(usersGrid.createRenderer(DataGrid.ImageRenderer.class));
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Результат:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_dataGrid_8.png" alt="gui dataGrid 8"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Интерфейс <code>WebComponentRenderer</code> позволяет настроить отображение веб-компонентов различных типов в ячейках <code>DataGrid</code>. Интерфейс реализован только для блока <strong>Web Module</strong>. Ниже приведён пример создания колонки для отображения компонента <code>LookupField</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.global.Configuration</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.core.global.GlobalConfig</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.AbstractWindow</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.Component</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.DataGrid</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.LookupField</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.xml.layout.ComponentsFactory</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.security.entity.User</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.web.gui.components.renderers.WebComponentRenderer</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">java.util.Locale</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="keyword">import</span> <span class="include">java.util.TreeMap</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Users</span> <span class="directive">extends</span> AbstractWindow {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> ComponentsFactory componentsFactory;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> <span class="predefined-type">Configuration</span> configuration;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> DataGrid&lt;User&gt; usersGrid;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {

        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Locale</span>&gt; locales = configuration.getConfig(GlobalConfig.class).getAvailableLocales();
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; options = <span class="keyword">new</span> <span class="predefined-type">TreeMap</span>&lt;&gt;();
        <span class="keyword">for</span> (<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Locale</span>&gt; entry : locales.entrySet()) {
            options.put(entry.getKey(), messages.getTools().localeToString(entry.getValue()));
        }

        DataGrid.Column column = usersGrid.addGeneratedColumn(<span class="string"><span class="delimiter">"</span><span class="content">language</span><span class="delimiter">"</span></span>,
                <span class="keyword">new</span> DataGrid.ColumnGenerator&lt;User, <span class="predefined-type">Component</span>&gt;() {
                    <span class="annotation">@Override</span>
                    <span class="directive">public</span> <span class="predefined-type">Component</span> getValue(DataGrid.ColumnGeneratorEvent&lt;User&gt; event) {
                        LookupField component = componentsFactory.createComponent(LookupField.class);
                        component.setOptionsMap(options);
                        component.setWidth(<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>);

                        User user = event.getItem();
                        component.setValue(user.getLanguage());

                        component.addValueChangeListener(e -&gt; user.setLanguage((<span class="predefined-type">String</span>) e.getValue()));

                        <span class="keyword">return</span> component;
                    }

                    <span class="annotation">@Override</span>
                    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">Component</span>&gt; getType() {
                        <span class="keyword">return</span> <span class="predefined-type">Component</span>.class;
                    }
                });

        column.setRenderer(<span class="keyword">new</span> WebComponentRenderer());
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Результат:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_dataGrid_13.png" alt="gui dataGrid 13"> 
          </div> 
         </div> 
         <div id="gui_DataGrid_setConverter" class="paragraph"> 
          <p>Когда тип поля не совпадает с типом данных, принимаемых рендерером, удобно пользоваться конвертерами, которые обеспечивают конвертацию между типами данных модели и представления. К примеру, чтобы отобразить булево значение в виде пиктограммы, можно использовать <code>HtmlRenderer</code>, который умеет отображать HTML-разметку, и конвертер, который будет превращать булево значение в подходящую разметку для отображения иконок.</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params){
    DataGrid.Column hasEmail = usersGrid.addGeneratedColumn(<span class="string"><span class="delimiter">"</span><span class="content">hasEmail</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> DataGrid.ColumnGenerator&lt;User, <span class="predefined-type">Boolean</span>&gt;() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Boolean</span> getValue(DataGrid.ColumnGeneratorEvent&lt;User&gt; event) {
            <span class="keyword">return</span> StringUtils.isNotEmpty(event.getItem().getEmail());
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">Boolean</span>&gt; getType() {
            <span class="keyword">return</span> <span class="predefined-type">Boolean</span>.class;
        }
    });
    hasEmail.setCaption(<span class="string"><span class="delimiter">"</span><span class="content">Has Email</span><span class="delimiter">"</span></span>);
    hasEmail.setRenderer(usersGrid.createRenderer(DataGrid.HtmlRenderer.class));
    hasEmail.setConverter(<span class="keyword">new</span> DataGrid.Converter&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Boolean</span>&gt;() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Boolean</span> convertToModel(<span class="predefined-type">String</span> value, <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Boolean</span>&gt; targetType, <span class="predefined-type">Locale</span> locale) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> convertToPresentation(<span class="predefined-type">Boolean</span> value, <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">String</span>&gt; targetType, <span class="predefined-type">Locale</span> locale) {
            <span class="keyword">return</span> BooleanUtils.isTrue(value)
                    ? FontAwesome.CHECK_SQUARE_O.getHtml()
                    : FontAwesome.SQUARE_O.getHtml();
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">Boolean</span>&gt; getModelType() {
            <span class="keyword">return</span> <span class="predefined-type">Boolean</span>.class;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">String</span>&gt; getPresentationType() {
            <span class="keyword">return</span> <span class="predefined-type">String</span>.class;
        }
    });
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Результат:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_dataGrid_9.png" alt="gui dataGrid 9"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Создавать рендереры можно двумя способами:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>через метод-фабрику интерфейса <code>DataGrid</code>, передавая в него интерфейс рендерера, для которого нужно создать имплементацию. Подходит для <strong>GUI</strong> и <strong>Web</strong> модулей.</p> </li> 
           <li> <p>непосредственно создавая имплементацию рендерера для соответствующего модуля:</p> 
            <div class="paragraph"> 
             <p><code>dataGrid.createRenderer(DataGrid.ImageRenderer.class) → new WebImageRenderer()</code></p> 
            </div> 
            <div class="paragraph"> 
             <p>На данный момент этот способ реализован только для модуля <strong>Web</strong>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Список рендереров, реализованных в платформе:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>TextRenderer</code> - рендерер для отображения простого текста.</p> </li> 
           <li> <p><code>HtmlRenderer</code> - рендерер для отображения HTML-разметки.</p> </li> 
           <li> <p><code>ProgressBarRenderer</code> - рендерер, который отображает <code>double</code>-значения от 0 до 1 в виде компонента <code>ProgressBar</code>.</p> </li> 
           <li> <p><code>DateRenderer</code> - рендерер для отображения дат в заданном формате.</p> </li> 
           <li> <p><code>NumberRenderer</code> - рендерер для отображения чисел в заданном формате.</p> </li> 
           <li> <p><code>ButtonRenderer</code> - рендерер, который использует строковое значение в качестве заголовка кнопки.</p> </li> 
           <li> <p><code>ImageRenderer</code> - рендерер, который использует строковое значение в качестве пути до изображения.</p> </li> 
           <li> <p><code>CheckBoxRenderer</code> - рендерер, который отображает булево значение в виде иконок чек-бокса.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p><strong>Header и Footer:</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p>Интерфейсы <code>HeaderRow</code> и <code>FooterRow</code> предназначены для отображения ячеек заголовков и строк с итогами таблицы соответственно. Эти ячейки могут быть объединёнными для нескольких колонок.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Для создания и настройки заголовков и итогов используются следующие методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>appendHeaderRow()</code>, <code>appendFooterRow()</code> - добавляет новую строку внизу секции заголовков/итогов.</p> </li> 
           <li> <p><code>prependHeaderRow()</code>, <code>prependFooterRow()</code> - добавляет новую строку наверху секции заголовков/итогов.</p> </li> 
           <li> <p><code>addHeaderRowAt()</code>, <code>addFooterRowAt()</code> - вставляет новую строку на заданную позицию в секции. Текущая строка на этой позиции, а также все следующие ниже, сдвигаются вниз с увеличением их индекса на 1.</p> </li> 
           <li> <p><code>removeHeaderRow()</code>, <code>removeFooterRow()</code> - удаляет указанную строку в секции.</p> </li> 
           <li> <p><code>getHeaderRowCount()</code>, <code>getFooterRowCount()</code> - возвращает количество строк в секции.</p> </li> 
           <li> <p><code>setDefaultHeaderRow()</code> - устанавливает заголовок таблицы по умолчанию. Интерфейс стандартного заголовка по умолчанию включает в себя элементы для сортировки колонок таблицы.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Интерфейсы <code>HeaderCell</code> и <code>FooterCell</code> позволяют управлять статическими ячейками:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setStyleName()</code> - устанавливает пользовательский стиль для данной ячейки.</p> </li> 
           <li> <p><code>getCellType()</code> - возвращает тип содержимого данной ячейки. Перечисление <code>DataGridStaticCellType</code> содержит 3 стандартных типа статических ячеек:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>TEXT</code></p> </li> 
                <li> <p><code>HTML</code></p> </li> 
                <li> <p><code>COMPONENT</code></p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
           <li> <p><code>getComponent()</code>, <code>getHtml()</code>, <code>getText()</code> - возвращает содержимое данной ячейки в зависимости от её типа.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Ниже приведён пример таблицы <code>DataGrid</code> с заголовком, содержащим объединённые ячейки, и строкой итогов, в которой отображаются вычисляемые значения:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dataGrid</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">dataGrid</span><span class="delimiter">"</span></span>
          <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">countryGrowthDs</span><span class="delimiter">"</span></span>
          <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;columns&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">country</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">year2014</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">year2015</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/columns&gt;</span>
<span class="tag">&lt;/dataGrid&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DataGridHeaderFooterFrame</span> <span class="directive">extends</span> AbstractFrame {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> DataGrid&lt;CountryGrowth&gt; dataGrid;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> CollectionDatasource&lt;CountryGrowth, <span class="predefined-type">UUID</span>&gt; countryGrowthDs;
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> UserSessionSource userSessionSource;

    <span class="directive">private</span> <span class="predefined-type">DecimalFormat</span> percentFormat;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        countryGrowthDs.refresh();

        initPercentFormat();
        initHeader();
        initFooter();
        initRenderers();
    }

    <span class="directive">private</span> <span class="predefined-type">DecimalFormat</span> initPercentFormat() {
        percentFormat = (<span class="predefined-type">DecimalFormat</span>) <span class="predefined-type">NumberFormat</span>.getPercentInstance(userSessionSource.getLocale());
        percentFormat.setMultiplier(<span class="integer">1</span>);
        percentFormat.setMaximumFractionDigits(<span class="integer">2</span>);
        <span class="keyword">return</span> percentFormat;
    }

    <span class="directive">private</span> <span class="type">void</span> initRenderers() {
        dataGrid.getColumnNN(<span class="string"><span class="delimiter">"</span><span class="content">year2014</span><span class="delimiter">"</span></span>).setRenderer(<span class="keyword">new</span> WebNumberRenderer(percentFormat));
        dataGrid.getColumnNN(<span class="string"><span class="delimiter">"</span><span class="content">year2015</span><span class="delimiter">"</span></span>).setRenderer(<span class="keyword">new</span> WebNumberRenderer(percentFormat));
    }

    <span class="directive">private</span> <span class="type">void</span> initHeader() {
        HeaderRow headerRow = dataGrid.prependHeaderRow();
        HeaderCell headerCell = headerRow.join(<span class="string"><span class="delimiter">"</span><span class="content">year2014</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">year2015</span><span class="delimiter">"</span></span>);
        headerCell.setText(<span class="string"><span class="delimiter">"</span><span class="content">GDP growth</span><span class="delimiter">"</span></span>);
        headerCell.setStyleName(<span class="string"><span class="delimiter">"</span><span class="content">center-bold</span><span class="delimiter">"</span></span>);
    }

    <span class="directive">private</span> <span class="type">void</span> initFooter() {
        FooterRow footerRow = dataGrid.appendFooterRow();
        footerRow.getCell(<span class="string"><span class="delimiter">"</span><span class="content">country</span><span class="delimiter">"</span></span>).setHtml(<span class="string"><span class="delimiter">"</span><span class="content">&lt;strong&gt;</span><span class="delimiter">"</span></span> + getMessage(<span class="string"><span class="delimiter">"</span><span class="content">average</span><span class="delimiter">"</span></span>) + <span class="string"><span class="delimiter">"</span><span class="content">&lt;/strong&gt;</span><span class="delimiter">"</span></span>);
        footerRow.getCell(<span class="string"><span class="delimiter">"</span><span class="content">year2014</span><span class="delimiter">"</span></span>).setText(percentFormat.format(getAverage(<span class="string"><span class="delimiter">"</span><span class="content">year2014</span><span class="delimiter">"</span></span>)));
        footerRow.getCell(<span class="string"><span class="delimiter">"</span><span class="content">year2015</span><span class="delimiter">"</span></span>).setText(percentFormat.format(getAverage(<span class="string"><span class="delimiter">"</span><span class="content">year2015</span><span class="delimiter">"</span></span>)));
    }

    <span class="directive">private</span> <span class="type">double</span> getAverage(<span class="predefined-type">String</span> propertyId) {
        <span class="type">double</span> average = <span class="float">0.0</span>;
        <span class="predefined-type">Collection</span>&lt;CountryGrowth&gt; items = countryGrowthDs.getItems();
        <span class="keyword">for</span> (CountryGrowth countryGrowth : items) {
            <span class="predefined-type">Double</span> value = countryGrowth.getValue(propertyId);
            average += value != <span class="predefined-constant">null</span> ? value : <span class="float">0.0</span>;
        }
        <span class="keyword">return</span> average / items.size();
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_dataGrid_12.png" alt="gui dataGrid 12"> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты dataGrid
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_colspan">colspan</a> - <a href="/manual.html#gui_DataGrid_columnResizeMode">columnResizeMode</a> - <a href="/manual.html#gui_DataGrid_columnsCollapsingAllowed">columnsCollapsingAllowed</a> - <a href="/manual.html#gui_DataGrid_contextMenuEnabled">contextMenuEnabled</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_DataGrid_editorBuffered">editorBuffered</a> - <a href="/manual.html#gui_DataGrid_editorCancelCaption">editorCancelCaption</a> - <a href="/manual.html#gui_DataGrid_editorEnabled">editorEnabled</a> - <a href="/manual.html#gui_DataGrid_editorSaveCaption">editorSaveCaption</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_DataGrid_frozenColumnCount">frozenColumnCount</a> - <a href="/manual.html#gui_DataGrid_headerVisible">headerVisible</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_DataGrid_reorderingAllowed">reorderingAllowed</a> - <a href="/manual.html#gui_attr_responsive">responsive</a> - <a href="/manual.html#gui_attr_rowspan">rowspan</a> - <a href="/manual.html#gui_DataGrid_selectionMode">selectionMode</a> - <a href="/manual.html#gui_attr_settingsEnabled">settingsEnabled</a> - <a href="/manual.html#gui_DataGrid_sortable">sortable</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_DataGrid_textSelectionEnabled">textSelectionEnabled</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы dataGrid
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_DataGrid_actions">actions</a> - <a href="/manual.html#gui_DataGrid_buttonsPanel">buttonsPanel</a> - <a href="/manual.html#gui_DataGrid_columns">columns</a> - <a href="/manual.html#gui_DataGrid_rowsCount">rowsCount</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты column
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_DataGrid_collapsed">collapsed</a> - <a href="/manual.html#gui_DataGrid_collapsible">collapsible</a> - <a href="/manual.html#gui_DataGrid_collapsingToggleCaption">collapsingToggleCaption</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_DataGrid_expandRatio">expandRatio</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_DataGrid_maximumWidth">maximumWidth</a> - <a href="/manual.html#gui_DataGrid_minimumWidth">minimumWidth</a> - <a href="/manual.html#gui_DataGrid_property">property</a> - <a href="/manual.html#gui_DataGrid_resizable">resizable</a> - <a href="/manual.html#gui_DataGrid_sortable">sortable</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы column
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_formatter">formatter</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_DataGrid_addGeneratedColumn">addGeneratedColumn</a> - <a href="/manual.html#gui_api_settings">applySettings</a> - <a href="/manual.html#gui_DataGrid_createRenderer">createRenderer</a> - <a href="/manual.html#gui_DataGrid_editItem">editItem</a> - <a href="/manual.html#gui_api_settings">saveSettings</a> - <a href="/manual.html#gui_DataGrid_scrollTo">getColumns</a> - <a href="/manual.html#gui_DataGrid_setCellDescriptionProvider">setCellDescriptionProvider</a> - <a href="/manual.html#gui_DataGrid_setCellStyleProvider">setCellStyleProvider</a> - <a href="/manual.html#gui_DataGrid_setConverter">setConverter</a> - <a href="/manual.html#gui_DataGrid_setEnterPressAction">setEnterPressAction</a> - <a href="/manual.html#gui_DataGrid_setItemClickAction">setItemClickAction</a> - <a href="/manual.html#gui_DataGrid_setRenderer">setRenderer</a> - <a href="/manual.html#gui_DataGrid_setRowDescriptionProvider">setRowDescriptionProvider</a> - <a href="/manual.html#gui_DataGrid_setRowStyleProvider">setRowStyleProvider</a> - <a href="/manual.html#gui_DataGrid_sort">sort</a></p> 
           </dd> 
           <dt class="hdlist1">
            Слушатели dataGrid
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_DataGrid_ColumnCollapsingChangeListener">ColumnCollapsingChangeListener</a> - <a href="/manual.html#gui_DataGrid_ColumnReorderListener">ColumnReorderListener</a> - <a href="/manual.html#gui_DataGrid_ColumnResizeListener">ColumnResizeListener</a> - <a href="/manual.html#gui_DataGrid_ContextClickListener">ContextClickListener</a> - <a href="/manual.html#gui_DataGrid_EditorCloseListener">EditorCloseListener</a> - <a href="/manual.html#gui_DataGrid_EditorOpenListener">EditorOpenListener</a> - <a href="/manual.html#gui_DataGrid_EditorPostCommitListener">EditorPostCommitListener</a> - <a href="/manual.html#gui_DataGrid_EditorPreCommitListener">EditorPreCommitListener</a> - <a href="/manual.html#gui_DataGrid_ItemClickListener">ItemClickListener</a> - <a href="/manual.html#gui_DataGrid_SelectionListener">SelectionListener</a> - <a href="/manual.html#gui_DataGrid_SortListener">SortListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_DateField"><a class="anchor" href="/manual.html#gui_DateField"></a>5.5.2.1.10. DateField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-datefield" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Поле для отображения и ввода даты и времени. Представляет собой поле даты, внутри которого имеется кнопка с выпадающим календарем, а правее находится поле для ввода времени.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_dateFieldSimple.png" alt="gui dateFieldSimple"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>dateField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>DateField</code> реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Для создания поля даты, связанного с данными, необходимо использовать атрибуты <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Как видно из примера, в экране описывается источник данных <code>orderDs</code> для некоторой сущности Заказ (<code>Order</code>), имеющей атрибут <code>date</code>. В компоненте ввода даты в атрибуте <a href="/manual.html#gui_attr_datasource">datasource</a> указывается ссылка на источник данных, а в атрибуте <a href="/manual.html#gui_attr_property">property</a> − название атрибута сущности, значение которого должно быть отображено в поле.</p> 
            </div> </li> 
           <li> <p>Если поле связано с атрибутом сущности, то оно автоматически принимает соответствующий вид:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p>Если атрибут типа <code>java.sql.Date</code> или указана аннотация <code>@Temporal(TemporalType.DATE)</code>, то поле времени не отображается. Формат даты определяется <a href="/manual.html#datatype">типом данных</a> <code>date</code> и задается в <a href="/manual.html#main_message_pack">главном пакете локализованных сообщений</a> в ключе <code>dateFormat</code>.</p> </li> 
              <li> <p>В противном случае отображается также поле времени с часами и минутами. Формат времени определяется <a href="/manual.html#datatype">типом данных</a> <code>time</code> и задается в <a href="/manual.html#main_message_pack">главном пакете локализованных сообщений</a> в ключе <code>timeFormat</code>.</p> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DateField_dateFormat" class="ulist"> 
          <ul> 
           <li> <p>Изменить формат представления даты и времени можно с помощью атрибута <code>dateFormat</code>. Значением атрибута может быть либо сама строка формата, либо ключ в пакете сообщений (если значение начинается с <code>msg://</code>).</p> 
            <div class="paragraph"> 
             <p>Формат задается по правилам класса <code>SimpleDateFormat</code> (<a href="http://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html" class="bare" target="_blank">http://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html</a>). Если в формате отсутствуют символы <code>H</code> или <code>h</code>, то поле времени не выводится.</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dateField</span> <span class="attribute-name">dateFormat</span>=<span class="string"><span class="delimiter">"</span><span class="content">MM/yy</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://monthOnlyDateField</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_dateField_format.png" alt="gui dateField format"> 
             </div> 
            </div> 
            <div class="admonitionblock warning"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Warning
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p><code>DateField</code> в основном предназначен для быстрого ввода с клавиатуры путем заполнения маски. Поэтому компонент поддерживает только форматы с цифрами и разделителями. Сложные форматы с текстовым представлением дня недели или месяца не будут работать.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DateField_range" class="ulist"> 
          <ul> 
           <li> <p>Диапазон доступных дат можно указать с помощью атрибутов <code>rangeStart</code> и <code>rangeEnd</code>. Если данные атрибуты установлены, все даты, выходящие за пределы диапазона, будут отключены. Значения доступных даты можно установить в XML в формате "yyyy-MM-dd", или программно с помощью соответствующих сеттеров.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dateField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">dateField</span><span class="delimiter">"</span></span> <span class="attribute-name">rangeStart</span>=<span class="string"><span class="delimiter">"</span><span class="content">2016-08-15</span><span class="delimiter">"</span></span> <span class="attribute-name">rangeEnd</span>=<span class="string"><span class="delimiter">"</span><span class="content">2016-08-19</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_datefield_month_range.png" alt="gui datefield month range"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DateField_resolution" class="ulist"> 
          <ul> 
           <li> <p>Точность представления даты и времени можно определить с помощью атрибута <code>resolution</code>. Значение атрибута должно соответствовать перечислению <code>DateField.Resolution</code> − <code>SEC</code>, <code>MIN</code>, <code>HOUR</code>, <code>DAY</code>, <code>MONTH</code>, <code>YEAR</code>. По умолчанию - <code>MIN</code>, то есть до минут.</p> 
            <div class="paragraph"> 
             <p>Если <code>resolution="DAY"</code> и не указан атрибут <code>dateFormat</code>, то в качестве формата будет взят формат, указанный в <a href="/manual.html#main_message_pack">главном пакете сообщений</a> с ключом <code>dateFormat</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если <code>resolution="MIN"</code> и не указан атрибут <code>dateFormat</code>, то в качестве формата будет взят формат, указанный в <a href="/manual.html#main_message_pack">главном пакете сообщений</a> с ключом <code>dateTimeFormat</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Ниже показано определения поля для ввода даты с точностью до месяца.</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dateField</span> <span class="attribute-name">resolution</span>=<span class="string"><span class="delimiter">"</span><span class="content">MONTH</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://monthOnlyDateField</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_dateField_resolution.png" alt="gui dateField resolution"> 
             </div> 
            </div> </li> 
           <li> <p>Изменение значения поля <code>DateField</code>, так же, как и любого другого компонента, реализующего интерфейс <code>Field</code>, можно отслеживать с помощью слушателя <code>ValueChangeListener</code>.</p> </li> 
           <li> <p>Если для пользователя методом <code>setTimeZone()</code> задан <a href="/manual.html#timeZone">часовой пояс</a>, то <code>DateField</code> может преобразовывать значения типа timestamp между часовыми поясами сервера и пользователя. Если компонент привязан к атрибуту типа timestamp, часовой пояс автоматически берется из текущей <a href="/manual.html#userSession">пользовательской сессии</a>. Если нет, то можно вызвать метод <code>setTimeZone()</code> в контроллере экрана, чтобы <code>DateField</code> выполнил необходимые преобразования.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_datefield_borderless" class="ulist"> 
          <ul> 
           <li> <p>В веб-клиенте с темой, основанной на Halo, к компоненту <code>DateField</code> можно применить заданный стиль <code>borderless</code>, чтобы удалить рамку и фон поля. Стили задаются в XML-дексрипторе или контроллере экрана с помощью атрибута <code>stylename</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dateField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">dateField</span><span class="delimiter">"</span></span>
           <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">borderless</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Чтобы применить стиль программно, выберите константу класса <code>HaloTheme</code> с префиксом компонента <code>DATEFIELD_</code>:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">dateField.setStyleName(HaloTheme.DATEFIELD_BORDERLESS);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты dateField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_DateField_dateFormat">dateFormat</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_DateField_range">rangeEnd</a> - <a href="/manual.html#gui_DateField_range">rangeStart</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_DateField_resolution">resolution</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы dateField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили dateField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_datefield_borderless">borderless</a> - <a href="/manual.html#gui_attr_stylename_small">small</a> - <a href="/manual.html#gui_attr_stylename_tiny">tiny</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_DatePicker"><a class="anchor" href="/manual.html#gui_DatePicker"></a>5.5.2.1.11. DatePicker</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-datepicker" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>DatePicker</code> это компонент для выбора даты. Он выглядит так же, как выпадающий календарь в <a href="/manual.html#gui_DateField">DateField</a>.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_datepicker_mini.png" alt="gui datepicker mini"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>datePicker</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>DatePicker</code> реализован для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Для создания <code>DatePicker</code>, связанного с данными, необходимо использовать атрибуты <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;datePicker</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">datePicker</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Как видно из примера, в экране описывается источник данных <code>orderDs</code> для некоторой сущности Заказ (<code>Order</code>), имеющей атрибут <code>date</code>. В компоненте ввода даты в атрибуте <a href="/manual.html#gui_attr_datasource">datasource</a> указывается ссылка на источник данных, а в атрибуте <a href="/manual.html#gui_attr_property">property</a> − название атрибута сущности, значение которого должно быть отображено в компоненте.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DatePicker_range" class="ulist"> 
          <ul> 
           <li> <p>Вы можете указать доступные для выбора даты с помощью атрибутов <code>rangeStart</code> и <code>rangeEnd</code>. Если вы их установите, даты, выходящие за пределы указанного промежутка, будут недоступны.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;datePicker</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">datePicker</span><span class="delimiter">"</span></span> <span class="attribute-name">rangeStart</span>=<span class="string"><span class="delimiter">"</span><span class="content">2016-08-15</span><span class="delimiter">"</span></span> <span class="attribute-name">rangeEnd</span>=<span class="string"><span class="delimiter">"</span><span class="content">2016-08-19</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_datepicker_month_range.png" alt="gui datepicker month range"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_DatePicker_resolution" class="ulist"> 
          <ul> 
           <li> <p>Точность выбора даты определяется атрибутом <code>resolution</code>. Значение атрибута должно соответстовать перечислению <code>DatePicker.Resolution</code> − <code>DAY</code>, <code>MONTH</code>, <code>YEAR</code>. Значение по-умолчанию: <code>DAY</code>.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;datePicker</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">datePicker</span><span class="delimiter">"</span></span> <span class="attribute-name">resolution</span>=<span class="string"><span class="delimiter">"</span><span class="content">MONTH</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_datepicker_month_resolution.png" alt="gui datepicker month resolution"> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;datePicker</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">datePicker</span><span class="delimiter">"</span></span> <span class="attribute-name">resolution</span>=<span class="string"><span class="delimiter">"</span><span class="content">YEAR</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_datepicker_year_resolution.png" alt="gui datepicker year resolution"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты datePicker
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_DatePicker_range">rangeEnd</a> - <a href="/manual.html#gui_DatePicker_range">rangeStart</a> - <a href="/manual.html#gui_DatePicker_resolution">resolution</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Embedded"><a class="anchor" href="/manual.html#gui_Embedded"></a>5.5.2.1.12. Embedded (Deprecated)</h6> 
         <div class="admonitionblock warning"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Warning
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Начиная с версии 6.7 платформы, компонент <code>Embedded</code> объявлен устаревшим (Deprecated). Используйте компонент <a href="/manual.html#gui_Image">Image</a> для отображения графического содержимого и компонент <a href="/manual.html#gui_BrowserFrame">BrowserFrame</a> для встраивания веб-страниц.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=image-embedded" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>Embedded</code> предназначен для вывода изображений и встраивания в экран произвольных веб-страниц.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>embedded</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>. В десктоп-клиенте поддерживается только вывод изображений.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Рассмотрим пример использования компонента для вывода изображения из файла, сохраненного в <a href="/manual.html#file_storage">FileStorage</a>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Объявляем компонент в XML-дескрипторе экрана:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groupBox</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Embedded</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span> <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">embedded</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;embedded</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">embedded</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
              <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/groupBox&gt;</span></code></pre> 
             </div> 
            </div> </li> 
           <li> <p>В контроллере экрана инжектируем компонент и интерфейс <code>FileStorageService</code>. Затем в методе <code>init()</code> получаем из параметров экрана переданный из вызывающего кода <code>FileDescriptor</code>, загружаем соответствующий файл в байтовый массив, создаем для него <code>ByteArrayInputStream</code> и передаем в метод <code>setSource()</code> компонента:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Embedded embedded;
<span class="annotation">@Inject</span>
<span class="directive">private</span> FileStorageService fileStorageService;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="predefined-type">FileDescriptor</span> imageFile = (<span class="predefined-type">FileDescriptor</span>) params.get(<span class="string"><span class="delimiter">"</span><span class="content">imageFile</span><span class="delimiter">"</span></span>);
    <span class="type">byte</span><span class="type">[]</span> bytes = <span class="predefined-constant">null</span>;
    <span class="keyword">if</span> (imageFile != <span class="predefined-constant">null</span>) {
        <span class="keyword">try</span> {
            bytes = fileStorageService.loadFile(imageFile);
        } <span class="keyword">catch</span> (FileStorageException e) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Unable to load image file</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
        }
    }
    <span class="keyword">if</span> (bytes != <span class="predefined-constant">null</span>) {
        embedded.setSource(imageFile.getName(), <span class="keyword">new</span> <span class="predefined-type">ByteArrayInputStream</span>(bytes));
        embedded.setType(Embedded.Type.IMAGE);
    } <span class="keyword">else</span> {
        embedded.setVisible(<span class="predefined-constant">false</span>);
    }
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Embedded_type" class="paragraph"> 
          <p>Компонент <code>Embedded</code> может отображать содержимое различных типов, которые по-разному отрисовываются в HTML. Тип содержимого можно задать методом <code>setType()</code>. Поддерживаются следующие типы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>OBJECT</code> - позволяет встраивать файлы некоторых типов в элементы HTML &lt;object&gt; и &lt;embed&gt;.</p> </li> 
           <li> <p><code>IMAGE</code> - встраивает изображения в HTML-элемент &lt;img&gt;.</p> </li> 
           <li> <p><code>BROWSER</code> - встраивает контейнер для отображения других независимых документов внутри элемента HTML &lt;iframe&gt;.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В веб-клиенте компонент позволяет отображать файлы, находящиеся внутри каталога <code>VAADIN</code>. Например:</p> 
         </div> 
         <div id="gui_Embedded_relativeSrc" class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;embedded</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">embedded</span><span class="delimiter">"</span></span>
          <span class="attribute-name">relativeSrc</span>=<span class="string"><span class="delimiter">"</span><span class="content">VAADIN/themes/halo/my-logo.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>или</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">embedded.setRelativeSource(<span class="string"><span class="delimiter">"</span><span class="content">VAADIN/themes/halo/my-logo.png</span><span class="delimiter">"</span></span>)</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Кроме того, можно определить каталог ресурсных файлов в свойстве приложения <a href="/manual.html#cuba.web.resourcesRoot">cuba.web.resourcesRoot</a>, и указать для компонента <code>Embedded</code> имя файла внутри этого каталога с префиксом значения атрибута: <code>file://</code> , <code>url://</code> или <code>theme://</code>:</p> 
         </div> 
         <div id="gui_Embedded_src" class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;embedded</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">embedded</span><span class="delimiter">"</span></span>
          <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">"</span><span class="content">file://my-logo.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>или</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">embedded.setSource(<span class="string"><span class="delimiter">"</span><span class="content">theme://branding/app-icon-menu.png</span><span class="delimiter">"</span></span>);</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Для встраивания в экран веб-клиента внешней веб-страницы необходимо передать компоненту URL:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> {
    embedded.setSource(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://www.cuba-platform.com</span><span class="delimiter">"</span></span>));
} <span class="keyword">catch</span> (<span class="exception">MalformedURLException</span> e) {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(e);
}</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты embedded
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Embedded_relativeSrc">relativeSrc</a> - <a href="/manual.html#gui_Embedded_src">src</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_FieldGroup"><a class="anchor" href="/manual.html#gui_FieldGroup"></a>5.5.2.1.13. FieldGroup</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-fieldgroup" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>FieldGroup</code> предназначен для совместного отображения и редактирования нескольких атрибутов сущностей.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_fieldGroup.png" alt="gui fieldGroup"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>fieldGroup</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания группы полей в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span>
                <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span>
                <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">order-with-customer</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/datasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderFieldGroup</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/fieldGroup&gt;</span>
<span class="tag">&lt;/layout&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Здесь в элементе <code>dsContext</code> определен <a href="/manual.html#datasources">источник данных</a> <code>datasource</code>, который содержит один экземпляр сущности <code>Order</code>. Для компонента <code>fieldGroup</code> в атрибуте <code>datasource</code> указывается используемый источник данных, а в элементах <code>field</code> - какие атрибуты сущности, содержащейся в источнике данных, необходимо отобразить.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Элементы <code>fieldGroup</code>:</p> 
         </div> 
         <div id="gui_FieldGroup_column" class="ulist"> 
          <ul> 
           <li> <p><code>column</code> - необязательный элемент, позволяющий располагать поля в несколько колонок. Для этого элементы <code>field</code> должны находиться не непосредственно внутри <code>fieldGroup</code>, а внутри своего <code>column</code>. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderFieldGroup</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">num</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/column&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">400px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">info</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/column&gt;</span>
<span class="tag">&lt;/fieldGroup&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В данном случае поля будут расположены в две колонки, причем в первой колонке все поля будут шириной <code>250px</code>, а во второй - <code>400px</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Атрибуты <code>column</code>:</p> 
            </div> 
            <div class="openblock"> 
             <div class="content"> 
              <div id="gui_FieldGroup_column_width" class="ulist"> 
               <ul> 
                <li> <p><code>width</code> - задает ширину полей данной колонки. По умолчанию ширина полей - <code>200px</code>. В данном атрибуте ширина может быть задана как в пикселах, так и в процентах от общего размера колонки по горизонтали.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_column_flex" class="ulist"> 
               <ul> 
                <li> <p><code>flex</code> - число, задающее степень изменения общего размера данной колонки по горизонтали относительно других колонок при изменении ширины всего компонента <code>fieldGroup</code>. Например, можно задать одной колонке <code>flex=1</code> а другой <code>flex=3</code>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_column_id" class="ulist"> 
               <ul> 
                <li> <p><code>id</code> - необязательный идентификатор колонки, позволяющий ссылаться на нее в случае <a href="/manual.html#screen_extension">расширении экрана</a>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FieldGroup_field" class="ulist"> 
          <ul> 
           <li> <p><code>field</code> - основной элемент компонента, описывает одно поле компонента.</p> 
            <div class="paragraph"> 
             <p>Собственные настраиваемые поля можно определить внутри элемента <code>field</code>:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;fieldGroup&gt;</span>
    <span class="tag">&lt;field</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">demo</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;lookupField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">demoField</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">userDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">group</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/field&gt;</span>
<span class="tag">&lt;/fieldGroup&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Атрибуты элемента <code>field</code>:</p> 
            </div> 
            <div class="openblock"> 
             <div class="content"> 
              <div id="gui_FieldGroup_field_id" class="ulist"> 
               <ul> 
                <li> <p><code>id</code> - обязательный атрибут в случае, если не определён атрибут <code>property</code>; в противном случае по умолчанию принимает то же значение, что и <code>property</code>. Атрибут <code>id</code> должен содержать произвольный уникальный идентификатор либо поля с заданным атрибутом <code>property</code>, либо программно определяемого поля. В последнем случае элемент <code>field</code> должен иметь также атрибут <code>custom="true"</code> (см. далее).</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_property" class="ulist"> 
               <ul> 
                <li> <p><code>property</code> - обязательный атрибут в случае, если не определён атрибут <code>id</code>; должен содержать название атрибута сущности, выводимого в поле, для связывания поля и данных.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_caption" class="ulist"> 
               <ul> 
                <li> <p><code>caption</code> − позволяет задать заголовок поля. Если не задан, будет отображено <a href="/manual.html#entity_localization">локализованное название атрибута</a> сущности.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_visible" class="ulist"> 
               <ul> 
                <li> <p><code>visible</code> − позволяет скрыть поле вместе с заголовком.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_datasource" class="ulist"> 
               <ul> 
                <li> <p><code>datasource</code> − позволяет задать для данного поля <a href="/manual.html#datasources">источник данных</a>, отличный от заданного для всего компонента <code>fieldGroup</code>. Таким образом в группе полей могут отображаться атрибуты разных сущностей.</p> </li> 
                <li> <p><code>optionsDatasource</code> − задает имя <a href="/manual.html#datasources">источника данных</a>, используемого для формирования списка опций. Данный атрибут можно задать для поля, связанного со ссылочным атрибутом сущности. По умолчанию выбор связанной сущности производится через экран выбора, а если <code>optionsDatasource</code> указан, то связанную сущность можно выбирать из выпадающего списка опций. Фактически указание <code>optionsDatasource</code> приводит к тому, что вместо компонента <a href="/manual.html#gui_PickerField">PickerField</a> в поле используется <a href="/manual.html#gui_LookupPickerField">LookupPickerField</a>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_width" class="ulist"> 
               <ul> 
                <li> <p><code>width</code> − позволяет задать ширину поля без учета заголовка. По умолчанию ширина поля - <code>200px</code>. Ширина может быть задана как в пикселах, так и в процентах от общего размера колонки по горизонтали. Для указания ширины всех полей одновременно можно использовать атрибут <code>width</code> элемента <code>column</code>, описанный выше.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_custom" class="ulist"> 
               <ul> 
                <li> <p><code>custom</code> - установка этого атрибута в <code>true</code> позволяет задать собственное представление поля, или говорит о том, что идентификатор поля не ссылается на атрибут сущности, и компонент, находящийся в поле, будет задан программно с помощью метода <code>setComponent()</code> компонента <code>FieldGroup</code> (см. ниже).</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_generator" class="ulist"> 
               <ul> 
                <li> <p>атрибут <code>generator</code> позволяет декларативно создавать собственные прелставления полей, указав имя метода, возвращающего компонент для данного поля:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;fieldGroup</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">productDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">description</span><span class="delimiter">"</span></span> <span class="attribute-name">generator</span>=<span class="string"><span class="delimiter">"</span><span class="content">generateDescriptionField</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/column&gt;</span>
<span class="tag">&lt;/fieldGroup&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Component</span> generateDescriptionField(Datasource datasource, <span class="predefined-type">String</span> fieldId) {
    <span class="predefined-type">TextArea</span> textArea = componentsFactory.createComponent(<span class="predefined-type">TextArea</span>.class);
    textArea.setRows(<span class="integer">5</span>);
    textArea.setDatasource(datasource, fieldId);
    <span class="keyword">return</span> textArea;
}</code></pre> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_link" class="ulist"> 
               <ul> 
                <li> <p><code>link</code> - установка атрибута в <code>true</code> позволяет отобразить вместо поля выбора сущности ссылку на экран просмотра экземпляра сущности (поддерживается только для <strong>Web Client</strong>). Такое поведение может быть необходимо, если требуется дать пользователю возможность просматривать связанную сущность, но саму связь он менять не должен.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_linkScreen" class="ulist"> 
               <ul> 
                <li> <p><code>linkScreen</code> - позволяет указать идентификатор экрана, который будет открыт по нажатию на ссылку, включенную свойством <code>link</code>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_linkScreenOpenType" class="ulist"> 
               <ul> 
                <li> <p><code>linkScreenOpenType</code> - задает режим открытия экрана редактирования (<code>THIS_TAB</code>, <code>NEW_TAB</code> или <code>DIALOG</code>).</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_linkInvoke" class="ulist"> 
               <ul> 
                <li> <p><code>linkInvoke</code> - позволяет заменить открытие окна на вызов метода контроллера.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Следующие атрибуты элемента <code>field</code> можно применять в зависимости от типа атрибута сущности, отображаемого полем:</p> 
              </div> 
              <div id="gui_FieldGroup_field_mask" class="ulist"> 
               <ul> 
                <li> <p>Если для текстового атрибута сущности задать значение атрибута <code>mask</code>, то в поле вместо компонента <a href="/manual.html#gui_TextField">TextField</a> будет использоваться компонент <a href="/manual.html#gui_MaskedField">MaskedField</a> с соотвествующей маской. В этом случае можно также задать атрибут <code>valueMode</code>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FieldGroup_field_rows" class="ulist"> 
               <ul> 
                <li> <p>Если для текстового атрибута сущности задать значение атрибута <code>rows</code>, то в поле вместо компонента <a href="/manual.html#gui_TextField">TextField</a> будет использоваться компонент <a href="/manual.html#gui_TextArea">TextArea</a> с соответствующим количеством строк. В этом случае можно также задать атрибут <code>cols</code>.</p> </li> 
                <li> <p>Для текстового атрибута сущности можно задать атрибут <code>maxLength</code> аналогично описанному для <a href="/manual.html#gui_TextField">TextField</a>.</p> </li> 
                <li> <p>Для атрибута сущности типа <code>date</code> или <code>dateTime</code> можно задать атрибуты <code>dateFormat</code> и <code>resolution</code> для параметризации находящегося в поле компонента <a href="/manual.html#gui_DateField">DateField</a>.</p> </li> 
                <li> <p>Для атрибута сущности типа <code>time</code> можно задать атрибут <code>showSeconds</code> для параметризации находящегося в поле компонента <a href="/manual.html#gui_TimeField">TimeField</a>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>fieldGroup</code>:</p> 
         </div> 
         <div id="gui_FieldGroup_border" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>border</code> может принимать значение <code>hidden</code> или <code>visible</code>. По умолчанию - <code>hidden</code>. При установке в значение <code>visible</code> компонент <code>fieldGroup</code> выделяется рамкой. В веб-реализации компонента отображение рамки осуществляется добавлением CSS-класса <code>cuba-fieldgroup-border</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FieldGroup_captionAlignment" class="ulist"> 
          <ul> 
           <li> <p><code>captionAlignment</code> определяет расположение заголовков относительно полей компонента <code>FieldGroup</code>. Принимает два значения: <code>LEFT</code> и <code>TOP</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FieldGroup_fieldFactoryBean" class="ulist"> 
          <ul> 
           <li> <p><code>fieldFactoryBean</code>: декларативные поля, объявленные в XML-дескрипторе, создаются с помощью интерфейса <code>FieldGroupFieldFactory</code>. Чтобы переопределить эту фабрику, используйте атрибут <code>fieldFactoryBean</code> с именем вашей реализации <code>FieldGroupFieldFactory</code>.</p> 
            <div id="gui_FieldGroup_setFieldFactory" class="paragraph"> 
             <p>Для элемента <code>FieldGroup</code>, полностью созданного программно, для этой цели используется метод <code>setFieldFactory()</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Методы интерфейса <code>FieldGroup</code>:</p> 
         </div> 
         <div id="gui_FieldGroup_addField" class="ulist"> 
          <ul> 
           <li> <p><code>addField</code> позволяет добавлять поля в FieldGroup на лету. В качестве параметра принимает экземпляр <code>FieldConfig</code>, также можно указать положение нового поля в FieldGroup с помощью параметров <code>colIndex</code> и <code>rowIndex</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FieldGroup_bind" class="ulist"> 
          <ul> 
           <li> <p>метод <code>bind()</code> необходимо применить к полю после вызова метода <code>setDatasource()</code>, чтобы вызвать создание компонентов поля.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FieldGroup_createField" class="ulist"> 
          <ul> 
           <li> <p><code>createField()</code> используется для создания элементов FieldGroup, реализующих интерфейс <code>FieldConfig</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">fieldGroup.addField(fieldGroup.createField(<span class="string"><span class="delimiter">"</span><span class="content">newField</span><span class="delimiter">"</span></span>));</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FieldGroup_getComponent" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>getComponent()</code> возвращает визуальный компонент, находящийся в поле с указанным идентификатором. Это может потребоваться для дополнительной параметризации компонента, недоступной через атрибуты XML-элемента <code>field</code>, описанные выше.</p> 
            <div class="paragraph"> 
             <p>Вместо явного вызова <code>getFieldNN("id").getComponentNN()</code> для получения ссылки на компонент поля в контроллере экрана можно использовать <a href="/manual.html#screen_controller_injection">инжекцию</a>. Для этого следует использовать аннотацию <code>@Named</code> с указанием идентификатора самого <code>fieldGroup</code>, и через точку - идентификатора поля.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Например, следующим образом в поле выбора связанной сущности можно добавить действие открытия экземпляра и убрать действие очистки поля:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderFieldGroup</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/fieldGroup&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">"</span><span class="content">orderFieldGroup.customer</span><span class="delimiter">"</span></span>)
<span class="directive">protected</span> PickerField customerField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    customerField.addOpenAction();
    customerField.removeAction(customerField.getAction(PickerField.ClearAction.NAME));
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Для использования метода <code>getComponent()</code> или инжекции компонентов полей необходимо знать тип компонента, находящегося в поле. В следующей таблице приведено соответствие типов атрибутов сущностей и создаваемых для них компонентов:</p> 
            </div> 
            <table class="tableblock frame-all grid-all spread"> 
             <colgroup> 
              <col style="width: 33%;"> 
              <col style="width: 33%;"> 
              <col style="width: 33%;"> 
             </colgroup> 
             <thead> 
              <tr> 
               <th class="tableblock halign-left valign-middle">Тип атрибута сущности</th> 
               <th class="tableblock halign-left valign-middle">Дополнительные условия</th> 
               <th class="tableblock halign-left valign-middle">Тип компонента поля</th> 
              </tr> 
             </thead> 
             <tbody> 
              <tr> 
               <td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Связанная сущность</p></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock">Задан атрибут <code>optionsDatasource</code></p></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_LookupPickerField">LookupPickerField</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle"></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_PickerField">PickerField</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock">Перечисление (<code>enum</code>)</p></td> 
               <td class="tableblock halign-left valign-middle"></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_LookupField">LookupField</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle" rowspan="3"><p class="tableblock"><code>string</code></p></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock">Задан атрибут <code>mask</code></p></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_MaskedField">MaskedField</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock">Задан атрибут <code>rows</code></p></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TextArea">TextArea</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle"></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TextField">TextField</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><code>boolean</code></p></td> 
               <td class="tableblock halign-left valign-middle"></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_CheckBox">CheckBox</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><code>date</code>, <code>dateTime</code></p></td> 
               <td class="tableblock halign-left valign-middle"></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_DateField">DateField</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><code>time</code></p></td> 
               <td class="tableblock halign-left valign-middle"></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TimeField">TimeField</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock"><code>int</code>, <code>long</code>, <code>double</code>, <code>decimal</code></p></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock">Задан атрибут <code>mask</code></p></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_MaskedField">MaskedField</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle"></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_TextField">TextField</a></p></td> 
              </tr> 
              <tr> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><code>UUID</code></p></td> 
               <td class="tableblock halign-left valign-middle"></td> 
               <td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="/manual.html#gui_MaskedField">MaskedField</a> с hex-маской</p></td> 
              </tr> 
             </tbody> 
            </table> </li> 
          </ul> 
         </div> 
         <div id="gui_FieldGroup_removeField" class="ulist"> 
          <ul> 
           <li> <p><code>removeField()</code> позволяет удалять поля на лету по <code>id</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FieldGroup_setComponent" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>setComponent()</code> задаёт собственное представление поля. Он может быть использован вместе с атрибутом <code>custom="true"</code> элемента <code>field</code> или с полем, созданным программно методом <code>createField()</code> (см. выше). При использовании с <code>custom="true"</code> необходимо вручную указать источник данных и свойство.</p> 
            <div class="paragraph"> 
             <p>Экземпляр FieldConfig можно получить с помощью методов <code>getField()</code> или <code>getFieldNN()</code>, и затем вызвать метод <code>setComponent()</code>, как показано в следующем примере:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> FieldGroup fieldGroup;
<span class="annotation">@Inject</span>
<span class="directive">protected</span> ComponentsFactory componentsFactory;
<span class="annotation">@Inject</span>
<span class="directive">private</span> Datasource&lt;User&gt; userDs;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    PasswordField passwordField = componentsFactory.createComponent(PasswordField.class);
    passwordField.setDatasource(userDs, <span class="string"><span class="delimiter">"</span><span class="content">password</span><span class="delimiter">"</span></span>);
    fieldGroup.getFieldNN(<span class="string"><span class="delimiter">"</span><span class="content">password</span><span class="delimiter">"</span></span>).setComponent(passwordField);
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты fieldGroup
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_FieldGroup_border">border</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_FieldGroup_captionAlignment">captionAlignment</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_FieldGroup_fieldFactoryBean">fieldFactoryBean</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты column
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_FieldGroup_column_flex">flex</a> - <a href="/manual.html#gui_FieldGroup_column_id">id</a> - <a href="/manual.html#gui_FieldGroup_column_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты field
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_FieldGroup_field_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_FieldGroup_field_rows">cols</a> - <a href="/manual.html#gui_FieldGroup_field_custom">custom</a> - <a href="/manual.html#gui_FieldGroup_field_datasource">datasource</a> - <a href="/manual.html#gui_DateField_dateFormat">dateFormat</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_FieldGroup_field_generator">generator</a> - <a href="/manual.html#gui_FieldGroup_field_id">id</a> - <a href="/manual.html#gui_FieldGroup_field_link">link</a> - <a href="/manual.html#gui_FieldGroup_field_linkInvoke">linkInvoke</a> - <a href="/manual.html#gui_FieldGroup_field_linkScreen">linkScreen</a> - <a href="/manual.html#gui_FieldGroup_field_linkScreenOpenType">linkScreenOpenType</a> - <a href="/manual.html#gui_FieldGroup_field_mask">mask</a> - <a href="/manual.html#gui_TextField_maxLength">maxLength</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_FieldGroup_field_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_DateField_resolution">resolution</a> - <a href="/manual.html#gui_FieldGroup_field_rows">rows</a> - <a href="/manual.html#gui_TimeField_showSeconds">showSeconds</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_FieldGroup_field_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы field
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_FieldGroup_column">column</a> - <a href="/manual.html#gui_FieldGroup_field">field</a> - <a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_FieldGroup_addField">addField</a> - <a href="/manual.html#gui_FieldGroup_bind">bind</a> - <a href="/manual.html#gui_FieldGroup_createField">createField</a> - <a href="/manual.html#gui_FieldGroup_getComponent">getComponent</a> - <a href="/manual.html#gui_FieldGroup_removeField">removeField</a> - <a href="/manual.html#gui_FieldGroup_setComponent">setComponent</a> - <a href="/manual.html#gui_FieldGroup_setFieldFactory">setFieldFactory</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_FileMultiUploadField"><a class="anchor" href="/manual.html#gui_FileMultiUploadField"></a>5.5.2.1.14. FileMultiUploadField</h6> 
         <div class="paragraph"> 
          <p>Компонент <code>FileMultiUploadField</code> позволяет пользователю загружать файлы на сервер. Компонент представляет собой кнопку, при нажатии на которую на экране отображается стандартное для операционной системы окно выбора файлов, в котором можно выбрать сразу несколько файлов для загрузки.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_multipleUpload.png" alt="gui multipleUpload"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>multiUpload</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Рассмотрим пример использования компонента.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Объявляем компонент в XML-дескрипторе экрана:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;multiUpload</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">multiUploadField</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://upload</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FileMultiUploadField_QueueUploadCompleteListener" class="ulist"> 
          <ul> 
           <li> <p>В контроллере экрана инжектируем сам компонент, а также интерфейсы <a href="/manual.html#file_upload">FileUploadingAPI</a> и <a href="/manual.html#dataSupplier">DataSupplier</a>. Затем в методе <code>init()</code> добавляем слушателей, которые будут реагировать на события успешной загрузки или ошибки:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> FileMultiUploadField multiUploadField;
<span class="annotation">@Inject</span>
<span class="directive">private</span> FileUploadingAPI fileUploadingAPI;
<span class="annotation">@Inject</span>
<span class="directive">private</span> DataSupplier dataSupplier;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    multiUploadField.addQueueUploadCompleteListener(() -&gt; {
        <span class="keyword">for</span> (<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">UUID</span>, <span class="predefined-type">String</span>&gt; entry : multiUploadField.getUploadsMap().entrySet()) {
            <span class="predefined-type">UUID</span> fileId = entry.getKey();
            <span class="predefined-type">String</span> fileName = entry.getValue();
            <span class="predefined-type">FileDescriptor</span> fd = fileUploadingAPI.getFileDescriptor(fileId, fileName);
            <span class="comment">// save file to FileStorage</span>
            <span class="keyword">try</span> {
                fileUploadingAPI.putFileIntoStorage(fileId, fd);
            } <span class="keyword">catch</span> (FileStorageException e) {
                <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">"</span><span class="content">Error saving file to FileStorage</span><span class="delimiter">"</span></span>, e);
            }
            <span class="comment">// save file descriptor to database</span>
            dataSupplier.commit(fd);
        }
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Uploaded files: </span><span class="delimiter">"</span></span> + multiUploadField.getUploadsMap().values(), NotificationType.HUMANIZED);
        multiUploadField.clearUploads();
    });

    multiUploadField.addFileUploadErrorListener(event -&gt;
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">File upload error</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED));
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Компонент загружает выбранные файлы во временное хранилище клиентского <a href="/manual.html#app_tiers">уровня</a> и вызывает слушатель, добавленный методом <code>addQueueUploadCompleteListener()</code>. В данном слушателе вызовом метода <code>getUploadsMap()</code> у компонента можно получить мэп идентификаторов файлов во временном хранилище на имена файлов. Далее для каждого элемента мэп создается соответствующий объект <code>FileDescriptor</code> путем вызова <code>FileUploadingAPI.getFileDescriptor()</code>. Объект <code>com.haulmont.cuba.core.entity.FileDescriptor</code> (не путать с <code>java.io.FileDescriptor</code>) является персистентной сущностью, которая однозначно идентифицирует загруженный файл и впоследствии используется для выгрузки файла из системы.</p> 
            </div> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Ниже приведён список доступных слушателей для отслеживания процесса загрузки:</p> 
              </div> 
              <div id="gui_FileMultiUploadField_FileUploadErrorListener" class="ulist"> 
               <ul> 
                <li> <p><code>FileUploadStartListener</code>,</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FileMultiUploadField_FileUploadStartListener" class="ulist"> 
               <ul> 
                <li> <p><code>FileUploadStartListener</code>,</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FileMultiUploadField_FileUploadFinishListener" class="ulist"> 
               <ul> 
                <li> <p><code>FileUploadFinishListener</code>,</p> </li> 
                <li> <p><code>QueueUploadCompleteListener</code>.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Метод <code>FileUploadingAPI.putFileIntoStorage()</code> используется для перемещения загружаемого файла из временного хранилища клиентского уровня в <a href="/manual.html#file_storage">FileStorage</a>. Параметрами этого метода являются идентификатор файла во временном хранилище и объект <code>FileDescriptor</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>После загрузки файла в <code>FileStorage</code> выполняется сохранение экземпляра <code>FileDescriptor</code> в базе данных посредством вызова <code>DataSupplier.commit()</code>. Возвращаемый этим методом сохраненный экземпляр может быть установлен в атрибут какой-либо сущности предметной области, связанной с данным файлом. В данном же случае <code>FileDescriptor</code> просто сохраняется в базе данных. Соответствующий файл будет доступен через экран <strong>Administration</strong> → <strong>External Files</strong>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>После обработки файлов необходимо очистить список файлов вызовом <code>clearUploads()</code> на случай повторной загрузки.</p> 
              </div> 
             </div> 
            </div> </li> 
           <li> <p>Максимальный размер загружаемого файла определяется свойством приложения <a href="/manual.html#cuba.maxUploadSizeMb">cuba.maxUploadSizeMb</a> и по умолчанию равен 20MB. При выборе пользователем файла большего размера выдается соответствующее сообщение и загрузка прерывается.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FileMultiUploadField_accept" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>accept</code> (и соответствующий метод <code>setAccept()</code>) может быть использован для установки маски расширений файлов в диалоге выбора файла. Пользователи будут иметь возможность выбрать "All files" и загрузить произвольные файлы.</p> 
            <div class="paragraph"> 
             <p>Значением атрибута должен быть список масок, разделенных запятыми. Например: <code>*.jpg,*.png</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FileMultiUploadField_fileSizeLimit" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>fileSizeLimit</code> (и соответствующий метод <code>setFileSizeLimit()</code>) может быть использован для установки максимально допустимого размера файла. Значением атрибута должно быть целое число для указания количества байт. Данный лимит устанавливает ограничение для каждого файла.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;multiUpload</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">multiUploadField</span><span class="delimiter">"</span></span> <span class="attribute-name">fileSizeLimit</span>=<span class="string"><span class="delimiter">"</span><span class="content">200000</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FileMultiUploadField_permittedExtensions" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>permittedExtensions</code> (и соответствующий метод <code>setPermittedExtensions()</code>) может быть использован для установки "белого списка" допустимых расширений загружаемых файлов.</p> 
            <div class="paragraph"> 
             <p>Значением атрибута должен быть набор строк, в котором каждая строка - это допустимое расширение с лидирующей точкой. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">uploadField.setPermittedExtensions(Sets.newHashSet(<span class="string"><span class="delimiter">"</span><span class="content">.png</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">.jpg</span><span class="delimiter">"</span></span>));</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FileMultiUploadField_dropZone" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>dropZone</code> используется для указания <a href="/manual.html#gui_BoxLayout">BoxLayout</a>, который будет использован в качестве целевой площадки для перетаскивания файлов извне браузера. Если стиль контейнера <a href="/manual.html#gui_FileUploadField_dropZone">не переопределён</a>, выбранный контейнер будет подсвечиваться, когда пользователь переносит над ним файлы, без наведения файла контейнер не отображается.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В разделе <a href="/manual.html#images_recipe">Загрузка и вывод изображений</a> приведен более сложный пример работы с загруженными файлами.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты multiUpload
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_FileMultiUploadField_accept">accept</a> - <a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_FileMultiUploadField_dropZone">dropZone</a> - <a href="/manual.html#gui_FileMultiUploadField_fileSizeLimit">fileSizeLimit</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_FileMultiUploadField_permittedExtensions">permittedExtensions</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Слушатели multiUpload
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_FileMultiUploadField_FileUploadErrorListener">FileUploadErrorListener</a> - <a href="/manual.html#gui_FileMultiUploadField_FileUploadFinishListener">FileUploadFinishListener</a> - <a href="/manual.html#gui_FileMultiUploadField_FileUploadStartListener">FileUploadStartListener</a> - <a href="/manual.html#gui_FileMultiUploadField_QueueUploadCompleteListener">QueueUploadCompleteListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_FileUploadField"><a class="anchor" href="/manual.html#gui_FileUploadField"></a>5.5.2.1.15. FileUploadField</h6> 
         <div class="paragraph"> 
          <p>Компонент <code>FileUploadField</code> позволяет пользователю загружать файлы на сервер. Компонент может содержать заголовок, ссылку на загруженный файл и две кнопки: для загрузки файла и для очистки. При нажатии на кнопку загрузки на экране отображается стандартное для операционной системы окно, в котором можно выбрать один файл. Чтобы дать пользователю возможность загружать сразу несколько файлов, используйте компонент <a href="/manual.html#gui_FileMultiUploadField">FileMultiUploadField</a>.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_upload.png" alt="gui upload"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>upload</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>FileUploadField</code> автоматически используется внутри <a href="/manual.html#gui_FieldGroup">FieldGroup</a> для атрибутов типа <code>FileDescriptor</code>. В этом случае компонент выглядит как на приведенном выше скриншоте и не требует никакого конфигурирования. Загруженный файл сразу же сохраняется в <a href="/manual.html#file_storage">file storage</a>, а соответствующий <code>FileDescriptor</code> - в базу данных.</p> </li> 
           <li> <p>Компонент можно использовать вне <code>FieldGroup</code> и подключить к источнику данных. В примере ниже предполагается, что источник данных <code>personDs</code> содержит сущность с атрибутом <code>photo</code>, который является ссылкой на <code>FileDescriptor</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;upload</span> <span class="attribute-name">fileStoragePutMode</span>=<span class="string"><span class="delimiter">"</span><span class="content">IMMEDIATE</span><span class="delimiter">"</span></span>
        <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">personDs</span><span class="delimiter">"</span></span>
        <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">photo</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Сохранением файла и <code>FileDescriptor</code> можно также управлять программно.</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p>Объявляем компонент в XML-дескрипторе экрана:</p> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;upload</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">uploadField</span><span class="delimiter">"</span></span>
        <span class="attribute-name">fileStoragePutMode</span>=<span class="string"><span class="delimiter">"</span><span class="content">MANUAL</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
                </div> 
               </div> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_FileUploadSucceedListener" class="ulist"> 
          <ul> 
           <li> <p>В контроллере экрана инжектируем сам компонент, а также интерфейсы <a href="/manual.html#file_upload">FileUploadingAPI</a> и <a href="/manual.html#dataSupplier">DataSupplier</a>. Затем в методе <code>init()</code> добавляем слушатели, которые будут реагировать на события успешной загрузки или ошибки:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> FileUploadField uploadField;
<span class="annotation">@Inject</span>
<span class="directive">private</span> FileUploadingAPI fileUploadingAPI;
<span class="annotation">@Inject</span>
<span class="directive">private</span> DataSupplier dataSupplier;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    uploadField.addFileUploadSucceedListener(event -&gt; {
        <span class="predefined-type">FileDescriptor</span> fd = uploadField.getFileDescriptor();
        <span class="keyword">try</span> {
            <span class="comment">// save file to FileStorage</span>
            fileUploadingAPI.putFileIntoStorage(uploadField.getFileId(), fd);
        } <span class="keyword">catch</span> (FileStorageException e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">"</span><span class="content">Error saving file to FileStorage</span><span class="delimiter">"</span></span>, e);
        }
        <span class="comment">// save file descriptor to database</span>
        dataSupplier.commit(fd);
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Uploaded file: </span><span class="delimiter">"</span></span> + uploadField.getFileName(), NotificationType.HUMANIZED);
    });

    uploadField.addFileUploadErrorListener(event -&gt;
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">File upload error</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED));
}</code></pre> 
             </div> 
            </div> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Компонент загружает файл во временное хранилище клиентского <a href="/manual.html#app_tiers">уровня</a> и вызывает слушатель, добавленный методом <code>addFileUploadSucceedListener()</code>. В этом слушателе у компонента запрашивается объект <code>FileDescriptor</code>, соответствующий загруженному файлу. Объект <code>com.haulmont.cuba.core.entity.FileDescriptor</code> является персистентной сущностью, которая однозначно идентифицирует загруженный файл и впоследствии используется для выгрузки файла из системы.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Метод <code>FileUploadingAPI.putFileIntoStorage()</code> используется для перемещения загружаемого файла из временного хранилища клиентского уровня в <a href="/manual.html#file_storage">FileStorage</a>. Параметрами этого метода являются идентификатор файла во временном хранилище и объект <code>FileDescriptor</code>. Оба эти параметра предоставляет <code>FileUploadField</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>После загрузки файла в <code>FileStorage</code> выполняется сохранение экземпляра <code>FileDescriptor</code> в базе данных посредством вызова <code>DataSupplier.commit()</code>. Возвращаемый этим методом сохраненный экземпляр может быть установлен в атрибут какой-либо сущности предметной области, связанной с данным файлом. В данном же случае <code>FileDescriptor</code> просто сохраняется в базе данных. Соответствующий файл будет доступен через экран <strong>Administration</strong> → <strong>External Files</strong>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Слушатель, добавленный методом <code>addFileUploadErrorListener()</code>, вызывается в случае ошибки загрузки файла во временное хранилище клиентского уровня.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Ниже приведён полный список доступных слушателей для отслеживания процесса загрузки:</p> 
              </div> 
              <div id="gui_FileUploadField_AfterValueClearListener" class="ulist"> 
               <ul> 
                <li> <p><code>AfterValueClearListener</code>,</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FileUploadField_BeforeValueClearListener" class="ulist"> 
               <ul> 
                <li> <p><code>BeforeValueClearListener</code>,</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FileUploadField_FileUploadErrorListener" class="ulist"> 
               <ul> 
                <li> <p><code>FileUploadErrorListener</code>,</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FileUploadField_FileUploadFinishListener" class="ulist"> 
               <ul> 
                <li> <p><code>FileUploadFinishListener</code></p> </li> 
               </ul> 
              </div> 
              <div id="gui_FileUploadField_FileUploadStartListener" class="ulist"> 
               <ul> 
                <li> <p><code>FileUploadStartListener</code>,</p> </li> 
               </ul> 
              </div> 
              <div id="gui_FileUploadField_FileUploadSucceedListener" class="ulist"> 
               <ul> 
                <li> <p><code>FileUploadSucceedListener</code>,</p> </li> 
                <li> <p><code>ValueChangeListener</code>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_fileStoragePutMode" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>fileStoragePutMode</code> задает режим сохранения файла и соответствующего <code>FileDescriptor</code>. В режиме <code>IMMEDIATE</code> это делается автоматически сразу после загрузки файла во временное хранилище клиентского уровня. В режиме <code>MANUAL</code> необходимо сделать это в листенере <code>FileUploadSucceedListener</code>. Режим <code>IMMEDIATE</code> выбирается по умолчанию, когда <code>FileUploadField</code> используется внутри <code>FieldGroup</code>. В противном случае, по умолчанию выбирается <code>MANUAL</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_uploadButtonCaption" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибуты <code>uploadButtonCaption</code>, <code>uploadButtonIcon</code> и <code>uploadButtonDescription</code> позволяют задать параметры кнопки загрузки.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_showFileName" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>showFileName</code> управляет отображением имени загруженного файла рядом с кнопкой загрузки. По умолчанию <code>false</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_showClearButton" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>showClearButton</code> управляет видимостью кнопки очистки. По умолчанию <code>false</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_clearButtonCaption" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибуты <code>clearButtonCaption</code>, <code>clearButtonIcon</code> и <code>clearButtonDescription</code> позволяют задать параметры кнопки очистки, если она видима.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_accept" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>accept</code> (и соответствующий метод <code>setAccept()</code>) может быть использован для установки маски расширений файлов в диалоге выбора файла. Пользователи будут иметь возможность выбрать "All files" и загрузить произвольные файлы.</p> 
            <div class="paragraph"> 
             <p>Значением атрибута должен быть список масок, разделенных запятыми. Например: <code>*.jpg,*.png</code>.</p> 
            </div> </li> 
           <li> <p>Максимальный размер загружаемого файла определяется свойством приложения <a href="/manual.html#cuba.maxUploadSizeMb">cuba.maxUploadSizeMb</a> и по умолчанию равен 20MB. При выборе пользователем файла большего размера выдается соответствующее сообщение и загрузка прерывается.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_fileSizeLimit" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>fileSizeLimit</code> (и соответствующий метод <code>setFileSizeLimit()</code>) может быть использован для установки максимально допустимого размера файла. Значением атрибута должно быть целое число для указания количества байт.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;upload</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">uploadField</span><span class="delimiter">"</span></span> <span class="attribute-name">fileSizeLimit</span>=<span class="string"><span class="delimiter">"</span><span class="content">2000</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_permittedExtensions" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>permittedExtensions</code> (и соответствующий метод <code>setPermittedExtensions()</code>) может быть использован для установки "белого списка" допустимых расширений загружаемых файлов.</p> 
            <div class="paragraph"> 
             <p>Значением атрибута должен быть набор расширений с лидирующими точками, разделенных запятыми. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">uploadField.setPermittedExtensions(Sets.newHashSet(<span class="string"><span class="delimiter">"</span><span class="content">.png</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">.jpg</span><span class="delimiter">"</span></span>));</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_FileUploadField_dropZone" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>dropZone</code> используется для указания <a href="/manual.html#gui_BoxLayout">BoxLayout</a>, который будет использован в качестве целевой площадки для перетаскивания файлов извне браузера. Зона перетаскивания может занимать всю площадь диалогового окна. Выбранный контейнер будет подсвечиваться, когда пользователь переносит над ним файлы, без наведения файла контейнер не отображается.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;layout</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
        <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">dropZone</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">AUTO</span><span class="delimiter">"</span></span>
          <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">textField</span><span class="delimiter">"</span></span>
                   <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Title</span><span class="delimiter">"</span></span>
                   <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;textArea</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">textArea</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Description</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">rows</span>=<span class="string"><span class="delimiter">"</span><span class="content">5</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;checkBox</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Is reference document</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;upload</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">upload</span><span class="delimiter">"</span></span>
                <span class="attribute-name">dropZone</span>=<span class="string"><span class="delimiter">"</span><span class="content">dropZone</span><span class="delimiter">"</span></span>
                <span class="attribute-name">showClearButton</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
                <span class="attribute-name">showFileName</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
    <span class="tag">&lt;hbox</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainMsg://actions.Apply</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainMsg://actions.Cancel</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hbox&gt;</span>
<span class="tag">&lt;/layout&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_dropZone.png" alt="gui dropZone"> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Чтобы сделать область dropZone статической и отображать её постоянно, необходимо назначить её контейнеру готовый стиль <code>dropzone-container</code>. В этом случае контейнер необходимо оставить пустым, поместив в него только текстовый компонент <code>label</code>:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;layout</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
        <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">textField</span><span class="delimiter">"</span></span>
               <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Title</span><span class="delimiter">"</span></span>
               <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;checkBox</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Is reference document</span><span class="delimiter">"</span></span>
              <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;upload</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">upload</span><span class="delimiter">"</span></span>
            <span class="attribute-name">dropZone</span>=<span class="string"><span class="delimiter">"</span><span class="content">dropZone</span><span class="delimiter">"</span></span>
            <span class="attribute-name">showClearButton</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
            <span class="attribute-name">showFileName</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">dropZone</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">150px</span><span class="delimiter">"</span></span>
          <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
          <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">dropzone-container</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;label</span> <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">dropzone-description</span><span class="delimiter">"</span></span>
               <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Drop file here</span><span class="delimiter">"</span></span>
               <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
    <span class="tag">&lt;hbox</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainMsg://actions.Apply</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainMsg://actions.Cancel</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hbox&gt;</span>
<span class="tag">&lt;/layout&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_dropZone_static.png" alt="gui dropZone static"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В разделе <a href="/manual.html#images_recipe">Загрузка и вывод изображений</a> приведен более сложный пример работы с загруженными файлами.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты upload
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_FileUploadField_accept">accept</a> - <a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_FileUploadField_clearButtonCaption">clearButtonCaption</a> - <a href="/manual.html#gui_FileUploadField_clearButtonCaption">clearButtonDescription</a> - <a href="/manual.html#gui_FileUploadField_clearButtonCaption">clearButtonIcon</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_FileUploadField_dropZone">dropZone</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_FileUploadField_fileSizeLimit">fileSizeLimit</a> - <a href="/manual.html#gui_FileUploadField_fileStoragePutMode">fileStoragePutMode</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_FileUploadField_permittedExtensions">permittedExtensions</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_FileUploadField_showClearButton">showClearButton</a> - <a href="/manual.html#gui_FileUploadField_showFileName">showFileName</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_FileUploadField_uploadButtonCaption">uploadButtonCaption</a> - <a href="/manual.html#gui_FileUploadField_uploadButtonCaption">uploadButtonDescription</a> - <a href="/manual.html#gui_FileUploadField_uploadButtonCaption">uploadButtonIcon</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a></p> 
           </dd> 
           <dt class="hdlist1">
            Слушатели upload
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_FileUploadField_AfterValueClearListener">AfterValueClearListener</a> - <a href="/manual.html#gui_FileUploadField_BeforeValueClearListener">BeforeValueClearListener</a> - <a href="/manual.html#gui_FileUploadField_FileUploadErrorListener">FileUploadErrorListener</a> - <a href="/manual.html#gui_FileUploadField_FileUploadFinishListener">FileUploadFinishListener</a> - <a href="/manual.html#gui_FileUploadField_FileUploadStartListener">FileUploadStartListener</a> - <a href="/manual.html#gui_FileUploadField_FileUploadSucceedListener">FileUploadSucceedListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Filter"><a class="anchor" href="/manual.html#gui_Filter"></a>5.5.2.1.16. Filter</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=multiple-filter" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>Filter</code> − универсальное средство фильтрации списков сущностей, извлекаемых из базы данных для отображения в табличном виде. Компонент позволяет производить быструю фильтрацию данных по произвольному набору условий, а также создавать фильтры для многократного использования.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>Filter</code> должен быть связан с <a href="/manual.html#datasources">источником данных</a> <code>collectionDatasource</code> содержащим <a href="/manual.html#datasource_query">запрос</a> на JPQL. Принцип действия фильтра основан на модификации этого запроса в соответствии с критериями, заданными пользователем. Таким образом фильтрация осуществляется на уровне БД при выполнении транслированного из JPQL в SQL запроса, и на Middleware и клиентский <a href="/manual.html#app_tiers">уровень</a> загружаются только отобранные данные.</p> 
         </div> 
         <div id="gui_Filter_use" class="paragraph"> 
          <p><strong>Использование фильтра</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p>Типичный фильтр выглядит следующим образом:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_filter_descr.png" alt="gui filter descr"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>По умолчанию, компонент находится в режиме быстрой фильтрации. Это означает, что пользователь может добавить набор условий для однократного поиска данных. После закрытия экрана просмотра экземпляров сущности условия будут удалены.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Для того чтобы создать быстрый фильтр, нажмите на ссылку <strong>Add search condition (Добавить условие поиска)</strong>. Отобразится экран выбора условий:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_filter_conditions.png" alt="gui filter conditions"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Рассмотрим возможные типы условий:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><strong>Properties (Атрибуты)</strong> – атрибуты данной сущности и связанных с ней сущностей. Отображаются персистентные атрибуты, явно заданные в элементе <code>property</code> XML-описателя фильтра, либо соответствующие правилам, указанным в элементе <a href="/manual.html#gui_Filter_properties">properties</a>.</p> </li> 
           <li> <p><strong>Custom conditions (Специальные условия)</strong> – условия, заданные разработчиком в элементах <code>custom</code> XML-описателя фильтра.</p> </li> 
           <li> <p><strong>Create new (Создать новое)</strong> – позволяет создать новое произвольное условие на JPQL. Данный пункт доступен пользователю, если у него есть специфическое <a href="/manual.html#permissions">разрешение</a> <code>cuba.gui.filter.customConditions</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Выбранные условия отображаются в верхней части панель фильтра. Рядом с каждым условием находится кнопка <span class="image"><img src="assets/gui_filter_remove_condition.png" alt="gui_filter_remove_condition"></span>, позволяющая удалить их из набора.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Быстрый фильтр можно сохранить для повторного использования в дальнейшем. Для этого нажмите на кнопку настроек фильтра и выберите <strong>Save/Save as (Сохранить/Сохранить как)</strong>. Во всплывающем окне задайте имя нового фильтра:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_filter_name.png" alt="gui filter name"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Фильтр будет сохранен в выпадающем меню кнопки <strong>Search (Поиск)</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пункт меню <strong>Reset filter (Сбросить фильтр)</strong> позволяет сбросить все текущие условия поиска.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_filter_reset.png" alt="gui filter reset"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопка настроек фильтра содержит выпадающий список опций для управления фильтром:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><strong>Save (Сохранить)</strong> – сохранить изменения в текущем фильтре.</p> </li> 
           <li> <p><strong>Save with values (Сохранить со значениями)</strong> – сохранить изменения в текущем фильтре, использовав значения в редакторах параметров фильра как дефолтные значения фильтра.</p> </li> 
           <li> <p><strong>Save as (Сохранить как)</strong> – сохранить фильтр под новым именем.</p> </li> 
           <li> <p><strong>Edit (Редактировать)</strong> – открыть редактор фильтра (см. ниже).</p> </li> 
           <li> <p><strong>Make default (Установить по умолчанию)</strong> – установить фильтр по умолчанию для данного экрана. Фильтр будет автоматически выводиться на панель при каждом открытии экрана.</p> </li> 
           <li> <p><strong>Remove (Удалить)</strong> – удалить текущий фильтр.</p> </li> 
           <li> <p><strong>Pin applied (Закрепить)</strong> – использовать результаты последнего поиска для последовательной фильтрации данных (см. <a href="/manual.html#gui_Filter_sequential_apply">Последовательное наложение фильтров</a>).</p> </li> 
           <li> <p><strong>Save as search folder (Сохранить как папку поиска)</strong> – создать <a href="/manual.html#search_folder">папку поиска</a> на основе текущего фильтра.</p> </li> 
           <li> <p><strong>Save as application folder (Сохранить как папку приложения)</strong> – создать <a href="/manual.html#search_folder">папку приложения</a> на основе текущего фильтра. Эта опция доступна только пользователям со специфическим разрешением <code>cuba.gui.appFolder.global</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Опция <strong>Edit</strong> открывает редактор фильтра, который дает возможность расширенной настройки текущего фильтра:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_filter_editor.png" alt="gui filter editor"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Название фильтра указывается в поле <strong>Filter name (Имя фильтра)</strong>. Это имя будет отображаться в списке доступных фильтров для текущего экрана.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Фильтр можно сделать <em>global</em> (то есть доступным для всех пользователей) с помощью установки флажка <strong>Available for all users (Общий)</strong> для всех пользователей, или установить текущий фильтр в качестве фильтра по умолчанию с помощью установки флажка <strong>Default (По умолчанию)</strong>. Для этой операции пользователю требуется специфическое <a href="/manual.html#permissions">разрешение</a> CUBA &gt; Фильтр &gt; Создание/изменение глобальных фильтров.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В дереве содержатся условия фильтра. Условия можно добавлять с помощью кнопки <strong>Add (Добавить)</strong> менять местами при помощи кнопок <span class="image"><img src="assets/gui_filter_cond_down.png" alt="gui_filter_cond_down"></span>/<span class="image"><img src="assets/gui_filter_cond_up.png" alt="gui_filter_cond_up"></span> или удалять с помощью кнопки <strong>Remove (Удалить)</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Группировку условий по И или ИЛИ можно добавить с помощью соответствующих кнопок. Все добавленные на верхний уровень (то есть без явной группировки) условия объединяются по И.</p> 
         </div> 
         <div class="paragraph"> 
          <p>При выборе условия в дереве в правой части редактора открывается список его свойств.</p> 
         </div> 
         <div class="paragraph"> 
          <p>С помощью соответствующих флажков можно сделать выбранное в таблице условие скрытым или обязательным для заполнения. Параметр скрытого условия не отображается пользователю, поэтому он должны быть введен во время редактирования фильтра.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Свойство <strong>Width</strong> позволяет задать ширину поля ввода параметра для текущего условия. По умолчанию, условия на панели фильтров отображаются в три колонки. Ширина поля равняется количеству колонок, которое оно может занять (1, 2 или 3).</p> 
         </div> 
         <div class="paragraph"> 
          <p>Значение параметра текущего условия по умолчанию можно задать в поле <strong>Default value (Значение по умолчанию)</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Специальный заголовок условия фильтрации можно задать в поле <strong>Caption (Заголовок)</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Поле <strong>Operation</strong> позволяет выбрать оператор поиска. Список доступных операторов зависит от типа атрибута.</p> 
         </div> 
         <div id="gui_Filter_component" class="paragraph"> 
          <p><strong>Описание компонента Filter</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>filter</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример объявления компонента в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Car</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">carBrowse</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>
            select c from ref$Car c order by c.createTs
        <span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;filter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsFilter</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;properties</span> <span class="attribute-name">include</span>=<span class="string"><span class="delimiter">"</span><span class="content">.*</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/filter&gt;</span>
    <span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsTable</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;columns&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">vin</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">model.name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour.name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/columns&gt;</span>
        <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/table&gt;</span>
<span class="tag">&lt;/layout&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Здесь в элементе <code>dsContext</code> определен <a href="/manual.html#datasources">источник данных</a> <code>collectionDatasource</code>, который выбирает экземпляры сущности <code>Car</code> с помощью JPQL запроса. Для компонента <code>filter</code> в его атрибуте <code>datasource</code> указан фильтруемый источник данных. Данные отображаются компонентом <a href="/manual.html#gui_Table">Table</a>, связанным с этим же источником.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Элемент <code>filter</code> может содержать вложенные элементы. Все они описывают условия, доступные пользователю для выбора в диалоге добавления условий:</p> 
         </div> 
         <div id="gui_Filter_properties" class="ulist"> 
          <ul> 
           <li> <p><code>properties</code> - позволяет сделать доступными сразу несколько атрибутов сущности. Данный элемент может иметь следующие атрибуты:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div id="gui_Filter_properties_include" class="ulist"> 
               <ul> 
                <li> <p><code>include</code> - обязательный атрибут, содержит регулярное выражение, которому должно соответствовать имя атрибута сущности.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Filter_properties_exclude" class="ulist"> 
               <ul> 
                <li> <p><code>exclude</code> - содержит регулярное выражение, при соответствии которому атрибут сущности исключается из ранее включенных с помощью <code>include</code>.</p> 
                 <div class="paragraph"> 
                  <p>Например:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">transactionsFilter</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">transactionsDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties</span> <span class="attribute-name">include</span>=<span class="string"><span class="delimiter">"</span><span class="content">.*</span><span class="delimiter">"</span></span> <span class="attribute-name">exclude</span>=<span class="string"><span class="delimiter">"</span><span class="content">(masterTransaction)|(authCode)</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>При использовании элемента <code>properties</code> автоматически игнорируются следующие атрибуты сущности:</p> 
                 </div> </li> 
                <li> <p>Недоступные в связи с <a href="/manual.html#permissions">разрешениями</a> подсистемы безопасности.</p> </li> 
                <li> <p>Коллекции (<code>@OneToMany</code>, <code>@ManyToMany</code>).</p> </li> 
                <li> <p>Неперсистентные атрибуты.</p> </li> 
                <li> <p>Атрибуты, не имеющие <a href="/manual.html#entity_localization">локализованного названия</a>.</p> </li> 
                <li> <p>Атрибуты, аннотированные <code>@SystemLevel</code>.</p> </li> 
                <li> <p>Атрибуты типа <code>byte[]</code>.</p> </li> 
                <li> <p>Атрибут <code>version</code>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_property" class="ulist"> 
          <ul> 
           <li> <p><code>property</code> - явно включает атрибут сущности по имени. Данный элемент может иметь следующие атрибуты:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div id="gui_Filter_property_name" class="ulist"> 
               <ul> 
                <li> <p><code>name</code> - обязательный атрибут, содержит имя включаемого атрибута сущности. Может быть путем (через ".") по графу сущностей. Например:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">transactionsFilter</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">transactionDs</span><span class="delimiter">"</span></span> <span class="attribute-name">applyTo</span>=<span class="string"><span class="delimiter">"</span><span class="content">table</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties</span> <span class="attribute-name">include</span>=<span class="string"><span class="delimiter">"</span><span class="content">.*</span><span class="delimiter">"</span></span> <span class="attribute-name">exclude</span>=<span class="string"><span class="delimiter">"</span><span class="content">(masterTransaction)|(authCode)</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">creditCard.maskedPan</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://EmbeddedCreditCard.maskedPan</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">creditCard.startDate</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://EmbeddedCreditCard.startDate</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_Filter_property_caption" class="ulist"> 
               <ul> 
                <li> <p><code>caption</code> - локализованное название атрибута сущности для отображения условия фильтра. Как правило, представляет из себя строку с префиксом <code>msg://</code> по правилам <a href="/manual.html#messageTools.loadString">MessageTools.loadString</a>().</p> 
                 <div class="paragraph"> 
                  <p>Если в атрибуте <code>name</code> указан путь (через ".") по графу сущностей, то атрибут <code>caption</code> является обязательным.</p> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_Filter_property_paramWhere" class="ulist"> 
               <ul> 
                <li> <p><code>paramWhere</code> − задает выражение на JPQL для отбора списка значений параметра условия, если параметр является связанной сущностью. Вместо алиаса сущности параметра в выражении нужно использовать метку (placeholder) <code>{E}</code>.</p> 
                 <div class="paragraph"> 
                  <p>Например, предположим, что сущность <code>Car</code> имеет ссылку на сущность <code>Model</code>. Тогда список возможных значений параметра может быть ограничен только моделями <code><strong>Audi</strong></code>:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsFilter</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">model</span><span class="delimiter">"</span></span> <span class="attribute-name">paramWhere</span>=<span class="string"><span class="delimiter">"</span><span class="content">{E}.manufacturer = 'Audi'</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>В выражении JPQL можно использовать параметры экрана, атрибуты сессии, а также компоненты экрана, в том числе отображающие другие параметры. Правила задания параметров запроса описаны в <a href="/manual.html#datasource_query">Запросы в CollectionDatasourceImpl</a>.</p> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Пример использования параметра сессии и параметра экрана:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="jpql">{E}.createdBy = :session$userLogin and {E}.name like :param$groupName</code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Используя <code>paramWhere</code> можно вводить зависимости между параметрами. Например, предположим, что <code>Manufacturer</code> является отдельной сущностью. То есть <code>Car</code> ссылается на <code>Model</code>, которая в свою очередь ссылается на <code>Manufacturer</code>. Тогда для фильтра по <code>Car</code> можно создать два условия: первое для выбора <code>Manufacturer</code> и второе для выбора <code>Model</code>. Чтобы ограничить список моделей выбранным перед этим производителем, добавьте в выражение <code>paramWhere</code> параметр:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="jpql">{E}.manufacturer.id = :component$filter.model_manufacturer90062</code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Здесь параметр ссылается на компонент, отображающий параметр Manufacturer. Имя компонента, отображающего параметр условия, можно узнать, вызвав контекстное меню на строке таблицы условий в редакторе фильтра:</p> 
                 </div> 
                 <div id="gui_Filter_parameter_component_name" class="imageblock" style="text-align: center"> 
                  <div class="content"> 
                   <img src="assets/gui_filter_component_name.png" alt="gui filter component name"> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_Filter_property_paramView" class="ulist"> 
               <ul> 
                <li> <p><code>paramView</code> − задает <a href="/manual.html#views">представление</a>, с которым будет загружаться список значений параметра условия, если параметр является связанной сущностью. Например, <code>_local</code>. Если не указано, используется <code>_minimal</code>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_custom" class="ulist"> 
          <ul> 
           <li> <p><code>custom</code> - элемент, определяющий произвольное условие. Содержимым элемента должно быть выражение на JPQL (возможно использование <a href="/manual.html#jpql_macro">JPQL Macros</a>), которое будет добавлено в условие <code>where</code> запроса источника данных. Вместо алиаса отбираемой сущности в выражении нужно использовать метку (placeholder) <code>{E}</code>. Параметр условия может быть только один, и если он есть, обозначается символом <code>?</code>.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Значение условия может содержать спецсимволы, например "%" или "_" для оператора "like". Если вам нужно экранировать эти символы, добавьте в условие <code>escape '&lt;char&gt;'</code>, например:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="sql">{E}.name <span class="keyword">like</span> <span class="error">?</span> escape <span class="string"><span class="delimiter">'</span><span class="char">\'</span></span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Тогда если в значении параметра условия будет передано <code>foo\%</code>, поиск будет интерпретировать "%" как символ в имени а не как спецсимвол.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример фильтра с произвольными условиями:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsFilter</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;properties</span> <span class="attribute-name">include</span>=<span class="string"><span class="delimiter">"</span><span class="content">.*</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;custom</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">vin</span><span class="delimiter">"</span></span> <span class="attribute-name">paramClass</span>=<span class="string"><span class="delimiter">"</span><span class="content">java.lang.String</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://vin</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
      {E}.vin like ?
    <span class="tag">&lt;/custom&gt;</span>
    <span class="tag">&lt;custom</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span> <span class="attribute-name">paramClass</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Colour</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://colour</span><span class="delimiter">"</span></span>
            <span class="attribute-name">inExpr</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
      ({E}.colour.id in (?))
    <span class="tag">&lt;/custom&gt;</span>
    <span class="tag">&lt;custom</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">repair</span><span class="delimiter">"</span></span> <span class="attribute-name">paramClass</span>=<span class="string"><span class="delimiter">"</span><span class="content">java.lang.String</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://repair</span><span class="delimiter">"</span></span>
            <span class="attribute-name">join</span>=<span class="string"><span class="delimiter">"</span><span class="content">join {E}.repairs cr</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
      cr.description like ?
    <span class="tag">&lt;/custom&gt;</span>
    <span class="tag">&lt;custom</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">updateTs</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://updateTs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
      @between({E}.updateTs, now-1, now+1, day)
    <span class="tag">&lt;/custom&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Созданные <code>custom</code> условия отображаются в секции <strong>Специальные условия</strong> диалога добавления условий:</p> 
              </div> 
              <div class="imageblock" style="text-align: center"> 
               <div class="content"> 
                <img src="assets/gui_filter_custom.png" alt="gui filter custom"> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Атрибуты элемента <code>custom</code>:</p> 
              </div> 
              <div id="gui_Filter_custom_name" class="ulist"> 
               <ul> 
                <li> <p><code>name</code> − обязательный атрибут - имя условия.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Filter_custom_caption" class="ulist"> 
               <ul> 
                <li> <p><code>caption</code> − обязательный атрибут - локализованное название условия. Как правило, представляет из себя строку с префиксом <code>msg://</code> по правилам <a href="/manual.html#messageTools.loadString">MessageTools.loadString</a>().</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Filter_custom_paramClass" class="ulist"> 
               <ul> 
                <li> <p><code>paramClass</code> − Java-класс параметра условия. Если параметр отсутствует, то данный атрибут не обязателен.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Filter_custom_inExpr" class="ulist"> 
               <ul> 
                <li> <p><code>inExpr</code> − должен быть установлен в <code>true</code>, если выражение JPQL содержит условие <code>in (?)</code>. При этом пользователь будет иметь возможность ввести несколько значений параметра данного условия.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Filter_custom_join" class="ulist"> 
               <ul> 
                <li> <p><code>join</code> − необязательный атрибут для задания строки, которая будет добавлена в секцию <code>from</code> запроса источника данных. Это может потребоваться для создания условия по атрибуту связанной коллекции. Значение данного атрибута должно включать в себя предложения <code>join</code> или <code>left join</code>.</p> 
                 <div class="paragraph"> 
                  <p>Например, предположим что сущность <code>Car</code> имеет атрибут <code>repairs</code>, который представляет собой коллекцию экземпляров связанной сущности <code>Repair</code>. Тогда для фильтрации <code>Car</code> по атрибуту <code>description</code> сущности <code>Repair</code> можно написать следующее условие:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsFilter</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;custom</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">repair</span><span class="delimiter">"</span></span>
            <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://repair</span><span class="delimiter">"</span></span>
            <span class="attribute-name">paramClass</span>=<span class="string"><span class="delimiter">"</span><span class="content">java.lang.String</span><span class="delimiter">"</span></span>
            <span class="attribute-name">join</span>=<span class="string"><span class="delimiter">"</span><span class="content">join {E}.repairs cr</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        cr.description like ?
    <span class="tag">&lt;/custom&gt;</span>
<span class="tag">&lt;/filter&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>При использовании такого условия исходный запрос источника данных:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="jpql">select c from sample$Car c order by c.createTs</code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>будет трансформирован в следующий:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="jpql">select c from sample$Car c join c.repairs cr
where (cr.description like ?)
order by c.createTs</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p><code>paramWhere</code> − задает выражение на JPQL для отбора списка значений параметра условия, если параметр является связанной сущностью. См. описание одноименного <a href="/manual.html#gui_Filter_property_paramWhere">атрибута</a> элемента <code>property</code>.</p> </li> 
                <li> <p><code>paramView</code> − задает <a href="/manual.html#views">представление</a>, с которым будет загружаться список значений параметра условия, если параметр является связанной сущностью. См. описание одноименного <a href="/manual.html#gui_Filter_property_paramView">атрибута</a> элемента <code>property</code>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>filter</code>:</p> 
         </div> 
         <div id="gui_Filter_editable" class="ulist"> 
          <ul> 
           <li> <p><code>editable</code> - если значение этого атрибута равно <code>false</code>, то кнопка <strong>Фильтр</strong> скрывается.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_manualApplyRequired" class="ulist"> 
          <ul> 
           <li> <p><code>manualApplyRequired</code> − определяет, в какой момент будет применяться фильтр. Если значение атрибута равно <code>false</code>, то фильтр (пустой или по умолчанию) будет применяться сразу при открытии экрана. Это означает, что источник данных будет обновлен и связанные компоненты (например, <code>Table</code>) отобразят данные. Если значение атрибута равно <code>true</code>, то фильтр будет применяться только после нажатия на кнопку <strong>Search</strong>.</p> 
            <div class="paragraph"> 
             <p>Данный атрибут имеет приоритет над свойством приложения <a href="/manual.html#cuba.gui.genericFilterManualApplyRequired">cuba.gui.genericFilterManualApplyRequired</a>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_useMaxResults" class="ulist"> 
          <ul> 
           <li> <p><code>useMaxResults</code> − ограничивает размер страницы загружаемых в источник данных экземпляров сущности. По умолчанию <code>true</code>.</p> 
            <div class="paragraph"> 
             <p>Если значение этого атрибута равно <code>false</code>, то фильтр не будет отображать поле <strong>Show rows</strong>. Количество записей в источнике данных (и соответственно, показываемых таблицей) будет ограничено только параметром <code>MaxFetchUI</code> механизма <a href="/manual.html#entity_statistics">статистики сущностей</a>, по умолчанию - 10000.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если данный атрибут не указан, или равен <code>true</code>, то поле <strong>Show rows</strong> отображается, если у пользователя также есть специфическое разрешение <a href="/manual.html#permissions">cuba.gui.filter.maxResults</a>. Если разрешение <code>cuba.gui.filter.maxResults</code> отсутствует, то фильтр будет принудительно отбирать только первые N строк без возможности пользователя отключить это или указать другое N. Число N определяется параметрами <code>FetchUI</code>, <code>DefaultFetchUI</code>, получаемыми из механизма <a href="/manual.html#entity_statistics">статистики сущностей</a>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>На рисунке далее показан вид фильтра со значением атрибута <code>useMaxResults="true"</code>, запретом специфического разрешения <code>cuba.gui.filter.maxResults</code> и параметром <code>DefaultFetchUI=2</code></p> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_filter_useMaxRezult.png" alt="gui filter useMaxRezult"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_textMaxResults" class="ulist"> 
          <ul> 
           <li> <p><code>textMaxResults</code> - позволяет использовать текстовое поле вместо выпадающего списка в качестве поля <strong>Show rows</strong>. По умолчанию <code>false</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_folderActionsEnabled" class="ulist"> 
          <ul> 
           <li> <p><code>folderActionsEnabled</code> − при указании значения <code>false</code> позволяет скрыть следующие действия с фильтром: <strong>Сохранить как папку поиска</strong>, <strong>Сохранить как папку приложения</strong>. По умолчанию значение атрибута равно <code>true</code>, действия <strong>Сохранить как папку поиска</strong>, <strong>Сохранить как папку приложения</strong> доступны.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_applyTo" class="ulist"> 
          <ul> 
           <li> <p><code>applyTo</code> − необязательный атрибут, содержит идентификатор компонента, с которым связан фильтр. Используется в случае, когда необходимо иметь доступ к <a href="/manual.html#gui_Table_presentations">представлениям</a> связанного компонента-таблицы. Например, сохраняя фильтр как <a href="/manual.html#search_folder">папку поиска</a> или как <a href="/manual.html#application_folder">папку приложения</a>, можно указать, какое представление будет применятся при просмотре этой папки.</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_filter_apply_to.png" alt="gui filter apply to"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_caption" class="ulist"> 
          <ul> 
           <li> <p><code>caption</code> - позволяет задать заголовок панели фильтров.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_columnsCount" class="ulist"> 
          <ul> 
           <li> <p><code>columnsCount</code> - задает количество колонок с условиями для конкретного фильтра. Значение по умолчанию - 3.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_defaultMode" class="ulist"> 
          <ul> 
           <li> <p><code>defaultMode</code> - задает режим фильтра при открытии экрана. Возможные значения: <code>generic</code> и <code>fts</code>. При указании значения <code>fts</code> фильтр будет открыт в режиме полнотекстового поиска (если сущность индексируется). Значение по умолчанию - <code>generic</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_modeSwitchVisible" class="ulist"> 
          <ul> 
           <li> <p><code>modeSwitchVisible</code> - определяет видимость чек-бокса для перевода фильтра в режим полнотекстового поиска. Если полнотекстовый поиск невозможен, то чек-бокс будет невидим независимо от указаного значения. Возможные значения атрибута: <code>true</code> и <code>false</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p><strong>Методы интерфейса Filter:</strong></p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setBorderVisible()</code> - определяет видимость границы фильтра. Значение по умолчанию - <code>true</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p><strong>Слушатели компонента Filter:</strong></p> 
         </div> 
         <div id="gui_Filter_ExpandedStateChangeListener" class="ulist"> 
          <ul> 
           <li> <p><code>ExpandedStateChangeListener</code> - позволяет отслеживать изменения состояния компонета (свёрнутое/развёрнутое).</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_FilterEntityChangeListener" class="ulist"> 
          <ul> 
           <li> <p><code>FilterEntityChangeListener</code> - срабатывает при первом выборе фильтра и дальнейшем выборе сохранённых фильтров.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты filter
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Filter_applyTo">applyTo</a> - <a href="/manual.html#gui_Filter_caption">caption</a> - <a href="/manual.html#gui_Filter_columnsCount">columnsCount</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_Filter_defaultMode">defaultMode</a> - <a href="/manual.html#gui_Filter_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_Filter_folderActionsEnabled">folderActionsEnabled</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Filter_manualApplyRequired">manualApplyRequired</a> - <a href="/manual.html#gui_attr_margin">margin</a> - <a href="/manual.html#gui_Filter_modeSwitchVisible">modeSwitchVisible</a> - <a href="/manual.html#gui_attr_settingsEnabled">settingsEnabled</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_Filter_textMaxResults">textMaxResults</a> - <a href="/manual.html#gui_Filter_useMaxResults">useMaxResults</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы filter
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Filter_custom">custom</a> - <a href="/manual.html#gui_Filter_properties">properties</a> - <a href="/manual.html#gui_Filter_property">property</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты properties
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Filter_properties_exclude">exclude</a> - <a href="/manual.html#gui_Filter_properties_include">include</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты property
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Filter_property_caption">caption</a> - <a href="/manual.html#gui_Filter_property_name">name</a> - <a href="/manual.html#gui_Filter_property_paramView">paramView</a> - <a href="/manual.html#gui_Filter_property_paramWhere">paramWhere</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты custom
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Filter_custom_caption">caption</a> - <a href="/manual.html#gui_Filter_custom_name">name</a> - <a href="/manual.html#gui_Filter_custom_inExpr">inExpr</a> - <a href="/manual.html#gui_Filter_custom_join">join</a> - <a href="/manual.html#gui_Filter_custom_paramClass">paramClass</a> - <a href="/manual.html#gui_Filter_property_paramView">paramView</a> - <a href="/manual.html#gui_Filter_property_paramWhere">paramWhere</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_expanded">addExpandedStateChangeListener</a> - <a href="/manual.html#gui_Filter_FilterEntityChangeListener">addFilterEntityChangeListener</a> - <a href="/manual.html#gui_api_settings">applySettings</a> - <a href="/manual.html#gui_api_margin">getMargin</a> - <a href="/manual.html#gui_api_settings">saveSettings</a> - <a href="/manual.html#gui_api_margin">setMargin</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
         <div id="gui_Filter_permissions" class="paragraph"> 
          <p><strong>Права пользователей</strong></p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Для создания/изменения/удаления глобальных (доступных всем пользователям) фильтров пользователь должен иметь разрешение <code>cuba.gui.filter.global</code>.</p> </li> 
           <li> <p>Для создания/изменения <code>custom</code> условий пользователь должен иметь разрешение <code>cuba.gui.filter.customConditions</code>.</p> </li> 
           <li> <p>Чтобы иметь возможность изменять максимальное количество строк на странице таблицы с помощью флажка и поля <strong>Show rows</strong> пользователь должен иметь разрешение <code>cuba.gui.filter.maxResults</code>. См. также атрибут фильтра <a href="/manual.html#gui_Filter_useMaxResults">useMaxResults</a>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Информация о том, как настраивать специфические разрешения, приведена в руководстве Подсистема безопасности.</p> 
         </div> 
         <div id="gui_Filter_ext_params" class="paragraph"> 
          <p><strong>Внешние параметры для управления фильтрами</strong></p> 
         </div> 
         <div id="gui_Filter_app_properties" class="ulist"> 
          <ul> 
           <li> <p><strong>Общесистемные параметры</strong></p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Следующие свойства приложения влияют на поведение фильтров:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><a href="/manual.html#cuba.gui.genericFilterManualApplyRequired">cuba.gui.genericFilterManualApplyRequired</a> − позволяет отключить автоматическое применение фильтра (то есть загрузку данных) сразу при открытии экрана. См. также атрибут фильтра <a href="/manual.html#gui_Filter_manualApplyRequired">manualApplyRequired</a>.</p> </li> 
                <li> <p><a href="/manual.html#cuba.gui.genericFilterChecking">cuba.gui.genericFilterChecking</a> − позволяет включить проверку заполненности хотя-бы одного условия перед применением фильтра.</p> </li> 
                <li> <p><a href="/manual.html#cuba.gui.genericFilterControlsLayout">cuba.gui.genericFilterControlsLayout</a> − определяет расположение элементов внутри фильтра.</p> </li> 
                <li> <p><a href="/manual.html#cuba.allowQueryFromSelected">cuba.allowQueryFromSelected</a> позволяет отключить механизм <a href="/manual.html#gui_Filter_sequential_apply">последовательного наложения фильтров</a>.</p> </li> 
                <li> <p><a href="/manual.html#cuba.gui.genericFilterColumnsCount">cuba.gui.genericFilterColumnsCount</a> - задает количество колонок по умолчанию для размещения условий фильтра. См также атрибут фильтра <a href="/manual.html#gui_Filter_columnsCount">columnsCount</a>.</p> </li> 
                <li> <p><a href="/manual.html#cuba.gui.genericFilterConditionsLocation">cuba.gui.genericFilterConditionsLocation</a> - задает расположение панели условий.</p> </li> 
                <li> <p><a href="/manual.html#cuba.gui.genericFilterPopupListSize">cuba.gui.genericFilterPopupListSize</a> - задает количество позиций в выпадающем списке кнопки <strong>Search</strong>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_screen_parameters" class="ulist"> 
          <ul> 
           <li> <p><strong>Параметры вызова экрана</strong></p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>При вызове экрана можно указать, какой фильтр и с какими параметрами должен быть применен сразу после открытия экрана. Для этого фильтр должен быть заранее создан, сохранен в базе данных, и соответствующая запись в таблице <code>SEC_FILTER</code> должна иметь заполненное поле <code>CODE</code>. Параметры вызова экрана задаются в конфигурационном файле <code>web-menu.xml</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Чтобы сохранить фильтр в базе данных, необходимо добавить скрипт вставки фильтра в скрипт <code>30.create-db.sql</code> сущности. Для генерации скрипта найдите фильтр в справочнике <strong>Entity Inspector</strong> меню <strong>Administration</strong>, в контекстном меню выберите <strong>System Information</strong>, нажмите на кнопку <strong>Script for insert</strong> и скопируйте текст скрипта.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Теперь можно добавить скрипт к экрану. Для указания кода фильтра в экран следует передать параметр с именем, равным идентификатору компонента фильтра в данном экране. Значением параметра должен быть код фильтра, который нужно установить и применить.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Для установки значений параметров фильтра в экран нужно передать параметры с именами, равными именам параметров, и значения в виде строк.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Пример описателя пункта главного меню, устанавливающего в открываемом экране <code>sample$Car.browse</code> в компоненте <code>carsFilter</code> фильтр с кодом <code>FilterByVIN</code>, с подстановкой в параметр условия <code>component$carsFilter.vin79216</code> значения <code>TMA</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;item</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">sample$Car.browse</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">carsFilter</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">FilterByVIN</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">component$carsFilter.vin79216</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">TMA</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/item&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Следует отметить, что фильтр с установленным полем <code>CODE</code> обладает особыми свойствами:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p>Его не могут редактировать пользователи.</p> </li> 
                <li> <p>Название такого фильтра можно отображать на нескольких языках. Для этого в <a href="/manual.html#main_message_pack">главном пакете сообщений</a> приложения должна быть строка с ключом, равным коду фильтра.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Filter_sequential_apply" class="paragraph"> 
          <p><strong>Последовательное наложение фильтров</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p>При включенном свойстве приложения <a href="/manual.html#cuba.allowQueryFromSelected">cuba.allowQueryFromSelected</a> в пользовательском интерфейсе компонента можно закреплять последний примененный фильтр и текущие результаты фильтрации. После этого можно выбрать другой фильтр или параметры и применить их на уже выбранных записях.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Данный подход позволяет решить две проблемы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Декомпозировать сложные фильтры.</p> </li> 
           <li> <p>Применять фильтры на записи, отобранные с помощью папок <a href="/manual.html#application_folder">приложения</a> или <a href="/manual.html#search_folder">поиска</a>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Чтобы применить этот механизм в пользовательском интерфейсе, выберите и примените один из фильтров. Затем нажмите на кнопку настроек фильтра и выберите <strong>Pin applied (Закрепить)</strong>. Фильтр закрепится в верхней части панели фильтров. Далее можно применить к выбранным записям другой фильтр. Так последовательно можно накладывать друг на друга любое количество фильтров. Также фильтры можно удалять последовательно с помощью кнопки <span class="image"><img src="assets/gui_filter_remove.png" alt="gui_filter_remove"></span>.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_filter_sequential.png" alt="gui filter sequential"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Механизм последовательного наложения фильтров основан на возможности <a href="/manual.html#dataManager">DataManager</a> выполнять <a href="/manual.html#query_from_selected">последовательные запросы</a>.</p> 
         </div> 
         <div id="gui_Filter_params_api" class="paragraph"> 
          <p><strong>API для работы с параметрами фильтра</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p>Интерфейс <code>Filter</code> предоставляет методы для установки и чтения значений параметра фильтра из кода контроллера экрана:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setParamValue(String paramName, Object value)</code></p> </li> 
           <li> <p><code>getParamValue(String paramName)</code></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p><code>paramName</code> - имя параметра фильтра. Имя параметра фильтра является составной частью имени компонента, отображающего значение параметра фильтра. Как получить имя компонента рассматривалось <a href="/manual.html#gui_Filter_parameter_component_name">выше</a>. Имя параметра - это часть имени компонента, находящаяся после последней точки. Например, если имя компонента <code>component$filter.model_manufacturer90062</code>, то имя параметра фильтра <code>model_manufacturer90062</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Обратите внимание, что в методе <a href="/manual.html#abstractFrame">init()</a> контроллера экрана данные методы использовать нельзя, т.к. в этот момент фильтр еще не проинициализирован. Вы можете работать с параметрами фильтра в методе <a href="/manual.html#abstractWindow">ready()</a>.</p> 
         </div> 
         <div id="gui_Filter_fts" class="paragraph"> 
          <p><strong>Режим полнотекстового поиска в фильтре</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p>Если источник данных фильтра содержит сущности, индексируемые системой полнотекстового поиска (см. <a href="https://doc.cuba-platform.com/fts-6.7-ru" target="_blank">Платформа CUBA. Полнотекстовый поиск</a>), то в фильтре становится доступным режим полнотекстового поиска. Чтобы переключиться в него, используйте флажок <strong>Full-Text Search</strong> ("Полнотекстовый поиск").</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_filter_fts.png" alt="gui filter fts"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В этом режиме фильтр имеет всего одно поле для задание критериев поиска, и поиск производится по индексируемым подсистемой FTS полям сущности.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Если таблица указана в атрибуте <a href="/manual.html#gui_Filter_applyTo">applyTo</a>, то при наведении указателя мыши на строку таблицы во всплывающем окне будет написано, в каких полях сущности было найдено условие поиска.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Для скрытия переключателя режима фильтра установите значение <code>false</code> атрибуту фильтра <a href="/manual.html#gui_Filter_modeSwitchVisible">modeSwitchVisible</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Если необходимо, чтобы фильтр по умолчанию открывался в режиме полнотекстового поиска, установите значение <code>fts</code> атрибуту <a href="/manual.html#gui_Filter_defaultMode">defaultMode</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Полнотекстовый поиск может использоваться совместно с любым количеством условий универсального фильтра:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/book_publication_fts_filter.png" alt="book publication fts filter"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Выбрать условие <strong>FTS condition</strong> можно в окне выбора условий фильтра.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_GroupTable"><a class="anchor" href="/manual.html#gui_GroupTable"></a>5.5.2.1.17. GroupTable</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=group-table" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>GroupTable</code> - это таблица с возможностью динамической группировки по любому полю. Для того чтобы сгруппировать таблицу по какой-либо колонке, нужно в заголовке таблицы перетащить эту колонку в позицию слева от элемента <span class="image"><img src="assets/gui_groupTableIcon.png" alt="gui_groupTableIcon"></span>. Сгруппированные значения можно разворачивать и сворачивать с помощью кнопок <span class="image"><img src="assets/gui_groupBox_plus.png" alt="gui_groupBox_plus"></span>/<span class="image"><img src="assets/gui_groupBox_minus.png" alt="gui_groupBox_minus"></span>.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_groupTableDragColumn.png" alt="gui groupTableDragColumn"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>groupTable</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован только для блока <strong>Web Client</strong>. В <strong>Desktop Client</strong> ведет себя как обычная таблица.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Для <code>GroupTable</code> в атрибуте <code>datasource</code> элемента <code>rows</code> должен быть указан <a href="/manual.html#datasources">groupDatasource</a>. В противном случае группировка работать не будет.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;groupDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span>
                     <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderWithCustomer</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>
            select o from sales$Order o order by o.date
        <span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/groupDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;groupTable</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersTable</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;columns&gt;</span>
            <span class="tag">&lt;group&gt;</span>
                <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/group&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer.name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/columns&gt;</span>
        <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/groupTable&gt;</span></code></pre> 
          </div> 
         </div> 
         <div id="gui_GroupTable_group" class="paragraph"> 
          <p><code>group</code> − необязательный элемент, может в единственном экземпляре находиться внутри <a href="/manual.html#gui_Table_columns">columns</a>. Содержит набор элементов <code>column</code>, по которым будет выполняться первоначальная группировка при открытии экрана.</p> 
         </div> 
         <div id="gui_GroupTable_groupAllowed" class="paragraph"> 
          <p>Элемент <code>column</code> может содержать атрибут <code>groupAllowed</code> с булевым значением. С помощью этого атрибута можно запретить пользователю группировать таблицу по данной колонке.</p> 
         </div> 
         <div id="gui_GroupTable_showTotalAggregation" class="paragraph"> 
          <p>При включенном атрибуте <code>aggregatable</code> таблица отображает результаты агрегации по всем строкам в дополнительной строке вверху, а также результаты агрегации по группам. Отображение агрегации по всем строкам можно отключить, установив <code>false</code> в атрибуте <code>showTotalAggregation</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>При включенном атрибуте <code>multiselect</code> клик по строке группировки с зажатой клавишей <strong>Ctrl</strong> разворачивает группу (если была свёрнута) и применяет выделение ко всем строкам этой группы. При этом, если вся группа выделена, <strong>Ctrl+click</strong> не снимает выделение со всей группы. Вы по-прежнему можете снять выделение с отдельных строк, пользуясь стандартным поведением клавиши <strong>Ctrl</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В остальном функциональность <code>GroupTable</code> аналогична простой таблице <a href="/manual.html#gui_Table">Table</a>.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты groupTable
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_Table_aggregatable">aggregatable</a> - <a href="/manual.html#gui_Table_aggregationStyle">aggregationStyle</a> - <a href="/manual.html#gui_Table_columnControlVisible">columnControlVisible</a> - <a href="/manual.html#gui_Table_allowPopupMenu">contextMenuEnabled</a> - <a href="/manual.html#gui_Table_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Table_multiLineCells">multiLineCells</a> - <a href="/manual.html#gui_Table_multiselect">multiselect</a> - <a href="/manual.html#gui_Table_presentations">presentations</a> - <a href="/manual.html#gui_Table_reorderingAllowed">reorderingAllowed</a> - <a href="/manual.html#gui_attr_settingsEnabled">settingsEnabled</a> - <a href="/manual.html#gui_GroupTable_showTotalAggregation">showTotalAggregation</a> - <a href="/manual.html#gui_Table_sortable">sortable</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_textSelectionEnabled">textSelectionEnabled</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы groupTable
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_actions">actions</a> - <a href="/manual.html#gui_Table_buttonsPanel">buttonsPanel</a> - <a href="/manual.html#gui_Table_columns">columns</a> - <a href="/manual.html#gui_Table_rows">rows</a> - <a href="/manual.html#gui_Table_rowsCount">rowsCount</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы columns
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_columns">column</a> - <a href="/manual.html#gui_GroupTable_group">group</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты 
            <a href="/manual.html#gui_Table_columns">column</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_column_align">align</a> - <a href="/manual.html#gui_Table_column_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_Table_column_collapsed">collapsed</a> - <a href="/manual.html#gui_DateField_dateFormat">dateFormat</a> - <a href="/manual.html#gui_Table_column_editable">editable</a> - <a href="/manual.html#gui_GroupTable_groupAllowed">groupAllowed</a> - <a href="/manual.html#gui_Table_column_id">id</a> - <a href="/manual.html#gui_Table_column_link">link</a> - <a href="/manual.html#gui_Table_column_linkInvoke">linkInvoke</a> - <a href="/manual.html#gui_Table_column_linkScreen">linkScreen</a> - <a href="/manual.html#gui_Table_column_linkScreenOpenType">linkScreenOpenType</a> - <a href="/manual.html#gui_Table_column_maxTextLength">maxTextLength</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_DateField_resolution">resolution</a> - <a href="/manual.html#gui_Table_column_sortable">sortable</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_Table_column_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы 
            <a href="/manual.html#gui_Table_columns">column</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_column_aggregation">aggregation</a> - <a href="/manual.html#gui_formatter">formatter</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты 
            <a href="/manual.html#gui_Table_rows">rows</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_datasource">datasource</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_ColumnCollapseListener">addColumnCollapseListener</a> - <a href="/manual.html#gui_Table_CellClickListener">setClickListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Image"><a class="anchor" href="/manual.html#gui_Image"></a>5.5.2.1.18. Image</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=url-image" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>Image</code> предназначен для отображения графического содержимого из различных источников. Компонент можно привязать к источнику данных или сконфигурировать программно.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML имя компонента: <code>image</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>Image</code> может отображать значение атрибута сущности с типом <code>FileDescriptor</code> или <code>byte[]</code>. Для этого используются атрибуты <code>datasource</code> и <code>property</code>, например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">image</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">employeeDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">avatar</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В данном случае компонент отображает атрибут <code>avatar</code> сущности <code>Employee</code>, находящейся в источнике данных <code>employeeDs</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Помимо источников данных, компонент <code>Image</code> может использовать в качестве источника содержимого различные типы ресурсов. Тип ресурса можно указать декларативно с помощью элементов <code>image</code>, перечисленных ниже:</p> 
         </div> 
         <div id="gui_Image_classpath" class="ulist"> 
          <ul> 
           <li> <p><code>classpath</code> - ресурс, расположенный в classpath.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;classpath</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">com/company/sample/web/screens/myPic.jpg</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/image&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_file" class="ulist"> 
          <ul> 
           <li> <p><code>file</code> - файл с изображением.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">D:\sample\modules\web\web\VAADIN\images\myImage.jpg</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/image&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_relativePath" class="ulist"> 
          <ul> 
           <li> <p><code>relativePath</code> - относительный путь к файлу в каталоге приложения.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;relativePath</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">VAADIN/images/myImage.jpg</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/image&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_theme" class="ulist"> 
          <ul> 
           <li> <p><code>theme</code> - ресурс из <a href="/manual.html#web_theme">темы</a> приложения, например: <code>VAADIN/themes/customTheme/some/path/image.png</code>.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;theme</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample/myPic.jpg</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/image&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_url" class="ulist"> 
          <ul> 
           <li> <p><code>url</code> - ресурс, загружаемый по URL.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;url</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">"</span><span class="content">https://www.cuba-platform.com/sites/all/themes/cuba_adaptive/img/lori.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/image&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>image</code>:</p> 
         </div> 
         <div id="gui_Image_scaleMode" class="ulist"> 
          <ul> 
           <li> <p><code>scaleMode</code> - устанавливает режим масштабирования изображения. Доступны следующие режимы:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>FILL</code> - изображение масштабируется, чтобы заполнить всю область компонента: используется вся ширина и высота компонента.</p> </li> 
                <li> <p><code>CONTAIN</code> - изображение подстраивается под размер компонента с сохранением пропорций, уменьшаясь или растягиваясь по меньшей стороне компонента.</p> </li> 
                <li> <p><code>SCALE_DOWN</code> - изображение изменяет размер, сравнивая разницу между <code>NONE</code> и <code>CONTAIN</code>, для того, чтобы найти наименьший конкретный размер объекта.</p> </li> 
                <li> <p><code>NONE</code> - изображение сохранит свой исходный размер, размер компонента будет равен размеру изображения.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_alternateText" class="ulist"> 
          <ul> 
           <li> <p><code>alternateText</code> - устанавливает альтернативный текст на случай, если ресурс недоступен или не задан.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">image</span><span class="delimiter">"</span></span> <span class="attribute-name">alternateText</span>=<span class="string"><span class="delimiter">"</span><span class="content">logo</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Параметры ресурсов <code>image</code>:</p> 
         </div> 
         <div id="gui_Image_bufferSize" class="ulist"> 
          <ul> 
           <li> <p><code>bufferSize</code> - размер буфера, используемого для загрузки этого ресурса, в байтах.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;file</span> <span class="attribute-name">bufferSize</span>=<span class="string"><span class="delimiter">"</span><span class="content">1024</span><span class="delimiter">"</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">C:/img.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/image&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_cacheTime" class="ulist"> 
          <ul> 
           <li> <p><code>cacheTime</code> - время хранения объекта в кэше в миллисекундах.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;file</span> <span class="attribute-name">cacheTime</span>=<span class="string"><span class="delimiter">"</span><span class="content">2400</span><span class="delimiter">"</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">"</span><span class="content">C:/img.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/image&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_mimeType" class="ulist"> 
          <ul> 
           <li> <p><code>mimeType</code> - MIME-тип ресурса.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;image&gt;</span>
    <span class="tag">&lt;url</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">"</span><span class="content">https://avatars3.githubusercontent.com/u/17548514?v=4</span><span class="entity">&amp;#38;</span><span class="content">s=200</span><span class="delimiter">"</span></span>
         <span class="attribute-name">mimeType</span>=<span class="string"><span class="delimiter">"</span><span class="content">image/png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/image&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Методы интерфейса <code>Image</code>:</p> 
         </div> 
         <div id="gui_Image_setDatasource" class="ulist"> 
          <ul> 
           <li> <p><code>setDatasource()</code> - устанавливает для изображения источник данных и его атрибут. Поддерживаются только атрибуты типов <code>FileDescriptor</code> и <code>byte[]</code>.</p> 
            <div class="paragraph"> 
             <p>Программное указание источника данных позволяет, к примеру, отображать изображения в ячейках таблицы:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">frameworksTable.addGeneratedColumn(<span class="string"><span class="delimiter">"</span><span class="content">image</span><span class="delimiter">"</span></span>, entity -&gt; {
    <span class="predefined-type">Image</span> image = componentsFactory.createComponent(<span class="predefined-type">Image</span>.class);
    image.setDatasource(frameworksTable.getItemDatasource(entity), <span class="string"><span class="delimiter">"</span><span class="content">image</span><span class="delimiter">"</span></span>);
    image.setHeight(<span class="string"><span class="delimiter">"</span><span class="content">100px</span><span class="delimiter">"</span></span>);
    <span class="keyword">return</span> image;
});</code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_Image_1.png" alt="gui Image 1"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_setSource" class="ulist"> 
          <ul> 
           <li> <p><code>setSource()</code> - устанавливает источник изображения. Метод принимает тип ресурса и возвращает объект ресурса, который может быть сконфигурирован далее. Для каждого типа ресурсов есть свои методы, например, <code>setPath()</code> для <code>ThemeResource</code> или <code>setStreamSupplier()</code> для <code>StreamResource</code>:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Image</span> image = componentsFactory.createComponent(<span class="predefined-type">Image</span>.class);

image.setSource(ThemeResource.class)
        .setPath(<span class="string"><span class="delimiter">"</span><span class="content">images/image.png</span><span class="delimiter">"</span></span>);</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>или</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">image.setSource(StreamResource.class)
        .setStreamSupplier(() -&gt; <span class="keyword">new</span> FileDataProvider(fileDescriptor).provide())
        .setBufferSize(<span class="integer">1024</span>);</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Можно использовать следующие типы ресурсов, реализующие интерфейс <code>Resource</code>, или расширить их:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>ClasspathResource</code> - для изображений, хранимых в classpath. Этот ресурс также можно использовать декларативно с помощью элемента <code>classpath</code> компонента <code>image</code>.</p> </li> 
                <li> <p><code>FileDescriptorResource</code> - для изображений, получаемых из <code>FileStorage</code>.</p> </li> 
                <li> <p><code>FileResource</code> - для изображений, хранимых в файловой системе. Этот ресурс также можно использовать декларативно с помощью элемента <code>file</code> компонента <code>image</code>.</p> </li> 
                <li> <p><code>RelativePathResource</code> - для изображений, хранимых в каталоге приложения. Этот ресурс также можно использовать декларативно с помощью элемента <code>relativePath</code> компонента <code>image</code>.</p> </li> 
                <li> <p><code>StreamResource</code> - для изображений, получаемых из потока.</p> </li> 
                <li> <p><code>ThemeResource</code> - для изображений темы, например, <code>VAADIN/themes/yourtheme/some/path/image.png</code>. Этот ресурс также можно использовать декларативно с помощью элемента <code>theme</code> компонента <code>image</code>.</p> </li> 
                <li> <p><code>UrlResource</code> - для изображений, загружаемых по указанному URL. Этот ресурс также можно использовать декларативно с помощью элемента <code>url</code> компонента <code>image</code>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_createResource" class="ulist"> 
          <ul> 
           <li> <p><code>createResource()</code> - создаёт ресурс изображения указанного типа. Созданный объект может быть позже передан в метод <code>setSource()</code>.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">FileDescriptorResource resource = image.createResource(FileDescriptorResource.class)
        .setFileDescriptor(avatar);
image.setSource(resource);</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Image_SourceChangeListener" class="ulist"> 
          <ul> 
           <li> <p><code>addSourceChangeListener()</code> - добавляет слушатель для отслеживания изменений источника изображения.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты image
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_Image_alternateText">alternateText</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_colspan">colspan</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_responsive">responsive</a> - <a href="/manual.html#gui_attr_rowspan">rowspan</a> - <a href="/manual.html#gui_Image_scaleMode">scaleMode</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты ресурсов image
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Image_bufferSize">bufferSize</a> - <a href="/manual.html#gui_Image_cacheTime">cacheTime</a> - <a href="/manual.html#gui_Image_mimeType">mimeType</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы image
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Image_classpath">classpath</a> - <a href="/manual.html#gui_Image_file">file</a> - <a href="/manual.html#gui_Image_relativePath">relativePath</a> - <a href="/manual.html#gui_Image_theme">theme</a> - <a href="/manual.html#gui_Image_url">url</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Image_SourceChangeListener">addSourceChangeListener</a> - <a href="/manual.html#gui_Image_createResource">createResource</a> - <a href="/manual.html#gui_Image_scaleMode">setScaleMode</a> - <a href="/manual.html#gui_Image_setDatasource">setDatasource</a> - <a href="/manual.html#gui_Image_setSource">setSource</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Label"><a class="anchor" href="/manual.html#gui_Label"></a>5.5.2.1.19. Label</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-label" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Надпись (<code>Label</code>) − текстовый компонент, отображающий статический текст либо значение атрибута сущности.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>label</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>Label</code> реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример задания надписи с текстом, взятым из <a href="/manual.html#message_packs">пакета локализованных сообщений</a>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://orders</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div id="gui_Label_value" class="paragraph"> 
          <p>Атрибут <code>value</code> предназначен для задания текста надписи.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В веб клиенте текст, содержащийся в атрибуте <code>value</code>, будет разбит на несколько строк, если по длине он превысит значение атрибута <a href="/manual.html#gui_attr_width">width</a>. Поэтому для отображения многострочной надписи, достаточно указать абсолютное значение атрибута <a href="/manual.html#gui_attr_width">width</a>. Если текст надписи слишком длинный, а значение атрибута <a href="/manual.html#gui_attr_width">width</a> не определено, то текст будет урезан.</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Label, which should be split into multiple lines</span><span class="delimiter">"</span></span>
       <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">200px</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Параметры надписи можно задать в контроллере экрана. Для этого необходимо задать компоненту идентификатор, по которому получить ссылку на него в контроллере:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;label</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">dynamicLabel</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> <span class="predefined-type">Label</span> dynamicLabel;

<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    dynamicLabel.setValue(<span class="string"><span class="delimiter">"</span><span class="content">Some value</span><span class="delimiter">"</span></span>);
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>Label</code> может отображать значение атрибута сущности. Для этого используются атрибуты <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>. Например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Customer</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;label</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В данном случае компонент отображает атрибут <code>name</code> сущности <code>Customer</code>, находящейся в источнике данных <code>customerDs</code>.</p> 
         </div> 
         <div id="gui_Label_htmlEnabled" class="paragraph"> 
          <p>Атрибут <code>htmlEnabled</code> указывает, каким образом будет рассматриваться значение атрибута <a href="/manual.html#gui_Label_value">value</a>: при <code>htmlEnabled="true"</code> как HTML-код, иначе как строка. Обратите внимание, что не все HTML-теги поддерживаются в десктоп-реализации экрана.</p> 
         </div> 
         <div id="gui_Label_stylenames" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Стили компонента Label
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>В веб-клиенте с темой, основанной на Halo, к компоненту <code>Label</code> можно применить заданные <a href="/manual.html#gui_Label_stylenames">стили</a>. Стили задаются в XML-дексрипторе или контроллере экрана с помощью атрибута <code>stylename</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Label to be styled</span><span class="delimiter">"</span></span>
       <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">colored</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Чтобы применить стиль программно, выберите одну из констант класса <code>HaloTheme</code> с префиксом компонента <code>LABEL_</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">label.setStyleName(HaloTheme.LABEL_COLORED);</code></pre> 
               </div> 
              </div> 
              <div id="gui_label_bold" class="ulist"> 
               <ul> 
                <li> <p><code>bold</code> - жирный шрифт. Подходит для выделения важных текстовых элементов UI.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_colored" class="ulist"> 
               <ul> 
                <li> <p><code>colored</code> - цветной текст.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_failure" class="ulist"> 
               <ul> 
                <li> <p><code>failure</code> - стиль сообщения об ошибке. Добавляет рамку вокруг компонента и пиктограмму рядом с текстом. Используется как уведомление рядом с другим компонентом.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_h1" class="ulist"> 
               <ul> 
                <li> <p><code>h1</code> - стиль основных заголовков приложения.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_h2" class="ulist"> 
               <ul> 
                <li> <p><code>h2</code> - стиль заголовков разделов приложения.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_h3" class="ulist"> 
               <ul> 
                <li> <p><code>h3</code> - стиль подзаголовков.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_h4" class="ulist"> 
               <ul> 
                <li> <p><code>h4</code> - стиль подзаголовков.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_light" class="ulist"> 
               <ul> 
                <li> <p><code>light</code> - облегченный шрифт. Подходит для выделения второстепенных текстовых элементов UI.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_no-margin" class="ulist"> 
               <ul> 
                <li> <p><code>no-margin</code> - убирает отступы заголовков.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_spinner" class="ulist"> 
               <ul> 
                <li> <p><code>spinner</code> - стиль спиннера. Используйте для пустых компонентов <code>Label</code>, чтобы создать спиннер.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_label_success" class="ulist"> 
               <ul> 
                <li> <p><code>success</code> - стиль сообщения об успешном выполнении. Добавляет рамку вокруг компонента и пиктограмму рядом с текстом. Используется как уведомление рядом с другим компонентом.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты label
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_Label_htmlEnabled">htmlEnabled</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_Label_value">value</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы label
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_formatter">formatter</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили label
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_label_bold">bold</a> - <a href="/manual.html#gui_label_colored">colored</a> - <a href="/manual.html#gui_label_failure">failure</a> - <a href="/manual.html#gui_label_h1">h1</a> - <a href="/manual.html#gui_label_h2">h2</a> - <a href="/manual.html#gui_label_h3">h3</a> - <a href="/manual.html#gui_label_h4">h4</a> - <a href="/manual.html#gui_attr_stylename_huge">huge</a> - <a href="/manual.html#gui_attr_stylename_large">large</a> - <a href="/manual.html#gui_label_light">light</a> - <a href="/manual.html#gui_label_no-margin">no-margin</a> - <a href="/manual.html#gui_attr_stylename_small">small</a> - <a href="/manual.html#gui_label_spinner">spinner</a> - <a href="/manual.html#gui_label_success">success</a> - <a href="/manual.html#gui_attr_stylename_tiny">tiny</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Link"><a class="anchor" href="/manual.html#gui_Link"></a>5.5.2.1.20. Link</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-link" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Ссылка (<code>Link</code>) − компонент-гиперссылка, позволяющая открывать внешние веб-ресурсы единообразно для веб и десктоп клиента.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>link</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример XML-описания компонента <code>link</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;link</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Link</span><span class="delimiter">"</span></span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">"</span><span class="content">https://www.cuba-platform.com</span><span class="delimiter">"</span></span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">"</span><span class="content">_blank</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>link</code>:</p> 
         </div> 
         <div id="gui_Link_url" class="ulist"> 
          <ul> 
           <li> <p><code>url</code> - адрес ресурса.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Link_target" class="ulist"> 
          <ul> 
           <li> <p><code>target</code> - для веб клиента задает способ открытия страницы, аналогичен атрибуту <code>target</code> HTML-тега <code>&lt;a&gt;</code>.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты link
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_Link_url">url</a> - <a href="/manual.html#gui_Link_target">target</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_LinkButton"><a class="anchor" href="/manual.html#gui_LinkButton"></a>5.5.2.1.21. LinkButton</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=link-button" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопка-ссылка (<code>LinkButton</code>) − кнопка, выглядящая как гиперссылка.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>linkButton</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент кнопки-ссылки реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопка-ссылка может содержать текст или пиктограмму (или и то и другое). На рисунке ниже отражены разные виды кнопок.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_linkButtonTypes.png" alt="gui linkButtonTypes"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопка-ссылка отличается от обычной кнопки <code>Button</code> только своим внешним видом. Все свойства и поведение идентичны описанным для <a href="/manual.html#gui_Button">Button</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример XML-описания кнопки-ссылки, вызывающей метод <code>someMethod()</code> контроллера, с надписью (атрибут <a href="/manual.html#gui_attr_caption">caption</a>), всплывающей подсказкой (атрибут <a href="/manual.html#gui_attr_description">description</a>) и пиктограммой (атрибут <a href="/manual.html#gui_attr_icon">icon</a>):</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;linkButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">linkButton</span><span class="delimiter">"</span></span>
            <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://linkButton</span><span class="delimiter">"</span></span>
            <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">Press me</span><span class="delimiter">"</span></span>
            <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">icons/save.png</span><span class="delimiter">"</span></span>
            <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">someMethod</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты linkButton
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Button_action">action</a> - <a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Button_invoke">invoke</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_LookupField"><a class="anchor" href="/manual.html#gui_LookupField"></a>5.5.2.1.22. LookupField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-lookupfield" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент для выбора значения из выпадающего списка. Выпадающий список реализует фильтрацию значений по мере ввода пользователя и постраничный вывод доступных значений.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_lookupField.png" alt="gui lookupField"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>lookupField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент LookupField реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Простейший вариант использования <code>LookupField</code> - выбор значения перечисления (<code>enum</code>) для атрибута сущности. Например, сущность <code>Role</code> имеет атрибут <code>type</code> типа <code>RoleType</code>, который является перечислением. Тогда для редактирования этого атрибута можно использовать <code>LookupField</code> следующим образом:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">roleDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.security.entity.Role</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">roleDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Как видно из примера, в экране описывается <a href="/manual.html#datasources">источник данных</a> <code>roleDs</code> для сущности <code>Role</code>. В компоненте <code>lookupField</code> в атрибуте <a href="/manual.html#gui_attr_datasource">datasource</a> указывается ссылка на источник данных, а в атрибуте <a href="/manual.html#gui_attr_property">property</a> − название атрибута сущности, значение которого должно быть отображено. В данном случае атрибут является перечислением, и в выпадающем списке будут отображены <a href="/manual.html#enum_localization">локализованные названия</a> всех значений этого перечисления.</p> 
            </div> </li> 
           <li> <p>Аналогично можно использовать <code>LookupField</code> для выбора экземпляра связанной сущности. Для формирования списка опций используется атрибут <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Car</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Colour</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>select c from sample$Colour c<span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В данном случае компонент отобразит отобразит <a href="/manual.html#namePattern_annotation">имена экземпляров</a> сущности <code>Colour</code>, находящихся в источнике данных <code>colorsDs</code>, а выбранное значение подставится в атрибут <code>colour</code> сущности <code>Car</code>, находящейся в источнике данных <code>carDs</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>С помощью атрибута <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> можно указать, какой атрибут сущности использовать вместо имени экземпляра для строковых названий опций.</p> 
            </div> </li> 
           <li> <p>Список опций компонента может быть задан произвольно с помощью методов <code>setOptionsList()</code>, <code>setOptionsMap()</code> и <code>setOptionsEnum()</code>, либо с помощью XML-атрибута <code>optionsDatasource</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_LookupField_setOptionsList" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>setOptionsList()</code> позволяет программно задать список опций компонента. Для этого объявляем компонент в XML-дескрипторе:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;lookupField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">numberOfSeatsField</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">modelDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">numberOfSeats</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Затем инжектируем компонент в контроллер и в методе <code>init()</code> задаем ему список опций:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> LookupField numberOfSeatsField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    list.add(<span class="integer">2</span>);
    list.add(<span class="integer">4</span>);
    list.add(<span class="integer">5</span>);
    list.add(<span class="integer">7</span>);
    numberOfSeatsField.setOptionsList(list);
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В выпадающем списке компонента отобразятся числа 2, 4, 5, 7. Выбранное число подставится в атрибут <code>numberOfSeats</code> сущности, находящейся в источнике данных <code>modelDs</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_LookupField_setOptionsMap" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>setOptionsMap()</code> позволяет задать строковые названия и значения опций по отдельности. Например, для описанного в XML-дескрипторе компонента <code>numberOfSeatsField</code> в методе <code>init()</code> контроллера задаем мэп опций:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> LookupField numberOfSeatsField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; map = <span class="keyword">new</span> <span class="predefined-type">LinkedHashMap</span>&lt;&gt;();
    map.put(<span class="string"><span class="delimiter">"</span><span class="content">two</span><span class="delimiter">"</span></span>, <span class="integer">2</span>);
    map.put(<span class="string"><span class="delimiter">"</span><span class="content">four</span><span class="delimiter">"</span></span>, <span class="integer">4</span>);
    map.put(<span class="string"><span class="delimiter">"</span><span class="content">five</span><span class="delimiter">"</span></span>, <span class="integer">5</span>);
    map.put(<span class="string"><span class="delimiter">"</span><span class="content">seven</span><span class="delimiter">"</span></span>, <span class="integer">7</span>);
    numberOfSeatsField.setOptionsMap(map);
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В выпадающем списке компонента отобразятся строки <code><strong>two</strong></code>, <code><strong>four</strong></code>, <code><strong>five</strong></code>, <code><strong>seven</strong></code>. Однако значением компонента будет число, соответствующее выбранной строке. Оно и подставится в атрибут <code>numberOfSeats</code> сущности, находящейся в источнике данных <code>modelDs</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_LookupField_setOptionsEnum" class="ulist"> 
          <ul> 
           <li> <p><code>setOptionsEnum()</code> принимает в качестве параметра класс перечисления. Выпадающий список будет содержать локализованные названия значений перечисления, значением компонента будет являться выбранное значение перечисления.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_LookupField_iconProvider" class="ulist"> 
          <ul> 
           <li> <p>Каждый элемент выпадающего списка может иметь пиктограмму слева. Создайте реализацию интерфейса <code>LookupField.OptionIconProvider</code> в контроллере экрана и установите ее для компонента <code>lookupField</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">lookupField.setOptionIconProvider(<span class="keyword">new</span> LookupField.OptionIconProvider&lt;Customer&gt;(){
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getItemIcon(Customer c){
        <span class="keyword">if</span>(c.getType()== LegalStatus.LEGAL)
            <span class="keyword">return</span><span class="string"><span class="delimiter">"</span><span class="content">icons/icon-office.png</span><span class="delimiter">"</span></span>;
        <span class="keyword">return</span><span class="string"><span class="delimiter">"</span><span class="content">icons/icon-user.png</span><span class="delimiter">"</span></span>;
    }
});</code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_lookupField_2.png" alt="gui lookupField 2"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_LookupField_filterMode" class="ulist"> 
          <ul> 
           <li> <p>С помощью атрибута <code>filterMode</code> можно задать тип фильтрации опций при вводе пользователя:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>NO</code> − нет фильтрации.</p> </li> 
              <li> <p><code>STARTS_WITH</code> − по началу фразы.</p> </li> 
              <li> <p><code>CONTAINS</code> − по любому вхождению (используется по умолчанию).</p> </li> 
             </ul> 
            </div> </li> 
           <li> <p>Если у компонента <code>LookupField</code> не установлен атрибут <a href="/manual.html#gui_attr_required">required</a>, и если связанный атрибут сущности не объявлен как обязательный, то в списке опций компонента присутствует пустая строка, при выборе которой компонент возвращает значение <code>null</code>. Атрибут <a href="/manual.html#gui_attr_nullName">nullName</a> позволяет задать строку, отображаемую в этом случае вместо пустой. Пример использования:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span> <span class="attribute-name">nullName</span>=<span class="string"><span class="delimiter">"</span><span class="content">(none)</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В данном случае вместо пустой строки отобразится строка <code>(none)</code>, при выборе которой в связанный атрибут сущности подставится значение <code>null</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>При программном задании списка опций методом <code>setOptionsList()</code> можно одну из опций передать в метод <code>setNullOption()</code>. Тогда при ее выборе пользователем значением компонента будет <code>null</code>.</p> 
            </div> </li> 
           <li> <p>Компонент <code>LookupField</code> способен обрабатывать ввод пользователя при отсутствии подходящей опции в списке. Для этого используются методы <code>setNewOptionAllowed()</code> и <code>setNewOptionHandler()</code>. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> LookupField colourField;

<span class="annotation">@Inject</span>
<span class="directive">protected</span> CollectionDatasource&lt;Colour, <span class="predefined-type">UUID</span>&gt; coloursDs;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    colourField.setNewOptionAllowed(<span class="predefined-constant">true</span>);
    colourField.setNewOptionHandler(<span class="keyword">new</span> LookupField.NewOptionHandler() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> addNewOption(<span class="predefined-type">String</span> caption) {
            Colour colour = <span class="keyword">new</span> Colour();
            colour.setName(caption);
            coloursDs.addItem(colour);
            colourField.setValue(colour);
        }
    });
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Обработчик <code>NewOptionHandler</code> вызывается, если пользователь ввел некоторое значение, не совпадающее ни с одной из опций, и нажал <strong>Enter</strong>. В данном случае в обработчике создается новый экземпляр сущности <code>Colour</code>, его атрибут <code>name</code> устанавливается в значение, введенное пользователем, этот экземпляр добавляется в источник данных опций и выбирается в компоненте.</p> 
            </div> 
            <div id="gui_LookupField_newOptionHandler" class="paragraph"> 
             <p>Вместо имплементации интерфейса <code>LookupField.NewOptionHandler</code> для обработки ввода пользователя можно использовать XML-атрибут <code>newOptionHandler</code> с указанным в нем методом контроллера. Данный метод должен иметь два параметра - первый типа <code>LookupField</code>, второй типа <code>String</code>. В них будут переданы соответственно экзампляр компонента и введенное пользователем значение. Атрибут <code>newOptionAllowed</code> используется вместо метода <code>setNewOptionAllowed()</code> для того, чтобы разрешить добавление новых опций.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_LookupField_nullOptionVisible" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>nullOptionVisible</code> устанавливает видимость элемента со значением null в списке опций. Может работать только если атрибут <a href="/manual.html#gui_attr_required">required</a> имеет значение <code>false</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_LookupField_textInputAllowed" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>textInputAllowed</code> используется для отключения возможности фильтрации опций с клавиатуры. Это бывает удобно для коротких списков. Значение по умолчанию - <code>true</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_LookupField_pageLength" class="ulist"> 
          <ul> 
           <li> <p>XML-атрибут <code>pageLength</code> позволяет переопределить количество опций на одной странице выпадающего списка, заданное свойством приложения <a href="/manual.html#cuba.gui.lookupFieldPageLength">cuba.gui.lookupFieldPageLength</a>.</p> </li> 
           <li> <p>В веб-клиенте с темой, основанной на Halo, к компоненту <code>LookupField</code> можно применить предопределенные стили. Стили задаются в XML-дексрипторе или контроллере экрана с помощью атрибута <code>stylename</code>:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;lookupField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">lookupField</span><span class="delimiter">"</span></span>
             <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">borderless</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Чтобы применить стиль программно, выберите одну из констант класса <code>HaloTheme</code> с префиксом компонента <code>LOOKUPFIELD_</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">lookupField.setStyleName(HaloTheme.LOOKUPFIELD_BORDERLESS);</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Стили компонента LookupField:</p> 
              </div> 
              <div id="gui_LookupField_align-center" class="ulist"> 
               <ul> 
                <li> <p><code>align-center</code> - align the text inside the field to center.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_LookupField_align-right" class="ulist"> 
               <ul> 
                <li> <p><code>align-right</code> - align the text inside the field to the right.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_LookupField_borderless" class="ulist"> 
               <ul> 
                <li> <p><code>borderless</code> - removes the border and background from the text field.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты lookupField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_LookupField_filterMode">filterMode</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_inputPrompt">inputPrompt</a> - <a href="/manual.html#gui_LookupField_newOptionHandler">newOptionAllowed</a> - <a href="/manual.html#gui_LookupField_newOptionHandler">newOptionHandler</a> - <a href="/manual.html#gui_attr_nullName">nullName</a> - <a href="/manual.html#gui_LookupField_nullOptionVisible">nullOptionVisible</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_LookupField_pageLength">pageLength</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_LookupField_textInputAllowed">textInputAllowed</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы lookupField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили lookupField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_LookupField_align-right">align-right</a> - <a href="/manual.html#gui_LookupField_align-center">align-center</a> - <a href="/manual.html#gui_LookupField_borderless">borderless</a> - <a href="/manual.html#gui_attr_stylename_huge">huge</a> - <a href="/manual.html#gui_attr_stylename_large">large</a> - <a href="/manual.html#gui_attr_stylename_small">small</a> - <a href="/manual.html#gui_attr_stylename_tiny">tiny</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a> - <a href="/manual.html#gui_LookupField_setOptionsEnum">setOptionsEnum</a> - <a href="/manual.html#gui_LookupField_setOptionsList">setOptionsList</a> - <a href="/manual.html#gui_LookupField_setOptionsMap">setOptionsMap</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_LookupPickerField"><a class="anchor" href="/manual.html#gui_LookupPickerField"></a>5.5.2.1.23. LookupPickerField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-lookuppickerfield" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>LookupPickerField</code> позволяет отображать экземпляр сущности в текстовом поле, выбирать экземпляр в выпадающем списке и выполнять действия нажатием на кнопки справа.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_lookupPickerField.png" alt="gui lookupPickerField"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>lookupPickerField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>LookupPickerField</code> является по сути гибридом <a href="/manual.html#gui_LookupField">LookupField</a> и <a href="/manual.html#gui_PickerField">PickerField</a>, поэтому все описанное для этих интерфейсов верно и для него. Исключением является список действий по умолчанию, добавляемых при определении компонента в XML: для <code>LookupPickerField</code> это действия <code>lookup</code> <span class="image"><img src="assets/lookupBtn.png" alt="lookupBtn"></span> и <code>open</code> <span class="image"><img src="assets/openBtn.png" alt="openBtn"></span>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования <code>LookupPickerField</code> для выбора значения ссылочного атрибута <code>colour</code> сущности <code>Car</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Car</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Colour</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>select c from sample$Colour c<span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;lookupPickerField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты lookupPickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_LookupField_filterMode">filterMode</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_inputPrompt">inputPrompt</a> - <a href="/manual.html#gui_PickerField_metaclass">metaClass</a> - <a href="/manual.html#gui_LookupField_newOptionHandler">newOptionAllowed</a> - <a href="/manual.html#gui_LookupField_newOptionHandler">newOptionHandler</a> - <a href="/manual.html#gui_attr_nullName">nullName</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_LookupField_pageLength">pageLength</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы lookupPickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Action">actions</a> - <a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределённые стили lookupPickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_stylename_huge">huge</a> - <a href="/manual.html#gui_attr_stylename_large">large</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_MaskedField"><a class="anchor" href="/manual.html#gui_MaskedField"></a>5.5.2.1.24. MaskedField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=masked-field" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Текстовое поле, в которое данные вводятся в определенном формате. <code>MaskedField</code> удобно использовать, например, для ввода телефонных номеров.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>maskedField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>MaskedField</code> реализован только для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>MaskedField</code> в основном повторяет функциональность <a href="/manual.html#gui_TextField">TextField</a>, за исключением того, что ему нельзя установить <code>datatype</code>. То есть <code>MaskedField</code> предназначен для работы только с текстом и строковыми атрибутами сущностей. <code>MaskedField</code> имеет следующие специфические атрибуты:</p> 
         </div> 
         <div id="gui_MaskedField_mask" class="ulist"> 
          <ul> 
           <li> <p><code>mask</code> - задает маску для поля. Чтобы задать маску, используются следующие символы:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>#</code> - цифра</p> </li> 
              <li> <p><code>U</code> - буква верхнего регистра</p> </li> 
              <li> <p><code>L</code> - буква нижнего регистра</p> </li> 
              <li> <p><code>?</code> - буква</p> </li> 
              <li> <p><code>А</code> - буква или цифра</p> </li> 
              <li> <p><code>*</code> - любой символ</p> </li> 
              <li> <p><code>H</code> - hex символ в верхнем регистре</p> </li> 
              <li> <p><code>h</code> - hex символ в нижнем регистре</p> </li> 
              <li> <p><code>~</code> - знак + или -</p> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_MaskedField_valueMode" class="ulist"> 
          <ul> 
           <li> <p><code>valueMode</code> - определяет формат возвращаемого значения (с маской, или без) и может принимать значение <code>masked</code> или <code>clear</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Пример текстового поля с маской для ввода номеров телефонов:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;maskedField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">phoneNumberField</span><span class="delimiter">"</span></span> <span class="attribute-name">mask</span>=<span class="string"><span class="delimiter">"</span><span class="content">(###)###-##-##</span><span class="delimiter">"</span></span> <span class="attribute-name">valueMode</span>=<span class="string"><span class="delimiter">"</span><span class="content">masked</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://showPhoneNumberBtn</span><span class="delimiter">"</span></span> <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">showPhoneNumber</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> MaskedField phoneNumberField;

<span class="directive">public</span> <span class="type">void</span> showPhoneNumber(){
    showNotification((<span class="predefined-type">String</span>) phoneNumberField.getValue(), NotificationType.HUMANIZED);
}</code></pre> 
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_MaskedField.png" alt="gui MaskedField"> 
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_MaskedField_maskedValueMode.png" alt="gui MaskedField maskedValueMode"> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты maskedField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_MaskedField_mask">mask</a> - <a href="/manual.html#gui_TextField_maxLength">maxLength</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_TextField_trim">trim</a> - <a href="/manual.html#gui_MaskedField_valueMode">valueMode</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы maskedField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_TextField_EnterPressListener">addEnterPressListener</a> - <a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_OptionsGroup"><a class="anchor" href="/manual.html#gui_OptionsGroup"></a>5.5.2.1.25. OptionsGroup</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-optionsgroup" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент, который обеспечивает выбор из списка опций, используя группу переключателей для выбора единственного значения или группу флажков для выбора нескольких значений.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_optionsGroup.png" alt="gui optionsGroup"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>optionsGroup</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>OptionsGroup</code> реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Простейший вариант использования <code>OptionsGroup</code> - выбор значения перечисления (<code>enum</code>) для атрибута сущности. Например, сущность <code>Role</code> имеет атрибут <code>type</code> типа <code>RoleType</code>, который является перечислением. Тогда для редактирования этого атрибута можно использовать <code>OptionsGroup</code> следующим образом:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">roleDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.security.entity.Role</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;optionsGroup</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">roleDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Как видно из примера, в экране описывается <a href="/manual.html#datasources">источник данных</a> <code>roleDs</code> для сущности <code>Role</code>. В компоненте <code>optionsGroup</code> в атрибуте <a href="/manual.html#gui_attr_datasource">datasource</a> указывается ссылка на источник данных, а в атрибуте <a href="/manual.html#gui_attr_property">property</a> − название атрибута сущности, значение которого должно быть отображено.</p> 
            </div> 
            <div class="paragraph"> 
             <p>В результате компонент примет следующий вид:</p> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_optionsGroup_roleType.png" alt="gui optionsGroup roleType"> 
             </div> 
            </div> </li> 
           <li> <p>Список опций компонента может быть задан произвольно с помощью методов <code>setOptionsList()</code>, <code>setOptionsMap()</code> и <code>setOptionsEnum()</code>, либо с помощью XML-атрибута <code>optionsDatasource</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_OptionsGroup_setOptionsList" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>setOptionsList()</code> позволяет программно задать список опций компонента. Для этого объявляем компонент в XML-дескрипторе:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;optionsGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">numberOfSeatsField</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Затем инжектируем компонент в контроллер и в методе <code>init()</code> задаем ему список опций:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> OptionsGroup numberOfSeatsField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; list = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    list.add(<span class="integer">2</span>);
    list.add(<span class="integer">4</span>);
    list.add(<span class="integer">5</span>);
    list.add(<span class="integer">7</span>);
    numberOfSeatsField.setOptionsList(list);
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Компонент примет следующий вид:</p> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_optionsGroup_integerList.png" alt="gui optionsGroup integerList"> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>При этом метод <code>getValue()</code> компонента в зависимости от выбранной опции будет возвращать <code>Integer</code> значения 2,4,5,7.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_OptionsGroup_setOptionsMap" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>setOptionsMap()</code> позволяет задать строковые названия и значения опций по отдельности. Например, для описанного в XML-дескрипторе компонента <code>numberOfSeatsField</code> в методе <code>init()</code> контроллера задаем мэп опций:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> OptionsGroup numberOfSeatsField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; map = <span class="keyword">new</span> <span class="predefined-type">LinkedHashMap</span>&lt;&gt;();
    map.put(<span class="string"><span class="delimiter">"</span><span class="content">two</span><span class="delimiter">"</span></span>, <span class="integer">2</span>);
    map.put(<span class="string"><span class="delimiter">"</span><span class="content">four</span><span class="delimiter">"</span></span>, <span class="integer">4</span>);
    map.put(<span class="string"><span class="delimiter">"</span><span class="content">five</span><span class="delimiter">"</span></span>, <span class="integer">5</span>);
    map.put(<span class="string"><span class="delimiter">"</span><span class="content">seven</span><span class="delimiter">"</span></span>, <span class="integer">7</span>);
    numberOfSeatsField.setOptionsMap(map);
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Компонент примет следующий вид:</p> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_optionsGroup_integerMap.png" alt="gui optionsGroup integerMap"> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>При этом метод <code>getValue()</code> компонента в зависимости от выбранной опции будет возвращать <code>Integer</code> значения 2,4,5,7, а не строки, отображаемые на экране.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_OptionsGroup_setOptionsEnum" class="ulist"> 
          <ul> 
           <li> <p><code>setOptionsEnum()</code> принимает в качестве параметра класс перечисления. Список опций будет состоять из локализованных названий значений перечисления, значением компонента будет являться выбранное значение перечисления.</p> </li> 
           <li> <p>Компонент может брать список опций из источника данных. Для этого используется атрибут <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a>. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Colour</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>select c from sample$Colour c<span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;optionsGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursField</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В данном случае компонент <code>coloursField</code> отобразит <a href="/manual.html#namePattern_annotation">имена экземпляров</a> сущности <code>Colour</code>, находящихся в источнике данных <code>coloursDs</code>, а его метод <code>getValue()</code> вернет выбранный экземпляр сущности.</p> 
            </div> 
            <div class="paragraph"> 
             <p>С помощью атрибута <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> можно указать, какой атрибут сущности использовать вместо имени экземпляра для строковых названий опций.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_OptionsGroup_multiselect" class="ulist"> 
          <ul> 
           <li> <p>С помощью атрибута <code>multiselect</code> можно переключить <code>OptionsGroup</code> в режим множественного выбора. Если <code>multiselect</code> включен, то компонент отображается как группа независимых флажков, а значением компонента является список выбранных опций.</p> 
            <div class="paragraph"> 
             <p>Например, создадим в XML-дескрипторе экрана компонент:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;optionsGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">roleTypesField</span><span class="delimiter">"</span></span> <span class="attribute-name">multiselect</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>И в контроллере зададим для него список опций - значения перечисления <code>RoleType</code>:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> OptionsGroup roleTypesField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    roleTypesField.setOptionsList(<span class="predefined-type">Arrays</span>.asList(RoleType.values()));
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Компонент примет следующий вид:</p> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_optionsGroup_roleType_multi.png" alt="gui optionsGroup roleType multi"> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В данном случае метод <code>getValue()</code> компонента вернет объект типа <code>java.util.List</code>, содержащий значения <code>RoleType.READONLY</code> и <code>RoleType.DENYING</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Этот пример иллюстрирует также способность компонента <code>OptionsGroup</code> автоматически отображать локализованные значения перечислений, входящих в модель данных приложения.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_OptionsGroup_orientation" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>orientation</code> задает расположение элементов группы. По умолчанию элементы располагаются по вертикали. Значение <code>horizontal</code> задает горизонтальное расположение.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты optionsGroup
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_OptionsGroup_multiselect">multiselect</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_OptionsGroup_orientation">orientation</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы optionsGroup
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_OptionsGroup_setOptionsEnum">setOptionsEnum</a> - <a href="/manual.html#gui_OptionsGroup_setOptionsList">setOptionsList</a> - <a href="/manual.html#gui_OptionsGroup_setOptionsMap">setOptionsMap</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_OptionsList"><a class="anchor" href="/manual.html#gui_OptionsList"></a>5.5.2.1.26. OptionsList</h6> 
         <div class="paragraph"> 
          <p><code>OptionsList</code> представляет собой вариацию компонента <a href="/manual.html#gui_OptionsGroup">OptionsGroup</a> с представлением опций в виде вертикального прокручиваемого списка. Если включена возможность множественного выбора, элементы могут быть выбраны с удерживанием клвиши Ctrl при клике или диапазона при удерживании клавиши Shift.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_optionsList.png" alt="gui optionsList"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>optionsList</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>OptionsList</code> реализован для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div id="gui_OptionsGroup_nullOptionVisible" class="paragraph"> 
          <p>По умолчанию компонент <code>OptionsList</code> отображает первый пустой элемент в списке опций. Пустой элемент можно скрыть с помощью атрибута <code>nullOptionVisible</code>, установив ему значение <code>false</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Единственная разница в API между <code>OptionsList</code> и <a href="/manual.html#gui_OptionsGroup">OptionsGroup</a> заключается в том, что <code>OptionsList</code> не имеет атрибута <code>orientation</code>.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты optionsList
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_OptionsGroup_multiselect">multiselect</a> - <a href="/manual.html#gui_OptionsGroup_nullOptionVisible">nullOptionVisible</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы optionsList
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_PasswordField"><a class="anchor" href="/manual.html#gui_PasswordField"></a>5.5.2.1.27. PasswordField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-passwordfield" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Текстовое поле, которое вместо символов, введенных пользователем, отображает эхо-символы.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>passwordField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>PasswordField</code> реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>PasswordField</code> в основном аналогичен компоненту <a href="/manual.html#gui_TextField">TextField</a>, за исключением того, что ему нельзя установить <code>datatype</code>. То есть <code>PasswordField</code> предназначен для работы только с текстом и строковыми атрибутами сущностей.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;passwordField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">passwordField</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://buttonsName</span><span class="delimiter">"</span></span> <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">showPassword</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> PasswordField passwordField;

<span class="directive">public</span> <span class="type">void</span> showPassword(){
    showNotification((<span class="predefined-type">String</span>) passwordField.getValue(), NotificationType.HUMANIZED);
}</code></pre> 
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_PasswordField.png" alt="gui PasswordField"> 
          </div> 
         </div> 
         <div id="gui_PasswordField_autocomplete" class="paragraph"> 
          <p>Атрибут <code>autocomplete</code> позволяет включить сохранение паролей в веб браузере. По умолчанию отключено.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты passwordField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_PasswordField_autocomplete">autocomplete</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_TextField_maxLength">maxLength</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы passwordField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_PickerField"><a class="anchor" href="/manual.html#gui_PickerField"></a>5.5.2.1.28. PickerField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-pickerfield" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>PickerField</code> позволяет отображать экземпляр сущности в текстовом поле и выполнять действия нажатием на кнопки справа.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/PickerField.png" alt="PickerField"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>pickerField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>PickerField</code> реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Как правило, <code>PickerField</code> используется для работы со ссылочными атрибутами сущностей. При этом компоненту достаточно указать атрибуты <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Car</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;pickerField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Как видно из примера, в экране описывается <a href="/manual.html#datasources">источник данных</a> <code>carDs</code> для некоторой сущности <code>Car</code>, имеющей атрибут <code>colour</code>. В элементе <code>pickerField</code> в атрибуте <code>datasource</code> указывается ссылка на источник данных, а в атрибуте <code>property</code> − название атрибута сущности, значение которого должно быть отображено в компоненте. Атрибут сущности должен являться ссылкой на другую сущность, в приведенном примере это <code>Colour</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_PickerField_actions" class="ulist"> 
          <ul> 
           <li> <p>Для <code>PickerField</code> можно определить произвольное количество <a href="/manual.html#gui_Action">действий</a>, отображаемых кнопками справа.</p> 
            <div id="gui_PickerField_addAction" class="paragraph"> 
             <p>Это можно сделать как в XML-дескрипторе с помощью вложенного элемента <code>actions</code>, так и программно в контроллере методом <code>addAction()</code>.</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p>Существуют <a href="/manual.html#standard_actions">стандартные действия</a>, определенные перечислением <code>PickerField.ActionType</code>: <code>lookup</code>, <code>clear</code>, <code>open</code>. Они выполняют соответственно выбор связанной сущности, очистку поля и открытие экрана редактирования выбранной связанной сущности. Для стандартных действий в XML не нужно определять никаких атрибутов, кроме идентификатора. Если при объявлении компонента никаких действий в элементе <code>actions</code> не задано, загрузчик XML определит для него действия <code>lookup</code> и <code>clear</code>. Чтобы добавить к действиям по умолчанию, например, действие <code>open</code>, нужно определить элемент <code>actions</code> следующим образом:</p> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;pickerField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">lookup</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">open</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">clear</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/pickerField&gt;</span></code></pre> 
                </div> 
               </div> 
               <div class="paragraph"> 
                <p>Элемент <code>action</code> не дополняет, а переопределяет набор стандартных действий, поэтому необходимо указывать идентификаторы всех требуемых действий. Компонент примет следующий вид:</p> 
               </div> 
               <div class="imageblock" style="text-align: center"> 
                <div class="content"> 
                 <img src="assets/gui_pickerFieldActionsSt.png" alt="gui pickerFieldActionsSt"> 
                </div> 
               </div> 
               <div class="paragraph"> 
                <p><a id="gui_PickerField_addLookupAction"></a> <a id="gui_PickerField_addOpenAction"></a> <a id="gui_PickerField_addClearAction"></a> Для программного задания стандартных действий служат методы <code>addLookupAction()</code>, <code>addOpenAction()</code> и <code>addClearAction()</code>. Если компонент определен в XML-дескрипторе без вложенного элемента <code>actions</code>, то достаточно добавить недостающие действия:</p> 
               </div> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> PickerField colourField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    colourField.addOpenAction();
}</code></pre> 
                </div> 
               </div> 
               <div class="paragraph"> 
                <p>Если же компонент создается в контроллере, то никаких действий по умолчанию он не получает, и необходимо добавить все нужные действия явно:</p> 
               </div> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> ComponentsFactory componentsFactory;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    PickerField colourField = componentsFactory.createComponent(PickerField.NAME);
    colourField.setDatasource(carDs, <span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span>);
    colourField.addLookupAction();
    colourField.addOpenAction();
    colourField.addClearAction();
}</code></pre> 
                </div> 
               </div> 
               <div class="paragraph"> 
                <p>Стандартные действия можно параметризовать. В XML-дескрипторе возможности для этого ограничены: существует только атрибут <code>openType</code>, в котором можно задать режим открытия экрана выбора (для <code>LookupAction</code>) или редактирования (для <code>OpenAction</code>).</p> 
               </div> 
               <div class="paragraph"> 
                <p>При программном создании действий можно задать любые свойства объектов <code>PickerField.LookupAction</code>, <code>PickerField.OpenAction</code> и <code>PickerField.ClearAction</code>, возвращаемых методами добавления стандартных действий. Например, так можно задать специфический экран выбора:</p> 
               </div> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java">PickerField.LookupAction lookupAction = customerField.addLookupAction();
lookupAction.setLookupScreen(<span class="string"><span class="delimiter">"</span><span class="content">customerLookupScreen</span><span class="delimiter">"</span></span>);</code></pre> 
                </div> 
               </div> 
               <div class="paragraph"> 
                <p>Подробнее см. JavaDocs классов <a href="/manual.html#standard_actions">стандартных действий</a>.</p> 
               </div> </li> 
              <li> <p>Произвольные действия в XML-дескрипторе также определяются во вложенном элементе <code>actions</code>, например:</p> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;pickerField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">lookup</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">show</span><span class="delimiter">"</span></span> <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">icons/show.png</span><span class="delimiter">"</span></span>
                <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">showColour</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/pickerField&gt;</span></code></pre> 
                </div> 
               </div> 
               <div class="paragraph"> 
                <p>Программно задать произвольное действие можно следующим образом:</p> 
               </div> 
               <div id="gui_PickerField_setLookupScreen" class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> PickerField colourField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    colourField.addAction(<span class="keyword">new</span> <span class="predefined-type">AbstractAction</span>(<span class="string"><span class="delimiter">"</span><span class="content">show</span><span class="delimiter">"</span></span>) {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> actionPerform(<span class="predefined-type">Component</span> component) {
            showColour(colourField.getValue());
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getCaption() {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getIcon() {
            <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">icons/show.png</span><span class="delimiter">"</span></span>;
        }
    });
}</code></pre> 
                </div> 
               </div> 
               <div class="paragraph"> 
                <p>Декларативное и программное создание действий подробно описано в разделе <a href="/manual.html#gui_Action">Действия. Интерфейс Action</a>.</p> 
               </div> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_PickerField_metaclass" class="ulist"> 
          <ul> 
           <li> <p>Компонент <code>PickerField</code> можно использовать без непосредственной привязки к данным, то есть без указания <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>. В этом случае для указания типа сущности, с которой должен работать <code>PickerField</code>, используется атрибут <code>metaClass</code>. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;pickerField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">colourField</span><span class="delimiter">"</span></span> <span class="attribute-name">metaClass</span>=<span class="string"><span class="delimiter">"</span><span class="content">sample$Colour</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Экземпляр выбранной сущности можно получить, инжектировав компонент в контроллер и вызвав его метод <code>getValue()</code>.</p> 
            </div> 
            <div class="admonitionblock warning"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Warning
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>Для правильной работы компонента <code>PickerField</code> необходима либо установка атрибута <code>metaClass</code>, либо одновременная установка атрибутов <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> </li> 
           <li> <p>В компоненте <code>PickerField</code> можно использовать горячие клавиши: см. <a href="/manual.html#shortcuts">Горячие клавиши</a>.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты pickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_PickerField_metaclass">metaClass</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы pickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_PickerField_actions">actions</a> - <a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_PickerField_addAction">addAction</a> - <a href="/manual.html#gui_PickerField_addClearAction">addClearAction</a> - <a href="/manual.html#gui_PickerField_addLookupAction">addLookupAction</a> - <a href="/manual.html#gui_PickerField_addOpenAction">addOpenAction</a> - <a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a> - <a href="/manual.html#gui_PickerField_setLookupScreen">setLookupScreen</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_PopupButton"><a class="anchor" href="/manual.html#gui_PopupButton"></a>5.5.2.1.29. PopupButton</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-popupbutton" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопка с выпадающим меню. Меню может содержать список действий или отображать собственное содержимое.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/PopupButton.png" alt="PopupButton"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>popupButton</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Кнопка <code>PopupButton</code> может содержать текст, заданный с помощью атрибута <a href="/manual.html#gui_attr_caption">caption</a>, или <a href="/manual.html#gui_attr_icon">пиктограмму</a> (или и то, и другое). Всплывающую подсказку можно задать с помощью атрибута <a href="/manual.html#gui_attr_description">description</a>. На рисунке ниже отражены разные виды кнопок:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_popupButtonTypes.png" alt="gui popupButtonTypes"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Элементы <code>popupButton</code>:</p> 
         </div> 
         <div id="gui_PopupButton_actions" class="ulist"> 
          <ul> 
           <li> <p><code>actions</code> - определяет выпадающий список <a href="/manual.html#gui_Action">действий</a>.</p> 
            <div class="paragraph"> 
             <p>Отображаются только следующие свойства действий: <code>caption</code>, <code>enable</code>, <code>visible</code>. Свойства <code>description</code>, <code>shortcut</code> игнорируются. Обработка свойства <code>icon</code> зависит от свойства приложения <a href="/manual.html#cuba.gui.showIconsForPopupMenuActions">cuba.gui.showIconsForPopupMenuActions</a> и от атрибута <code>showActionIcons</code> компонента. Последний имеет приоритет.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Пример кнопки с выпадающим списком, содержащим два действия:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;popupButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">popupButton</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://popupButton</span><span class="delimiter">"</span></span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">Press me</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">popupAction1</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://action1</span><span class="delimiter">"</span></span> <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">someAction1</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">popupAction2</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://action2</span><span class="delimiter">"</span></span> <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">someAction2</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/popupButton&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_PopupButton_popup" class="ulist"> 
          <ul> 
           <li> <p><code>popup</code> - позволяет создать собственное содержимое всплывающего меню. Если оно задано, элемент <code>actions</code> игнорируется.</p> 
            <div class="paragraph"> 
             <p>Пример кнопки с собственным содержимым:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;popupButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">popupButton</span><span class="delimiter">"</span></span>
             <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Settings</span><span class="delimiter">"</span></span>
             <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span>
             <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">font-icon:GEARS</span><span class="delimiter">"</span></span>
             <span class="attribute-name">closePopupOnOutsideClick</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
             <span class="attribute-name">popupOpenDirection</span>=<span class="string"><span class="delimiter">"</span><span class="content">BOTTOM_CENTER</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;popup&gt;</span>
        <span class="tag">&lt;vbox</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span>
              <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">AUTO</span><span class="delimiter">"</span></span>
              <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
              <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Settings</span><span class="delimiter">"</span></span>
                   <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span>
                   <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">h2</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;progressBar</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Progress</span><span class="delimiter">"</span></span>
                         <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;textField</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">New title</span><span class="delimiter">"</span></span>
                       <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;lookupField</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Status</span><span class="delimiter">"</span></span>
                         <span class="attribute-name">optionsEnum</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.core.global.SendingStatus</span><span class="delimiter">"</span></span>
                         <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;hbox</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Save</span><span class="delimiter">"</span></span> <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">icons/ok.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Reset</span><span class="delimiter">"</span></span> <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">font-icon:REMOVE</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/hbox&gt;</span>
        <span class="tag">&lt;/vbox&gt;</span>
    <span class="tag">&lt;/popup&gt;</span>
<span class="tag">&lt;/popupButton&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_popupButton_custom.png" alt="gui popupButton custom"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>popupButton</code>:</p> 
         </div> 
         <div id="gui_PopupButton_autoClose" class="ulist"> 
          <ul> 
           <li> <p><code>autoClose</code> - определяет, должно ли всплывающее меню закрываться автоматически после вызова действия.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_PopupButton_closePopupOnOutsideClick" class="ulist"> 
          <ul> 
           <li> <p><code>closePopupOnOutsideClick</code> - если установлено значение <code>true</code>, щелчок по области за пределами всплывающего меню закрывает его. Это не относится к щелчкам по самой кнопке компонента.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_PopupButton_menuWidth" class="ulist"> 
          <ul> 
           <li> <p><code>menuWidth</code> - устанавливает ширину всплывающего меню.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_PopupButton_popupOpenDirection" class="ulist"> 
          <ul> 
           <li> <p><code>popupOpenDirection</code> - задаёт направление открытия всплывающего окна. Возможные значения:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>BOTTOM_LEFT</code>,</p> </li> 
              <li> <p><code>BOTTOM_RIGHT</code>,</p> </li> 
              <li> <p><code>BOTTOM_CENTER</code>.</p> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_PopupButton_showActionIcons" class="ulist"> 
          <ul> 
           <li> <p><code>showActionIcons</code> - разрешает отображение пиктограмм для кнопок действий.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_PopupButton_togglePopupVisibilityOnClick" class="ulist"> 
          <ul> 
           <li> <p><code>togglePopupVisibilityOnClick</code> - определяет, должны ли последовательные щелчки по кнопке компонента изменять видимость всплывающего меню.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Методы интерфейса <code>PopupButton</code>:</p> 
         </div> 
         <div id="gui_PopupButton_PopupVisibilityListener" class="ulist"> 
          <ul> 
           <li> <p><code>addPopupVisibilityListener()</code> - добавляет компоненту слушатель для отслеживания событий изменения видимости компонента.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">popupButton.addPopupVisibilityListener(popupVisibilityEvent -&gt; {
    showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Popup visibility changed</span><span class="delimiter">"</span></span>);
});</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты popupButton
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_PopupButton_autoClose">autoClose</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_PopupButton_closePopupOnOutsideClick">closePopupOnOutsideClick</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_PopupButton_menuWidth">menuWidth</a> - <a href="/manual.html#gui_PopupButton_popupOpenDirection">popupOpenDirection</a> - <a href="/manual.html#gui_PopupButton_showActionIcons">showActionIcons</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_PopupButton_togglePopupVisibilityOnClick">togglePopupVisibilityOnClick</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы popupButton
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_PopupButton_actions">actions</a> - <a href="/manual.html#gui_PopupButton_popup">popup</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_PopupButton_PopupVisibilityListener">addPopupVisibilityListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_PopupView"><a class="anchor" href="/manual.html#gui_PopupView"></a>5.5.2.1.30. PopupView</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=opening-popupview" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>PopupView</code> представляет собой компонент, позволяющий открывать popup с контейнером. Контейнер может открываться по клику на минимизированное значение или программно. Он может быть закрыт отведением курсора или по клику вне контейнера.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Обычный <code>PopupView</code> со скрытым и видимым popup-ом:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_popup_view_mini.png" alt="Popup hidden"> 
          </div> 
          <div class="title">
           Рисунок 20. Popup скрыт
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_popup_view_mini_open.png" alt="Popup visible"> 
          </div> 
          <div class="title">
           Рисунок 21. Popup открыт
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования PopupView, где минимизированное значение получено из пакета локализации:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;popupView</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">popupView</span><span class="delimiter">"</span></span>
           <span class="attribute-name">minimizedValue</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://minimizedValue</span><span class="delimiter">"</span></span>
           <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">PopupView caption</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">60px</span><span class="delimiter">"</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">40px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Content</span><span class="delimiter">"</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
<span class="tag">&lt;/popupView&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Содержимое popup-а должно быть контейнером, например <a href="/manual.html#gui_BoxLayout">BoxLayout</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Методы <code>PopupView</code>:</p> 
         </div> 
         <div class="openblock"> 
          <div class="content"> 
           <div class="ulist"> 
            <ul> 
             <li> <p><code>setPopupVisible()</code> позволяет открывать и закрывать popup программно.</p> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> PopupView popupView;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    popupView.setPopupVisible(<span class="predefined-constant">true</span>);
}</code></pre> 
               </div> 
              </div> </li> 
             <li> <p><code>setMinimizedValue()</code> позволяет программно менять минимизированное значение.</p> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> PopupView popupView;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    popupView.setMinimizedValue(<span class="string"><span class="delimiter">"</span><span class="content">Hello world!</span><span class="delimiter">"</span></span>);
}</code></pre> 
               </div> 
              </div> </li> 
            </ul> 
           </div> 
           <div id="gui_PopupView_PopupVisibilityListener" class="ulist"> 
            <ul> 
             <li> <p><code>addPopupVisibilityListener(PopupVisibilityListener listener)</code> позволяет отслеживать изменения видимости popup.</p> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> PopupView popupView;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    popupView.addPopupVisibilityListener(event -&gt;
        showNotification(event.isPopupVisible() ? <span class="string"><span class="delimiter">"</span><span class="content">The popup is visible</span><span class="delimiter">"</span></span> : <span class="string"><span class="delimiter">"</span><span class="content">The popup is hidden</span><span class="delimiter">"</span></span>,
            NotificationType.HUMANIZED));
}</code></pre> 
               </div> 
              </div> </li> 
            </ul> 
           </div> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>PopupView</code>:</p> 
         </div> 
         <div class="openblock"> 
          <div class="content"> 
           <div id="gui_PopupView_minimizedValue" class="ulist"> 
            <ul> 
             <li> <p><code>minimizedValue</code> определяет текст минимизированного значения.</p> </li> 
            </ul> 
           </div> 
           <div id="gui_PopupView_hideOnMouseOut" class="ulist"> 
            <ul> 
             <li> <p>Если атрибуту <code>hideOnMouseOut</code> установлено значение <code>false</code>, popup будет закрываться по клику вне popup.</p> </li> 
            </ul> 
           </div> 
           <div id="gui_PopupView_captionAsHtml" class="ulist"> 
            <ul> 
             <li> <p><code>captionAsHtml</code> позволяет использовать HTML теги в подписи компонента.</p> </li> 
            </ul> 
           </div> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты popupView
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_PopupView_captionAsHtml">captionAsHtml</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_PopupView_hideOnMouseOut">hideOnMouseOut</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_PopupView_minimizedValue">minimizedValue</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_PopupView_PopupVisibilityListener">addPopupVisibilityListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_ProgressBar"><a class="anchor" href="/manual.html#gui_ProgressBar"></a>5.5.2.1.31. ProgressBar</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=normal-progressbar" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>ProgressBar</code> служит для отображения хода выполнения некоторого длительного процесса.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_progressBar.png" alt="gui progressBar"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>progressBar</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования компонента совместно с механизмом <a href="/manual.html#background_tasks">фоновых задач</a>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;progressBar</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">progressBar</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> ProgressBar progressBar;

<span class="annotation">@Inject</span>
<span class="directive">protected</span> BackgroundWorker backgroundWorker;

<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> ITERATIONS = <span class="integer">5</span>;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    BackgroundTask&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Void</span>&gt; task = <span class="keyword">new</span> BackgroundTask&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Void</span>&gt;(<span class="integer">300</span>, <span class="local-variable">this</span>) {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Void</span> run(TaskLifeCycle&lt;<span class="predefined-type">Integer</span>&gt; taskLifeCycle) <span class="directive">throws</span> <span class="exception">Exception</span> {
            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">1</span>; i &lt;= ITERATIONS; i++) {
                <span class="predefined-type">TimeUnit</span>.SECONDS.sleep(<span class="integer">2</span>); <span class="comment">// time consuming task</span>
                taskLifeCycle.publish(i);
            }
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> progress(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; changes) {
            <span class="type">float</span> lastValue = changes.get(changes.size() - <span class="integer">1</span>);
            progressBar.setValue(lastValue / ITERATIONS);
        }
    };

    BackgroundTaskHandler taskHandler = backgroundWorker.handle(task);
    taskHandler.execute();
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Здесь в методе <code>BackgroundTask.progress()</code>, выполняемом в UI-потоке, компоненту <code>ProgressBar</code> устанавливается текущее значение. Значением компонента должно быть число типа <code>float</code> от <code>0.0</code> до <code>1.0</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Изменения значения компонента <code>ProgressBar</code> можно отслеживать с помощью слушателя <code>ValueChangeListener</code>.</p> 
         </div> 
         <div id="gui_ProgressBar_indeterminate" class="paragraph"> 
          <p>Если выполняемый процесс не может передавать информацию о прогрессе, то с помощью атрибута <code>indeterminate</code> можно задать отображение неопределенного состояния индикатора. Если значение атрибута равно <code>true</code>, то индикатор отображает неопределенное состояние. По умолчанию <code>false</code>. Например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;progressBar</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">progressBar</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span> <span class="attribute-name">indeterminate</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div id="gui_ProgressBar_indeterminate-circle" class="paragraph"> 
          <p>По умолчанию неопределённый индикатор представляет собой горизонтальную полосу. Чтобы отобразить <code>ProgressBar</code> в виде крутящегося колесика, установите атрибут <code>stylename="indeterminate-circle"</code>.</p> 
         </div> 
         <div id="gui_ProgressBar_point" class="paragraph"> 
          <p>Чтобы изменить форму индикатора на точку, перемещающуюся по полосе, вместо растущей полосы, используйте стиль <code>point</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">progressBar.setStyleName(HaloTheme.PROGRESSBAR_POINT);</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты progressBar
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_ProgressBar_indeterminate">indeterminate</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили progressBar
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_ProgressBar_indeterminate-circle">indeterminate-circle</a> - <a href="/manual.html#gui_ProgressBar_point">point</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_RelatedEntities"><a class="anchor" href="/manual.html#gui_RelatedEntities"></a>5.5.2.1.32. RelatedEntities</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-relatedentities" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>RelatedEntities</code> - компонент в виде кнопки с выпадающим списком, при нажатии показывающим список классов, связанных с сущностью, экземпляры которой отображаются в таблице. Пользователь выбирает интересующий его класс сущности, после чего открывается новый браузер с экземплярами данной сущности, связанными с выбранными экземплярами в начальной таблице.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_relatedEntities.png" alt="gui relatedEntities"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>relatedEntities</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>При отборе связанных сущностей для отображения учитываются разрешения пользователя на открытие экранов, чтение сущностей и чтение атрибутов.</p> 
         </div> 
         <div class="paragraph"> 
          <p>По умолчанию для выбранного в списке класса сущности открывается браузер сущности, определенный по соглашениям (<code>{entity_name}.browse</code>, <code>{entity_name}.lookup</code>). Опционально, экран можно явно задать в компоненте.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В открытом браузере динамически создается фильтр, который выбирает связанные с выбранными сущностями записи.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания компонента в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">invoiceTable</span><span class="delimiter">"</span></span>
       <span class="attribute-name">multiselect</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
       <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">remove</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>

    <span class="tag">&lt;buttonsPanel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">buttonsPanel</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">createBtn</span><span class="delimiter">"</span></span>
                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">invoiceTable.create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">editBtn</span><span class="delimiter">"</span></span>
                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">invoiceTable.edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">removeBtn</span><span class="delimiter">"</span></span>
                <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">invoiceTable.remove</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;relatedEntities</span> <span class="attribute-name">for</span>=<span class="string"><span class="delimiter">"</span><span class="content">invoiceTable</span><span class="delimiter">"</span></span>
                         <span class="attribute-name">openType</span>=<span class="string"><span class="delimiter">"</span><span class="content">NEW_TAB</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">invoiceItems</span><span class="delimiter">"</span></span>
                      <span class="attribute-name">screen</span>=<span class="string"><span class="delimiter">"</span><span class="content">sales$InvoiceItem.lookup</span><span class="delimiter">"</span></span>
                      <span class="attribute-name">filterCaption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://invoiceItems</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/relatedEntities&gt;</span>
    <span class="tag">&lt;/buttonsPanel&gt;</span></code></pre> 
          </div> 
         </div> 
         <div id="gui_RelatedEntities_for" class="paragraph"> 
          <p>Атрибут <code>for</code> является обязательным. В нем указывается идентификатор таблицы.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибут <code>openType="NEW_TAB"</code> устанавливает режим открытия браузера (новая вкладка). По умолчанию браузер открывается в текущей вкладке.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Элемент <code>property</code> позволяет явно задать связанную сущность, которая будет отображаться в выпадающем списке.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>property</code>:</p> 
         </div> 
         <div id="gui_RelatedEntities_property_name" class="ulist"> 
          <ul> 
           <li> <p><code>name</code> - имя атрибута текущей сущности, ссылающегося на связанную сущность</p> </li> 
          </ul> 
         </div> 
         <div id="gui_RelatedEntities_property_screen" class="ulist"> 
          <ul> 
           <li> <p><code>screen</code> - идентификатор браузера, открывающегося при выборе сущности в списке</p> </li> 
          </ul> 
         </div> 
         <div id="gui_RelatedEntities_property_filterCaption" class="ulist"> 
          <ul> 
           <li> <p><code>filterCaption</code> - имя динамически формируемого фильтра</p> </li> 
          </ul> 
         </div> 
         <div id="gui_RelatedEntities_exclude" class="paragraph"> 
          <p>Атрибут <code>exclude</code> позволяет исключить определенные связанные сущности из числа отображаемых. В качестве значения указывается регулярное выражение, отбирающее ссылочные атрибуты текущей сущности для исключения.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_relatedEntitiesTable.png" alt="gui relatedEntitiesTable"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В платформе есть API для открытия экранов связанных сущностей без использования компонента <code>RelatedEntities</code>: интерфейс <code>RelatedEntitiesAPI</code> и его реализация <code>RelatedEntitiesBean</code>. Логика задаётся методом <code>openRelatedScreen()</code>, который принимает коллекцию сущностей с одной стороны отношения, <code>MetaClass</code> отдельной сущности из этой коллекции и поле, являющееся ссылкой на связанные сущности.</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">related</span><span class="delimiter">"</span></span>
        <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Related customer</span><span class="delimiter">"</span></span>
        <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">onRelatedClick</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.company.sales.entity.Order</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.AbstractLookup</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.components.Table</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.gui.relatedentities.RelatedEntitiesAPI</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Inject</span>;


<span class="directive">public</span> <span class="type">class</span> <span class="class">OrderBrowse</span> <span class="directive">extends</span> AbstractLookup {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> RelatedEntitiesAPI relatedEntitiesAPI;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Table&lt;Order&gt; ordersTable;


    <span class="directive">public</span> <span class="type">void</span> onRelatedClick() {
        relatedEntitiesAPI.openRelatedScreen(ordersTable.getSelected(),
                Order.class, <span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>);
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>По умолчанию метод открывает стандартный экран просмотра списка. Дополнительно можно указать параметр <code>RelatedScreenDescriptor</code>, если требуется открыть экран, отличный от стандартного, или открыть его с параметрами. <code>RelatedScreenDescriptor</code> - это простой Java-объект, хранящий идентификатор экрана (<code>String</code>), тип его открытия (<code>WindowManager.OpenType</code>), заголовок фильтра (<code>String</code>) и параметры экрана (<code>Map&lt;String, Object&gt;</code>).</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">relatedEntitiesAPI.openRelatedScreen(ordersTable.getSelected(),
        Order.class, <span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>,
        <span class="keyword">new</span> RelatedScreenDescriptor(<span class="string"><span class="delimiter">"</span><span class="content">sales$Customer.lookup</span><span class="delimiter">"</span></span>, <span class="predefined-type">OpenType</span>.DIALOG));</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты relatedEntities
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_RelatedEntities_exclude">exclude</a> - <a href="/manual.html#gui_RelatedEntities_for">for</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_openType">openType</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты property
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_RelatedEntities_property_filterCaption">filterCaption</a> - <a href="/manual.html#gui_RelatedEntities_property_name">name</a> - <a href="/manual.html#gui_RelatedEntities_property_screen">screen</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_RichTextArea"><a class="anchor" href="/manual.html#gui_RichTextArea"></a>5.5.2.1.33. RichTextArea</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-richtextarea" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Текстовая область для отображения и ввода форматированного текста.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>richTextArea</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>RichTextArea</code> реализован только для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>RichTextArea</code> в основном повторяет функциональность <code><a href="/manual.html#gui_TextField">TextField</a></code>, за исключением того, что ему нельзя установить <code>datatype</code>. То есть <code>RichTextArea</code> предназначен для работы только с текстом и строковыми атрибутами сущностей.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_RichTextAreaInfo.png" alt="gui RichTextAreaInfo"> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты richTextArea
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_SearchPickerField"><a class="anchor" href="/manual.html#gui_SearchPickerField"></a>5.5.2.1.34. SearchPickerField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-searchpickerfield" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>SearchPickerField</code> служит для поиска экземпляров сущностей по вводимой пользователем строке. Пользователю достаточно ввести несколько символов и нажать клавишу <strong>Enter</strong>. Если поиск дал несколько совпадений, найденные значения отображаются в виде выпадающего списка. Если же критерию поиска соответствует только один экземпляр, он сразу становится значением компонента. <code>SearchPickerField</code> позволяет также выполнять действия нажатием на кнопки справа.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_searchPickerFieldOverlap.png" alt="gui searchPickerFieldOverlap"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>См. также <a href="/manual.html#gui_SuggestionPickerField">SuggestionPickerField</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>searchPickerField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Для работы компонента <code>SearchPickerField</code> необходимо создать <a href="/manual.html#datasources">collectionDatasource</a>, и задать в нем запрос, содержащий условия поиска. Условие обязательно должно содержать параметр с именем <code>custom$searchString</code> - именно в него компонент передает введенную пользователем подстроку при нажатии <strong>Enter</strong>. Источник данных с условием поиска должен быть указан в атрибуте <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> компонента. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Car</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Colour</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>
            select c from sample$Colour c
            where c.name like :(?i)custom$searchString
        <span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;searchPickerField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В данном случае компонент будет искать экземпляры сущности <code>Colour</code> по вхождению подстроки в ее атрибут <code>name</code>. Префикс <code>(?i)</code> служит для регистро-независимого поиска (см. <a href="/manual.html#datasource_query_case_insensitive">Поиск подстроки без учета регистра</a>). Выбранное значение подставится в атрибут <code>colour</code> сущности <code>Car</code>, находящейся в источнике данных <code>carDs</code>.</p> 
            </div> 
            <div id="gui_SearchPickerField_escapeValueForLike" class="paragraph"> 
             <p>Атрибут <code>escapeValueForLike</code> со значением <code>true</code> позволяет искать значения, содержащие специальные символы <code>%</code>, <code>\</code> и <code>_</code> при помощи like. Чтобы использовать <code>escapeValueForLike = true</code>, необходимо добавить в запрос источника данных escape-значение:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">select</span> c <span class="keyword">from</span> ref<span class="error">$</span>Colour c
<span class="keyword">where</span> c.name <span class="keyword">like</span> :(<span class="error">?</span>i)custom<span class="error">$</span>searchString <span class="keyword">or</span> c.description <span class="keyword">like</span> :(<span class="error">?</span>i)custom<span class="error">$</span>searchString escape <span class="string"><span class="delimiter">'</span><span class="char">\'</span></span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Атрибут <code>escapeValueForLike</code> работает со всеми типами базы данных, кроме HSQLDB.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_SearchPickerField_minSearchStringLength" class="ulist"> 
          <ul> 
           <li> <p>С помощью атрибута <code>minSearchStringLength</code> можно задать минимальное количество символов, которое должен ввести пользователь для поиска значения.</p> </li> 
           <li> <p>В контроллере экрана для компонента можно реализовать методы, вызываемые в двух случаях:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p>если количество введенных символов меньше значения атрибута <code>minSearchStringLength</code>.</p> </li> 
              <li> <p>если поиск введенных пользователем символов не дал результатов.</p> 
               <div class="paragraph"> 
                <p>Пример реализации методов для вывода на экран сообщений:</p> 
               </div> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> SearchPickerField colourField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    colourField.setSearchNotifications(<span class="keyword">new</span> SearchField.SearchNotifications() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> notFoundSuggestions(<span class="predefined-type">String</span> filterString) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">No colours found for search string: </span><span class="delimiter">"</span></span> + filterString,
                             NotificationType.TRAY);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> needMinSearchStringLength(<span class="predefined-type">String</span> filterString, <span class="type">int</span> minSearchStringLength) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Minimum length of search string is </span><span class="delimiter">"</span></span> + minSearchStringLength,
                             NotificationType.TRAY);
        }
    });
}</code></pre> 
                </div> 
               </div> </li> 
             </ul> 
            </div> </li> 
           <li> <p><code>SearchPickerField</code> реализует интерфейсы <a href="/manual.html#gui_LookupField">LookupField</a> и <a href="/manual.html#gui_PickerField">PickerField</a>, поэтому все описанное для этих интерфейсов в части работы с сущностями верно и для него. Исключением является список действий по умолчанию, добавляемых при определении компонента в XML: для <code>SearchPickerField</code> это действия <code>lookup</code> <span class="image"><img src="assets/lookupBtn.png" alt="lookupBtn"></span> и <code>open</code> <span class="image"><img src="assets/openBtn.png" alt="openBtn"></span>.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты searchPickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_LookupField_filterMode">filterMode</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_inputPrompt">inputPrompt</a> - <a href="/manual.html#gui_PickerField_metaclass">metaClass</a> - <a href="/manual.html#gui_SearchPickerField_minSearchStringLength">minSearchStringLength</a> - <a href="/manual.html#gui_LookupField_newOptionHandler">newOptionAllowed</a> - <a href="/manual.html#gui_LookupField_newOptionHandler">newOptionHandler</a> - <a href="/manual.html#gui_attr_nullName">nullName</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы searchPickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Action">actions</a> - <a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределённые стили searchPickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_stylename_huge">huge</a> - <a href="/manual.html#gui_attr_stylename_large">large</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_SideMenu"><a class="anchor" href="/manual.html#gui_SideMenu"></a>5.5.2.1.35. SideMenu</h6> 
         <div class="paragraph"> 
          <p>Компонент <code>SideMenu</code> позволяет создать боковое главное меню в <a href="/manual.html#main_window_layout">главном окне приложения</a>, управлять элементами меню, добавлять пиктограммы и ярлыки и применять стили.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Его также можно использовать в экранах приложения как обычный визуальный компонент. Для этого необходимо добавить пространство имён <code>xmlns:main="http://schemas.haulmont.com/cuba/mainwindow.xsd"</code> в дескриптор экрана.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_sidemenu.png" alt="gui sidemenu"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>sideMenu</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания компонента в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;main:sideMenu</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">sideMenu</span><span class="delimiter">"</span></span>
               <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
               <span class="attribute-name">selectOnClick</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>CUBA Studio предоставляет готовый шаблон главного экрана с реализацией компонента <code>sideMenu</code> и готовыми стилями боковой панели:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;hbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">horizontalWrap</span><span class="delimiter">"</span></span>
          <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">workArea</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
          <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">c-sidemenu-layout</span><span class="delimiter">"</span></span>
          <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;vbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">sideMenuPanel</span><span class="delimiter">"</span></span>
              <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">sideMenu</span><span class="delimiter">"</span></span>
              <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
              <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">false,false,true,false</span><span class="delimiter">"</span></span>
              <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
              <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">c-sidemenu-panel</span><span class="delimiter">"</span></span>
              <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">250px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;hbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">appTitleBox</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">c-sidemenu-title</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;label</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">appTitleLabel</span><span class="delimiter">"</span></span>
                       <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span>
                       <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainMsg://application.logoLabel</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/hbox&gt;</span>
            <span class="tag">&lt;embedded</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">logoImage</span><span class="delimiter">"</span></span>
                      <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span>
                      <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">c-app-icon</span><span class="delimiter">"</span></span>
                      <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">IMAGE</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;hbox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">userInfoBox</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">userIndicator</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
                  <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;main:userIndicator</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">userIndicator</span><span class="delimiter">"</span></span>
                                    <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;main:newWindowButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">newWindowButton</span><span class="delimiter">"</span></span>
                                      <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainMsg://newWindowBtnDescription</span><span class="delimiter">"</span></span>
                                      <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">app/images/new-window.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;main:logoutButton</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">logoutButton</span><span class="delimiter">"</span></span>
                                   <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainMsg://logoutBtnDescription</span><span class="delimiter">"</span></span>
                                   <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">app/images/exit.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/hbox&gt;</span>
            <span class="tag">&lt;main:sideMenu</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">sideMenu</span><span class="delimiter">"</span></span>
                           <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;main:ftsField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ftsField</span><span class="delimiter">"</span></span>
                           <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/vbox&gt;</span>
        <span class="tag">&lt;main:workArea</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">workArea</span><span class="delimiter">"</span></span>
                       <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;main:initialLayout</span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
                                <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;label</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">welcomeLabel</span><span class="delimiter">"</span></span>
                       <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span>
                       <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">c-welcome-text</span><span class="delimiter">"</span></span>
                       <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainMsg://application.welcomeText</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/main:initialLayout&gt;</span>
        <span class="tag">&lt;/main:workArea&gt;</span>
    <span class="tag">&lt;/hbox&gt;</span>
<span class="tag">&lt;/layout&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p><strong>Атрибуты sideMenu:</strong></p> 
         </div> 
         <div id="gui_SideMenu_selectOnClick" class="ulist"> 
          <ul> 
           <li> <p><code>selectOnClick</code> - установка атрибута в <code>true</code> подсвечивает выделение элемента меню после его выбора кликом мыши. По умолчанию <code>false</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_sidemenu_2.png" alt="gui sidemenu 2"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p><strong>Методы интерфейса SideMenu:</strong></p> 
         </div> 
         <div id="gui_SideMenu_createMenuItem" class="ulist"> 
          <ul> 
           <li> <p><code>createMenuItem</code> - создаёт новый объект элемента меню, но не добавляет его к меню. Идентификатор <code>id</code> должен быть уникальным в области всего меню.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_addMenuItem" class="ulist"> 
          <ul> 
           <li> <p><code>addMenuItem</code> - добавляет элемент к меню.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_removeMenuItem" class="ulist"> 
          <ul> 
           <li> <p><code>removeMenuItem</code> - удаляет элемент из списка элементов меню.</p> </li> 
           <li> <p><code>getMenuItem</code> - возвращает объект элемента меню по его идентификатору.</p> </li> 
           <li> <p><code>hasMenuItems</code> - возвращает <code>true</code>, если в меню есть вложенные элементы.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>SideMenu</code> предназначен для отображения элементов меню. Чтобы создать элемент меню, используется API компонента <code>MenuItem</code> в контроллере экрана. Методы, перечисленные ниже, можно использовать для динамического обновления элементов меню, реализуя бизнес-логику приложения. Пример программного создания элемента меню:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">SideMenu.MenuItem item = sideMenu.createMenuItem(<span class="string"><span class="delimiter">"</span><span class="content">special</span><span class="delimiter">"</span></span>);
item.setCaption(<span class="string"><span class="delimiter">"</span><span class="content">Daily offer</span><span class="delimiter">"</span></span>);
item.setBadgeText(<span class="string"><span class="delimiter">"</span><span class="content">New</span><span class="delimiter">"</span></span>);
item.setIcon(<span class="string"><span class="delimiter">"</span><span class="content">font-icon:GIFT</span><span class="delimiter">"</span></span>);
sideMenu.addMenuItem(item,<span class="integer">0</span>);</code></pre> 
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_sidemenu_3.png" alt="gui sidemenu 3"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p><strong>Методы интерфейса MenuItem:</strong></p> 
         </div> 
         <div id="gui_SideMenu_MenuItem_setCaption" class="ulist"> 
          <ul> 
           <li> <p><code>setCaption</code> - устанавливает заголовок элемента меню.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_MenuItem_setCaptionAsHtml" class="ulist"> 
          <ul> 
           <li> <p><code>setCaptionAsHtml</code> - разрешает/запрещает использование HTML-заголовков.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_MenuItem_setBadgeText" class="ulist"> 
          <ul> 
           <li> <p><code>setBadgeText</code> - устанавливает текст ярлыка элемента меню. Ярлыки представляют собой небольшие виджеты справа от элемента меню, к примеру:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> count = <span class="integer">5</span>;
SideMenu.MenuItem item = sideMenu.createMenuItem(<span class="string"><span class="delimiter">"</span><span class="content">count</span><span class="delimiter">"</span></span>);
item.setCaption(<span class="string"><span class="delimiter">"</span><span class="content">Messages</span><span class="delimiter">"</span></span>);
item.setBadgeText(count + <span class="string"><span class="delimiter">"</span><span class="content"> new</span><span class="delimiter">"</span></span>);
item.setIcon(<span class="string"><span class="delimiter">"</span><span class="content">font-icon:ENVELOPE</span><span class="delimiter">"</span></span>);
sideMenu.addMenuItem(item,<span class="integer">0</span>);</code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_sidemenu_4.png" alt="gui sidemenu 4"> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Текст ярлыка можно обновлять автоматически с помощью компонента <a href="/manual.html#gui_Timer">Timer</a>:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> updateCounters(<span class="predefined-type">Timer</span> source) {
    sideMenu.getMenuItemNN(<span class="string"><span class="delimiter">"</span><span class="content">sales</span><span class="delimiter">"</span></span>)
            .setBadgeText(<span class="predefined-type">String</span>.valueOf(LocalTime.MIDNIGHT.minusSeconds(timerCounter-source.getDelay())));
    timerCounter++;
}</code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_sidemenu_5.png" alt="gui sidemenu 5"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_MenuItem_setIcon" class="ulist"> 
          <ul> 
           <li> <p><code>setIcon</code> - устанавливает пиктограмму элемента меню.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_MenuItem_setCommand" class="ulist"> 
          <ul> 
           <li> <p><code>setCommand</code> - используется для описания действия, которое должно быть выполнено при выборе этого элемента меню кликом мыши.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_MenuItem_addChildItem" class="ulist"> 
          <ul> 
           <li> <p><code>addChildItem/removeChildItem</code> - добавляет/удаляет элементы меню в подгруппу корневого элемента.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_MenuItem_setExpanded" class="ulist"> 
          <ul> 
           <li> <p><code>setExpanded</code> - раскрывает или сворачивает подгруппы меню по умолчанию.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_MenuItem_setStyleName" class="ulist"> 
          <ul> 
           <li> <p><code>setStyleName</code> - устанавливает один или более пользовательских стилей для компонента, заменяя все ранее заданные стили. Имена стилей при перечислении отделаются пробелами. Имя стиля должно быть названием существующего CSS-класса.</p> 
            <div class="paragraph"> 
             <p>Стандартный шаблон главного экрана с <code>sideMenu</code> стилизован несколькими предопределёнными стилями: <code>c-sidemenu-layout</code>, <code>c-sidemenu-panel</code> и <code>c-sidemenu-title</code>. Стиль бокового меню по умолчанию <code>c-sidemenu</code> поддерживается только в рамках темы <code>Halo</code> и темах, её расширяющих. В теме <code>Havana</code> стили <code>sideMenu</code> не поддерживаются.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_SideMenu_MenuItem_setTestId" class="ulist"> 
          <ul> 
           <li> <p><code>setTestId</code> - устанавливает значение <code>cuba-id</code> для тестирования UI.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты sideMenu
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_SideMenu_selectOnClick">selectOnClick</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты ftsfield
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API sideMenu
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_SideMenu_addMenuItem">addMenuItem</a> - <a href="/manual.html#gui_SideMenu_createMenuItem">createMenuItem</a> - <a href="/manual.html#gui_SideMenu_removeMenuItem">removeMenuItem</a></p> 
           </dd> 
           <dt class="hdlist1">
            API menuItem
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_SideMenu_MenuItem_addChildItem">addChildItem</a> - <a href="/manual.html#gui_SideMenu_MenuItem_addChildItem">removeChildItem</a> - <a href="/manual.html#gui_SideMenu_MenuItem_setBadgeText">setBadgeText</a> - <a href="/manual.html#gui_SideMenu_MenuItem_setCaption">setCaption</a> - <a href="/manual.html#gui_SideMenu_MenuItem_setCaptionAsHtml">setCaptionAsHtml</a> - <a href="/manual.html#gui_SideMenu_MenuItem_setCommand">setCommand</a> - <a href="/manual.html#gui_SideMenu_MenuItem_setExpanded">setExpanded</a> - <a href="/manual.html#gui_SideMenu_MenuItem_setIcon">setIcon</a> - <a href="/manual.html#gui_SideMenu_MenuItem_setStyleName">setStyleName</a> - <a href="/manual.html#gui_SideMenu_MenuItem_setTestId">setTestId</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_SourceCodeEditor"><a class="anchor" href="/manual.html#gui_SourceCodeEditor"></a>5.5.2.1.36. SourceCodeEditor</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-codeeditor" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>SourceCodeEditor</code> - компонент для отображения и ввода исходного кода. Он представляет собой многострочное текстовое поле с возможностью подсветки кода и отображения полей печати и номеров строк.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>sourceCodeEditor</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>SourceCodeEditor</code> реализован для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>SourceCodeEditor</code> в основном повторяет функциональность <a href="/manual.html#gui_TextField">TextField</a> и имеет следующие специфические атрибуты:</p> 
         </div> 
         <div id="gui_sourceCodeEditor_handleTabKey" class="ulist"> 
          <ul> 
           <li> <p>если <code>handleTabKey</code> имеет значение <code>true</code>, нажатие на кнопку <strong>Tab</strong> на клавиатуре добавляет отступ текущей строки, если значение равно <code>false</code>, нажатие перемещает курсор или фокус на следующую позицию табуляции. Данный атрибут необходимо установить во время инициализации экрана, он не может быть изменён во время работы.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Следующие свойства можно легко изменять в работающем приложении:</p> 
         </div> 
         <div id="gui_sourceCodeEditor_highlightActiveLine" class="ulist"> 
          <ul> 
           <li> <p><code>highlightActiveLine</code> используется для подсветки текущей строки, на которой находится курсор.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_sourceCodeEditor_mode" class="ulist"> 
          <ul> 
           <li> <p>атрибут <code>mode</code> предоставляет список языков, для которых поддерживается подсветка синтаксиса. Этот список задан в перечислении <code>Mode</code> интерфейса <code>SourceCodeEditor</code> и включает в себя следующие языки: Java, HTML, XML, Groovy, SQL, JavaScript, Properties и Text без подсветки.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_sourceCodeEditor_printMargin" class="ulist"> 
          <ul> 
           <li> <p><code>printMargin</code> определяет, отображать или скрыть линию края печати в текстовом поле.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_sourceCodeEditor_showGutter" class="ulist"> 
          <ul> 
           <li> <p><code>showGutter</code> используется для отображения или скрытия левой панели с номерами строк.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Ниже приведён пример компонента <code>SourceCodeEditor</code> с динамически настраиваемыми атрибутами.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-дескриптор:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hbox</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;checkBox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">highlightActiveLineCheck</span><span class="delimiter">"</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">BOTTOM_LEFT</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Highlight Active Line</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;checkBox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">printMarginCheck</span><span class="delimiter">"</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">BOTTOM_LEFT</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Print Margin</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;checkBox</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">showGutterCheck</span><span class="delimiter">"</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">BOTTOM_LEFT</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Show Gutter</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;lookupField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">modeField</span><span class="delimiter">"</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">BOTTOM_LEFT</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Mode</span><span class="delimiter">"</span></span> <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hbox&gt;</span>
<span class="tag">&lt;sourceCodeEditor</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">simpleCodeEditor</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Контроллер:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> LookupField modeField;
<span class="annotation">@Inject</span>
<span class="directive">private</span> SourceCodeEditor simpleCodeEditor;
<span class="annotation">@Inject</span>
<span class="directive">private</span> CheckBox highlightActiveLineCheck;
<span class="annotation">@Inject</span>
<span class="directive">private</span> CheckBox printMarginCheck;
<span class="annotation">@Inject</span>
<span class="directive">private</span> CheckBox showGutterCheck;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    highlightActiveLineCheck.setValue(simpleCodeEditor.isHighlightActiveLine());
    highlightActiveLineCheck.addValueChangeListener(e -&gt; simpleCodeEditor.setHighlightActiveLine(<span class="predefined-type">Boolean</span>.TRUE.equals(e.getValue())));

    printMarginCheck.setValue(simpleCodeEditor.isShowPrintMargin());
    printMarginCheck.addValueChangeListener(e -&gt; simpleCodeEditor.setShowPrintMargin(<span class="predefined-type">Boolean</span>.TRUE.equals(e.getValue())));

    showGutterCheck.setValue(simpleCodeEditor.isShowGutter());
    showGutterCheck.addValueChangeListener(e -&gt; simpleCodeEditor.setShowGutter(<span class="predefined-type">Boolean</span>.TRUE.equals(e.getValue())));

    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; modes = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
    <span class="keyword">for</span> (SourceCodeEditor.Mode mode : SourceCodeEditor.Mode.values()) {
        modes.put(mode.toString(), mode);
    }

    modeField.setOptionsMap(modes);
    modeField.setValue(SourceCodeEditor.Mode.Text);
    modeField.addValueChangeListener(e -&gt; simpleCodeEditor.setMode((SourceCodeEditor.Mode) e.getValue()));
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Результат выполения кода:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_SourceCodeEditor_1.png" alt="gui SourceCodeEditor 1"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>SourceCodeEditor</code> также поддерживает автодополнение кода, определяемое с помощью класса <code>Suggester</code>. Чтобы подключить автодополнение, необходимо переопределить и вызвать метод <code>setSuggester</code>, например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> SourceCodeEditor suggesterCodeEditor;
<span class="annotation">@Inject</span>
<span class="directive">private</span> CollectionDatasource&lt;User, <span class="predefined-type">UUID</span>&gt; usersDs;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    suggesterCodeEditor.setSuggester((source, text, cursorPosition) -&gt; {
        <span class="predefined-type">List</span>&lt;Suggestion&gt; suggestions = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
        usersDs.refresh();
        <span class="keyword">for</span> (User user : usersDs.getItems()) {
            suggestions.add(<span class="keyword">new</span> Suggestion(source, user.getLogin(), user.getName(), <span class="predefined-constant">null</span>, -<span class="integer">1</span>, -<span class="integer">1</span>));
        }
        <span class="keyword">return</span> suggestions;
    });
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Результат:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_SourceCodeEditor_2.png" alt="gui SourceCodeEditor 2"> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты sourceCodeEditor
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_colspan">colspan</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_sourceCodeEditor_handleTabKey">handleTabKey</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_sourceCodeEditor_highlightActiveLine">highlightActiveLine</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_sourceCodeEditor_mode">mode</a> - <a href="/manual.html#gui_sourceCodeEditor_printMargin">printMargin</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_rowspan">rowspan</a> - <a href="/manual.html#gui_sourceCodeEditor_showGutter">showGutter</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_SuggestionPickerField"><a class="anchor" href="/manual.html#gui_SuggestionPickerField"></a>5.5.2.1.37. SuggestionPickerField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=datasource-suggestion-picker-field" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>SuggestionPickerField</code> предназначен для поиска экземпляров сущности по строке, вводимой пользователем. Он отличается от <a href="/manual.html#gui_SearchPickerField">SearchPickerField</a> тем, что обновляет список опций при каждом вводе символа пользователем без необходимости нажимать Enter. Список опций загружается асинхронно в соответствии с логикой, задаваемой разработчиком на стороне сервера.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>SuggestionPickerField</code> является также <a href="/manual.html#gui_PickerField">PickerField</a> и может содержать действия, отображаемые кнопками справа.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_suggestionPickerField_1.png" alt="gui suggestionPickerField 1"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>suggestionPickerField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>SuggestionPickerField</code> используется для выбора значений ссылочных атрибутов, поэтому для компонента обычно указываются атрибуты <code>datasource</code> и <code>property</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span>
                <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Order</span><span class="delimiter">"</span></span>
                <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">order-view</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;suggestionPickerField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">suggestionPickerField</span><span class="delimiter">"</span></span>
                           <span class="attribute-name">captionProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>
                           <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span>
                           <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/layout&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>suggestionPickerField</code>:</p> 
         </div> 
         <div id="gui_suggestionPickerField_asyncSearchDelayMs" class="ulist"> 
          <ul> 
           <li> <p><code>asyncSearchDelayMs</code> - устанавливает задержку между последним нажатием клавиши и асинхронным поиском.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_suggestionPickerField_metaClass" class="ulist"> 
          <ul> 
           <li> <p><code>metaClass</code> - указывает ссылку на интерфейс метаданных компонента в случае, если компонент используется без непосредственной привязки к данным, то есть без указания <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_suggestionPickerField_minSearchStringLength" class="ulist"> 
          <ul> 
           <li> <p><code>minSearchStringLength</code> - устанавливает минимальную длину строки для начала поиска.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_suggestionPickerField_suggestionsLimit" class="ulist"> 
          <ul> 
           <li> <p><code>suggestionsLimit</code> - устанавливает ограничение количества выводимых подсказок.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Элементы <code>suggestionPickerField</code>:</p> 
         </div> 
         <div id="gui_suggestionPickerField_actions" class="ulist"> 
          <ul> 
           <li> <p><code>actions</code> - необязательный элемент для описания действий, связанных с компонентом. Кроме описания произвольных действий, поддерживаются следующие <a href="/manual.html#picker_actions">стандартные действия</a>, определяемые перечислением <code>PickerField.ActionType</code>: <code>lookup</code>, <code>open</code>, <code>clear</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_suggestionPickerField_query" class="ulist"> 
          <ul> 
           <li> <p><code>query</code> - необязательный элемент, позволяющий задать запрос для выбора предлагаемых значений. Элемент <code>query</code>, в свою очередь, имеет следующие атрибуты:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div id="gui_suggestionPickerField_query_entityClass" class="ulist"> 
               <ul> 
                <li> <p><code>entityClass</code> (обязательный атрибут) - полное квалифицированное имя класса сущности.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_suggestionPickerField_query_escapeValueForLike" class="ulist"> 
               <ul> 
                <li> <p><code>escapeValueForLike</code> - позволяет разрешить поиск по значениям, содержащим специальные символы: <code>%</code>, <code>\</code>, и т.д. По умолчанию <code>false</code>,</p> </li> 
               </ul> 
              </div> 
              <div id="gui_suggestionPickerField_query_searchStringFormat" class="ulist"> 
               <ul> 
                <li> <p><code>searchStringFormat</code> - строка Groovy, что позволяет использовать в запросе валидные Groovy-выражения.</p> </li> 
               </ul> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;suggestionField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">suggestionField</span><span class="delimiter">"</span></span>
                 <span class="attribute-name">captionProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">login</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;query</span> <span class="attribute-name">entityClass</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.security.entity.User</span><span class="delimiter">"</span></span>
           <span class="attribute-name">escapeValueForLike</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
           <span class="attribute-name">searchStringFormat</span>=<span class="string"><span class="delimiter">"</span><span class="content">%$searchString%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        select e from sec$User e where e.login like :searchString
    <span class="tag">&lt;/query&gt;</span>
<span class="tag">&lt;/suggestionField&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Если элемент <code>query</code> не задан, то список опций должен быть предоставлен объектом типа <code>SearchExecutor</code>, созданным программно (см. ниже).</p> 
              </div> 
             </div> 
            </div> 
            <div class="dlist"> 
             <dl> 
              <dt class="hdlist1">
               Простой пример использования SuggestionPickerField
              </dt> 
              <dd> 
               <div class="openblock"> 
                <div class="content"> 
                 <div class="paragraph"> 
                  <p>Как правило, для компонента достаточно установить <code>SearchExecutor</code>. <code>SearchExecutor</code> - это функциональный интерфейс, содержащий один метод: <code>List&lt;E extends Entity&gt; search(String searchString, Map&lt;String, Object&gt; searchParams)</code>:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java">suggestionPickerField.setSearchExecutor((searchString, searchParams) -&gt; {
    <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(entity1, entity2, ...);
});</code></pre> 
                  </div> 
                 </div> 
                 <div class="admonitionblock warning"> 
                  <table> 
                   <tbody>
                    <tr> 
                     <td class="icon"> 
                      <div class="title">
                       Warning
                      </div> </td> 
                     <td class="content"> 
                      <div class="paragraph"> 
                       <p>Метод <code>search()</code> выполняется в фоновом потоке, поэтому он не может обращаться к визуальным компонентам или источникам данных, связанным с визуальными компонентами. Можно использовать <a href="/manual.html#dataManager">DataManager</a> или напрямую вызывать сервисы среднего слоя, или обрабатывать и возвращать данные, предварительно загруженные в экран.</p> 
                      </div> </td> 
                    </tr> 
                   </tbody>
                  </table> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Параметр <code>searchString</code> может быть использован для фильтрации кандидатов по строке, введенной пользователем:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">OrderEdit</span> <span class="directive">extends</span> AbstractEditor&lt;Order&gt; {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> SuggestionPickerField suggestionPickerField;

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> DataManager dataManager;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        suggestionPickerField.setSearchExecutor((searchString, searchParams) -&gt;
                dataManager.loadList(LoadContext.create(Customer.class).setQuery(
                    LoadContext.createQuery(<span class="string"><span class="delimiter">"</span><span class="content">select c from sample$Customer c where c.name like :name order by c.name</span><span class="delimiter">"</span></span>)
                        .setParameter(<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">%</span><span class="delimiter">"</span></span> + searchString + <span class="string"><span class="delimiter">"</span><span class="content">%</span><span class="delimiter">"</span></span>))));
    }
}</code></pre> 
                  </div> 
                 </div> 
                </div> 
               </div> 
              </dd> 
              <dt class="hdlist1">
               Использование ParametrizedSearchExecutor
              </dt> 
              <dd> 
               <div class="openblock"> 
                <div class="content"> 
                 <div class="paragraph"> 
                  <p>В примерах выше параметр <code>searchParams</code> является пустым. Для поиска с параметрами используется <code>ParametrizedSearchExecutor</code>:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java">suggestionPickerField.setSearchExecutor(<span class="keyword">new</span> SuggestionField.ParametrizedSearchExecutor&lt;Customer&gt;(){
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; getParams() {
        <span class="keyword">return</span> ParamsMap.of(...);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Customer&gt; search(<span class="predefined-type">String</span> searchString, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; searchParams) {
        <span class="keyword">return</span> executeSearch(searchString, searchParams);
    }
});</code></pre> 
                  </div> 
                 </div> 
                </div> 
               </div> 
              </dd> 
              <dt class="hdlist1">
               Использование EnterActionHandler и ArrowDownActionHandler
              </dt> 
              <dd> 
               <div class="openblock"> 
                <div class="content"> 
                 <div class="paragraph"> 
                  <p>Компонент также может быть использован с обработчиками событий <code>EnterActionHandler</code> и <code>ArrowDownActionHandler</code>. Эти листнеры срабатывают, когда пользователь нажимает клавиши <strong>Enter</strong> или <strong>Arrow Down</strong> при скрытом всплывающем окне для подсказок. Они также представляют собой функциональные интерфейсы с единственным методом с одним параметром - <code>currentSearchString</code>. Вы можете настроить и свои обработчики событий и использовать метод <code>showSuggestions()</code> интерфейса <code>SuggestionField</code>, который принимает список сущностей, для отображения подсказок:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java">suggestionPickerField.setArrowDownActionHandler(currentSearchString -&gt; {
    <span class="predefined-type">List</span>&lt;Customer&gt; suggestions = findSuggestions();
    suggestionPickerField.showSuggestions(suggestions);
});

suggestionPickerField.setEnterActionHandler(currentSearchString -&gt; {
    <span class="predefined-type">List</span>&lt;Customer&gt; suggestions = getDefaultSuggestions();
    suggestionPickerField.showSuggestions(suggestions);
});</code></pre> 
                  </div> 
                 </div> 
                </div> 
               </div> 
              </dd> 
             </dl> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты suggestionPickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_suggestionPickerField_asyncSearchDelayMs">asyncSearchDelayMs</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_attr_colspan">colspan</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_inputPrompt">inputPrompt</a> - <a href="/manual.html#gui_suggestionPickerField_metaClass">metaClass</a> - <a href="/manual.html#gui_suggestionPickerField_minSearchStringLength">minSearchStringLength</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_responsive">responsive</a> - <a href="/manual.html#gui_attr_rowspan">rowspan</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_suggestionPickerField_suggestionsLimit">suggestionsLimit</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы suggestionPickerField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_suggestionPickerField_actions">actions</a> - <a href="/manual.html#gui_suggestionPickerField_query">query</a> - <a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты query
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_suggestionPickerField_query_entityClass">entityClass</a> - <a href="/manual.html#gui_suggestionPickerField_query_escapeValueForLike">escapeValueForLike</a> - <a href="/manual.html#gui_suggestionPickerField_query_searchStringFormat">searchStringFormat</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Table"><a class="anchor" href="/manual.html#gui_Table"></a>5.5.2.1.38. Table</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-table" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>Table</code> позволяет выводить информацию в табличном виде, сортировать данные, управлять колонками и заголовками таблицы, вызывать действия для выбранных строк.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_table.png" alt="gui table"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>table</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания таблицы в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span>
                          <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span>
                          <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderWithCustomer</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>
            select o from sales$Order o order by o.date
        <span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersTable</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">300px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;columns&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer.name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/columns&gt;</span>
        <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/table&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Здесь в элементе <code>dsContext</code> определен <a href="/manual.html#datasources">источник данных</a> <code>collectionDatasource</code>, который выбирает сущности <code>Order</code> с помощью <a href="/manual.html#jpql">JPQL</a> запроса <code>select o from sales$Order o order by o.date</code>. Для компонента <code>table</code> в элементе <code>rows</code> указывается используемый источник данных, а в элементе <code>columns</code> - какие атрибуты сущности, содержащейся в источнике данных, использовать в качестве колонок.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Элементы <code>table</code>:</p> 
         </div> 
         <div id="gui_Table_rows" class="ulist"> 
          <ul> 
           <li> <p><code>rows</code> - обязательный элемент, в атрибуте <code>datasource</code> которого необходимо объявить используемый таблицей <a href="/manual.html#datasources">источник данных</a>.</p> 
            <div class="paragraph"> 
             <p>Для строк можно настроить отображение заголовков - задать каждой строке свой значок в дополнительной колонке слева. Для этого в контроллере экрана необходимо реализовать интерфейс <code>ListComponent.IconProvider</code> и установить его таблице:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Table&lt;Customer&gt; table;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    table.setIconProvider(<span class="keyword">new</span> ListComponent.IconProvider&lt;Customer&gt;() {
        <span class="annotation">@Nullable</span>
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getItemIcon(Customer entity) {
            CustomerGrade grade = entity.getGrade();
            <span class="keyword">switch</span> (grade) {
                <span class="keyword">case</span> PREMIUM: <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">icons/premium_grade.png</span><span class="delimiter">"</span></span>;
                <span class="keyword">case</span> HIGH: <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">icons/high_grade.png</span><span class="delimiter">"</span></span>;
                <span class="keyword">case</span> MEDIUM: <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">icons/medium_grade.png</span><span class="delimiter">"</span></span>;
                <span class="keyword">default</span>: <span class="keyword">return</span> <span class="predefined-constant">null</span>;
            }
        }
    });
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_columns" class="ulist"> 
          <ul> 
           <li> <p><code>columns</code> - обязательный элемент, определяет набор колонок таблицы.</p> 
            <div class="paragraph"> 
             <p>Каждая колонка описывается во вложенном элементе <code>column</code> со следующими атрибутами:</p> 
            </div> 
            <div class="openblock"> 
             <div class="content"> 
              <div id="gui_Table_column_id" class="ulist"> 
               <ul> 
                <li> <p><code>id</code> − обязательный атрибут, содержит название атрибута сущности, выводимого в колонке. Может быть как непосредственным атрибутом сущности, находящейся в источнике данных, так и атрибутом связанной сущности - переход по графу объектов обозначается точкой. Например:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;columns&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer.name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer.address.country</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/columns&gt;</span></code></pre> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_caption" class="ulist"> 
               <ul> 
                <li> <p><code>caption</code> − необязательный атрибут, содержит заголовок колонки. Если не задан, будет отображено <a href="/manual.html#entity_localization">локализованное название атрибута</a> сущности.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_collapsed" class="ulist"> 
               <ul> 
                <li> <p><code>collapsed</code> − необязательный атрибут, при указании <code>true</code> колонка будет изначально скрыта. Пользователь может управлять отображением колонок с помощью меню, доступного по кнопке <span class="image"><img src="assets/gui_table_columnControl.png" alt="gui_table_columnControl"></span> в правой верхней части таблицы, если атрибут <code>columnControlVisible</code> таблицы не <code>false</code>. По умолчанию <code>collapsed</code> имеет значение <code>false</code>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_width" class="ulist"> 
               <ul> 
                <li> <p><code>width</code> − необязательный атрибут, отвечает за изначальную ширину колонки. Может принимать только числовые значения в пикселах.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_align" class="ulist"> 
               <ul> 
                <li> <p><code>align</code> - необязательный атрибут, устанавливает выравнивание текста в ячейках данной колонки. Возможные значения: <code>LEFT</code>, <code>RIGHT</code>, <code>CENTER</code>. По умолчанию <code>LEFT</code>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_editable" class="ulist"> 
               <ul> 
                <li> <p><code>editable</code> − необязательный атрибут, разрешает/запрещает редактирование данной колонки в редактируемой таблице. Чтобы колонка была редактируемой, атрибут <a href="/manual.html#gui_Table_editable">editable</a> всей таблицы также должен быть установлен в <code>true</code>. Динамическое изменение значения этого атрибута не поддерживается.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_sortable" class="ulist"> 
               <ul> 
                <li> <p><code>sortable</code> − необязательный атрибут, позволяющий запретить сортировку колонки. Вступает в действие, если атрибут <a href="/manual.html#gui_Table_sortable">sortable</a> всей таблицы установлен в <code>true</code> (что имеет место по умолчанию).</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_maxTextLength" class="ulist"> 
               <ul> 
                <li> <p><code>maxTextLength</code> - необязательный атрибут, позволяет ограничивать количество символов в ячейке. При этом если разница между фактическим и допустимым количеством символов не превышает порог в 10 символов, "лишние" символы не скрываются. Для просмотра полной записи надо кликнуть на ее видимую часть. Пример колонки с ограничением в 5 символов:</p> 
                 <div class="imageblock" style="text-align: center"> 
                  <div class="content"> 
                   <img src="assets/gui_table_column_maxTextLength.png" alt="gui table column maxTextLength"> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_link" class="ulist"> 
               <ul> 
                <li> <p><code>link</code> - установка атрибута в <code>true</code> позволяет отобразить в ячейке таблицы ссылку на экран просмотра экземпляра сущности (поддерживается только для <strong>Web Client</strong>). Атрибут <code>link="true"</code>) может указываться и для колонок примитивных типов: в этом случае, при нажатии на ссылку будет открываться редактор основной сущности таблицы. Такой подход может применяться для упрощения навигации - пользователи смогут открывать редактор одним кликом по некоторому ключевому атрибуту.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_linkScreen" class="ulist"> 
               <ul> 
                <li> <p><code>linkScreen</code> - позволяет указать идентификатор экрана, который будет открыт по нажатию на ссылку, включенную свойством <code>link</code>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_linkScreenOpenType" class="ulist"> 
               <ul> 
                <li> <p><code>linkScreenOpenType</code> - задает режим открытия экрана (<code>THIS_TAB</code>, <code>NEW_TAB</code> или <code>DIALOG</code>).</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_linkInvoke" class="ulist"> 
               <ul> 
                <li> <p><code>linkInvoke</code> - позволяет заменить открытие окна на вызов метода контроллера.</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> linkedMethod(<span class="predefined-type">Entity</span> item, <span class="predefined-type">String</span> columnId) {
    Customer customer = (Customer) item;
    showNotification(customer.getName());
}</code></pre> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_captionProperty" class="ulist"> 
               <ul> 
                <li> <p><code>captionProperty</code> - имя атрибута сущности, который должен быть отображен в колонке вместо указанного в <a href="/manual.html#gui_Table_column_id">id</a>. Например, если имеется связанная сущность <code>Priority</code> с атрибутами <code>name</code> и <code>orderNo</code>, можно определить следующую колонку:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">priority.orderNo</span><span class="delimiter">"</span></span> <span class="attribute-name">captionProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">priority.name</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://priority</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>В этом случае в колонке будет отображаться название приоритета, а сортировка колонки будет осуществляться по атрибуту <code>orderNo</code>.</p> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_generator" class="ulist"> 
               <ul> 
                <li> <p>необязательный атрибут <code>generator</code> содержит ссылку на метод в контроллере экрана, который создает визуальный компонент для отображения содержимого ячейки:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;columns&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">imageFile</span><span class="delimiter">"</span></span>
            <span class="attribute-name">generator</span>=<span class="string"><span class="delimiter">"</span><span class="content">generateImageFileCell</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/columns&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Component</span> generateImageFileCell(Employee entity) {
    Embedded embedded = componentsFactory.createComponent(Embedded.class);
    embedded.setType(Embedded.Type.IMAGE);
    <span class="predefined-type">FileDescriptor</span> userImageFile = entity.getImageFile();
    FileDataProvider dataProvider = <span class="keyword">new</span> FileDataProvider(userImageFile);
    embedded.setSource(userImageFile.getId() + <span class="string"><span class="delimiter">"</span><span class="content">.</span><span class="delimiter">"</span></span> + userImageFile.getExtension(), dataProvider);
    <span class="keyword">return</span> embedded;
}</code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Он может быть использован вместо передачи реализации <code>Table.ColumnGenerator</code> в метод <a href="/manual.html#gui_Table_addGeneratedColumn">addGeneratedColumn()</a>.</p> 
                 </div> </li> 
                <li> <p>Элемент <code>column</code> может содержать вложенный элемент <a href="/manual.html#gui_formatter">formatter</a> для представления значения атрибута в виде, отличном от стандартного для данного <a href="/manual.html#datatype">Datatype</a>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;formatter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.gui.components.formatters.DateFormatter</span><span class="delimiter">"</span></span>
               <span class="attribute-name">format</span>=<span class="string"><span class="delimiter">"</span><span class="content">yyyy-MM-dd HH:mm:ss</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/column&gt;</span></code></pre> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_rowsCount" class="ulist"> 
          <ul> 
           <li> <p><code>rowsCount</code> − необязательный элемент, создающий для таблицы компонент <code>RowsCount</code>, который позволяет загружать в таблицу данные постранично. Размер страницы задается путем ограничения количества записей в источнике данных методом <code>CollectionDatasource.setMaxResults()</code>. Как правило, это делает связанный с источником данных таблицы компонент <a href="/manual.html#gui_Filter">Filter</a>, однако при отсутствии универсального фильтра можно вызвать этот метод и напрямую из контроллера экрана.</p> 
            <div class="paragraph"> 
             <p>Компонент <code>RowsCount</code> может также отобразить общее число записей, возвращаемых текущим запросом в источнике данных, без извлечения этих записей. Для этого при щелчке пользователя на знаке "?" он вызывает метод <code>AbstractCollectionDatasource.getCount()</code>, что приводит к выполнению в БД запроса с такими же, как у текущего запроса условиями, но с агрегатной функцией <code>COUNT(*)</code> вместо результатов. Полученное число отображается вместо знака "?".</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_actions" class="ulist"> 
          <ul> 
           <li> <p><code>actions</code> − необязательный элемент для описания <a href="/manual.html#gui_Action">действий</a>, связанных с таблицей. Кроме описания произвольных действий, поддерживаются следующие <a href="/manual.html#standard_actions">стандартные действия</a>, определяемые перечислением <code>ListActionType</code>: <code>create</code>, <code>edit</code>, <code>remove</code>, <code>refresh</code>, <code>add</code>, <code>exclude</code>, <code>excel</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_buttonsPanel" class="ulist"> 
          <ul> 
           <li> <p><code>buttonsPanel</code> - необязательный элемент, создающий над таблицей контейнер <a href="/manual.html#gui_ButtonsPanel">ButtonsPanel</a> для отображения кнопок действий.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>table</code>:</p> 
         </div> 
         <div id="gui_Table_multiselect" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>multiselect</code> позволяет задать режим множественного выделения строк в таблице. Если <code>multiselect</code> равен <code>true</code>, то пользователь может выделить несколько строк с помощью клавиатуры или мыши, удерживая клавиши <strong>Ctrl</strong> или <strong>Shift</strong>. По умолчанию режим множественного выделения отключен.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_sortable" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>sortable</code> разрешает или запрещает сортировку в таблице. По умолчанию имеет значение <code>true</code>. Если сортировка разрешена, то при нажатии на название колонки справа от названия появляется значок <span class="image"><img src="assets/gui_sortable_down.png" alt="gui_sortable_down"></span>/<span class="image"><img src="assets/gui_sortable_up.png" alt="gui_sortable_up"></span>. Сортировку некоторой отдельной колонки можно запретить с помощью атрибута <a href="/manual.html#gui_Table_column_sortable">sortable</a> этой колонки.</p> 
            <div class="paragraph"> 
             <p>При включенной с помощью элемента <code>rowsCount</code> (см. выше) страничной загрузке таблицы сортировка производится разными способами в зависимости от того, умещаются ли все записи на одной странице. Если умещаются, то сортировка производится в памяти, без обращений к БД. Если же страниц больше одной, то сортировка производится на базе данных путем отправки нового запроса с соответствующим <code>ORDER BY</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Колонка таблицы может ссылаться на локальный атрибут или на связанную сущность. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersTable</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;columns&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer.name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- the 'name' attribute of the 'Customer' entity --&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">contract</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>      <span class="comment">&lt;!-- the 'Contract' entity --&gt;</span>
    <span class="tag">&lt;/columns&gt;</span>
    <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/table&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В последнем случае, сортировка на базе данных производится по атрибутам, указанным в аннотации <code>@NamePattern</code> связанной сущности. Если у связанной сущности нет такой аннотации, то сортировка производится в памяти только в пределах текущей страницы.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если колонка таблицы ссылается на неперсистентный атрибут, то сортировка на базе данных производится по атрибутам, указанным в параметре <code>related()</code> аннотации <code>@MetaProperty</code>. Если такой параметр не указан, то сортировка производится в памяти только в пределах текущей страницы.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если таблица соединена со вложенным <a href="/manual.html#datasources">источником данных</a>, который содержит коллекцию связанных сущностей, то для того, чтобы таблицу можно было сортировать, атрибут-коллекция должен быть упорядоченного типа (<code>List</code> или <code>LinkedHashSet</code>). Если атрибут имеет тип <code>Set</code>, то атрибут <code>sortable</code> не оказывает влияния и пользователи не смогут сортировать таблицу.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_presentations" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>presentations</code> управляет механизмом <a href="/manual.html#gui_presentations">представлений</a>. Значение по умолчанию равно <code>false</code>. Когда значение атрибута равно <code>true</code>, то в верхнем правом углу таблицы появляется значок <span class="image"><img src="assets/gui_presentation.png" alt="gui_presentation"></span>. Механизм представлений реализован только для блока <strong>Web Client</strong>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_columnControlVisible" class="ulist"> 
          <ul> 
           <li> <p>Установка атрибута <code>columnControlVisible</code> в <code>false</code> запрещает пользователю скрывать колонки с помощью меню, выпадающего при нажатия на кнопку <span class="image"><img src="assets/gui_table_columnControl.png" alt="gui_table_columnControl"></span> в правой части шапки таблицы. Флажками в меню отмечаются отображаемые в данный момент колонки.</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_table_columnControl_all.png" alt="gui table columnControl all"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_reorderingAllowed" class="ulist"> 
          <ul> 
           <li> <p>Установка атрибута <code>reorderingAllowed</code> в <code>false</code> запрещает пользователю менять местами колонки, перетаскивая их с помощью мыши.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_columnHeaderVisible" class="ulist"> 
          <ul> 
           <li> <p>Установка атрибута <code>columnHeaderVisible</code> в <code>false</code> скрывает заголовок таблицы.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_showSelection" class="ulist"> 
          <ul> 
           <li> <p>При установленном в <code>false</code> атрибуте <code>showSelection</code> текущая строка не имеет выделения.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_allowPopupMenu" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>contextMenuEnabled</code> разрешает или запрещает показывать контекстное меню. По умолчанию атрибут имеет значение <code>true</code>. В контекстном меню отображаются действия таблицы (если они есть), и пункт <strong>Системная информация</strong>, содержащий информацию о выбранной сущности (если у пользователя есть <a href="/manual.html#permissions">разрешение</a> <code>cuba.gui.showInfo</code>).</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_multiLineCells" class="ulist"> 
          <ul> 
           <li> <p>Если атрибуту <code>multiLineCells</code> таблицы присвоить значение <code>true</code>, то ячейки, содержащие текст с переносами строк, будут отображать его в несколько строк. В таком режиме в веб клиенте для правильной работы полосы прокрутки все строки текущей страницы таблицы будут загружены веб-браузером сразу, без ленивой загрузки видимой части таблицы. По умолчанию атрибут имеет значение <code>false</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_aggregatable" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>aggregatable</code> включает режим агрегации строк таблицы. Поддерживаются следующие операции:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>SUM</code> - сумма</p> </li> 
                <li> <p><code>AVG</code> - среднее значение</p> </li> 
                <li> <p><code>COUNT</code> - количество</p> </li> 
                <li> <p><code>MIN</code> - минимальное значение</p> </li> 
                <li> <p><code>MAX</code> - максимальное значение</p> </li> 
               </ul> 
              </div> 
              <div id="gui_Table_column_aggregation" class="paragraph"> 
               <p>Для агрегируемых колонок необходимо указать элемент <code>aggregation</code> с атрибутом <code>type</code>, задающим функцию агрегации. По умолчанию в агрегируемых колонках поддерживаются только числовые типы данных, такие как <code>Integer, Double, Long</code> и <code>BigDecimal</code>. Агрегированные значения столбцов выводятся в дополнительной строке вверху таблицы. Пример описания таблицы с агрегацией:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">itemsTable</span><span class="delimiter">"</span></span> <span class="attribute-name">aggregatable</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;columns&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">product</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">quantity</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;aggregation</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">SUM</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/column&gt;</span>
    <span class="tag">&lt;/columns&gt;</span>
    <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">itemsDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/table&gt;</span></code></pre> 
               </div> 
              </div> 
              <div id="gui_Table_column_aggregation_strategyClass" class="paragraph"> 
               <p>Элемент <code>aggregation</code> может также содержать атрибут <code>strategyClass</code>, указывающий класс, реализующий интерфейс <code>AggregationStrategy</code> interface (см. ниже пример установки стратегии агрегации программно).</p> 
              </div> 
              <div class="paragraph"> 
               <p>Для отображения агрегированного значения в виде, отличном от стандартного для данного <a href="/manual.html#datatype">Datatype</a>, для него можно указать <a href="/manual.html#gui_formatter">Formatter</a>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;aggregation</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">SUM</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;formatter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.MyFormatter</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/aggregation&gt;</span>
<span class="tag">&lt;/column&gt;</span></code></pre> 
               </div> 
              </div> 
              <div id="gui_Table_aggregationStyle" class="paragraph"> 
               <p>Атрибут <code>aggregationStyle</code> позволяет задать положение строки агрегации: <code>TOP</code> или <code>BOTTOM</code>. По умолчанию используется <code>TOP</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>В дополнение к операциям, перечисленным выше, можно задать собственную стратегию агрегации путем создания класса, реализующего интерфейс <code>AggregationStrategy</code>, и передачи его методу <code>setAggregation()</code> класса <code>Table.Column</code> в составе экземпляра <code>AggregationInfo</code>. Например:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TimeEntryAggregation</span> <span class="directive">implements</span> AggregationStrategy&lt;<span class="predefined-type">List</span>&lt;TimeEntry&gt;, <span class="predefined-type">String</span>&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> aggregate(<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">List</span>&lt;TimeEntry&gt;&gt; propertyValues) {
        HoursAndMinutes total = <span class="keyword">new</span> HoursAndMinutes();
        <span class="keyword">for</span> (<span class="predefined-type">List</span>&lt;TimeEntry&gt; list : propertyValues) {
            <span class="keyword">for</span> (TimeEntry timeEntry : list) {
                total.add(HoursAndMinutes.fromTimeEntry(timeEntry));
            }
        }
        <span class="keyword">return</span> StringFormatHelper.getTotalDayAggregationString(total);
    }
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;<span class="predefined-type">String</span>&gt; getResultClass() {
        <span class="keyword">return</span> <span class="predefined-type">String</span>.class;
    }
}</code></pre> 
               </div> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">AggregationInfo info = <span class="keyword">new</span> AggregationInfo();
info.setPropertyPath(metaPropertyPath);
info.setStrategy(<span class="keyword">new</span> TimeEntryAggregation());

Table.Column column = weeklyReportsTable.getColumn(columnId);
column.setAggregation(info);</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_editable" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>editable</code> позволяет перевести таблицу в режим in-place редактирования ячеек. В этом режиме в колонках, имеющих атрибут <code>editable = true</code>, отображаются компоненты для редактирования значений атрибутов сущности, находящейся в источнике данных.</p> 
            <div class="paragraph"> 
             <p>Тип компонента для каждой редактируемой колонки выбирается автоматически на основании типа атрибута сущности. Например, для строковых и числовых атрибутов используется <a href="/manual.html#gui_TextField">TextField</a>, для <code>Date</code> - <a href="/manual.html#gui_DateField">DateField</a>, для перечислений - <a href="/manual.html#gui_LookupField">LookupField</a>, для ссылок на другие сущности - <a href="/manual.html#gui_PickerField">PickerField</a>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Для редактируемой колонки типа <code>Date</code> можно дополнительно указать атрибуты <code>dateFormat</code> или <code>resolution</code> аналогично описанным для <a href="/manual.html#gui_DateField">DateField</a>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Для редактируемой колонки, отображающей связанную сущность, можно дополнительно указать атрибуты <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> и <a href="/manual.html#gui_attr_captionProperty">captionProperty</a>. При указании <code>optionsDatasource</code> вместо <a href="/manual.html#gui_PickerField">PickerField</a> используется компонент <a href="/manual.html#gui_LookupField">LookupField</a>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Произвольно настроить отображение ячеек, в том числе для редактирования содержимого, можно с помощью метода <code>Table.addGeneratedColumn()</code> - см. ниже.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_stylename" class="ulist"> 
          <ul> 
           <li> <p>В веб-клиенте с темой, основанной на Halo, атрибут <code>stylename</code> позволяет применять к таблице предопределенные стили <code>Table</code>. Стили задаются в XML-дексрипторе или контроллере экрана с помощью атрибута <code>stylename</code>:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">table</span><span class="delimiter">"</span></span>
       <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">no-stripes</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;columns&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">product</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">quantity</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/columns&gt;</span>
    <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">itemsDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/table&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Чтобы применить стиль программно, выберите одну из констант класса <code>HaloTheme</code> с префиксом компонента <code>TABLE_</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">table.setStyleName(HaloTheme.TABLE_NO_STRIPES);</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Стили компонента Table:</p> 
              </div> 
              <div id="gui_table_borderless" class="ulist"> 
               <ul> 
                <li> <p><code>borderless</code> - удаляет внешнюю рамку таблицы.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_table_compact" class="ulist"> 
               <ul> 
                <li> <p><code>compact</code> - уменьшает отступы внутри ячеек таблицы.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_table_no-header" class="ulist"> 
               <ul> 
                <li> <p><code>no-header</code> - скрывает заголовки таблицы.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_table_no-horizontal-lines" class="ulist"> 
               <ul> 
                <li> <p><code>no-horizontal-lines</code> - удаляет горизонтальные строковые разделители.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_table_no-stripes" class="ulist"> 
               <ul> 
                <li> <p><code>no-stripes</code> - отключает чередование цветов строк таблицы.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_table_no-vertical-lines" class="ulist"> 
               <ul> 
                <li> <p><code>no-vertical-lines</code> - удаляет вертикальные разделители столбцов.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_table_small" class="ulist"> 
               <ul> 
                <li> <p><code>small</code> - уменьшает размер шрифта и отступы внутри ячеек таблицы.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Методы интерфейса <code>Table</code>:</p> 
         </div> 
         <div id="gui_Table_ColumnCollapseListener" class="ulist"> 
          <ul> 
           <li> <p>метод <code>addColumnCollapsedListener</code>() позволяет отслеживать видимость колонок таблицы с помощью интерфейса слушателя <code>ColumnCollapsedListener</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_getSelected" class="ulist"> 
          <ul> 
           <li> <p><code>getSelected()</code>, <code>getSingleSelected()</code> - возвращают экземпляры сущностей, соответствующие выделенным в таблице строкам. Коллекцию можно получить вызовом метода <code>getSelected()</code>. Если ничего не выбрано, возвращается пустой набор. Если <code>multiselect</code> отключен, удобно пользоваться методом <code>getSingleSelected()</code>, возвращающим одну выбранную сущность или <code>null</code>, если ничего не выбрано.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_addGeneratedColumn" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>addGeneratedColumn()</code> позволяет задать собственное представление данных в колонке. Он принимает два параметра: идентификатор колонки и реализацию интерфейса <code>Table.ColumnGenerator</code>. Идентификатор может совпадать с одним из идентификаторов, указанных для колонок таблицы в XML-дескрипторе - в этом случае новая колонка вставляется вместо заданной в XML. Если идентификатор не совпадает ни с одной колонкой, создается новая справа.</p> 
            <div id="gui_Table_generateCell" class="paragraph"> 
             <p>Метод <code>generateCell()</code> интерфейса <code>Table.ColumnGenerator</code> вызывается таблицей для каждой строки, и в него передается экземпляр сущности, отображаемой в данной строке. Метод <code>generateCell()</code> должен вернуть визуальный компонент, который и будет отображаться в ячейке.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Пример использования:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Table carsTable;

<span class="annotation">@Inject</span>
<span class="directive">protected</span> ComponentsFactory componentsFactory;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    carsTable.addGeneratedColumn(<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> Table.ColumnGenerator() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Component</span> generateCell(<span class="predefined-type">Entity</span> entity) {
            LookupPickerField field = componentsFactory.createComponent(LookupPickerField.NAME);
            field.setDatasource(carsTable.getItemDatasource(entity), <span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span>);
            field.setOptionsDatasource(coloursDs);
            field.addLookupAction();
            field.addOpenAction();
            <span class="keyword">return</span> field;
        }
    });
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В данном случае в ячейках колонки <code>colour</code> таблицы отображается компонент <a href="/manual.html#gui_LookupPickerField">LookupPickerField</a>. Компонент должен сохранять свое значение в атрибут <code>colour</code> сущности, экземпляр которой отображается в данной строке. Для этого у таблицы методом <code>getItemDatasource()</code> запрашивается источник данных для текущего экземпляра сущности, и передается компоненту <code>LookupPickerField</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если в ячейке необходимо отобразить просто динамически сформированный текст, вместо компонента <a href="/manual.html#gui_Label">Label</a> используйте класс <code>Table.PlainTextCell</code>. Это упростит отрисовку и сделает таблицу быстрее.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если в метод <code>addGeneratedColumn()</code> передан идентификатор колонки, не объявленной в XML-дескрипторе, то может понадобиться установить заголовок новой колонки следующим образом:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">carsTable.getColumn(<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span>).setCaption(<span class="string"><span class="delimiter">"</span><span class="content">Colour</span><span class="delimiter">"</span></span>);</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Существует также более декларативный подход, использующий XML-атрибут <a href="/manual.html#gui_Table_column_generator">generator</a>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_requestFocus" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>requestFocus()</code> позволяет установить фокус на определенное поле конкретной записи. Принимает два параметра: экземпляр сущности, определяющй строку и идентификатор колонки. Пример программной установки фокуса:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">table.requestFocus(item, <span class="string"><span class="delimiter">"</span><span class="content">count</span><span class="delimiter">"</span></span>);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_scrollTo" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>scrollTo()</code> позволяет программно прокрутить таблицу до нужной записи. Метод принимает экземпляр сущности, определяющий нужную строку в таблице.</p> 
            <div class="paragraph"> 
             <p>Пример использования метода:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">table.scrollTo(item);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_CellClickListener" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>setClickListener()</code> может избавить от необходимости добавлять генерируемые колонки с компонентами, если нужно нарисовать что-либо в ячейках и получать оповещения когда пользователь кликает на эти ячейки. Имплементация класса <code>CellClickListener</code>, передаваемая в данный метод, получает текущий экземпляр сущности и идентификатор колонки. Содержимое ячеек будет завернуто в элемент <code>span</code> со стилем <code>cuba-table-clickable-cell</code>, который можно использовать для задания отображения ячеек.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_setStyleProvider" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>setStyleProvider()</code> позволяет задать стиль отображения ячеек таблицы. Параметром метода должна быть реализация интерфейса <code>Table.StyleProvider</code>. Метод <code>getStyleName()</code> этого интерфейса вызывается таблицей отдельно для каждой строки и для каждой ячейки. Если метод вызван для строки, то первый параметр содержит экземпляр сущности, отображаемый этой строкой, а второй параметр <code>null</code>. Если же метод вызван для ячейки, то второй параметр содержит имя атрибута, отображаемого этой ячейкой.</p> 
            <div class="paragraph"> 
             <p>Пример задания стилей:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> Table customersTable;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    customersTable.setStyleProvider(<span class="keyword">new</span> Table.StyleProvider() {
        <span class="annotation">@Nullable</span>
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getStyleName(<span class="predefined-type">Entity</span> entity, <span class="annotation">@Nullable</span> <span class="predefined-type">String</span> property) {
            Customer customer = (Customer) entity;
            <span class="keyword">if</span> (property == <span class="predefined-constant">null</span>) {
                <span class="comment">// style for row</span>
                <span class="keyword">if</span> (hasComplaints(customer)) {
                    <span class="keyword">return</span><span class="string"><span class="delimiter">"</span><span class="content">unsatisfied-customer</span><span class="delimiter">"</span></span>;
                }
            } <span class="keyword">else</span> <span class="keyword">if</span> (property.equals(<span class="string"><span class="delimiter">"</span><span class="content">grade</span><span class="delimiter">"</span></span>)) {
                <span class="comment">// style for column "grade"</span>
                <span class="keyword">switch</span> (customer.getGrade()) {
                    <span class="keyword">case</span> PREMIUM: <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">premium-grade</span><span class="delimiter">"</span></span>;
                    <span class="keyword">case</span> HIGH: <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">high-grade</span><span class="delimiter">"</span></span>;
                    <span class="keyword">case</span> MEDIUM: <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">medium-grade</span><span class="delimiter">"</span></span>;
                    <span class="keyword">default</span>: <span class="keyword">return</span> <span class="predefined-constant">null</span>;
                }
            }
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
    });
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Далее нужно определить заданные для строк и ячеек стили в теме приложения. Подробная информация о создании темы находится в <a href="/manual.html#gui_themes">Создание темы приложения</a>. Для веб-клиента новые стили определяются в файле <code>styles.scss</code>. Имена стилей, заданные в контроллере, совместно с префиксами, обозначающими строку или колонку таблицы, образуют CSS-селекторы. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="css"><span class="class">.v-table-row</span><span class="class">.unsatisfied-customer</span> {
  <span class="key">font-weight</span>: <span class="value">bold</span>;
}
<span class="class">.v-table-cell-content</span><span class="class">.premium-grade</span> {
  <span class="key">background-color</span>: <span class="value">red</span>;
}
<span class="class">.v-table-cell-content</span><span class="class">.high-grade</span> {
  <span class="key">background-color</span>: <span class="value">green</span>;
}
<span class="class">.v-table-cell-content</span><span class="class">.medium-grade</span> {
  <span class="key">background-color</span>: <span class="value">blue</span>;
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_addPrintable" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>addPrintable()</code> позволяет задать специфическое представление данных колонки при выводе в XLS-файл, осуществляемом <a href="/manual.html#standard_actions">стандартным действием</a> <code>excel</code> или напрямую с помощью класса <code>ExcelExporter</code>. Метод принимает идентификатор колонки и реализацию интерфейса <code>Table.Printable</code> для нее. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">ordersTable.addPrintable(<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> Table.Printable&lt;Customer, <span class="predefined-type">String</span>&gt;() {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getValue(Customer customer) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">Name: </span><span class="delimiter">"</span></span> + customer.getName;
    }
});</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Метод <code>getValue()</code> интерфейса <code>Table.Printable</code> должен возвращать данные, которые будут находиться в ячейке таблицы. Это может быть не только строка - метод может возвращать значения других типов, например, числовые данные или даты, и они будут представлены в XLS-файле соответствующим образом.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Если форматированный вывод в XLS необходим для генерируемой колонки, нужно использовать реализацию интерфейса <code>Table.PrintableColumnGenerator</code>, передавая ее методу <code>addGeneratedColumn()</code>. Значение для вывода в ячейку XLS-документа задается в методе <code>getValue()</code> этого интерфейса:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">ordersTable.addGeneratedColumn(<span class="string"><span class="delimiter">"</span><span class="content">product</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> Table.PrintableColumnGenerator&lt;Order, <span class="predefined-type">String</span>&gt;() {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Component</span> generateCell(Order entity) {
        <span class="predefined-type">Label</span> label = componentsFactory.createComponent(<span class="predefined-type">Label</span>.NAME);
        Product product = order.getProduct();
        label.setValue(product.getName() + <span class="string"><span class="delimiter">"</span><span class="content">, </span><span class="delimiter">"</span></span> + product.getCost());
        <span class="keyword">return</span> label;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getValue(Order entity) {
        Product product = order.getProduct();
        <span class="keyword">return</span> product.getName() + <span class="string"><span class="delimiter">"</span><span class="content">, </span><span class="delimiter">"</span></span> + product.getCost();
    }
});</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Если генерируемой колонке тем или иным способом не задано представления <code>Printable</code>, то в случае, если колонке соответствует атрибут сущности, будет выведено его значение, в противном случае не будет выведено ничего.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_setItemClickAction" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>setItemClickAction()</code> позволяет задать <a href="/manual.html#gui_Action">действие</a>, выполняемое при двойном клике на строке таблицы. Если такое действие не задано, при двойном клике таблица пытается найти среди своих действий подходящее в следующем порядке:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p>Действие, назначенное на клавишу <strong>Enter</strong> посредством свойства <code>shortcut</code>.</p> </li> 
              <li> <p>Действие с именем <code>edit</code>.</p> </li> 
              <li> <p>Действие с именем <code>view</code>.</p> 
               <div class="paragraph"> 
                <p>Если такое действие найдено и имеет свойство <code>enabled = true</code>, оно выполняется.</p> 
               </div> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_Table_setEnterPressAction" class="ulist"> 
          <ul> 
           <li> <p>Метод <code>setEnterPressAction()</code> позволяет задать <a href="/manual.html#gui_Action">действие</a>, выполняемое при нажатии клавиши <strong>Enter</strong>. Если такое действие не задано, таблица пытается найти среди своих действий подходящее в следующем порядке:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p>Действие, назначенное методом <code>setItemClickAction()</code>.</p> </li> 
                <li> <p>Действие, назначенное на клавишу <strong>Enter</strong> посредством свойства <code>shortcut</code>.</p> </li> 
                <li> <p>Действие с именем <code>edit</code>.</p> </li> 
                <li> <p>Действие с именем <code>view</code>.</p> </li> 
               </ul> 
              </div> 
              <div class="paragraph"> 
               <p>Если такое действие найдено и имеет свойство <code>enabled = true</code>, оно выполняется.</p> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты table
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_Table_aggregatable">aggregatable</a> - <a href="/manual.html#gui_Table_aggregationStyle">aggregationStyle</a> - <a href="/manual.html#gui_Table_columnControlVisible">columnControlVisible</a> - <a href="/manual.html#gui_Table_columnHeaderVisible">columnHeaderVisible</a> - <a href="/manual.html#gui_Table_allowPopupMenu">contextMenuEnabled</a> - <a href="/manual.html#gui_Table_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Table_multiLineCells">multiLineCells</a> - <a href="/manual.html#gui_Table_multiselect">multiselect</a> - <a href="/manual.html#gui_Table_presentations">presentations</a> - <a href="/manual.html#gui_Table_reorderingAllowed">reorderingAllowed</a> - <a href="/manual.html#gui_attr_settingsEnabled">settingsEnabled</a> - <a href="/manual.html#gui_Table_showSelection">showSelection</a> - <a href="/manual.html#gui_Table_sortable">sortable</a> - <a href="/manual.html#gui_Table_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_textSelectionEnabled">textSelectionEnabled</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы table
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_actions">actions</a> - <a href="/manual.html#gui_Table_buttonsPanel">buttonsPanel</a> - <a href="/manual.html#gui_Table_columns">columns</a> - <a href="/manual.html#gui_Table_rows">rows</a> - <a href="/manual.html#gui_Table_rowsCount">rowsCount</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты 
            <a href="/manual.html#gui_Table_columns">column</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_column_align">align</a> - <a href="/manual.html#gui_Table_column_caption">caption</a> - <a href="/manual.html#gui_Table_column_captionProperty">captionProperty</a> - <a href="/manual.html#gui_Table_column_collapsed">collapsed</a> - <a href="/manual.html#gui_DateField_dateFormat">dateFormat</a> - <a href="/manual.html#gui_Table_column_editable">editable</a> - <a href="/manual.html#gui_Table_column_generator">generator</a> - <a href="/manual.html#gui_Table_column_id">id</a> - <a href="/manual.html#gui_Table_column_link">link</a> - <a href="/manual.html#gui_Table_column_linkInvoke">linkInvoke</a> - <a href="/manual.html#gui_Table_column_linkScreen">linkScreen</a> - <a href="/manual.html#gui_Table_column_linkScreenOpenType">linkScreenOpenType</a> - <a href="/manual.html#gui_Table_column_maxTextLength">maxTextLength</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_DateField_resolution">resolution</a> - <a href="/manual.html#gui_Table_column_sortable">sortable</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_Table_column_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы 
            <a href="/manual.html#gui_Table_columns">column</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_column_aggregation">aggregation</a> - <a href="/manual.html#gui_formatter">formatter</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты 
            <a href="/manual.html#gui_Table_column_aggregation">aggregation</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_column_aggregation">type</a> - <a href="/manual.html#gui_Table_column_aggregation_strategyClass">strategyClass</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты 
            <a href="/manual.html#gui_Table_rows">rows</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_datasource">datasource</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили table
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_table_borderless">borderless</a> - <a href="/manual.html#gui_table_compact">compact</a> - <a href="/manual.html#gui_table_no-header">no-header</a> - <a href="/manual.html#gui_table_no-horizontal-lines">no-horizontal-lines</a> - <a href="/manual.html#gui_table_no-stripes">no-stripes</a> - <a href="/manual.html#gui_table_no-vertical-lines">no-vertical-lines</a> - <a href="/manual.html#gui_table_small">small</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_addGeneratedColumn">addGeneratedColumn</a> - <a href="/manual.html#gui_Table_addPrintable">addPrintable</a> - <a href="/manual.html#gui_Table_ColumnCollapseListener">addColumnCollapseListener</a> - <a href="/manual.html#gui_api_settings">applySettings</a> - <a href="/manual.html#gui_Table_generateCell">generateCell</a> - <a href="/manual.html#gui_Table_getSelected">getSelected</a> - <a href="/manual.html#gui_Table_requestFocus">requestFocus</a> - <a href="/manual.html#gui_api_settings">saveSettings</a> - <a href="/manual.html#gui_Table_scrollTo">scrollTo</a> - <a href="/manual.html#gui_Table_CellClickListener">setClickListener</a> - <a href="/manual.html#gui_Table_setEnterPressAction">setEnterPressAction</a> - <a href="/manual.html#gui_Table_setItemClickAction">setItemClickAction</a> - <a href="/manual.html#gui_Table_setStyleProvider">setStyleProvider</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_TextArea"><a class="anchor" href="/manual.html#gui_TextArea"></a>5.5.2.1.39. TextArea</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-textarea" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Текстовая область − многострочное текстовое поле для редактирования текста.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>textArea</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>TextArea</code> реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>TextArea</code> в основном повторяет функциональность <a href="/manual.html#gui_TextField">TextField</a> и имеет следующие специфические атрибуты:</p> 
         </div> 
         <div id="gui_TextArea_cols_rows" class="ulist"> 
          <ul> 
           <li> <p><code>cols</code> и <code>rows</code> задают количество строк и столбцов текста:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;textArea</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">textArea</span><span class="delimiter">"</span></span> <span class="attribute-name">cols</span>=<span class="string"><span class="delimiter">"</span><span class="content">20</span><span class="delimiter">"</span></span> <span class="attribute-name">rows</span>=<span class="string"><span class="delimiter">"</span><span class="content">5</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Значения <code>width</code> и <code>height</code> имеют приоритет над значениями <code>cols</code> и <code>rows</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TextArea_resizableDirection" class="ulist"> 
          <ul> 
           <li> <p><code>resizableDirection</code> – задаёт возможность изменения размера области и его направление.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;textArea</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">textArea</span><span class="delimiter">"</span></span> <span class="attribute-name">resizableDirection</span>=<span class="string"><span class="delimiter">"</span><span class="content">BOTH</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="imageblock" style="text-align: center"> 
               <div class="content"> 
                <img src="assets/gui_textField_resizable.png" alt="gui textField resizable"> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Доступны следующие режимы изменения размера:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>BOTH</code> - компонент может изменять размер в обоих направлениях. Режим не будет работать, если задан размер компонента в процентах.</p> </li> 
                <li> <p><code>NONE</code> - компонент не может изменять размер.</p> </li> 
                <li> <p><code>VERTICAL</code> - компонент может изменять размер только по вертикали. Режим не будет работать, если задана высота компонента в процентах.</p> </li> 
                <li> <p><code>HORIZONTAL</code> - компонент может изменять размер только по горизонтали. Режим не будет работать, если задана ширина компонента в процентах.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_TextArea_ResizeListener" class="paragraph"> 
               <p>События изменения размеров области можно отслеживать с помощью слушателя <code>ResizeListener</code>, например:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">textArea.addResizeListener(e -&gt; showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Resized</span><span class="delimiter">"</span></span>));</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TextArea_wordwrap" class="ulist"> 
          <ul> 
           <li> <p><code>wordwrap</code> - установите данный атрибут в <code>false</code>, чтобы отключить перенос строк по словам.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>TextArea</code> поддерживает слушатель <code>TextChangeListener</code>, определёный в родительском интерфейсе <code>TextInputField</code>. События изменения текста обрабатываются асинхронно после ввода, не блокируя сам ввод.</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">textArea.addTextChangeListener(event -&gt; {
    <span class="type">int</span> length = event.getText().length();
    textAreaLabel.setValue(length + <span class="string"><span class="delimiter">"</span><span class="content"> of </span><span class="delimiter">"</span></span> + textArea.getMaxLength());
});</code></pre> 
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_TextArea_2.png" alt="gui TextArea 2"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Параметром <code>TextChangeEventMode</code> задаётся режим передачи изменений на сервер для вызова события на серверной стороне. В платформе реализовано 3 режима передачи:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>LAZY</code> (по умолчанию) - событие вызывается во время паузы в наборе текста. Продолжительность паузы можно задать с помощью метода <code>setInputEventTimeout()</code>. Событие изменения текста обрабатывается принудительно перед возможным событием <code>ValueChangeEvent</code>, даже если пользователь не выдержал паузу в наборе текста.</p> </li> 
           <li> <p><code>TIMEOUT</code> - событие вызывается после периода ожидания. В случае ввода нескольких изменений за один период, на сервер отсылается событие со всеми изменениями, включая последнее. Продолжительность периода ожидания можно задать с помощью метода <code>setInputEventTimeout()</code>.</p> 
            <div class="paragraph"> 
             <p>В случае, если <code>ValueChangeEvent</code> может случиться до истечения периода ожидания, событие <code>TextChangeEvent</code> обрабатывается до его истечения, при условии, что набранный текст был изменён после предыдущего <code>TextChangeEvent</code>.</p> 
            </div> </li> 
           <li> <p><code>EAGER</code> - событие вызывается незамедлительно после каждого изменения текста, то есть после каждого нажатия клавиш. Запросы отправляются по отдельности и обрабатываются последовательно один за другим. Тем не менее, асинхронная передача событий изменения на сервер позволяет не блокировать дальнейший ввод текста.</p> 
            <div class="dlist"> 
             <dl> 
              <dt class="hdlist1">
               Стили компонента TextArea
              </dt> 
              <dd> 
               <div class="openblock"> 
                <div class="content"> 
                 <div class="paragraph"> 
                  <p>В веб-клиенте с темой, основанной на Halo, к компоненту <code>TextArea</code> можно применить предопределенные стили. Стили задаются в XML-дексрипторе или контроллере экрана с помощью атрибута <code>stylename</code>:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;textArea</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">textArea</span><span class="delimiter">"</span></span>
          <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">borderless</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Чтобы применить стиль программно, выберите одну из констант класса <code>HaloTheme</code> с префиксом компонента <code>TEXTAREA_</code>:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java">textArea.setStyleName(HaloTheme.TEXTAREA_BORDERLESS);</code></pre> 
                  </div> 
                 </div> 
                 <div id="gui_textarea_align-center" class="ulist"> 
                  <ul> 
                   <li> <p><code>align-center</code> - выравнивание текста по центру области.</p> </li> 
                  </ul> 
                 </div> 
                 <div id="gui_textarea_align-right" class="ulist"> 
                  <ul> 
                   <li> <p><code>align-right</code> - выравнивание текста по правому краю области.</p> </li> 
                  </ul> 
                 </div> 
                 <div id="gui_textarea_borderless" class="ulist"> 
                  <ul> 
                   <li> <p><code>borderless</code> - удаляет рамку и фон текстовой области.</p> </li> 
                  </ul> 
                 </div> 
                </div> 
               </div> 
              </dd> 
             </dl> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты textArea
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_TextField_caseConversion">caseConversion</a> - <a href="/manual.html#gui_TextArea_cols_rows">cols</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_TextField_datatype">datatype</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_TextField_maxLength">maxLength</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_TextArea_resizableDirection">resizableDirection</a> - <a href="/manual.html#gui_TextArea_cols_rows">rows</a> - <a href="/manual.html#gui_attr_settingsEnabled">settingsEnabled</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_TextField_trim">trim</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a> - <a href="/manual.html#gui_TextArea_wordwrap">wordwrap</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили textArea
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_textarea_align-center">align-center</a> - <a href="/manual.html#gui_textarea_align-right">align-right</a> - <a href="/manual.html#gui_textarea_borderless">borderless</a> - <a href="/manual.html#gui_attr_stylename_huge">huge</a> - <a href="/manual.html#gui_attr_stylename_large">large</a> - <a href="/manual.html#gui_attr_stylename_small">small</a> - <a href="/manual.html#gui_attr_stylename_tiny">tiny</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_TextArea_ResizeListener">addResizeListener</a> - <a href="/manual.html#gui_TextField_TextChangeListener">addTextChangeListener</a> - <a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_api_settings">applySettings</a> - <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a> - <a href="/manual.html#gui_api_settings">saveSettings</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_TextField"><a class="anchor" href="/manual.html#gui_TextField"></a>5.5.2.1.40. TextField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-textfield" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Поле для редактирования текста. Может использоваться как для работы с атрибутами сущностей, так и для ввода и отображения произвольной текстовой информации.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>textField</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент текстового поля реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Пример текстового поля с заголовком, взятым из <a href="/manual.html#message_packs">пакета локализованных сообщений</a>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">nameField</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>На рисунке ниже показан вид простого текстового поля.</p> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_textField_data.png" alt="gui textField data"> 
             </div> 
            </div> </li> 
           <li> <p>В веб-клиенте с темой, основанной на Halo, к компоненту <code>TextField</code> можно применить предопределенные стили. Стили задаются в XML-дексрипторе или контроллере экрана с помощью атрибута <code>stylename</code>:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">textField</span><span class="delimiter">"</span></span>
           <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">borderless</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Чтобы применить стиль программно, выберите одну из констант класса <code>HaloTheme</code> с префиксом компонента <code>TEXTFIELD_</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">textField.setStyleName(HaloTheme.TEXTFIELD_INLINE_ICON);</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Стили компонента TextField:</p> 
              </div> 
              <div id="gui_textfield_align-center" class="ulist"> 
               <ul> 
                <li> <p><code>align-center</code> - выравние текста по центру поля.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_textfield_align-right" class="ulist"> 
               <ul> 
                <li> <p><code>align-right</code> - выравнивание текста по правому краю поля.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_textfield_borderless" class="ulist"> 
               <ul> 
                <li> <p><code>borderless</code> - удаляет рамку и фон текстового поля.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_textfield_inline-icon" class="ulist"> 
               <ul> 
                <li> <p><code>inline-icon</code> - расположение пиктограммы внутри текстового поля.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_TextField_caseConversion" class="paragraph"> 
               <p>Компонент TextField поддерживает автоматическую конвертацию регистра. Атрибут <code>caseConvertion</code> может принимать следующие значения:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>UPPER</code> - верхний регистр,</p> </li> 
                <li> <p><code>LOWER</code> - нижний регистр,</p> </li> 
                <li> <p><code>NONE</code> - конвертация отключена (значение по умолчанию). Используйте это значение для поддержки клавиатурного ввода с использованием IME, к примеру, для японского, корейского и китайского языков.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
           <li> <p>Для создания текстового поля, связанного с данными, необходимо использовать атрибуты <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Customer</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Как видно из примера, в экране описывается <a href="/manual.html#datasources">источник данных</a> <code>customerDs</code> для некоторой сущности <code>Покупатель (Customer)</code>, имеющей атрибут <code>name</code>. В компоненте текстового поля в атрибуте <a href="/manual.html#gui_attr_datasource">datasource</a> указывается ссылка на источник данных, а в атрибуте <a href="/manual.html#gui_attr_property">property</a> − название атрибута сущности, значение которого должно быть отображено в текстовом поле.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TextField_datatype" class="ulist"> 
          <ul> 
           <li> <p>Если поле не связано с атрибутом сущности (то есть не указан источник данных и название атрибута), то можно указать тип данных с помощью атрибута <code>datatype</code>. Тип данных используется для форматирования значения поля. В качестве значения атрибута может быть указано любое имя типа данных, зарегистрированного в метаданных приложения - см. <a href="/manual.html#datatype">Datatype</a>. Как правило, в <code>TextField</code> используются следующие типы данных:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>decimal</code></p> </li> 
              <li> <p><code>double</code></p> </li> 
              <li> <p><code>int</code></p> </li> 
              <li> <p><code>long</code></p> 
               <div class="paragraph"> 
                <p>В качестве примера рассмотрим текстовое поле с типом данных <code>Integer</code>.</p> 
               </div> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">integerField</span><span class="delimiter">"</span></span> <span class="attribute-name">datatype</span>=<span class="string"><span class="delimiter">"</span><span class="content">int</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://integerFieldName</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
                </div> 
               </div> 
               <div class="paragraph"> 
                <p>Если в таком поле ввести значение, которое невозможно интерпретировать как целое число, то при потере фокуса полем будет выведено сообщение об ошибке и значение поля вернется на предыдущее.</p> 
               </div> </li> 
             </ul> 
            </div> </li> 
           <li> <p>Текстовому полю может быть назначен <a href="/manual.html#gui_validator">валидатор</a> - класс, реализующий интерфейс <code>Field.Validator</code>. Валидатор позволяет дополнительно к <code>datatype</code> ограничить вводимую пользователем информацию. Например, для создания поля ввода положительных целых чисел нужно создать класс валидатора:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PositiveIntegerValidator</span> <span class="directive">implements</span> <span class="predefined-type">Field</span>.Validator {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> value) <span class="directive">throws</span> ValidationException {
        <span class="predefined-type">Integer</span> i = (<span class="predefined-type">Integer</span>) value;
        <span class="keyword">if</span> (i &lt;= <span class="integer">0</span>)
            <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(<span class="string"><span class="delimiter">"</span><span class="content">Value must be positive</span><span class="delimiter">"</span></span>);
    }
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>и задать его для текстового поля с типом данных <code>int</code> в элементе <a href="/manual.html#gui_validator">validator</a>:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">integerField</span><span class="delimiter">"</span></span> <span class="attribute-name">datatype</span>=<span class="string"><span class="delimiter">"</span><span class="content">int</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.gui.PositiveIntegerValidator</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/textField&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В отличие от проверки вводимой строки на соответствие типу данных, валидация срабатывает не сразу при потере полем фокуса, а только при вызове у поля метода <code>validate()</code>. Это означает, что поле (и связанный с ним атрибут сущности) может некоторое время содержать значение, не удовлетворяющее условиям валидации (в приведенном примере неположительное число). Это не является проблемой, так как обычно поля редактирования с валидацией располагаются в <a href="/manual.html#screen_edit">экране редактирования</a>, а он автоматически вызывает валидацию всех своих полей перед коммитом. Если же поле находится не в экране редактирования, то необходимо вызывать метод <code>validate()</code> поля в контроллере явно.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TextField_TextChangeListener" class="ulist"> 
          <ul> 
           <li> <p>Компонент <code>TextField</code> поддерживает слушатель <code>TextChangeListener</code>, определёный в родительском интерфейсе <code>TextInputField</code>. События изменения текста обрабатываются асинхронно после ввода, не блокируя сам ввод.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">textField.addTextChangeListener(event -&gt; {
    <span class="type">int</span> length = event.getText().length();
    textFieldLabel.setValue(length + <span class="string"><span class="delimiter">"</span><span class="content"> of </span><span class="delimiter">"</span></span> + textField.getMaxLength());
});
textField.setTextChangeEventMode(TextInputField.TextChangeEventMode.LAZY);</code></pre> 
               </div> 
              </div> 
              <div class="imageblock" style="text-align: center"> 
               <div class="content"> 
                <img src="assets/gui_textfield_2.png" alt="gui textfield 2"> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
           <li> <p>Параметром <code>TextChangeEventMode</code> задаётся режим передачи изменений на сервер для вызова события на серверной стороне. В платформе реализовано 3 режима передачи:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>LAZY</code> (по умолчанию) - событие вызывается во время паузы в наборе текста. Продолжительность паузы можно задать с помощью метода <code>setInputEventTimeout()</code>. Событие изменения текста обрабатывается принудительно перед возможным событием <code>ValueChangeEvent</code>, даже если пользователь не выдержал паузу в наборе текста.</p> </li> 
                <li> <p><code>TIMEOUT</code> - событие вызывается после периода ожидания. В случае ввода нескольких изменений за один период, на сервер отсылается событие со всеми изменениями, включая последнее. Продолжительность периода ожидания можно задать с помощью метода <code>setInputEventTimeout()</code>.</p> 
                 <div class="paragraph"> 
                  <p>В случае, если <code>ValueChangeEvent</code> может случиться до истечения периода ожидания, событие <code>TextChangeEvent</code> обрабатывается до его истечения, при условии, что набранный текст был изменён после предыдущего <code>TextChangeEvent</code>.</p> 
                 </div> </li> 
                <li> <p><code>EAGER</code> - событие вызывается незамедлительно после каждого изменения текста, то есть после каждого нажатия клавиш. Запросы отправляются по отдельности и обрабатываются последовательно один за другим. Тем не менее, асинхронная передача событий изменения на сервер позволяет не блокировать дальнейший ввод текста.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TextField_EnterPressListener" class="ulist"> 
          <ul> 
           <li> <p><code>EnterPressListener</code> позволяет указать <a href="/manual.html#gui_Action">действие</a>, которое должно быть выполнено по нажатию клавиши Enter:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">textField.addEnterPressListener(e -&gt; showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Enter pressed</span><span class="delimiter">"</span></span>));</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TextField_ValueChangeListener" class="ulist"> 
          <ul> 
           <li> <p><code>ValueChangeListener</code> позволяет обрабатывать изменения значения в текстовом поле, когда пользователь уже закончил ввод, т.е. после нажатия клавиши Enter или при потере компонентом фокуса. В слушатель передается объект события типа <code>ValueChangeEvent</code>, который имеет следующие методы:</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>getPrevValue()</code> возвращает значение компонента до изменения.</p> </li> 
              <li> <p><code>getValue()</code> возвращает текущее значение компонента.</p> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java">textField.addValueChangeListener(e -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Before: </span><span class="delimiter">"</span></span> + e.getPrevValue() + <span class="string"><span class="delimiter">"</span><span class="content">. After: </span><span class="delimiter">"</span></span> + e.getValue()));</code></pre> 
                </div> 
               </div> </li> 
             </ul> 
            </div> </li> 
           <li> <p>Если текстовое поле связано с атрибутом сущности (через <code>datasource</code> и <code>property</code>), и если для атрибута сущности в <a href="/manual.html#entity_attr_annotations">JPA-аннотации</a> <code>@Column</code> указан параметр <code>length</code>, то <code>TextField</code> будет соответственно ограничивать максимальную длину вводимого текста.</p> 
            <div id="gui_TextField_maxLength" class="paragraph"> 
             <p>Если текстовое поле не связано с атрибутом, либо для него не определено значение <code>length</code>, либо это значение нужно переопределить, то для ограничения максимальной длины вводимого текста можно использовать атрибут <code>maxLength</code>. Значение "-1" означает отсутствие ограничения. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">shortTextField</span><span class="delimiter">"</span></span> <span class="attribute-name">maxLength</span>=<span class="string"><span class="delimiter">"</span><span class="content">10</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TextField_trim" class="ulist"> 
          <ul> 
           <li> <p>По умолчанию текстовое поле отсекает пробелы в начале и конце введенной строки. То есть если пользователь ввел строку " aaa bbb " то значением поля, возвращаемым методом <code>getValue()</code> и сохраняемым в связанный атрибут сущности, будет строка "aaa bbb". Для того, чтобы отключить отсечение пробелов, используйте атрибут <code>trim</code> со значением <code>false</code>.</p> 
            <div class="paragraph"> 
             <p>Следует иметь в виду, что отсечение пробелов работает только при вводе нового значения. Если в значении связанного атрибута уже присутствуют пробелы, они будут отображаться, пока пользователь не изменит значение поля.</p> 
            </div> </li> 
           <li> <p>Текстовое поле всегда вместо введенной пустой строки возвращает <code>null</code>. Соответственно, при включенном атрибуте <code>trim</code> строка, состоящая из одних пробелов также превратится в <code>null</code>.</p> </li> 
           <li> <p>Метод <code>setCursorPosition()</code> используется для установки позиции курсора в указанный индекс (начинается с 0). После вызова метода поле принимает фокус ввода.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты textField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_TextField_caseConversion">caseConversion</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_TextField_datatype">datatype</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_inputPrompt">inputPrompt</a> - <a href="/manual.html#gui_TextField_maxLength">maxLength</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_TextField_trim">trim</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы textField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили textField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_textfield_align-center">align-center</a> - <a href="/manual.html#gui_textfield_align-right">align-right</a> - <a href="/manual.html#gui_textfield_borderless">borderless</a> - <a href="/manual.html#gui_attr_stylename_huge">huge</a> - <a href="/manual.html#gui_textfield_inline-icon">inline-icon</a> - <a href="/manual.html#gui_attr_stylename_large">large</a> - <a href="/manual.html#gui_attr_stylename_small">small</a> - <a href="/manual.html#gui_attr_stylename_tiny">tiny</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_TextField_EnterPressListener">addEnterPressListener</a> - <a href="/manual.html#gui_TextField_TextChangeListener">addTextChangeListener</a> - <a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_TimeField"><a class="anchor" href="/manual.html#gui_TimeField"></a>5.5.2.1.41. TimeField</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-timefield" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Поле для отображения и ввода времени.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_timeField.png" alt="gui timeField"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>timeField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>TimeField</code> реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Для создания поля времени, связанного с данными, необходимо использовать атрибуты <a href="/manual.html#gui_attr_datasource">datasource</a> и <a href="/manual.html#gui_attr_property">property</a>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;timeField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">deliveryTime</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Как видно из примера, в экране описывается источник данных <code>orderDs</code> для некоторой сущности Заказ (<code>Order</code>), имеющей атрибут <code>deliveryTime</code>. В компоненте ввода времени в атрибуте <code>datasource</code> указывается ссылка на источник данных, а в атрибуте <code>property</code> − название атрибута сущности, значение которого должно быть отображено в поле.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Связанный атрибут сущности должен быть типа <code>java.util.Date</code> или <code>java.sql.Time</code>.</p> 
            </div> </li> 
           <li> <p>Формат отображения времени определяется <a href="/manual.html#datatype">типом данных</a> <code>time</code> и задается в <a href="/manual.html#main_message_pack">главном пакете локализованных сообщений</a> в ключе <code>timeFormat</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_TimeField_timeFormat" class="ulist"> 
          <ul> 
           <li> <p>Формат отображения времени можно также задать в атрибуте <code>timeFormat</code> компонента. Это может быть как сама строка формата, так и ключ в пакете сообщений (с префиксом <code>msg://</code>).</p> </li> 
          </ul> 
         </div> 
         <div id="gui_TimeField_showSeconds" class="ulist"> 
          <ul> 
           <li> <p>Независимо от упомянутого выше формата отображением секунд можно управлять с помощью атрибута <code>showSeconds</code>. По умолчанию секунды отображаются, если формат содержит символы <code>ss</code>.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;timeField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">createTs</span><span class="delimiter">"</span></span> <span class="attribute-name">showSeconds</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_timeFieldSec.png" alt="gui timeFieldSec"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты timeField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_TimeField_showSeconds">showSeconds</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_TimeField_timeFormat">timeFormat</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы timeField
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_api_commit">commit</a> - <a href="/manual.html#gui_api_discard">discard</a> - <a href="/manual.html#gui_api_isModified">isModified</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_TokenList"><a class="anchor" href="/manual.html#gui_TokenList"></a>5.5.2.1.42. TokenList</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=normal-tokenlist" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>TokenList</code> представляет собой упрощенный вариант работы со списком сущностей: названия экземпляров располагаются в вертикальном или горизонтальном списке, добавление производится из выпадающего списка, удаление - с помощью кнопок, расположенных рядом с каждым экземпляром.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_tokenList.png" alt="gui tokenList"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>tokenList</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания компонента <code>TokenList</code> в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span>
                <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span>
                <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">order-edit</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">productsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">products</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/datasource&gt;</span>
    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">allProductsDs</span><span class="delimiter">"</span></span>
                          <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Product</span><span class="delimiter">"</span></span>
                          <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_minimal</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>select p from sales$Product p order by p.name<span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;tokenList</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">productsList</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">productsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">inline</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">500px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;lookup</span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">allProductsDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tokenList&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Здесь в элементе <code>dsContext</code> определен вложенный источник данных <code>productsDs</code>, содержащий коллекцию входящих в состав заказа продуктов. Кроме того, определен источник данных <code>allProductsDs</code>, содержащий коллекцию всех продуктов, имеющихся в базе данных. Компонент <code>TokenList</code> с идентификатором <code>productsList</code> отображает содержимое источника данных <code>productsDs</code>, а также позволяет изменять эту коллекцию, добавляя в него экземпляры из источника данных <code>allProductsDs</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>tokenList</code>:</p> 
         </div> 
         <div id="gui_TokenList_position" class="ulist"> 
          <ul> 
           <li> <p><code>position</code> - задает позиционирование раскрывающегося списка. Атрибут может принимать два значения: <code>TOP</code>, <code>BOTTOM</code>. По умолчанию <code>TOP</code>.</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_tokenListBottom.png" alt="gui tokenListBottom"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TokenList_inline" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>inline</code> задает отображение списка выбранных значений: вертикально или горизонтально. Значение <code>true</code> соответствует горизонтальному расположению, значение <code>false</code> − вертикальному. Так выглядит компонент с горизонтальным расположением значений:</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_tokenListInline.png" alt="gui tokenListInline"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TokenList_simple" class="ulist"> 
          <ul> 
           <li> <p><code>simple</code> - значение <code>true</code> позволяет убрать компонент выбора, оставляя только кнопку добавления и очистки списка. При нажатии на кнопку добавления <strong>Add</strong> сразу показывается экран списка экземпляров сущности, тип которой задан источником данных <code>datasource</code>. Идентификатор экрана выбора определяется по правилам, описанным для <a href="/manual.html#picker_actions">стандартного действия</a> <code>PickerField.LookupAction</code>. Кнопка очистки списка <strong>Clear</strong> удаляет все элементы из источника данных компонента <code>TokenList</code>.</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_tokenListSimple_withClear.png" alt="gui tokenListSimple withClear"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TokenList_clearEnabled" class="ulist"> 
          <ul> 
           <li> <p><code>clearEnabled</code> - значение <code>false</code> позволяет скрыть кнопку очистки <strong>Clear</strong>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Элементы <code>tokenList</code>:</p> 
         </div> 
         <div id="gui_TokenList_lookup" class="ulist"> 
          <ul> 
           <li> <p><code>lookup</code> − описатель компонента выбора значений.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Атрибуты элемента <code>lookup</code>:</p> 
              </div> 
              <div id="gui_TokenList_lookup_lookup" class="ulist"> 
               <ul> 
                <li> <p>Атрибут <code>lookup</code> задает возможность выбора значений через экран выбора сущностей:</p> 
                 <div class="imageblock" style="text-align: center"> 
                  <div class="content"> 
                   <img src="assets/gui_tokenListLookup.png" alt="gui tokenListLookup"> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_TokenList_lookup_inputPrompt" class="ulist"> 
               <ul> 
                <li> <p><code>inputPrompt</code> - текстовая подсказка, которая отображается в поле выбора. Если подсказка не задана, поле будет пустым.</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;tokenList</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">linesList</span><span class="delimiter">"</span></span>
           <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderItemsDs</span><span class="delimiter">"</span></span>
           <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">320px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;lookup</span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">allItemsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">inputPrompt</span>=<span class="string"><span class="delimiter">"</span><span class="content">Choose an item</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/tokenList&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="imageblock" style="text-align: center"> 
                  <div class="content"> 
                   <img src="assets/gui_TokenList_inputPrompt.png" alt="gui TokenList inputPrompt"> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
              <div id="gui_TokenList_lookup_lookupScreen" class="ulist"> 
               <ul> 
                <li> <p>Атрибут <code>lookupScreen</code> задает идентификатор экрана для выбора значений в режиме <code>lookup="true"</code>. Если данный атрибут не задан, то идентификатор экрана выбора определяется по правилам, описанным для <a href="/manual.html#picker_actions">стандартного действия</a> <code>PickerField.LookupAction</code>.</p> </li> 
                <li> <p>Атрибут <code>openType</code> можно задать способ открытия экрана выбора, аналогично описанному для <a href="/manual.html#picker_actions">стандартного действия</a> <code>PickerField.LookupAction</code>. По умолчанию - <code>THIS_TAB</code>.</p> </li> 
               </ul> 
              </div> 
              <div id="gui_TokenList_lookup_multiselect" class="ulist"> 
               <ul> 
                <li> <p>Если значение атрибута <code>multiselect</code> установлено в <code>true</code>, то в мэп параметров экрана выбора в ключе <code>MULTI_SELECT</code> передается значение <code>true</code>. Этот признак можно использовать для установки в экране режима множественного выбора. Данный ключ определен в перечислении <code>WindowParams</code>, поэтому с ним удобно работать следующим образом:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="keyword">if</span> (WindowParams.MULTI_SELECT.getBool(getContext())) {
        usersTable.setMultiSelect(<span class="predefined-constant">true</span>);
    }
}</code></pre> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TokenList_button" class="ulist"> 
          <ul> 
           <li> <p><code>addButton</code> − описатель кнопки добавления значений. Может содержать атрибуты <a href="/manual.html#gui_attr_caption">caption</a> и <a href="/manual.html#gui_attr_icon">icon</a>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Слушатели <code>tokenList</code>:</p> 
         </div> 
         <div id="gui_TokenList_ItemClickListener" class="ulist"> 
          <ul> 
           <li> <p><code>ItemClickListener</code> позволяет отслеживать клики по элементам <code>tokenList</code>.</p> </li> 
           <li> <p><code>ValueChangeListener</code> отслеживает изменения значения<code>tokenList</code>, так же, как и любого другого компонента, реализующего интерфейс <code>Field</code>.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты tokenList
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_TokenList_clearEnabled">clearEnabled</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_TokenList_inline">inline</a> - <a href="/manual.html#gui_TokenList_position">position</a> - <a href="/manual.html#gui_TokenList_simple">simple</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы tokenList
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_TokenList_button">addButton</a> - <a href="/manual.html#gui_TokenList_lookup">lookup</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты 
            <a href="/manual.html#gui_TokenList_lookup">lookup</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_LookupField_filterMode">filterMode</a> - <a href="/manual.html#gui_TokenList_lookup_inputPrompt">inputPrompt</a> - <a href="/manual.html#gui_TokenList_lookup_lookup">lookup</a> - <a href="/manual.html#gui_TokenList_lookup_lookupScreen">lookupScreen</a> - <a href="/manual.html#gui_TokenList_lookup_multiselect">multiselect</a> - <a href="/manual.html#gui_attr_openType">openType</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты 
            <a href="/manual.html#gui_TokenList_button">button</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_icon">icon</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a> - <a href="/manual.html#gui_TokenList_ItemClickListener">setItemClickListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Tree"><a class="anchor" href="/manual.html#gui_Tree"></a>5.5.2.1.43. Tree</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-tree" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>Tree</code> предназначен для отображения иерархической структуры, представленной сущностями, содержащими ссылки на самих себя.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_Tree.png" alt="gui Tree"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>tree</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div id="gui_Tree_treechildren" class="paragraph"> 
          <p>Для <code>Tree</code> в атрибуте <code>datasource</code> элемента <code>treechildren</code> должен быть указан <a href="/manual.html#datasources">hierarchicalDatasource</a>. Объявление <code>hierarchicalDatasource</code> должно содержать атрибут <code>hierarchyProperty</code> - имя атрибута сущности, являющегося ссылкой на саму себя.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания компонента <code>Tree</code> в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;hierarchicalDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">departmentsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Department</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">browse</span><span class="delimiter">"</span></span>
                            <span class="attribute-name">hierarchyProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">parentDept</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>
            select d from sales$Department d order by d.createTs
        <span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/hierarchicalDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;tree</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">departmentsTree</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;treechildren</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">departmentsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">captionProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tree&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В атрибуте <code>captionProperty</code> элемента <code>treechildren</code> можно задать имя свойства сущности, отображаемого в дереве. Если этот атрибут не определен, то будет отображаться <a href="/manual.html#namePattern_annotation">имя экземпляра</a> сущности.</p> 
         </div> 
         <div id="gui_Tree_multiselect" class="paragraph"> 
          <p>Атрибут <code>multiselect</code> позволяет задать режим множественного выделения элементов дерева. Если <code>multiselect</code> равен <code>true</code>, то пользователь может выделить несколько элементов с помощью клавиатуры или мыши, удерживая клавиши <strong>Ctrl</strong> или <strong>Shift</strong>. По умолчанию режим множественного выделения отключен.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Метод <code>setItemClickAction()</code> позволяет задать <a href="/manual.html#gui_Action">действие</a>, которое будет выполнено при двойном клике по узлу дерева.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Каждый элемент дерева может иметь пиктограмму слева. Создайте реализацию интерфейса <code>ListComponent.IconProvider</code> в контроллере экрана и установите ее для компонента <code>Tree</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Tree&lt;<span class="predefined-type">Region</span>&gt; tree;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    tree.setIconProvider(<span class="keyword">new</span> ListComponent.IconProvider&lt;<span class="predefined-type">Region</span>&gt;() {
        <span class="annotation">@Nullable</span>
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getItemIcon(<span class="predefined-type">Region</span> entity) {
            <span class="keyword">if</span> (entity.getParent() == <span class="predefined-constant">null</span>) {
                <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">icons/root.png</span><span class="delimiter">"</span></span>;
            }
            <span class="keyword">return</span> <span class="string"><span class="delimiter">"</span><span class="content">icons/leaf.png</span><span class="delimiter">"</span></span>;
        }
    });
}</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты tree
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Tree_multiselect">multiselect</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы tree
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_actions">actions</a> - <a href="/manual.html#gui_Tree_treechildren">treechildren</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты treechildren
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_attr_datasource">datasource</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_TreeTable"><a class="anchor" href="/manual.html#gui_TreeTable"></a>5.5.2.1.44. TreeTable</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=tree-table" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>TreeTable</code> − иерархическая таблица, отображающая в первой колонке древовидную структуру. Предназначена для работы с сущностями, которые содержат ссылки на самих себя. Это могут быть например, файловая система или организационная структура предприятия.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_treeTable.png" alt="gui treeTable"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>treeTable</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Для <code>TreeTable</code> в атрибуте <code>datasource</code> элемента <code>rows</code> должен быть указан <a href="/manual.html#datasources">hierarchicalDatasource</a>. Объявление <code>hierarchicalDatasource</code> должно содержать атрибут <code>hierarchyProperty</code> - имя атрибута сущности, являющегося ссылкой на саму себя.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания таблицы в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;hierarchicalDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">tasksDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Task</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">browse</span><span class="delimiter">"</span></span>
                            <span class="attribute-name">hierarchyProperty</span>=<span class="string"><span class="delimiter">"</span><span class="content">parentTask</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>
            select t from sales$Task t
        <span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/hierarchicalDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;treeTable</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">tasksTable</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;columns&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">dueDate</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">assignee</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/columns&gt;</span>
        <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">tasksDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/treeTable&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Функциональность <code>TreeTable</code> аналогична простой таблице <a href="/manual.html#gui_Table">Table</a>.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты treeTable
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_Table_aggregatable">aggregatable</a> - <a href="/manual.html#gui_Table_aggregationStyle">aggregationStyle</a> - <a href="/manual.html#gui_Table_columnControlVisible">columnControlVisible</a> - <a href="/manual.html#gui_Table_allowPopupMenu">contextMenuEnabled</a> - <a href="/manual.html#gui_Table_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Table_multiLineCells">multiLineCells</a> - <a href="/manual.html#gui_Table_multiselect">multiselect</a> - <a href="/manual.html#gui_Table_presentations">presentations</a> - <a href="/manual.html#gui_Table_reorderingAllowed">reorderingAllowed</a> - <a href="/manual.html#gui_attr_settingsEnabled">settingsEnabled</a> - <a href="/manual.html#gui_Table_sortable">sortable</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_textSelectionEnabled">textSelectionEnabled</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы treeTable
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_actions">actions</a> - <a href="/manual.html#gui_Table_buttonsPanel">buttonsPanel</a> - <a href="/manual.html#gui_Table_columns">columns</a> - <a href="/manual.html#gui_Table_rows">rows</a> - <a href="/manual.html#gui_Table_rowsCount">rowsCount</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты 
            <a href="/manual.html#gui_Table_columns">column</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_column_align">align</a> - <a href="/manual.html#gui_Table_column_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_Table_column_collapsed">collapsed</a> - <a href="/manual.html#gui_DateField_dateFormat">dateFormat</a> - <a href="/manual.html#gui_Table_column_editable">editable</a> - <a href="/manual.html#gui_Table_column_id">id</a> - <a href="/manual.html#gui_Table_column_link">link</a> - <a href="/manual.html#gui_Table_column_linkInvoke">linkInvoke</a> - <a href="/manual.html#gui_Table_column_linkScreen">linkScreen</a> - <a href="/manual.html#gui_Table_column_linkScreenOpenType">linkScreenOpenType</a> - <a href="/manual.html#gui_Table_column_maxTextLength">maxTextLength</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_DateField_resolution">resolution</a> - <a href="/manual.html#gui_Table_column_sortable">sortable</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_Table_column_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы 
            <a href="/manual.html#gui_Table_columns">column</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_column_aggregation">aggregation</a> - <a href="/manual.html#gui_formatter">formatter</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты 
            <a href="/manual.html#gui_Table_rows">rows</a>
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_datasource">datasource</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_Table_ColumnCollapseListener">addColumnCollapseListener</a> - <a href="/manual.html#gui_Table_CellClickListener">setClickListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_TwinColumn"><a class="anchor" href="/manual.html#gui_TwinColumn"></a>5.5.2.1.45. TwinColumn</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-twincolumn" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>TwinColumn</code> представляет собой сдвоенный список для множественного выбора опций. В левом списке содержатся доступные невыбранные значения, в правом списке содержатся выбранные значения. Пользователь выбирает значения, перенося их из левого в правый список и обратно с помощью двойного клика или соответствующих кнопок. Для каждого значения можно задать уникальный стиль отображения и пиктограмму.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/TwinColumn.png" alt="TwinColumn"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>twinColumn</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован только для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования компонента <code>twinColumn</code> для выбора экземпляров сущности:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Car</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.entity.Colour</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>select c from sample$Colour c<span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span>
<span class="tag">&lt;layout&gt;</span>
    <span class="tag">&lt;twinColumn</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursField</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span> <span class="attribute-name">addAllBtnEnabled</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В данном случае компонент <code>coloursField</code> отобразит <a href="/manual.html#namePattern_annotation">имена экземпляров</a> сущности <code>Colour</code>, находящихся в источнике данных <code>coloursDs</code>, а его метод <code>getValue()</code> вернет коллекцию выбранных экземпляров сущности.</p> 
         </div> 
         <div id="gui_TwinColumn_addAllBtnEnabled" class="paragraph"> 
          <p>Атрибут <code>addAllBtnEnabled</code> задает отображение кнопок, позволяющих перемещать между списками все опции сразу.</p> 
         </div> 
         <div id="gui_TwinColumn_columns_rows" class="paragraph"> 
          <p>Атрибут <code>columns</code> используется для задания количества символов в строке, а атрибут <code>rows</code> − для задания количества строк текста в каждом списке.</p> 
         </div> 
         <div id="gui_TwinColumn_captions" class="paragraph"> 
          <p>Атрибуты <code>leftColumnCaption</code> и <code>rightColumnCaption</code> используются для назначения заголовков списков.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Для задания внешнего вида опций можно реализовать интерфейс <code>TwinColumn.StyleProvider</code> и возвращать название стиля и путь к пиктограмме в зависимости от конкретного экземпляра сущности, отображаемого в компоненте.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Список опций компонента <code>TwinColumn</code> может быть задан произвольно с помощью методов <code>setOptionsList()</code>, <code>setOptionsMap()</code> и <code>setOptionsEnum()</code>, аналогично описанному для компонента <a href="/manual.html#gui_OptionsGroup">OptionsGroup</a>.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты twinColumn
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_TwinColumn_addAllBtnEnabled">addAllBtnEnabled</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_captionProperty">captionProperty</a> - <a href="/manual.html#gui_TwinColumn_columns_rows">columns</a> - <a href="/manual.html#gui_attr_datasource">datasource</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_editable">editable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_TwinColumn_captions">leftColumnCaption</a> - <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a> - <a href="/manual.html#gui_attr_property">property</a> - <a href="/manual.html#gui_attr_required">required</a> - <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a> - <a href="/manual.html#gui_TwinColumn_captions">rightColumnCaption</a> - <a href="/manual.html#gui_TwinColumn_columns_rows">rows</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы twinColumn
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_validator">validator</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addValueChangeListener">addValueChangeListener</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="gui_layouts"><a class="anchor" href="/manual.html#gui_layouts"></a>5.5.2.2. Контейнеры</h5> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_Accordion">Accordion</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_BoxLayout">BoxLayout</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_ButtonsPanel">ButtonsPanel</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_CssLayout">CssLayout</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_Frame">Frame</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_GridLayout">GridLayout</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_GroupBoxLayout">GroupBoxLayout</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_HtmlBoxLayout">HtmlBoxLayout</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_ScrollBoxLayout">ScrollBoxLayout</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_SplitPanel">SplitPanel</a></p> 
        </div> 
        <div class="paragraph"> 
         <p><a href="/manual.html#gui_TabSheet">TabSheet</a></p> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Accordion"><a class="anchor" href="/manual.html#gui_Accordion"></a>5.5.2.2.1. Accordion</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-accordion" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Контейнер <code>Accordion</code> - это вертикальный контейнер со сворачиваемыми вкладками, который позволяет легко скрывать и отображать большой объем контента. <code>Accordion</code> реализован для блока <strong>Web Client</strong>.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_accordion.png" alt="gui accordion"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>accordion</code>. Пример описания аккордеона в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;accordion</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">accordion</span><span class="delimiter">"</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tab</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">tabStamford</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://tabStamford</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://sampleStamford</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tab&gt;</span>
    <span class="tag">&lt;tab</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">tabBoston</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://tabBoston</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://sampleBoston</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tab&gt;</span>
    <span class="tag">&lt;tab</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">tabLondon</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://tabLondon</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://sampleLondon</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tab&gt;</span>
<span class="tag">&lt;/accordion&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>accordion</code> должен иметь вложенные элементы <code>tab</code>, описывающие вкладки. Каждая вкладка является контейнером с вертикальным расположением компонентов, аналогичным <a href="/manual.html#gui_BoxLayout">vbox</a>. Контейнер <strong>аккордеон</strong> может быть использован при нехватке места на странице приложения, или же если название вкладки слишком длинное для отображения в <code>TabSheet</code>. Аккордеон предоставляет анимацию плавного перехода.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты элемента <code>tab</code>:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>id</code> – идентификатор вкладки. Следует отметить, что вкладка не является компонентом, и данный идентификатор используется только в рамках <code>Accordion</code> для работы с ней из кода контроллера..</p> </li> 
           <li> <p><a href="/manual.html#gui_attr_caption">caption</a> – заголовок вкладки.</p> </li> 
           <li> <p><a href="/manual.html#gui_attr_icon">icon</a> - указывает на местоположение пиктограммы в каталоге темы. Подробную информацию о том, где следует располагать файлы пиктограмм, можно прочитать в <a href="/manual.html#gui_themes">Темы приложения</a>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_accordion_tab_lazy" class="ulist"> 
          <ul> 
           <li> <p><code>lazy</code> – задает отложенную загрузку содержимого вкладки.</p> 
            <div class="paragraph"> 
             <p>При открытии экрана <code>lazy</code>-вкладки не загружают свое содержимое, что приводит к созданию меньшего количества компонентов в памяти. Компоненты вкладки загружаются только в тот момент, когда пользователь выбирает данную вкладку. Кроме того, если на <code>lazy</code>-вкладке расположены визуальные компоненты, связанные с <a href="/manual.html#datasources">источником данных</a>, содержащим JPQL запрос, то этот запрос также не выполняется. В результате экран открывается быстрее, а данные загружаются только в тот момент, когда пользователь действительно хочет их увидеть, выбирая данную вкладку.</p> 
            </div> 
            <div id="gui_accordion_SelectedTabChangeListener" class="paragraph"> 
             <p>Следует иметь в виду, что компоненты, расположенные на <code>lazy</code>-вкладке, не существуют в момент открытия экрана. Поэтому их нельзя <a href="/manual.html#screen_controller_injection">инжектировать</a> в контроллер, и нельзя получить вызовом <code>getComponent()</code> в методе <code>init()</code> контроллера. Обратиться к компонентам <code>lazy</code>-вкладки можно только после того, как пользователь на нее переключился. Этот момент можно отловить с помощью слушателя <code>Accordion.SelectedTabChangeListener</code>, например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Accordion accordion;

<span class="directive">private</span> <span class="type">boolean</span> tabInitialized;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    accordion.addSelectedTabChangeListener(event -&gt; {
        <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">tabCambridge</span><span class="delimiter">"</span></span>.equals(event.getSelectedTab().getName())) {
            initCambridgeTab();
        }
    });
}

<span class="directive">private</span> <span class="type">void</span> initCambridgeTab(){
    <span class="keyword">if</span> (tabInitialized) {
        <span class="keyword">return</span>;
    }
    tabInitialized = <span class="predefined-constant">true</span>;
    <span class="comment">// initialization code here</span>
    <span class="comment">// use getComponentNN("comp_id") here to get lazy tab's components</span>
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>По умолчанию вкладки не являются <code>lazy</code>, а значит, загружают свое содержимое в момент открытия экрана.</p> 
            </div> </li> 
           <li> <p>В веб-клиенте с темой, основанной на Halo, атрибут <code>stylename</code> позволяет установить для компонента <code>accordion</code> стиль <code>borderless</code>, который удаляет рамку и фон контейнера:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">accordion.setStyleName(HaloTheme.ACCORDION_BORDERLESS);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Вкладка компонента <code>accordion</code> может содержать любой другой визуальный контейнер, такой как таблица, сетка и т.д.:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;accordion</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">accordion</span><span class="delimiter">"</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span> <span class="attribute-name">enable</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tab</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">tabNY</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://tabNY</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">nYTable</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;columns&gt;</span>
                <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">borough</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">county</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">population</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">square</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/columns&gt;</span>
            <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">newYorkDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/table&gt;</span>
    <span class="tag">&lt;/tab&gt;</span>
<span class="tag">&lt;/accordion&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_accordion_2.png" alt="gui accordion 2"> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты accordion
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_colspan">colspan</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_rowspan">rowspan</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabCaptionsAsHtml">tabCaptionsAsHtml</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты tab
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_attr_description">description</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_expand">expand</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_accordion_tab_lazy">lazy</a> - <a href="/manual.html#gui_attr_margin">margin</a> - <a href="/manual.html#gui_attr_spacing">spacing</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_accordion_SelectedTabChangeListener">addSelectedTabChangeListener</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_BoxLayout"><a class="anchor" href="/manual.html#gui_BoxLayout"></a>5.5.2.2.2. BoxLayout</h6> 
         <div class="paragraph"> 
          <p><code>BoxLayout</code> представляет собой контейнер с последовательным размещением компонентов.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Существует три типа <code>BoxLayout</code>, определяемых именем XML-элемента:</p> 
         </div> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=hbox-sample" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>hbox</code> − горизонтальное расположение компонентов.</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_hbox.png" alt="gui hbox"> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hbox</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hbox&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=vbox-sample" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>vbox</code> − вертикальное расположение компонентов. <code>vbox</code> имеет 100% ширину по умолчанию.</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_vbox.png" alt="gui vbox"> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;vbox</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/vbox&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=flowbox-sample" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>flowBox</code> − горизонтальное расположение компонентов с переносом вниз. При недостатке места по горизонтали непомещающиеся компоненты будут перенесены "на следующую строку" (поведение аналогично <strong>Swing</strong> <code>FlowLayout</code>).</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_flowbox.png" alt="gui flowbox"> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;flowBox</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/flowBox&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В веб-клиенте с темой, основанной на Halo, <code>BoxLayout</code> может быть использован для создания сложных составных компонентов. Атрибут <code>stylename</code> со значением <code>card</code> или <code>well</code> в сочетании с атрибутом <code>stylename="v-panel-caption"</code> вложенного контейнера задают компоненту внешний вид <a href="https://vaadin.com/docs/-/part/framework/layout/layout-panel.html" target="_blank">Vaadin Panel</a>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>стиль <code>card</code> придаёт контейнеру вид карточки.</p> </li> 
           <li> <p><code>well</code> делает карточку "утопленной" с затемнением фона.</p> </li> 
          </ul> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_boxlayout.png" alt="gui boxlayout"> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;vbox</span> <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">well</span><span class="delimiter">"</span></span>
      <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">200px</span><span class="delimiter">"</span></span>
      <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">300px</span><span class="delimiter">"</span></span>
      <span class="attribute-name">expand</span>=<span class="string"><span class="delimiter">"</span><span class="content">message</span><span class="delimiter">"</span></span>
      <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hbox</span> <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">v-panel-caption</span><span class="delimiter">"</span></span>
          <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Widget caption</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_RIGHT</span><span class="delimiter">"</span></span>
                <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">font-icon:EXPAND</span><span class="delimiter">"</span></span>
                <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">borderless-colored</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hbox&gt;</span>
    <span class="tag">&lt;textArea</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">message</span><span class="delimiter">"</span></span>
              <span class="attribute-name">inputPrompt</span>=<span class="string"><span class="delimiter">"</span><span class="content">Enter your message here...</span><span class="delimiter">"</span></span>
              <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">280</span><span class="delimiter">"</span></span>
              <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_CENTER</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Send message</span><span class="delimiter">"</span></span>
            <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/vbox&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Метод <a href="/manual.html#gui_api_getComponent">getComponent()</a> позволяет получить дочерний компонент <code>BoxLayout</code> по его индексу:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Button</span> button = (<span class="predefined-type">Button</span>) hbox.getComponent(<span class="integer">0</span>);</code></pre> 
          </div> 
         </div> 
         <div id="gui_BoxLayout_addShortcutAction" class="paragraph"> 
          <p>В компоненте <code>BoxLayout</code> можно использовать горячие клавиши. Задать сочетание клавиш и вызываемое действие можно с помощью метода <code>addShortcutAction()</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">flowBox.addShortcutAction(<span class="keyword">new</span> ShortcutAction(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A</span><span class="delimiter">"</span></span>, shortcutTriggeredEvent -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A action</span><span class="delimiter">"</span></span> )));</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты hbox, vbox, flowBox
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_expand">expand</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_margin">margin</a> - <a href="/manual.html#gui_attr_spacing">spacing</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_api_addLayoutClickListener">addLayoutClickListener</a> - <a href="/manual.html#gui_api_shortcut">addShortcutAction</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_margin">getMargin</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_indexOf">indexOf</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a> - <a href="/manual.html#gui_api_margin">setMargin</a> - <a href="/manual.html#gui_api_spacing">setSpacing</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_ButtonsPanel"><a class="anchor" href="/manual.html#gui_ButtonsPanel"></a>5.5.2.2.3. ButtonsPanel</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=table-buttonspanel" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>ButtonsPanel</code> - контейнер, унифицирующий использование и размещение компонентов (чаще всего кнопок) для управления данными в таблице.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_buttonsPanel.png" alt="gui buttonsPanel"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>buttonsPanel</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания <code>ButtonsPanel</code> в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersTable</span><span class="delimiter">"</span></span>
       <span class="attribute-name">editable</span>=<span class="string"><span class="delimiter">"</span><span class="content">false</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">remove</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">excel</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
    <span class="tag">&lt;buttonsPanel&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersTable.create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersTable.edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersTable.remove</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersTable.excel</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/buttonsPanel&gt;</span>
    <span class="tag">&lt;columns&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">email</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/columns&gt;</span>
    <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/table&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Элемент <code>buttonsPanel</code> можно разместить как внутри <code>table</code>, так и в произвольном месте экрана.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Если <code>buttonsPanel</code> находится внутри <code>table</code>, то она комбинируется с компонентом <a href="/manual.html#gui_Table_rowsCount">rowsCount</a> таблицы, тем самым оптимально расходуя место по вертикали. Кроме того, в этом случае при открытии экрана выбора методом <code>Frame.openLookup()</code> (например, из компонента <a href="/manual.html#gui_PickerField">PickerField</a>) панель кнопок скрывается.</p> 
         </div> 
         <div id="gui_ButtonsPanel_alwaysVisible" class="paragraph"> 
          <p>Атрибут <code>alwaysVisible</code> служит для отключения скрытия панели в экране выбора при его открытии методом <code>Frame.openLookup()</code>. Если значение атрибута равно <code>true</code>, то панель с кнопками не скрывается. По умолчанию значение атрибута равно <code>false</code>.</p> 
         </div> 
         <div id="gui_ButtonsPanel_LayoutClickListener" class="paragraph"> 
          <p>События щелчка по области компонента <code>buttonsPanel</code> можно отслеживать с помощью интерфейса <code>LayoutClickListener</code>.</p> 
         </div> 
         <div id="gui_ButtonsPanel_addShortcutAction" class="paragraph"> 
          <p>В компоненте <code>ButtonsPanel</code> можно использовать горячие клавиши. Задать сочетание клавиш и вызываемое действие можно с помощью метода <code>addShortcutAction()</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">buttonsPanel.addShortcutAction(<span class="keyword">new</span> ShortcutAction(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A</span><span class="delimiter">"</span></span>, shortcutTriggeredEvent -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A action</span><span class="delimiter">"</span></span> )));</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты buttonsPanel
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_ButtonsPanel_alwaysVisible">alwaysVisible</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_expand">expand</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_addLayoutClickListener">addLayoutClickListener</a> - <a href="/manual.html#gui_api_shortcut">addShortcutAction</a> - <a href="/manual.html#gui_api_spacing">setSpacing</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_CssLayout"><a class="anchor" href="/manual.html#gui_CssLayout"></a>5.5.2.2.4. CssLayout</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=responsive-csslayout" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Контейнер <code>CssLayout</code> позволяет управлять размещением и стилизацией своих компонентов с помощью CSS.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>cssLayout</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Ниже приведен пример использования <code>cssLayout</code> в простом responsive экране.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Отображение компонентов на широком дисплее:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_cssLayout_1.png" alt="gui cssLayout 1"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Отображение компонентов на узком дисплее:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_cssLayout_2.png" alt="gui cssLayout 2"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-дескриптор экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cssLayout</span> <span class="attribute-name">responsive</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
           <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">responsive-container</span><span class="delimiter">"</span></span>
           <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
          <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
          <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">group-panel</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;textField</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Field One</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;textField</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Field Two</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Button</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
          <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
          <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">group-panel</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;textField</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Field Three</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;textField</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Field Four</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Button</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
<span class="tag">&lt;/cssLayout&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Содержимое файла <code>modules/web/themes/halo/halo-ext.scss</code> (в разделе <a href="/manual.html#web_theme_extension">Расширение существующей темы</a> приведена информация о том как создать этот файл):</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="css"><span class="comment">/* Define your theme modifications inside next mixin */</span>
<span class="directive">@mixin</span> <span class="tag">halo-ext</span> {
  <span class="directive">@include</span> <span class="key">halo</span>;

  .<span class="key">responsive-container</span> {
    <span class="error">&amp;</span><span class="error">[</span><span class="key">width-range</span>~=<span class="string"><span class="delimiter">"</span><span class="content">0-900px</span><span class="delimiter">"</span></span><span class="error">]</span> {
      .<span class="key">group-panel</span> {
        <span class="key">width</span>: <span class="float">100%</span> <span class="important">!important</span>;
      }
    }

    <span class="error">&amp;</span><span class="error">[</span><span class="key">width-range</span>~=<span class="string"><span class="delimiter">"</span><span class="content">901px-</span><span class="delimiter">"</span></span><span class="error">]</span> {
      .<span class="key">group-panel</span> {
        <span class="key">width</span>: <span class="float">50%</span> <span class="important">!important</span>;
      }
    }
  }
}</code></pre> 
          </div> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>stylename</code> позволяет применять стили к компоненту <code>CssLayout</code> в XML-дескрипторе или контроллере экрана.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="ulist"> 
               <ul> 
                <li> <p>стиль <code>v-component-group</code> используется для склеивания компонентов, т.е. группировки без отступов между ними:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cssLayout</span> <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">v-component-group</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">inputPrompt</span>=<span class="string"><span class="delimiter">"</span><span class="content">Search...</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">OK</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/cssLayout&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="imageblock" style="text-align: center"> 
                  <div class="content"> 
                   <img src="assets/gui_cssLayout_3.png" alt="gui cssLayout 3"> 
                  </div> 
                 </div> </li> 
                <li> <p>стиль <code>well</code> делает контейнер "утопленным" с затемнением фона.</p> </li> 
                <li> <p>стиль <code>card</code> придаёт контейнеру вид карточки. В сочетании со стилем <code>v-panel-caption</code>, установленным для любого вложенного контейнера, он позволяет создавать сложные составные контейнеры, например:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cssLayout</span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">300px</span><span class="delimiter">"</span></span>
           <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">card</span><span class="delimiter">"</span></span>
           <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">300px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hbox</span> <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">v-panel-caption</span><span class="delimiter">"</span></span>
          <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Widget caption</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_RIGHT</span><span class="delimiter">"</span></span>
                <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">font-icon:EXPAND</span><span class="delimiter">"</span></span>
                <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">borderless-colored</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/hbox&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Panel content</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
<span class="tag">&lt;/cssLayout&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Результат:</p> 
                 </div> 
                 <div class="imageblock" style="text-align: center"> 
                  <div class="content"> 
                   <img src="assets/gui_cssLayout_4.png" alt="gui cssLayout 4"> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты cssLayout
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_responsive">responsive</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_api_shortcut">addShortcutAction</a> - <a href="/manual.html#gui_api_addLayoutClickListener">addLayoutClickListener</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_indexOf">indexOf</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Frame"><a class="anchor" href="/manual.html#gui_Frame"></a>5.5.2.2.5. Frame</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-frame" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Элемент <code>frame</code> предназначен для включения в экран <a href="/manual.html#frame">фреймов</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты:</p> 
         </div> 
         <div id="gui_Frame_src" class="ulist"> 
          <ul> 
           <li> <p><code>src</code> − путь к XML-дескриптору фрейма.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_Frame_screen" class="ulist"> 
          <ul> 
           <li> <p><code>screen</code> - идентификатор фрейма в <a href="/manual.html#screens.xml">screens.xml</a> (если фрейм зарегистрирован).</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Должен быть указан один из этих атрибутов. Если указано оба, фрейм будет загружен из явно указанного в <code>src</code> файла.</p> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты frame
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_Frame_screen">screen</a> - <a href="/manual.html#gui_Frame_src">src</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_margin">getMargin</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_indexOf">indexOf</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a> - <a href="/manual.html#gui_api_margin">setMargin</a> - <a href="/manual.html#gui_api_spacing">setSpacing</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_GridLayout"><a class="anchor" href="/manual.html#gui_GridLayout"></a>5.5.2.2.6. GridLayout</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-grid" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>GridLayout</code> - контейнер, располагающий компоненты по сетке.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_gridlayout.png" alt="gui gridlayout"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>grid</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования контейнера:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;grid</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;columns</span> <span class="attribute-name">count</span>=<span class="string"><span class="delimiter">"</span><span class="content">4</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;rows&gt;</span>
        <span class="tag">&lt;row&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Date</span><span class="delimiter">"</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_LEFT</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Customer</span><span class="delimiter">"</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_LEFT</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>
                         <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/row&gt;</span>
        <span class="tag">&lt;row&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Amount</span><span class="delimiter">"</span></span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">MIDDLE_LEFT</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/row&gt;</span>
    <span class="tag">&lt;/rows&gt;</span>
<span class="tag">&lt;/grid&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Элементы <code>grid</code>:</p> 
         </div> 
         <div id="gui_GridLayout_columns" class="ulist"> 
          <ul> 
           <li> <p><code>columns</code> - обязательный элемент, описывает колонки сетки. Должен либо иметь атрибут <code>count</code>, либо вложенные элементы <code>column</code> для каждой колонки.</p> 
            <div id="gui_GridLayout_columns_count" class="paragraph"> 
             <p>В простейшем случае достаточно задать число колонок в атрибуте <code>count</code>. Тогда, если ширина всего контейнера явно задана в пикселах или процентах, незанятое место будет распределяться между колонками равными долями.</p> 
            </div> 
            <div id="gui_GridLayout_column_flex" class="paragraph"> 
             <p>Для распределения незанятого места неравными долями необходимо определить для каждой колонки элемент <code>column</code> и задать для него атрибут <code>flex</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Пример сетки, в которой вторая и четвертая колонки занимают все лишнее место по горизонтали, причем четвертая колонка забирает себе в три раза больше лишнего места:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;grid</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;columns&gt;</span>
        <span class="tag">&lt;column</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">flex</span>=<span class="string"><span class="delimiter">"</span><span class="content">1</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;column</span> <span class="attribute-name">flex</span>=<span class="string"><span class="delimiter">"</span><span class="content">3</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/columns&gt;</span>
    <span class="tag">&lt;rows&gt;</span>
        <span class="tag">&lt;row&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>
                         <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/row&gt;</span>
        <span class="tag">&lt;row&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/row&gt;</span>
    <span class="tag">&lt;/rows&gt;</span>
<span class="tag">&lt;/grid&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Если атрибут <code>flex</code> не указан, или указано значение 0, то ширина данной колонки будет установлена по содержимому, если хотя-бы одна другая колонка имеет ненулевой <code>flex</code>. В приведенном примере первая и третья колонки получат ширину по максимальной длине текста надписей.</p> 
            </div> 
            <div class="admonitionblock tip"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Tip
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>Для того, чтобы лишнее место вообще образовалось, необходимо установить всему контейнеру ширину в пикселах или процентах. В противном случае ширина колонок будет рассчитана по ширине содержимого, и атрибут <code>flex</code> не будет иметь никакого эффекта.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_GridLayout_rows" class="ulist"> 
          <ul> 
           <li> <p><code>rows</code> − обязательный элемент, содержит последовательность строк. Каждая строка определяется в своем элементе <code>row</code>.</p> 
            <div id="gui_GridLayout_row_flex" class="paragraph"> 
             <p>Элемент <code>row</code> может содержать атрибут <code>flex</code>, аналогичный описанному для <code>column</code>, но влияющий на распределение лишнего места по вертикали при заданной общей высоте сетки.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Элемент <code>row</code> должен содержать элементы компонентов, отображаемых в ячейках данной строки сетки. Число компонентов в одной строке не должно превышать заданного количества колонок, но может быть меньше.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Любой компонент, находящийся в контейнере <code>grid</code>, может иметь атрибуты <a href="/manual.html#gui_attr_colspan">colspan</a> и <a href="/manual.html#gui_attr_rowspan">rowspan</a>. Эти атрибуты задают соответственно сколько колонок и строк будет занимать данный компонент. Например, так можно растянуть поле <code>Field3</code> на три колонки:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;grid</span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;columns</span> <span class="attribute-name">count</span>=<span class="string"><span class="delimiter">"</span><span class="content">4</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;rows&gt;</span>
        <span class="tag">&lt;row&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Name 1</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;textField</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Name 2</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;textField</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/row&gt;</span>
        <span class="tag">&lt;row&gt;</span>
            <span class="tag">&lt;label</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Name 3</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;textField</span> <span class="attribute-name">colspan</span>=<span class="string"><span class="delimiter">"</span><span class="content">3</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/row&gt;</span>
    <span class="tag">&lt;/rows&gt;</span>
<span class="tag">&lt;/grid&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В результате компоненты будут располагаться следующим образом:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_gridlayout_colspan.png" alt="gui gridlayout colspan"> 
          </div> 
         </div> 
         <div id="gui_GridLayout_LayoutClickListener" class="paragraph"> 
          <p>События щелчка по области компонента <code>GridLayout</code> можно отслеживать с помощью интерфейса <code>LayoutClickListener</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Метод <a href="/manual.html#gui_api_getComponent">getComponent()</a> позволяет получить дочерний компонент <code>GridLayout</code> по индексам его колонки и строки:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Button</span> button = (<span class="predefined-type">Button</span>) gridLayout.getComponent(<span class="integer">0</span>,<span class="integer">1</span>);</code></pre> 
          </div> 
         </div> 
         <div id="gui_GridLayout_addShortcutAction" class="paragraph"> 
          <p>В компоненте <code>GridLayout</code> можно использовать горячие клавиши. Задать сочетание клавиш и вызываемое действие можно с помощью метода <code>addShortcutAction()</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">grid.addShortcutAction(<span class="keyword">new</span> ShortcutAction(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A</span><span class="delimiter">"</span></span>, shortcutTriggeredEvent -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A action</span><span class="delimiter">"</span></span> )));</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты grid
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_margin">margin</a> - <a href="/manual.html#gui_attr_spacing">spacing</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Элементы grid
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_GridLayout_columns">columns</a> - <a href="/manual.html#gui_GridLayout_rows">rows</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты columns
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_GridLayout_columns_count">count</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты column
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_GridLayout_column_flex">flex</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты row
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_GridLayout_row_flex">flex</a> - <a href="/manual.html#gui_attr_visible">visible</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_api_shortcut">addShortcutAction</a> - <a href="/manual.html#gui_api_addLayoutClickListener">addLayoutClickListener</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_margin">getMargin</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a> - <a href="/manual.html#gui_api_margin">setMargin</a> - <a href="/manual.html#gui_api_spacing">setSpacing</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_GroupBoxLayout"><a class="anchor" href="/manual.html#gui_GroupBoxLayout"></a>5.5.2.2.7. GroupBoxLayout</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-groupbox" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>GroupBoxLayout</code> - контейнер, позволяющий выделить рамкой содержащиеся в нем компоненты, и задать им общий заголовок. Кроме того, он умеет сворачивать свое содержимое.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_groupBox.png" alt="gui groupBox"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>groupBox</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описание контейнера в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groupBox</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Order</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>
                 <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/groupBox&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>groupBox</code>:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>caption</code> - заголовок группы.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_GroupBox_orientation" class="ulist"> 
          <ul> 
           <li> <p><code>orientation</code> - задает направление расположения вложенных компонентов − <code>horizontal</code> или <code>vertical</code>. По умолчанию <code>vertical</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_GroupBox_collapsable" class="ulist"> 
          <ul> 
           <li> <p><code>collapsable</code> − значение <code>true</code> позволяет пользователю скрывать содержимое компонента с помощью значков <span class="image"><img src="assets/gui_groupBox_minus.png" alt="gui_groupBox_minus"></span>/<span class="image"><img src="assets/gui_groupBox_plus.png" alt="gui_groupBox_plus"></span>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_GroupBox_collapsed" class="ulist"> 
          <ul> 
           <li> <p><code>collapsed</code> − если указано значение <code>true</code>, то содержимое компонента будет свернуто сразу после открытия экрана. Используется совместно с <code>collapsable="true"</code>.</p> 
            <div class="paragraph"> 
             <p>Пример свернутого <code>GroupBox</code>:</p> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_groupBox_collapsed.png" alt="gui groupBox collapsed"> 
             </div> 
            </div> 
            <div id="gui_GroupBox_ExpandedStateChangeListener" class="paragraph"> 
             <p>Изменения состояния компонента <code>groupBox</code> (сворачивание и разворачивание) можно отслеживать с помощью интерфейса <code>ExpandedStateChangeListener</code>.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_GroupBox_outerMargin" class="ulist"> 
          <ul> 
           <li> <p><code>outerMargin</code> - устанавливает внешние поля вокруг границы <code>groupBox</code>. Если указано значение <code>true</code>, внешние поля будут добавлены ко всем сторонам компонента. Чтобы задать внешние поля индивидуально, укажите значения <code>true</code> или <code>false</code> для каждой стороны <code>groupBox</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groupBox</span> <span class="attribute-name">outerMargin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true, false, true, false</span><span class="delimiter">"</span></span><span class="tag">&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Если атрибут <code>showAsPanel</code> установлен в <code>true</code>, <code>outerMargin</code> игнорируется.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_GroupBox_panel" class="ulist"> 
          <ul> 
           <li> <p><code>showAsPanel</code> – если указано значение <code>true</code>, то компонент будет выглядеть как <a href="https://vaadin.com/docs/-/part/framework/layout/layout-panel.html" target="_blank">Vaadin Panel</a>. Значение по-умолчанию - <code>false</code>.</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_groupBox_Panel.png" alt="gui groupBox Panel"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Контейнер <code>groupBox</code> по умолчанию имеет ширину 100% аналогично <a href="/manual.html#gui_BoxLayout">vbox</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В веб-клиенте с темой, основанной на Halo, к компоненту <code>groupBox</code> можно применить предопределенные стили. Стили задаются в XML-дексрипторе или контроллере экрана с помощью атрибута <code>stylename</code>. Чтобы применить стиль программно, выберите одну из констант класса <code>HaloTheme</code> с префиксом компонента <code>LAYOUT_</code> или <code>GROUPBOX_</code>. Следующие стили должны использоваться совместно с атрибутом <code>showAsPanel</code>, имеющим значение <code>true</code>:</p> 
         </div> 
         <div id="gui_groupbox_borderless" class="ulist"> 
          <ul> 
           <li> <p>стиль <code>borderless</code> удаляет рамку и фон контейнера <code>groupBox</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml">groupBox.setShowAsPanel(true);
groupBox.setStyleName(HaloTheme.GROUPBOX_PANEL_BORDERLESS);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_groupbox_card" class="ulist"> 
          <ul> 
           <li> <p>стиль <code>card</code> придаёт контейнеру вид карточки.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_groupbox_well" class="ulist"> 
          <ul> 
           <li> <p>стиль <code>well</code> делает контейнер "утопленным" с затемнением фона:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groupBox</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Well-styled groupBox</span><span class="delimiter">"</span></span>
          <span class="attribute-name">showAsPanel</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span>
          <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">well</span><span class="delimiter">"</span></span>
          <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">300px</span><span class="delimiter">"</span></span>
          <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">200px</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_groupBox_Panel_2.png" alt="gui groupBox Panel 2"> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_GroupBox_addShortcutAction" class="paragraph"> 
          <p>В компоненте <code>Groupbox</code> можно использовать горячие клавиши. Задать сочетание клавиш и вызываемое действие можно с помощью метода <code>addShortcutAction()</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">groupBox.addShortcutAction(<span class="keyword">new</span> ShortcutAction(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A</span><span class="delimiter">"</span></span>, shortcutTriggeredEvent -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A action</span><span class="delimiter">"</span></span> )));</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты groupBox
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_GroupBox_collapsable">collapsable</a> - <a href="/manual.html#gui_GroupBox_collapsed">collapsed</a> - <a href="/manual.html#gui_attr_expand">expand</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_GroupBox_orientation">orientation</a> - <a href="/manual.html#gui_GroupBox_outerMargin">outerMargin</a> - <a href="/manual.html#gui_attr_settingsEnabled">settingsEnabled</a> - <a href="/manual.html#gui_attr_spacing">spacing</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили groupBox
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_groupbox_borderless">borderless</a> - <a href="/manual.html#gui_groupbox_card">card</a> - <a href="/manual.html#gui_groupbox_well">well</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_api_expanded">addExpandedStateChangeListener</a> - <a href="/manual.html#gui_api_shortcut">addShortcutAction</a> - <a href="/manual.html#gui_api_settings">applySettings</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_indexOf">indexOf</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a> - <a href="/manual.html#gui_api_settings">saveSettings</a> - <a href="/manual.html#gui_api_outerMargin">setOuterMargin</a> - <a href="/manual.html#gui_api_spacing">setSpacing</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_HtmlBoxLayout"><a class="anchor" href="/manual.html#gui_HtmlBoxLayout"></a>5.5.2.2.8. HtmlBoxLayout</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=html-box" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>HtmlBoxLayout</code> позволяет определять расположение компонентов в HTML-шаблоне, который включается в <a href="/manual.html#web_theme">тему</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>htmlBox</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Ниже приведен пример использования <code>htmlBox</code> в простом экране.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_htmlBox_1.png" alt="gui htmlBox 1"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-дескриптор экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;htmlBox</span> <span class="attribute-name">align</span>=<span class="string"><span class="delimiter">"</span><span class="content">TOP_CENTER</span><span class="delimiter">"</span></span>
         <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">"</span><span class="content">sample</span><span class="delimiter">"</span></span>
         <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">500px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;label</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">logo</span><span class="delimiter">"</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">Subscribe</span><span class="delimiter">"</span></span>
           <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">logo</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">email</span><span class="delimiter">"</span></span>
               <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
               <span class="attribute-name">inputPrompt</span>=<span class="string"><span class="delimiter">"</span><span class="content">email@test.test</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">submit</span><span class="delimiter">"</span></span>
            <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span>
            <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">showMessage</span><span class="delimiter">"</span></span>
            <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Subscribe</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/htmlBox&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>htmlBox</code>:</p> 
         </div> 
         <div id="gui_htmlBox_template" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>template</code> задает имя HTML-файла, находящегося в подкаталоге <code>layouts</code> темы. Перед созданием шаблона необходимо создать <a href="/manual.html#web_theme_extension">расширение темы</a> или <a href="/manual.html#web_theme_creation">новую тему</a>.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Например, если вы используете тему Halo и хотите назвать шаблон <code>my_template</code>, укажите <code>my_template</code> в атрибуте и разместите шаблон в файле <code>modules/web/themes/halo/layouts/my_template.html</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Содержимое шаблона <code>modules/web/themes/halo/layouts/sample.html</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;div</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">logo</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">logo</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;table</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">component-container</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tr&gt;</span>
        <span class="tag">&lt;td&gt;</span>
            <span class="tag">&lt;div</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">email</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">email</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;/td&gt;</span>
        <span class="tag">&lt;td&gt;</span>
            <span class="tag">&lt;div</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">"</span><span class="content">submit</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">submit</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;/td&gt;</span>
    <span class="tag">&lt;/tr&gt;</span>
<span class="tag">&lt;/table&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Шаблон должен содержать элементы <code>&lt;div&gt;</code> с атрибутами <code>location</code>. В этих элементах будут отображаться компоненты CUBA, определенные в XML дескрипторе с соответствующими идентификаторами.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Содержимое файла <code>modules/web/themes/halo/halo-ext.scss</code> (в разделе <a href="/manual.html#web_theme_extension">Расширение существующей темы</a> приведена информация о том как создать этот файл):</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../halo/halo</span><span class="delimiter">"</span></span>;

<span class="directive">@mixin</span> <span class="tag">halo-ext</span> {
  <span class="directive">@include</span> <span class="key">halo</span>;

  .<span class="key">email</span> {
    <span class="key">width</span>: <span class="float">390px</span>;
  }

  .<span class="key">submit</span> {
    <span class="key">width</span>: <span class="float">100px</span>;
  }

  .<span class="key">logo</span> {
    <span class="key">font-size</span>: <span class="float">96px</span>;
    <span class="key">text-transform</span>: <span class="value">uppercase</span>;
    <span class="key">margin-top</span>: <span class="float">50px</span>;
  }

  .<span class="key">component-container</span> {
    <span class="key">display</span>: <span class="value">inline-block</span>;
    <span class="key">vertical-align</span>: <span class="value">top</span>;
    <span class="key">width</span>: <span class="float">100%</span>;
  }
}</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_htmlBox_templateContents" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>templateContents</code> задаёт непосредственно содержимое шаблона, который будет использован для отображения данного контейнера.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Пример использования атрибута:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;htmlBox</span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">256px</span><span class="delimiter">"</span></span>
         <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">400px</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;templateContents&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;table align="center" cellspacing="10"
                   style="width: 100%; height: 100%; color: #fff; padding: 20px;    background: #31629E repeat-x"&gt;
                &lt;tr&gt;
                    &lt;td colspan="2"&gt;&lt;h1 style="margin-top: 0;"&gt;Login&lt;/h1&gt;
                    &lt;td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td align="right"&gt;User&amp;nbsp;name:&lt;/td&gt;
                    &lt;td&gt;
                        &lt;div location="username"&gt;&lt;/div&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td align="right"&gt;Password:&lt;/td&gt;
                    &lt;td&gt;
                        &lt;div location="password"&gt;&lt;/div&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td align="right" colspan="2"&gt;
                        &lt;div location="okbutton" style="padding: 10px;"&gt;&lt;/div&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan="2" style="padding: 7px; background-color: #4172AE"&gt;&lt;span
                            style="font-family: FontAwesome; margin-right: 5px;"&gt;&amp;#xf05a;&lt;/span&gt; This information is in the layout.
                    &lt;td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/templateContents&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">username</span><span class="delimiter">"</span></span>
               <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;textField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">password</span><span class="delimiter">"</span></span>
               <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">okbutton</span><span class="delimiter">"</span></span>
            <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Login</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/htmlBox&gt;</span></code></pre> 
               </div> 
              </div> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты htmlBox
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_htmlBox_template">template</a> - <a href="/manual.html#gui_htmlBox_templateContents">templateContents</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_ScrollBoxLayout"><a class="anchor" href="/manual.html#gui_ScrollBoxLayout"></a>5.5.2.2.9. ScrollBoxLayout</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-scrollbox" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>ScrollBoxLayout</code> − контейнер, который позволяет прокручивать свое содержимое.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_scrollBox.png" alt="gui scrollBox"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>scrollBox</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описание контейнера с прокруткой в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groupBox</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Order</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">300</span><span class="delimiter">"</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">170</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;scrollBox</span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/scrollBox&gt;</span>
<span class="tag">&lt;/groupBox&gt;</span></code></pre> 
          </div> 
         </div> 
         <div id="gui_ScrollBox_orientation" class="ulist"> 
          <ul> 
           <li> <p>С помощью атрибута <code>orientation</code> можно задавать направление расположения вложенных компонентов − <code>horizontal</code> или <code>vertical</code>. По умолчанию <code>vertical</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_ScrollBox_scrollBars" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>scrollBars</code> позволяет настраивать полосы прокрутки. Может принимать значения <code>horizontal</code>, <code>vertical</code> - для прокрутки по горизонтали и вертикали соответственно, <code>both</code> - для прокрутки во всех направлениях. Установка значения <code>none</code> запрещает прокрутку в любом направлении</p> </li> 
          </ul> 
         </div> 
         <div class="admonitionblock warning"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Warning
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Вложенные в <code>scrollBox</code> компоненты должны иметь фиксированные размеры или размеры по умолчанию. Нельзя устанавливать <code>height="100%"</code> или <code>width="100%"</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>В то же время <code>scrollBox</code> не может вычислять свои собственные размеры по содержимому. Ему нужно либо указать абсолютные размеры, либо растянуть в родительском контейнере, установив <code>height="100%"</code> и <code>width="100%"</code>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div id="gui_ScrollBox_addShortcutAction" class="paragraph"> 
          <p>В компоненте <code>ScrollBox</code> можно использовать горячие клавиши. Задать сочетание клавиш и вызываемое действие можно с помощью метода <code>addShortcutAction()</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">scrollBox.addShortcutAction(<span class="keyword">new</span> ShortcutAction(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A</span><span class="delimiter">"</span></span>, shortcutTriggeredEvent -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A action</span><span class="delimiter">"</span></span> )));</code></pre> 
          </div> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты scrollBox
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_margin">margin</a> - <a href="/manual.html#gui_ScrollBox_orientation">orientation</a> - <a href="/manual.html#gui_ScrollBox_scrollBars">scrollBars</a> - <a href="/manual.html#gui_attr_spacing">spacing</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_api_shortcut">addShortcutAction</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_margin">getMargin</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_indexOf">indexOf</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a> - <a href="/manual.html#gui_api_margin">setMargin</a> - <a href="/manual.html#gui_api_spacing">setSpacing</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_SplitPanel"><a class="anchor" href="/manual.html#gui_SplitPanel"></a>5.5.2.2.10. SplitPanel</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-split" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p><code>SplitPanel</code> − контейнер, разбитый на две области, размер которых по горизонтали либо вертикали можно менять путем перемещения разделителя.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_splitPanel.png" alt="gui splitPanel"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>split</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания панели с разделителем в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;split</span> <span class="attribute-name">orientation</span>=<span class="string"><span class="delimiter">"</span><span class="content">horizontal</span><span class="delimiter">"</span></span> <span class="attribute-name">pos</span>=<span class="string"><span class="delimiter">"</span><span class="content">30</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
<span class="tag">&lt;/split&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Внутри контейнера <code>split</code> обязательно должны находиться два вложенных контейнера или компонента, которые и будут расположены по обе стороны разделителя.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты <code>split</code>:</p> 
         </div> 
         <div id="gui_SplitPanel_minmax" class="ulist"> 
          <ul> 
           <li> <p><code>minSplitPosition</code>, <code>maxSplitPosition</code> - определяют диапазон допустимых значений позиции разделителя. Могут быть установлены в пикселях или в процентах.</p> 
            <div class="paragraph"> 
             <p>Например, вы можете запретить перетаскивать сплиттер вне диапазона между 100 и 300 пикселями с левой стороны компонента:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;split</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">splitPanel</span><span class="delimiter">"</span></span> <span class="attribute-name">maxSplitPosition</span>=<span class="string"><span class="delimiter">"</span><span class="content">300px</span><span class="delimiter">"</span></span> <span class="attribute-name">minSplitPosition</span>=<span class="string"><span class="delimiter">"</span><span class="content">100px</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span> <span class="attribute-name">height</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Button 1</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Button 2</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
    <span class="tag">&lt;vbox</span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Button 4</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Button 5</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/vbox&gt;</span>
<span class="tag">&lt;/split&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Если вы хотите установить диапазон программно, вы должны указать единицу измерения с помощью <code>Component.UNITS_PIXELS</code> или <code>Component.UNITS_PERCENTAGE</code></p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">splitPanel.setMinSplitPosition(<span class="integer">100</span>, <span class="predefined-type">Component</span>.UNITS_PIXELS);
splitPanel.setMaxSplitPosition(<span class="integer">300</span>, <span class="predefined-type">Component</span>.UNITS_PIXELS);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_SplitPanel_orientation" class="ulist"> 
          <ul> 
           <li> <p><code>orientation</code> - задает ориентацию расположения компонентов. <code>horizontal</code> - вложенные компоненты располагаются горизонтально, <code>vertical</code> - вертикально.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SplitPanel_pos" class="ulist"> 
          <ul> 
           <li> <p><code>pos</code> - целое число, определяющее процентное соотношение размера первой области по отношению ко второй. Например, <code>pos="30"</code> означает соотношение областей 30/70. По умолчанию соотношение областей составляет 50/50.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SplitPanel_reversePosition" class="ulist"> 
          <ul> 
           <li> <p><code>reversePosition</code> - указывает, что атрибут <code>pos</code> содержит позицию разделителя, отсчитанную с обратной стороны компонента.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SplitPanel_locked" class="ulist"> 
          <ul> 
           <li> <p>Если атрибут <code>locked</code> установлен в <code>true</code>, то пользователи не смогут изменить положение разделителя.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SplitPanel_stylename" class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>stylename</code> со значением <code>large</code> увеличивает толщину разделителя.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">split.setStyleName(HaloTheme.SPLITPANEL_LARGE);</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Методы <code>SplitPanel</code>:</p> 
         </div> 
         <div id="gui_SplitPanel_getPosition" class="ulist"> 
          <ul> 
           <li> <p>Позицию разделителя можно получить с помощью метода <code>getSplitPosition()</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_SplitPanel_PositionUpdateListener" class="ulist"> 
          <ul> 
           <li> <p>События изменения положения разделителя можно отлеж <code>PositionUpdateListener</code>.</p> </li> 
           <li> <p>Если нужно получить единицу измерения позиции разделителя, используйте метод <code>getSplitPositionUnit()</code>. Он возвращает <code>Component.UNITS_PIXELS</code> или <code>Component.UNITS_PERCENTAGE</code>.</p> </li> 
           <li> <p><code>isSplitPositionReversed()</code> возвращает <code>true</code> в случае, если позиция отсчитывается с обратной стороны компонента.</p> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты split
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_align">align</a> - <a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_SplitPanel_locked">locked</a> - <a href="/manual.html#gui_SplitPanel_minmax">minSplitPosition</a> - <a href="/manual.html#gui_SplitPanel_minmax">maxSplitPosition</a> - <a href="/manual.html#gui_SplitPanel_orientation">orientation</a> - <a href="/manual.html#gui_SplitPanel_pos">pos</a> - <a href="/manual.html#gui_SplitPanel_reversePosition">reversePosition</a> - <a href="/manual.html#gui_attr_settingsEnabled">settingsEnabled</a> - <a href="/manual.html#gui_SplitPanel_stylename">stylename</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_SplitPanel_PositionUpdateListener">addPositionUpdateListener</a> - <a href="/manual.html#gui_api_settings">applySettings</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a> - <a href="/manual.html#gui_api_settings">saveSettings</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_TabSheet"><a class="anchor" href="/manual.html#gui_TabSheet"></a>5.5.2.2.11. TabSheet</h6> 
         <div class="manual-live-demo-container"> 
          <a href="https://demo.cuba-platform.com/sampler/open?screen=simple-tabsheet" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
         </div> 
         <div class="paragraph"> 
          <p>Контейнер <code>TabSheet</code> - это панель с вкладками (<code>tabs</code>). В один момент времени отображается содержимое только одной вкладки.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_tabsheet.png" alt="gui tabsheet"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>XML-имя компонента: <code>tabSheet</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример описания панели с вкладками в XML-дескрипторе экрана:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;tabSheet&gt;</span>
    <span class="tag">&lt;tab</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainTab</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Tab1</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;dateField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Date</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tab&gt;</span>
    <span class="tag">&lt;tab</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">additionalTab</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Tab2</span><span class="delimiter">"</span></span> <span class="attribute-name">margin</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">spacing</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;textField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Amount</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/tab&gt;</span>
<span class="tag">&lt;/tabSheet&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент <code>tabSheet</code> должен иметь вложенные элементы <code>tab</code>, описывающие вкладки. Каждая вкладка является контейнером с вертикальным расположением компонентов, аналогичным <a href="/manual.html#gui_BoxLayout">vbox</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Атрибуты элемента <code>tab</code>:</p> 
         </div> 
         <div id="gui_TabSheet_tab_id" class="ulist"> 
          <ul> 
           <li> <p><code>id</code> - идентификатор вкладки. Следует отметить, что вкладка не является компонентом, и данный идентификатор используется только в рамках <code>TabSheet</code> для работы с ней из кода контроллера.</p> </li> 
           <li> <p><a href="/manual.html#gui_attr_caption">caption</a> - заголовок вкладки.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_TabSheet_closable" class="ulist"> 
          <ul> 
           <li> <p><code>closable</code> - определяет, будет ли отображаться кнопка <strong>x</strong> для закрытия вкладки. Значение по умолчанию - <code>false</code>.</p> </li> 
           <li> <p><a href="/manual.html#gui_attr_icon">icon</a> - указывает на местоположение пиктограммы в каталоге темы. Применяется только для блока <strong>Web Client</strong>. Подробную информацию о том, где следует располагать файлы пиктограмм, можно прочитать в <a href="/manual.html#gui_themes">Создание темы приложения</a>.</p> </li> 
          </ul> 
         </div> 
         <div id="gui_TabSheet_tab_lazy" class="ulist"> 
          <ul> 
           <li> <p><code>lazy</code> - задает отложенную загрузку содержимого вкладки.</p> 
            <div class="paragraph"> 
             <p>При открытии экрана lazy-вкладки не загружают свое содержимое, что приводит к созданию меньшего количества компонентов в памяти. Компоненты вкладки загружаются только в тот момент, когда пользователь выбирает данную вкладку. Кроме того, если на lazy-вкладке расположены визуальные компоненты, связанные с <a href="/manual.html#datasources">источником данных</a>, содержащим JPQL запрос, то этот запрос также не выполняется. В результате экран открывается быстрее, а данные загружаются только в тот момент, когда пользователь действительно хочет их увидеть, выбирая данную вкладку.</p> 
            </div> 
            <div id="gui_TabSheet_SelectedTabChangeListener" class="paragraph"> 
             <p>Следует иметь в виду, что компоненты, расположенные на lazy-вкладке, не существуют в момент открытия экрана. Поэтому их нельзя <a href="/manual.html#screen_controller_injection">инжектировать</a> в контроллер, и нельзя получить вызовом <code>getComponent()</code> в методе <code>init()</code> контроллера. Обратиться к компонентам <code>lazy</code>-вкладки можно только после того, как пользователь на нее переключился. Этот момент можно отловить с помощью слушателя <code>TabSheet.SelectedTabChangeListener</code>, например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> TabSheet tabsheet;

<span class="directive">private</span> <span class="type">boolean</span> detailsInitialized, historyInitialized;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    tabsheet.addSelectedTabChangeListener(event -&gt; {
        <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">detailsTab</span><span class="delimiter">"</span></span>.equals(event.getSelectedTab().getName())) {
            initDetails();
        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string"><span class="delimiter">"</span><span class="content">historyTab</span><span class="delimiter">"</span></span>.equals(event.getSelectedTab().getName())) {
            initHistory();
        }
    });
}

<span class="directive">private</span> <span class="type">void</span> initDetails(){
    <span class="keyword">if</span> (detailsInitialized) {
        <span class="keyword">return</span>;
    }
    <span class="comment">// use getComponentNN("comp_id") here to get tab's components</span>
    detailsInitialized=<span class="predefined-constant">true</span>;
}

<span class="directive">private</span> <span class="type">void</span> initHistory(){
    <span class="keyword">if</span> (historyInitialized) {
        <span class="keyword">return</span>;
    }
    <span class="comment">// use getComponentNN("comp_id") here to get tab's components</span>
    historyInitialized = <span class="predefined-constant">true</span>;
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>По умолчанию вкладки не являются <code>lazy</code>, а значит, загружают свое содержимое в момент открытия экрана.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="gui_TabSheet_tab_detachable" class="ulist"> 
          <ul> 
           <li> <p><code>detachable</code> - значение <code>true</code> в десктоп-реализации экрана дает возможность отсоединять вкладку в отдельное окно. Это позволяет, например, размещать части UI приложения на разных мониторах. Отделяемая вкладка имеет специальную кнопку в заголовке:</p> 
            <div class="imageblock" style="text-align: center"> 
             <div class="content"> 
              <img src="assets/gui_tabsheetDetachable.png" alt="gui tabsheetDetachable"> 
             </div> 
            </div> 
            <div class="dlist"> 
             <dl> 
              <dt class="hdlist1">
               Стили TabSheet
              </dt> 
              <dd> 
               <div class="openblock"> 
                <div class="content"> 
                 <div class="paragraph"> 
                  <p>В веб-клиенте с темой, основанной на Halo, к контейнеру <code>TabSheet</code> можно применить предопределенные стили. Стили задаются в XML-дексрипторе или контроллере экрана с помощью атрибута <code>stylename</code>:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;tabSheet</span> <span class="attribute-name">stylename</span>=<span class="string"><span class="delimiter">"</span><span class="content">framed</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;tab</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">mainTab</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Framed tab</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/tabSheet&gt;</span></code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Чтобы применить стиль программно, выберите одну из констант класса <code>HaloTheme</code> с префиксом компонента <code>TABSHEET_</code>:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="java">tabSheet.setStyleName(HaloTheme.TABSHEET_COMPACT_TABBAR);</code></pre> 
                  </div> 
                 </div> 
                 <div id="gui_tabsheet_centered-tabs" class="ulist"> 
                  <ul> 
                   <li> <p><code>centered-tabs</code> - центрирует вкладки на панели. Подходит для страниц, где все вкладки целиком помещаются на панели (т.е. нет прокрутки вкладок).</p> </li> 
                  </ul> 
                 </div> 
                 <div id="gui_tabsheet_compact-tabbar" class="ulist"> 
                  <ul> 
                   <li> <p><code>compact-tabbar</code> - уменьшает отступы вокруг вкладок.</p> </li> 
                  </ul> 
                 </div> 
                 <div id="gui_tabsheet_equal-width-tabs" class="ulist"> 
                  <ul> 
                   <li> <p><code>equal-width-tabs</code> - задаёт всем вкладкам на панели равный размер (т.е. expand ratio == 1 для всех вкладок). Заголовки вкладок будут обрезаны, если они не поместятся на вкладку целиком. Прокрутка вкладок в этом случае не работает (будут видны одновременно все вкладки).</p> </li> 
                  </ul> 
                 </div> 
                 <div id="gui_tabsheet_framed" class="ulist"> 
                  <ul> 
                   <li> <p><code>framed</code> - добавляет рамку как вокруг всего контейнера целиком, так и вокруг каждой вкладки на панели.</p> </li> 
                  </ul> 
                 </div> 
                 <div id="gui_tabsheet_icons-on-top" class="ulist"> 
                  <ul> 
                   <li> <p><code>icons-on-top</code> - располагает пиктограмму вкладки над её заголовком (по умолчанию пиктограммы располагаются слева от заголовка).</p> </li> 
                  </ul> 
                 </div> 
                 <div id="gui_tabsheet_only-selected-closeable" class="ulist"> 
                  <ul> 
                   <li> <p><code>only-selected-closeable</code> - только выделенная вкладка имеет кнопку закрытия. Стиль не запрещает программного закрытия вкладок, а только скрывает кнопку от пользователя.</p> </li> 
                  </ul> 
                 </div> 
                 <div id="gui_tabsheet_padded-tabbar" class="ulist"> 
                  <ul> 
                   <li> <p><code>padded-tabbar</code> - добавляет небольшие отступы вокруг вкладок на панели, так что они не касаются границ контейнера.</p> </li> 
                  </ul> 
                 </div> 
                </div> 
               </div> 
              </dd> 
             </dl> 
            </div> </li> 
          </ul> 
         </div> 
         <hr> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Атрибуты tabSheet
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_height">height</a> - <a href="/manual.html#gui_attr_id">id</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_tabCaptionsAsHtml">tabCaptionsAsHtml</a> - <a href="/manual.html#gui_attr_tabIndex">tabIndex</a> - <a href="/manual.html#gui_attr_tabsVisible">tabsVisible</a> - <a href="/manual.html#gui_attr_visible">visible</a> - <a href="/manual.html#gui_attr_width">width</a></p> 
           </dd> 
           <dt class="hdlist1">
            Атрибуты tab
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_attr_caption">caption</a> - <a href="/manual.html#gui_TabSheet_closable">closable</a> - <a href="/manual.html#gui_TabSheet_tab_detachable">detachable</a> - <a href="/manual.html#gui_attr_enable">enable</a> - <a href="/manual.html#gui_attr_expand">expand</a> - <a href="/manual.html#gui_attr_margin">margin</a> - <a href="/manual.html#gui_attr_icon">icon</a> - <a href="/manual.html#gui_TabSheet_tab_id">id</a> - <a href="/manual.html#gui_TabSheet_tab_lazy">lazy</a> - <a href="/manual.html#gui_attr_spacing">spacing</a> - <a href="/manual.html#gui_attr_stylename">stylename</a> - <a href="/manual.html#gui_attr_visible">visible</a></p> 
           </dd> 
           <dt class="hdlist1">
            Предопределенные стили tabSheet
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_tabsheet_centered-tabs">centered-tabs</a> - <a href="/manual.html#gui_tabsheet_compact-tabbar">compact-tabbar</a> - <a href="/manual.html#gui_tabsheet_equal-width-tabs">equal-width-tabs</a> - <a href="/manual.html#gui_tabsheet_framed">framed</a> - <a href="/manual.html#gui_tabsheet_icons-on-top">framed</a> - <a href="/manual.html#gui_tabsheet_only-selected-closeable">only-selected-closeable</a> - <a href="/manual.html#gui_tabsheet_padded-tabbar">padded-tabbar</a></p> 
           </dd> 
           <dt class="hdlist1">
            API
           </dt> 
           <dd> 
            <p><a href="/manual.html#gui_api_add">add</a> - <a href="/manual.html#gui_TabSheet_SelectedTabChangeListener">addSelectedTabChangeListener</a> - <a href="/manual.html#gui_api_getComponent">getComponent</a> - <a href="/manual.html#gui_api_getComponentNN">getComponentNN</a> - <a href="/manual.html#gui_api_getComponents">getComponents</a> - <a href="/manual.html#gui_api_getOwnComponent">getOwnComponent</a> - <a href="/manual.html#gui_api_getOwnComponents">getOwnComponents</a> - <a href="/manual.html#gui_api_remove">remove</a> - <a href="/manual.html#gui_api_removeAll">removeAll</a></p> 
           </dd> 
          </dl> 
         </div> 
         <hr> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="gui_misc"><a class="anchor" href="/manual.html#gui_misc"></a>5.5.2.3. Разное</h5> 
        <div class="paragraph"> 
         <p>В данном разделе рассматриваются различные элементы универсального пользовательского интерфейса, имеющие отношение к визуальным компонентам.</p> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_formatter"><a class="anchor" href="/manual.html#gui_formatter"></a>5.5.2.3.1. Formatter</h6> 
         <div class="paragraph"> 
          <p>Formatter предназначен для преобразования некоторого значения в строку.</p> 
         </div> 
         <div class="admonitionblock warning"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Warning
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Formatter предназначен для использования с read-only компонентами, такими как <a href="/manual.html#gui_Label">Label</a>, колонка <a href="/manual.html#gui_Table">Table</a> и тому подобными. Для форматирования значения в редактируемых компонентах, например <a href="/manual.html#gui_TextField">TextField</a>, используйте механизм <code><a href="/manual.html#datatype">Datatype</a></code>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>В XML-дескрипторе экрана formatter для компонента может быть задан во вложенном элементе <code>formatter</code>. Элемент имеет единственный атрибут:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>class</code> − имя класса, реализующего интерфейс <code>com.haulmont.cuba.gui.components.Formatter</code></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Если конструктор класса formatter принимает параметр типа <code>org.dom4j.Element</code>, то ему будет передан элемент XML, описывающий данный <code>formatter</code>. Это можно использовать для параметризации экземпляра formatter'а, например, строкой форматирования. В частности, имеющиеся в платформе классы <code>DateFormatter</code> и <code>NumberFormatter</code> могут брать строку форматирования из атрибута <code>format</code>. Пример использования:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">date</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;formatter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.gui.components.formatters.DateFormatter</span><span class="delimiter">"</span></span> <span class="attribute-name">format</span>=<span class="string"><span class="delimiter">"</span><span class="content">yyyy-MM-dd HH:mm:ss</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/column&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Кроме того, класс <code>DateFormatter</code> распознает также атрибут <code>type</code>, который может принимать значения <code>DATE</code> или <code>DATETIME</code>. В этом случае форматирование производится с помощью механизма <code><a href="/manual.html#datatype">Datatype</a></code> по строке формата <code>dateFormat</code> или <code>dateTimeFormat</code> соответственно. Например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">endDate</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;formatter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.gui.components.formatters.DateFormatter</span><span class="delimiter">"</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">"</span><span class="content">DATE</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/column&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Если formatter реализован внутренним классом, то он должен быть объявлен с модификатором <code>static</code>, а его имя для загрузки отделяется символом "$", например:</p> 
              </div> 
              <div class="paragraph"> 
               <p><code>&lt;formatter class="com.sample.sales.gui.OrderBrowse$CurrencyFormatter"/&gt;</code></p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>Formatter можно назначить компоненту не только в XML-дескрипторе экрана, но и программно, передавая экземпляр formatter'а в метод <code>setFormatter()</code> компонента.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример объявления собственного formatter'а и использования его для форматирования значения колонки таблицы:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CurrencyFormatter</span> <span class="directive">implements</span> <span class="predefined-type">Formatter</span>&lt;<span class="predefined-type">BigDecimal</span>&gt; {

    <span class="directive">protected</span> GeneralConfiguration generalConfiguration;
    <span class="directive">protected</span> <span class="predefined-type">Currency</span> currentCurrency;

    <span class="directive">public</span> CurrencyFormatter(GeneralConfiguration generalConfiguration) {
        <span class="local-variable">this</span>.generalConfiguration = generalConfiguration;
        currentCurrency = generalConfiguration.getCurrency();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> format(<span class="predefined-type">BigDecimal</span> value) {
        <span class="keyword">return</span> currentCurrency.format(value);
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> <span class="type">void</span> initTableColumns() {
    <span class="predefined-type">Formatter</span>&lt;<span class="predefined-type">BigDecimal</span>&gt; currencyFormatter = <span class="keyword">new</span> CurrencyFormatter(generalConfiguration);
    table.getColumn(<span class="string"><span class="delimiter">"</span><span class="content">totalPrice</span><span class="delimiter">"</span></span>).setFormatter(currencyFormatter);
}</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_presentations"><a class="anchor" href="/manual.html#gui_presentations"></a>5.5.2.3.2. Presentations</h6> 
         <div class="paragraph"> 
          <p>Механизм представлений позволяет пользователям системы управлять настройками отображения таблиц.</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_presentations.png" alt="gui presentations"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Пользователи могут:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Сохранять представления под уникальными именами. Настройки таблицы автоматически сохраняются в активном представлении.</p> </li> 
           <li> <p>Редактировать и удалять представления.</p> </li> 
           <li> <p>Переключаться между представлениями.</p> </li> 
           <li> <p>Задавать представление по умолчанию, которое будет применяться при открытии экрана.</p> </li> 
           <li> <p>Создавать глобальные представления, доступные всем пользователям системы. Для создания, изменения и удаления глобальных представлений пользователь должен иметь <a href="/manual.html#permissions">разрешение</a> <code>cuba.gui.presentations.global</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Представления доступны в компонентах, реализующих интерфейс <code>com.haulmont.cuba.gui.components.Component.HasPresentations</code>. В платформе такими компонентами являются:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><a href="/manual.html#gui_Table">Table</a></p> </li> 
           <li> <p><a href="/manual.html#gui_GroupTable">GroupTable</a></p> </li> 
           <li> <p><a href="/manual.html#gui_TreeTable">TreeTable</a></p> </li> 
          </ul> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_Timer"><a class="anchor" href="/manual.html#gui_Timer"></a>5.5.2.3.3. Timer</h6> 
         <div class="paragraph"> 
          <p>Таймер − это невизуальный компонент, позволяющий выполнять некоторый код контроллера экрана через определенные промежутки времени. Срабатывание таймера происходит в потоке обработки событий пользовательского интерфейса, что позволяет обновлять экран без каких-либо ограничений. Таймер прекращает работу при закрытии экрана, для которого он был создан.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Компонент реализован для блоков <strong>Web Client</strong> и <strong>Desktop Client</strong>. Для веб клиента реализация таймеров основана на опросе сервера из веб-браузера, для десктоп клиента - на <code>javax.swing.Timer</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Основной способ создания таймеров - декларативно в XML-дескрипторе экрана в элементе <code>timers</code>, располагающемся между элементами <code>dsContext</code> и <code>layout</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Для описания таймера используется элемент <code>timer</code>.</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Атрибут <code>delay</code> является обязательным атрибутом, в нем задается интервал срабатывания таймера в миллисекундах.</p> </li> 
           <li> <p><code>autostart</code> - необязательный атрибут, при установке которого в <code>true</code> таймер стартует сразу после открытия экрана. По умолчанию <code>false</code>, что означает что для старта таймера необходимо вызвать его метод <code>start()</code>.</p> </li> 
           <li> <p><code>repeating</code> − необязательный атрибут, включает многократное срабатывание таймера. Если значение атрибута равно <code>true</code>, то таймер выполняется циклически, через равные промежутки времени, заданные в атрибуте <code>delay</code>. В противном случае таймер выполняется один раз через <code>delay</code> миллисекунд после старта таймера.</p> </li> 
           <li> <p><code>onTimer</code> − необязательный атрибут, содержащий имя метода, вызываемого при срабатывании таймера. Метод-обработчик должен быть определен в контроллере экрана с модификатором <code>public</code> и иметь один параметр типа <code>com.haulmont.cuba.gui.components.Timer</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования таймера для периодического обновления содержимого таблицы:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;window</span> <span class="attribute-name">...</span>
  <span class="error">&lt;</span><span class="attribute-name">dsContext</span><span class="tag">&gt;</span>
      <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">bookInstanceDs</span><span class="delimiter">"</span></span> <span class="attribute-name">...</span>
  <span class="error">&lt;</span><span class="error">/</span><span class="attribute-name">dsContext</span><span class="tag">&gt;</span>
  <span class="tag">&lt;timers&gt;</span>
      <span class="tag">&lt;timer</span> <span class="attribute-name">delay</span>=<span class="string"><span class="delimiter">"</span><span class="content">3000</span><span class="delimiter">"</span></span> <span class="attribute-name">autostart</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">repeating</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span> <span class="attribute-name">onTimer</span>=<span class="string"><span class="delimiter">"</span><span class="content">refreshData</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/timers&gt;</span>
  <span class="tag">&lt;layout</span> <span class="attribute-name">...</span></code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> CollectionDatasource bookInstanceDs;

<span class="directive">public</span> <span class="type">void</span> refreshData(<span class="predefined-type">Timer</span> timer) {
    bookInstanceDs.refresh();
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Таймер можно инжектировать в поле контроллера, либо получить методом <code>Window.getTimer()</code>. Управлять активностью таймера можно с помощью его методов <code>start()</code> и <code>stop()</code>. Для уже активного таймера вызов <code>start()</code> игнорируется. После остановки таймера методом <code>stop()</code> его можно снова запустить методом <code>start()</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример определения таймера в XML дескрипторе и использования листенеров в контроллере:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;timers&gt;</span>
    <span class="tag">&lt;timer</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">helloTimer</span><span class="delimiter">"</span></span> <span class="attribute-name">delay</span>=<span class="string"><span class="delimiter">"</span><span class="content">5000</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/timers&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> <span class="predefined-type">Timer</span> helloTimer;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="comment">// add execution handler</span>
    helloTimer.addActionListener(timer -&gt; {
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Hello</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
    });
    <span class="comment">// add stop listener</span>
    helloTimer.addStopListener(timer -&gt; {
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Timer is stopped</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
    });
    <span class="comment">// start the timer</span>
    helloTimer.start();
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Таймер можно также создавать в коде контроллера следующим образом:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> ComponentsFactory componentsFactory;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="comment">// create timer</span>
    <span class="predefined-type">Timer</span> helloTimer = componentsFactory.createTimer();
    <span class="comment">// add timer to the screen</span>
    addTimer(helloTimer);
    <span class="comment">// set timer parameters</span>
    helloTimer.setDelay(<span class="integer">5000</span>);
    helloTimer.setRepeating(<span class="predefined-constant">true</span>);
    <span class="comment">// add execution handler</span>
    helloTimer.addActionListener(timer -&gt; {
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Hello</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
    });
    <span class="comment">// add stop listener</span>
    helloTimer.addStopListener(timer -&gt; {
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Timer is stopped</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
    });
    <span class="comment">// start the timer</span>
    helloTimer.start();
}</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="gui_validator"><a class="anchor" href="/manual.html#gui_validator"></a>5.5.2.3.4. Validator</h6> 
         <div class="paragraph"> 
          <p>Валидатор предназначен для проверки значения, введенного в визуальном компоненте.</p> 
         </div> 
         <div class="admonitionblock warning"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Warning
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Следует отличать валидацию от проверки типа данных. Если для некоторого компонента, например <a href="/manual.html#gui_TextField">TextField</a>, задан тип, отличный от строкового (это происходит при связывании с атрибутом сущности или назначении <code>datatype</code>), то компонент не позволяет ввести значение, не удовлетворяющее этому типу - при потере фокуса или нажатии <strong>Enter</strong> компонент отобразит предыдущее значение.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Валидация же срабатывает не сразу при вводе или потере компонентом фокуса, а только при вызове у компонента метода <code>validate()</code>. Это означает, что компонент (и связанный с ним атрибут сущности) может некоторое время содержать значение, не удовлетворяющее условиям валидации. Это не является проблемой, так как обычно компоненты ввода с валидацией располагаются в <a href="/manual.html#screen_edit">экране редактирования</a>, а он автоматически вызывает валидацию всех своих компонентов перед коммитом. Если же компонент находится не в экране редактирования, то необходимо вызывать его метод <code>validate()</code> в контроллере явно.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>В XML-дескрипторе экрана валидатор для компонента может быть задан во вложенном элементе <code>validator</code>. Возможные атрибуты элемента <code>validator</code>:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>script</code> − путь к скрипту Groovy, осуществляющему валидацию.</p> </li> 
           <li> <p><code>class</code> − имя класса Java, реализующего интерфейс <code>Field.Validator</code>.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Groovy-валидатор и стандартные классы Java-валидаторов, расположенные в пакете <code>com.haulmont.cuba.gui.components.validators</code> поддерживают атрибут <code>message</code> − сообщение, выводимое пользователю в случае ошибки валидации. Атрибут должен содержать сообщение или ключ в пакете сообщений экрана, например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.gui.components.validators.PatternValidator</span><span class="delimiter">"</span></span>
           <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://validationError</span><span class="delimiter">"</span></span>
           <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">"</span><span class="content">\d{3}</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="properties"># messages.properties
validationError = Input error</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Валидатор можно установить с помощью интерфейса CUBA Studio. Пример добавления валидатора к полю <code>fieldGroup</code>:</p> 
         </div> 
         <div class="imageblock" style="text-align: center"> 
          <div class="content"> 
           <img src="assets/gui_validator.png" alt="gui validator"> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Выбор механизма валидации осуществляется следующим образом:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Если не указано значение атрибута <code>script</code>, и сам элемент <code>validator</code> не содержит текста выражения Groovy, то в качестве валидатора используется класс, указанный в атрибуте <code>class</code>.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">amount</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.gui.components.validators.DoubleValidator</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/field&gt;</span></code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Если элемент <code>validator</code> содержит текст, то он будет использован как выражение Groovy и выполнен с помощью <a href="/manual.html#scripting">Scripting</a>.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">year</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;validator&gt;</span>
        value ==~ /\d+/
    <span class="tag">&lt;/validator&gt;</span>
<span class="tag">&lt;/field&gt;</span></code></pre> 
             </div> 
            </div> </li> 
           <li> <p>В противном случае с помощью <a href="/manual.html#scripting">Scripting</a> будет выполнен скрипт Groovy, указанный в атрибуте <code>script</code>.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">zipCode</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;validator</span> <span class="attribute-name">script</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.demo.web.address.ZipValidator</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/field&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>В выражение или скрипт Groovy будет передана одна переменная <code>value</code>, содержащая значение, введенное в визуальном компоненте. Выражение или скрипт должны вернуть <code>boolean</code> значение: <code>true</code> − valid, <code>false</code> − not valid.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Если в качестве валидатора используется класс Java, то он должен иметь либо дефолтный конструктор без параметров, либо конструктор со следующим набором параметров:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>org.dom4j.Element</code>, <code>String</code> - в этот конструктор будут переданы XML-элемент валидатора и имя пакета сообщений экрана.</p> </li> 
           <li> <p><code>org.dom4j.Element</code> - в этот конструктор будет передан XML-элемент валидатора.</p> </li> 
          </ul> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Если валидатор реализован внутренним классом, то он должен быть объявлен с модификатором <code>static</code>, а его имя для загрузки отделяется символом "$", например:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.gui.AddressEdit$ZipValidator</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>Платформа уже содержит несколько реализаций наиболее часто используемых валидаторов (см. пакет <code>com.haulmont.cuba.gui.components.validators</code>), которые можно применять в проектах:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>DateValidator</code></p> </li> 
           <li> <p><code>DoubleValidator</code></p> </li> 
           <li> <p><code>EmailValidator</code></p> </li> 
           <li> <p><code>IntegerValidator</code></p> </li> 
           <li> <p><code>LongValidator</code></p> </li> 
           <li> <p><code>PatternValidator</code></p> </li> 
           <li> <p><code>ScriptValidator</code></p> </li> 
           <li> <p><code>StringValidator</code></p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Валидатор-класс можно назначить компоненту не только в XML-дескрипторе экрана, но и программно, передавая экземпляр валидатора в метод <code>addValidator()</code> компонента.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример создания класса валидатора почтового индекса:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ZipValidator</span> <span class="directive">implements</span> <span class="predefined-type">Field</span>.Validator {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> value) <span class="directive">throws</span> ValidationException {
        <span class="keyword">if</span> (value != <span class="predefined-constant">null</span> &amp;&amp; ((<span class="predefined-type">String</span>) value).length() != <span class="integer">6</span>)
            <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(<span class="string"><span class="delimiter">"</span><span class="content">Zip must be of 6 characters length</span><span class="delimiter">"</span></span>);
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Использование валидатора почтового индекса и стандартного валидатора по шаблону в полях компонента <a href="/manual.html#gui_FieldGroup">FieldGroup</a>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;fieldGroup&gt;</span>
    <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">zip</span><span class="delimiter">"</span></span> <span class="attribute-name">required</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.gui.ZipValidator</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/field&gt;</span>
    <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">imei</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.cuba.gui.components.validators.PatternValidator</span><span class="delimiter">"</span></span>
               <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">"</span><span class="content">\d{15}</span><span class="delimiter">"</span></span>
               <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">"</span><span class="content">IMEI validation failed</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/field&gt;</span>
<span class="tag">&lt;/fieldGroup&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Пример программного задания валидатора:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (<span class="predefined-type">Boolean</span>.TRUE.equals(parameter.getRequired())) {
    tokenList.addValidator(<span class="keyword">new</span> <span class="predefined-type">Field</span>.Validator() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> value) <span class="directive">throws</span> ValidationException {
            <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="predefined-type">Collection</span> &amp;&amp; CollectionUtils.isEmpty((<span class="predefined-type">Collection</span>) value)) {
                <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(getMessage(<span class="string"><span class="delimiter">"</span><span class="content">paramIsRequiredButEmpty</span><span class="delimiter">"</span></span>));
            }
        }
    });
}</code></pre> 
          </div> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="gui_api"><a class="anchor" href="/manual.html#gui_api"></a>5.5.2.4. API компонентов</h5> 
        <div class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Доступно для всех визуальных компонентов
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_unwrap" class="ulist"> 
              <ul> 
               <li> <p><code>unwrap()</code> - возвращает экземпляр компонента для текущего типа клиента (компонент Vaadin или Swing). Можно использовать в клиентском модуле для доступа к API базового компонента, см. раздел <a href="/manual.html#webComponentsHelper">Работа с компонентами Vaadin</a>.</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">com.vaadin.ui.TextField vTextField = textField.unwrap(com.vaadin.ui.TextField.class);</code></pre> 
                 </div> 
                </div> </li> 
               <li> <p><code>unwrapComposition()</code> - возвращает экземпляр самого внешнего контейнера для текущего типа клиента. Можно использовать в клиентском модуле для доступа к API базового компонента.</p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.Buffered
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_commit" class="ulist"> 
              <ul> 
               <li> <p><code>commit()</code> - обновляет источник данных, сохраняя все изменения, внесённые после последнего коммита.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_api_discard" class="ulist"> 
              <ul> 
               <li> <p><code>discard()</code> - отменяет все изменения, внесённые после последнего коммита. Значение компонента обновляется из источника данных.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_api_isModified" class="ulist"> 
              <ul> 
               <li> <p><code>isModified()</code> - возвращает <code>true</code>, если значение компонента изменилось с момента последнего обновления из источника данных.</p> </li> 
              </ul> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (textArea.isModified()) {
    textArea.commit();
}</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_CheckBox">CheckBox</a> - <a href="/manual.html#gui_DateField">DateField</a> - <a href="/manual.html#gui_FileUploadField">FileUploadField</a> - <a href="/manual.html#gui_LookupField">LookupField</a> - <a href="/manual.html#gui_LookupPickerField">LookupPickerField</a> - <a href="/manual.html#gui_PickerField">PickerField</a> - <a href="/manual.html#gui_TextArea">TextArea</a> - <a href="/manual.html#gui_TextField">TextField</a> - <a href="/manual.html#gui_TimeField">TimeField</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.Collapsable
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_expanded" class="ulist"> 
              <ul> 
               <li> <p><code>addExpandedStateChangeListener()</code> - добавляет слушатель, реализующий интерфейс <code>ExpandedStateChangeListener</code>, для отслеживания событий сворачивания/разворачивания компонента.</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">groupBox.addExpandedStateChangeListener(e -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Expanded: </span><span class="delimiter">"</span></span> + groupBox.isExpanded()));</code></pre> 
                 </div> 
                </div> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_Filter">Filter</a> - <a href="/manual.html#gui_GroupBoxLayout">GroupBoxLayout</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.Container
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_add" class="ulist"> 
              <ul> 
               <li> <p><code>add()</code> - добавляет дочерний компонент в контейнер.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_api_remove" class="ulist"> 
              <ul> 
               <li> <p><code>remove()</code> - удаляет дочерний компонент из контейнера.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_api_removeAll" class="ulist"> 
              <ul> 
               <li> <p><code>removeAll()</code> - удаляет все дочерние компоненты из контейнера.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_api_getOwnComponent" class="ulist"> 
              <ul> 
               <li> <p><code>getOwnComponent()</code> - возвращает компонент, вложенный непосредственно в этот контейнер.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_api_getComponent" class="ulist"> 
              <ul> 
               <li> <p><code>getComponent()</code> - возвращает компонент, находящийся где-либо внутри дерева компонентов в этом контейнере.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_api_getComponentNN" class="ulist"> 
              <ul> 
               <li> <p><code>getComponentNN()</code> - возвращает компонент, находящийся где-либо внутри дерева компонентов в этом контейнере, и выбрасывает исключение, если компонент не найден.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_api_getOwnComponents" class="ulist"> 
              <ul> 
               <li> <p><code>getOwnComponents()</code> - возвращает список всех компонентов, вложенных непосредственно в этот контейнер.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_api_getComponents" class="ulist"> 
              <ul> 
               <li> <p><code>getComponents()</code> - возвращает список всех компонентов, находящихся где-либо внутри дерева компонентов в этом контейнере.</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_Accordion">Accordion</a> - <a href="/manual.html#gui_BoxLayout">BoxLayout</a> - <a href="/manual.html#gui_CssLayout">CssLayout</a> - <a href="/manual.html#gui_Frame">Frame</a> - <a href="/manual.html#gui_GridLayout">GridLayout</a> - <a href="/manual.html#gui_GroupBoxLayout">GroupBoxLayout</a> - <a href="/manual.html#gui_HtmlBoxLayout">HtmlBoxLayout</a> - <a href="/manual.html#gui_ScrollBoxLayout">ScrollBoxLayout</a> - <a href="/manual.html#gui_SplitPanel">SplitPanel</a> - <a href="/manual.html#gui_TabSheet">TabSheet</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.OrderedContainer
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_indexOf" class="ulist"> 
              <ul> 
               <li> <p><code>indexOf()</code> - вовзращает индекс компонента внутри упорядоченного контейнера.</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_BoxLayout">BoxLayout</a> - <a href="/manual.html#gui_CssLayout">CssLayout</a> - <a href="/manual.html#gui_Frame">Frame</a> - <a href="/manual.html#gui_GroupBoxLayout">GroupBoxLayout</a> - <a href="/manual.html#gui_ScrollBoxLayout">ScrollBoxLayout</a> -</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.HasSettings
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_settings" class="ulist"> 
              <ul> 
               <li> <p><code>applySettings()</code> - восстанавливает последние пользовательские настройки для этого компонента.</p> </li> 
               <li> <p><code>saveSettings()</code> - сохраняет текущие пользовательские настройки для этого компонента.</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_DataGrid">DataGrid</a> - <a href="/manual.html#gui_Filter">Filter</a> - <a href="/manual.html#gui_GroupBoxLayout">GroupBoxLayout</a> - <a href="/manual.html#gui_SplitPanel">SplitPanel</a> - <a href="/manual.html#gui_Table">Table</a> - <a href="/manual.html#gui_TextArea">TextArea</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.HasValue
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_addValueChangeListener" class="ulist"> 
              <ul> 
               <li> <p><code>addValueChangeListener()</code> - добавляет слушатель, реализующий интерфейс <code>ValueChangeListener</code>, для отслеживания изменения значения компонента.</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">textField.addValueChangeListener(e -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Before: </span><span class="delimiter">"</span></span> + e.getPrevValue() + <span class="string"><span class="delimiter">"</span><span class="content">. After: </span><span class="delimiter">"</span></span> + e.getValue()));</code></pre> 
                 </div> 
                </div> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_CheckBox">CheckBox</a> - <a href="/manual.html#gui_ColorPicker">ColorPicker</a> - <a href="/manual.html#gui_DateField">DateField</a> - <a href="/manual.html#gui_DatePicker">DatePicker</a> - <a href="/manual.html#gui_FileUploadField">FileUploadField</a> - <a href="/manual.html#gui_Label">Label</a> - <a href="/manual.html#gui_LookupField">LookupField</a> - <a href="/manual.html#gui_LookupPickerField">LookupPickerField</a> - <a href="/manual.html#gui_MaskedField">MaskedField</a> - <a href="/manual.html#gui_OptionsGroup">OptionsGroup</a> - <a href="/manual.html#gui_OptionsList">OptionsList</a> - <a href="/manual.html#gui_PasswordField">PasswordField</a> - <a href="/manual.html#gui_PickerField">PickerField</a> - <a href="/manual.html#gui_ProgressBar">ProgressBar</a> - <a href="/manual.html#gui_RichTextArea">RichTextArea</a> - <a href="/manual.html#gui_SearchPickerField">SearchPickerField</a> - <a href="/manual.html#gui_SourceCodeEditor">SourceCodeEditor</a> - <a href="/manual.html#gui_SuggestionPickerField">SuggestionPickerField</a> - <a href="/manual.html#gui_TextArea">TextArea</a> - <a href="/manual.html#gui_TextField">TextField</a> - <a href="/manual.html#gui_TimeField">TimeField</a> - <a href="/manual.html#gui_TokenList">TokenList</a> - <a href="/manual.html#gui_TwinColumn">TwinColumn</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.LayoutClickNotifier
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_addLayoutClickListener" class="ulist"> 
              <ul> 
               <li> <p><code>addLayoutClickListener()</code> - добавляет слушатель, реализующий интерфейс <code>LayoutClickListener</code>, для отслеживания кликов по области компонента.</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">vbox.addLayoutClickListener(event -&gt;
                showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Clicked</span><span class="delimiter">"</span></span>));</code></pre> 
                 </div> 
                </div> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_ButtonsPanel">ButtonsPanel</a> - <a href="/manual.html#gui_BoxLayout">BoxLayout</a> - <a href="/manual.html#gui_CssLayout">CssLayout</a> - <a href="/manual.html#gui_GridLayout">GridLayout</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.Margin
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_margin" class="ulist"> 
              <ul> 
               <li> <p><code>setMargin()</code> - устанавливает компоненту внешние поля.</p> 
                <div class="ulist"> 
                 <ul> 
                  <li> <p>Добавление внешних полей со всех сторон компонента:</p> 
                   <div class="listingblock"> 
                    <div class="content"> 
                     <pre class="CodeRay highlight"><code data-lang="java">vbox.setMargin(<span class="predefined-constant">true</span>);</code></pre> 
                    </div> 
                   </div> </li> 
                  <li> <p>Добавление внешних полей только в верхней и нижней части компонента:</p> 
                   <div class="listingblock"> 
                    <div class="content"> 
                     <pre class="CodeRay highlight"><code data-lang="java">vbox.setMargin(<span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>);</code></pre> 
                    </div> 
                   </div> </li> 
                  <li> <p>Создание объекта конфигурации <code>MarginInfo</code>:</p> 
                   <div class="listingblock"> 
                    <div class="content"> 
                     <pre class="CodeRay highlight"><code data-lang="java">vbox.setMargin(<span class="keyword">new</span> MarginInfo(<span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">true</span>));</code></pre> 
                    </div> 
                   </div> </li> 
                 </ul> 
                </div> </li> 
               <li> <p><code>getMargin()</code> - возвращает конфигурацию внешних полей в виде экземпляра <code>MarginInfo</code>.</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_BoxLayout">BoxLayout</a> - <a href="/manual.html#gui_Filter">Filter</a> - <a href="/manual.html#gui_Frame">Frame</a> - <a href="/manual.html#gui_GridLayout">GridLayout</a> - <a href="/manual.html#gui_ScrollBoxLayout">ScrollBoxLayout</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.OuterMargin
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_outerMargin" class="ulist"> 
              <ul> 
               <li> <p><code>setOuterMargin()</code> - устанавливает внешние поля вокруг границы компонента.</p> 
                <div class="ulist"> 
                 <ul> 
                  <li> <p>Добавление внешних полей со всех сторон компонента:</p> 
                   <div class="listingblock"> 
                    <div class="content"> 
                     <pre class="CodeRay highlight"><code data-lang="java">groupBox.setOuterMargin(<span class="predefined-constant">true</span>);</code></pre> 
                    </div> 
                   </div> </li> 
                  <li> <p>Добавление внешних полей только в верхней и нижней части компонента:</p> 
                   <div class="listingblock"> 
                    <div class="content"> 
                     <pre class="CodeRay highlight"><code data-lang="java">groupBox.setOuterMargin(<span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>);</code></pre> 
                    </div> 
                   </div> </li> 
                  <li> <p>Создание объекта конфигурации <code>MarginInfo</code>:</p> 
                   <div class="listingblock"> 
                    <div class="content"> 
                     <pre class="CodeRay highlight"><code data-lang="java">groupBox.setOuterMargin(<span class="keyword">new</span> MarginInfo(<span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">true</span>));</code></pre> 
                    </div> 
                   </div> </li> 
                 </ul> 
                </div> </li> 
               <li> <p><code>getOuterMargin()</code> - возвращает конфигурацию внешних полей в виде экземпляра <code>MarginInfo</code>.</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_GroupBoxLayout">GroupBoxLayout</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.ShortcutNotifier
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_shortcut" class="ulist"> 
              <ul> 
               <li> <p><code>addShortcutAction()</code> - добавляет действие, вызываемое при нажатии определённого сочетания клавиш.</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">cssLayout.addShortcutAction(<span class="keyword">new</span> ShortcutAction(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A</span><span class="delimiter">"</span></span>, shortcutTriggeredEvent -&gt;
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">SHIFT-A action</span><span class="delimiter">"</span></span> )));</code></pre> 
                 </div> 
                </div> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_BoxLayout">BoxLayout</a> - <a href="/manual.html#gui_ButtonsPanel">ButtonsPanel</a> - <a href="/manual.html#gui_CssLayout">CssLayout</a> - <a href="/manual.html#gui_GridLayout">GridLayout</a> - <a href="/manual.html#gui_GroupBoxLayout">GroupBoxLayout</a> - <a href="/manual.html#gui_ScrollBoxLayout">ScrollBoxLayout</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
          <dt class="hdlist1">
           Component.Spacing
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div id="gui_api_spacing" class="ulist"> 
              <ul> 
               <li> <p><code>setSpacing()</code> - добавляет внутренние поля между компонентом и вложенными в него компонентами.</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">vbox.setSpacing(<span class="predefined-constant">true</span>);</code></pre> 
                 </div> 
                </div> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Доступно для компонентов:</p> 
             </div> 
             <div class="paragraph"> 
              <p><a href="/manual.html#gui_BoxLayout">BoxLayout</a> - <a href="/manual.html#gui_ButtonsPanel">ButtonsPanel</a> - <a href="/manual.html#gui_Frame">Frame</a> - <a href="/manual.html#gui_GridLayout">GridLayout</a> <a href="/manual.html#gui_GroupBoxLayout">GroupBoxLayout</a> - <a href="/manual.html#gui_ScrollBoxLayout">ScrollBoxLayout</a></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="gui_attributes"><a class="anchor" href="/manual.html#gui_attributes"></a>5.5.2.5. XML-атрибуты компонентов</h5> 
        <div id="gui_attr_align" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           align
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут, задающий расположение компонента относительно вышестоящего контейнера.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Возможные значения:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>TOP_RIGHT</code></p> </li> 
               <li> <p><code>TOP_LEFT</code></p> </li> 
               <li> <p><code>TOP_CENTER</code></p> </li> 
               <li> <p><code>MIDDLE_RIGHT</code></p> </li> 
               <li> <p><code>MIDDLE_LEFT</code></p> </li> 
               <li> <p><code>MIDDLE_CENTER</code></p> </li> 
               <li> <p><code>BOTTOM_RIGHT</code></p> </li> 
               <li> <p><code>BOTTOM_LEFT</code></p> </li> 
               <li> <p><code>BOTTOM_CENTER</code></p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_caption" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           caption
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут, устанавливающий заголовок для визуального компонента.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Значением атрибута должна быть либо строка сообщения, либо ключ в <a href="/manual.html#message_packs">пакете сообщений</a>. В случае ключа значение должно начинаться с префикса <code>msg://</code></p> 
             </div> 
             <div class="paragraph"> 
              <p>Способы задания ключа:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p>Короткий ключ − при этом сообщение ищется в пакете, заданном для данного экрана:</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="plain">caption="msg://infoFieldCaption"</code></pre> 
                 </div> 
                </div> </li> 
               <li> <p>Полный ключ, с заданием пакета:</p> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="plain">caption="msg://com.company.sample.gui.screen/infoFieldCaption"</code></pre> 
                 </div> 
                </div> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_captionProperty" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           captionProperty
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Задает имя атрибута сущности, отображаемого компонентом. Используется только для сущностей, находящихся в источнике данных (например заданном для <a href="/manual.html#gui_LookupField">LookupField</a> свойством <a href="/manual.html#gui_attr_optionsDatasource">optionsDatasource</a>).</p> 
             </div> 
             <div class="paragraph"> 
              <p>Если <code>captionProperty</code> не задан, будет отображаться <a href="/manual.html#namePattern_annotation">имя экземпляра</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_colspan" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           colspan
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Указывает, сколько колонок сетки должен занять компонент (по умолчанию 1).</p> 
             </div> 
             <div class="paragraph"> 
              <p>Данный атрибут может быть назначен любому компоненту, находящемуся непосредственно внутри контейнера <a href="/manual.html#gui_GridLayout">GridLayout</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_datasource" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           datasource
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Предназначен для задания <a href="/manual.html#datasources">источника данных</a>, описанного в секции <code>dsContext</code> XML-дескриптора экрана.</p> 
             </div> 
             <div class="paragraph"> 
              <p>При указании атрибута <code>datasource</code> для компонента, реализующего интерфейс <code>DatasourceComponent</code>, необходимо также задать атрибут <a href="/manual.html#gui_attr_property">property</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_description" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           description
          </dt> 
          <dd> 
           <p>Атрибут, задающий текст подсказки для компонента.</p> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_editable" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           editable
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут, указывающий на возможность редактирования содержимого компонента (не путать с <a href="/manual.html#gui_attr_enable">enable</a>).</p> 
             </div> 
             <div class="paragraph"> 
              <p>Возможные значения − <code>true</code>, <code>false</code>. По умолчанию <code>true</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>На возможность редактирования содержимого для компонента, связанного с данными (наследника <code>DatasourceComponent</code> или <code>ListComponent</code>), влияет также подсистема безопасности. Если по данным <a href="/manual.html#security_subsystem">подсистемы безопасности</a> данный компонент должен быть недоступен для редактирования, значение атрибута <code>editable</code> не принимается во внимание.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_enable" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           enable
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут компонента, устанавливающий его состояние: доступен, недоступен.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Если компонент недоступен, то он не принимает фокус ввода. Недоступность контейнера приводит к тому, что все его компоненты также становятся недоступными. Возможные значения − <code>true</code>, <code>false</code>. По умолчанию все компоненты доступны.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_expand" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           expand
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут контейнера для управления его внутренней компоновкой.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Задает компонент внутри контейнера, который необходимо расширить на все доступное пространство в направлении размещения компонентов. Для контейнера с вертикальным размещением устанавливает компоненту 100% высоту, для контейнера с горизонтальным размещением - 100% ширину. Кроме того, при изменении размера контейнера изменять размер будет именно этот компонент.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_height" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           height
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут, устанавливающий высоту компонента.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Может быть задана в пикселях либо в процентах от высоты вышестоящего контейнера. Например: <code>100px</code>, <code>100%</code>, <code>50</code>. Если единица измерения не указана, подразумевается высота в пикселях.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Установка значения в <code>%</code> означает, что компонент по высоте займет соответствующую часть пространства, предоставляемого контейнером более высокого уровня.</p> 
             </div> 
             <div class="paragraph"> 
              <p>При выборе значения <code>AUTO</code> или <code>-1px</code> для компонента устанавливается высота по умолчанию, для контейнера высота определяется по содержимому, то есть суммарной высотой вложенных компонентов.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_icon" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           icon
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут, устанавливающий пиктограмму для визуального компонента.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Значением атрибута должен быть путь к файлу пиктограммы относительно каталога <a href="/manual.html#gui_themes">темы</a>. Например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml">icon="icons/create.png"</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Если пиктограмма должна быть выбрана в зависимости от языка пользователя, можно указать путь к ней в пакете сообщений, а в атрибуте <code>icon</code> − ключ сообщения, например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml">icon="msg://addIcon"</code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>В веб клиенте с <a href="/manual.html#web_theme">темой</a> Halo (или производной от нее) вместо файлов можно использовать элементы шрифта Font Awesome. Для этого достаточно указать константу из класса <code>com.vaadin.server.FontAwesome</code> с префиксом <code>font-icon:</code> например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml">icon="font-icon:BOOK"</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_id" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           id
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Идентификатор компонента.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Рекомендуется формировать значение по правилам Java-идентификаторов и использовать camelСase, например, <code>userGrid</code>, <code>filterPanel</code>.Может быть указан для любого компонента и должен быть уникальным в пределах экрана.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_inputPrompt" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           inputPrompt
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут <code>inputPrompt</code> задает строку, отображаемую в поле, если его значение равно <code>null</code>.</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;suggestionField</span> <span class="attribute-name">inputPrompt</span>=<span class="string"><span class="delimiter">"</span><span class="content">Let's search something!</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Атрибут используется для компонентов <a href="/manual.html#gui_TextField">TextField</a>, <a href="/manual.html#gui_LookupField">LookupField</a>, <a href="/manual.html#gui_LookupPickerField">LookupPickerField</a>, <a href="/manual.html#gui_SearchPickerField">SearchPickerField</a>, <a href="/manual.html#gui_SuggestionPickerField">SuggestionPickerField</a> только в веб клиенте.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_margin" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           margin
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут <code>margin</code> устанавливает наличие отступа между внешними границами и содержимым контейнера.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Может иметь два вида значений:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>margin="true"</code> − установить отступ со всех сторон сразу</p> </li> 
               <li> <p><code>margin="true,false,true,false"</code> − установить отступ только сверху и снизу (формат значения "сверху,справа,снизу,слева")</p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>По умолчанию отступы отсутствуют.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_nullName" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           nullName
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Идентификатор опции, выбор которой будет равносилен установке значения в <code>null</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Атрибут используется для компонентов <a href="/manual.html#gui_LookupField">LookupField</a>, <a href="/manual.html#gui_LookupPickerField">LookupPickerField</a>, <a href="/manual.html#gui_SearchPickerField">SearchPickerField</a>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Пример для компонента <a href="/manual.html#gui_LookupField">LookupField</a>, установка значения атрибута в <a href="/manual.html#screen_xml_glossentry">XML-дескрипторе</a>:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;lookupField</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span>
             <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>
             <span class="attribute-name">nullName</span>=<span class="string"><span class="delimiter">"</span><span class="content">(none)</span><span class="delimiter">"</span></span>
             <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">200px</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Пример для компонента <a href="/manual.html#gui_LookupField">LookupField</a>, установка значения атрибута в <a href="/manual.html#screen_controller_glossentry">контроллере</a>:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;lookupField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerLookupField</span><span class="delimiter">"</span></span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span>
             <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">200px</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">orderDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
              </div> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java">customerLookupField.setNullOption(<span class="string"><span class="delimiter">"</span><span class="content">&lt;null&gt;</span><span class="delimiter">"</span></span>);</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_openType" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           openType
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Задает режим открытия связанного экрана. Соответствует перечислению <code>WindowManager.OpenType</code> со значениями <code>NEW_TAB</code>, <code>THIS_TAB</code>, <code>NEW_WINDOW</code>, <code>DIALOG</code>. По умолчанию <code>THIS_TAB</code>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_optionsDatasource" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           optionsDatasource
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Задает имя <a href="/manual.html#datasources">источника данных</a>, используемого для формирования списка опций.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Совместно с <code>optionsDatasource</code> может использоваться атрибут <a href="/manual.html#gui_attr_captionProperty">captionProperty</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_property" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           property
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут компонента, реализующего интерфейс <code>DatasourceComponent</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Предназначен для задания имени атрибута сущности, значение которого будет отображаться или редактироваться данным визуальным компонентом.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Используется всегда совместно с атрибутом <a href="/manual.html#gui_attr_datasource">datasource</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_required" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           required
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут визуального компонента, реализующего интерфейс <code>Field</code>. Указывает, что в данное поле обязательно должно быть введено значение.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Возможные значения атрибута − <code>true</code>, <code>false</code>. По умолчанию <code>false</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Совместно с <code>required</code> может использоваться атрибут <a href="/manual.html#gui_attr_requiredMessage">requiredMessage</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_requiredMessage" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           requiredMessage
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>XML-атрибут, используемый совместно с атрибутом <a href="/manual.html#gui_attr_required">required</a>. Позволяет установить сообщение, выводимое пользователю в случае нарушения требования <a href="/manual.html#gui_attr_required">required</a>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Атрибут может содержать сообщение или ключ в пакете сообщений, например: <code>requiredMessage="msg://infoTextField.requiredMessage"</code></p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_responsive" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           responsive
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Определяет, должен ли компонент реагировать на изменения размеров доступной области. Реакцию можно задать с помощью <a href="/manual.html#web_theme_extension">стилей</a>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Возможные значения атрибута − <code>true</code>, <code>false</code>. По умолчанию <code>false</code>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_rowspan" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           rowspan
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Указывает, сколько строк сетки должен занять компонент (по умолчанию 1).</p> 
             </div> 
             <div class="paragraph"> 
              <p>Данный атрибут может быть назначен любому компоненту, находящемуся непосредственно внутри контейнера <a href="/manual.html#gui_GridLayout">GridLayout</a>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_settingsEnabled" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           settingsEnabled
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Определяет, нужно ли сохранять пользовательские настройки отображения компонента. Настройки сохраняются только для компонентов, имеющих <a href="/manual.html#gui_attr_id">id</a>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Возможные значения атрибута − <code>true</code>, <code>false</code>. По умолчанию <code>true</code>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_spacing" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           spacing
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут <code>spacing</code> устанавливает наличие отступов между компонентами внутри контейнера.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Возможные значения − <code>true</code>, <code>false</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>По умолчанию отступы отсутствуют.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_stylename" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           stylename
          </dt> 
          <dd> 
           <p>Атрибут, задающий имя стиля компонента. Подробнее см. <a href="/manual.html#gui_themes">Темы приложения</a>.</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>В теме <code>halo</code> определено несколько стандартных стилей для компонентов:</p> 
             </div> 
             <div id="gui_attr_stylename_huge" class="ulist"> 
              <ul> 
               <li> <p><code>huge</code> - устанавливает размер поля 160% от его размера по умолчанию.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_attr_stylename_large" class="ulist"> 
              <ul> 
               <li> <p><code>large</code> - устанавливает размер поля 120% от его размера по умолчанию.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_attr_stylename_small" class="ulist"> 
              <ul> 
               <li> <p><code>small</code> - устанавливает размер поля 85% от его размера по умолчанию.</p> </li> 
              </ul> 
             </div> 
             <div id="gui_attr_stylename_tiny" class="ulist"> 
              <ul> 
               <li> <p><code>tiny</code> - устанавливает размер поля 75% от его размера по умолчанию.</p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_tabCaptionsAsHtml" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           tabCaptionsAsHtml
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Определяет, разрешена ли HTML-разметка в заголовках вкладок. Если выбрано значение <code>true</code>, заголовки отображаются в браузере как HTML, при этом ответственность за безопасность используемого HTML-кода несёт сам разработчик. Если выбрано значение <code>false</code>, содержимое заголовка отображается как обычный текст.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Возможные значения − <code>true</code>, <code>false</code>. По умолчанию <code>false</code>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_tabIndex" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           tabIndex
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Определяет, может ли компонент принимать фокус, и задаёт относительный порядок перехода фокуса между компонентами экрана.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Может принимать положительное или отрицательное целочисленное значение:</p> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>отрицательное значение</code> означает, что компонент может принимать фокус, но будет пропущен при последовательном перемещении фокуса с клавиатуры;</p> </li> 
               <li> <p><code>0</code> означает, что компонент может принимать фокус, в том числе и при его перемещении с клавиатуры, но его относительный порядковый номер будет совпадать с его расположением на экране относительно других компонентов.</p> </li> 
               <li> <p><code>положительное значение</code> означает, что компонент может принимать фокус, в том числе и при его перемещении с клавиатуры. Относительный порядковый номер компонента будет совпадать со значением атрибута: фокус будет перемещаться от меньшего значения <code>tabIndex</code> к большему. Если для нескольких компонентов установлено одинаковое значение <code>tabIndex</code>, порядок их фокуса будет будет совпадать с их расположением на экране относительно друг друга.</p> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_tabsVisible" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           tabsVisible
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Определяет, должна ли область выбора вкладок отображаться в UI.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Возможные значения − <code>true</code>, <code>false</code>. По умолчанию <code>true</code>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_textSelectionEnabled" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           textSelectionEnabled
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Определяет, разрешено ли выделение текста в ячейках таблицы.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Возможные значения атрибута − <code>true</code>, <code>false</code>. По умолчанию <code>false</code>.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_visible" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           visible
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут, устанавливающий видимость компонента. Возможные значения − <code>true</code>, <code>false</code>.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Если контейнер невидим, не видны и все его компоненты. По умолчанию все компоненты видимы.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="gui_attr_width" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           width
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Атрибут, устанавливающий ширину компонента.</p> 
             </div> 
             <div class="paragraph"> 
              <p>Значение может быть задано в пикселях или в процентах от ширины вышестоящего контейнера. Например: <code>100px</code>, <code>100%</code>, <code>50</code>. Если единица измерения не указана, подразумевается ширина в пикселях. Простановка значения в <code>%</code> означает, что компонент по ширине займет соответствующую часть пространства, предоставляемого контейнером более высокого уровня.</p> 
             </div> 
             <div class="paragraph"> 
              <p>При выборе значения <code>AUTO</code> или <code>-1px</code> для компонента устанавливается ширина по умолчанию, для контейнера ширина определяется по содержимому, то есть суммарной шириной вложенных компонентов.</p> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="datasources"><a class="anchor" href="/manual.html#datasources"></a>5.5.3. Источники данных</h4> 
       <div class="paragraph"> 
        <p>Источники данных обеспечивают работу связанных с данными (data-aware) компонентов.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Визуальные компоненты сами не обращаются к <strong>Middleware</strong>, а получают экземпляры сущностей из связанных источников данных. При этом один источник данных может обслуживать несколько визуальных компонентов, если им нужен один и тот же экземпляр или набор экземпляров.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Связь визуального компонента и источника данных проявляется в следующем:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>При изменении пользователем значения в компоненте новое значение проставляется в атрибуте сущности, находящейся в источнике.</p> </li> 
         <li> <p>При изменении атрибута сущности из кода новое значение проставляется и отображается в визуальном компоненте.</p> </li> 
         <li> <p>Для слежения за вводом пользователя можно использовать как <a href="/manual.html#datasource_listeners">слушатель источника данных</a>, так и слушатель значения визуального компонента - они срабатывают друг за другом.</p> </li> 
         <li> <p>При необходимости прочитать или записать значение атрибута сущности в коде предпочтительнее использовать источник данных, а не компонент. Рассмотрим пример чтения атрибута:</p> 
          <div class="listingblock"> 
           <div class="content"> 
            <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> FieldGroup fieldGroup;

<span class="annotation">@Inject</span>
<span class="directive">private</span> Datasource&lt;Order&gt; orderDs;

<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup.customer</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> PickerField customerField;

<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params){
    Customer customer;
    <span class="comment">// Get customer from component: not for common use</span>
    <span class="predefined-type">Component</span> component = fieldGroup.getFieldNN(<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>).getComponentNN();
    customer = ((HasValue)component).getValue();
    <span class="comment">// Get customer from component: recommended</span>
    customer = customerField.getValue();
    <span class="comment">// Get customer from datasource</span>
    customer = orderDs.getItem().getCustomer();
}</code></pre> 
           </div> 
          </div> 
          <div class="paragraph"> 
           <p>Как видно из примера, работа со значениями атрибутов сущностей через компонент - не самый прямолинейный способ. В первом случае он требует приведения типа и указания поля <a href="/manual.html#gui_FieldGroup">FieldGroup</a> в виде строки. Второй пример более безопасный и прямой, но он требует знания ещё и типа поля, которое должно быть <a href="/manual.html#screen_controller_injection">инжектировано</a> в контроллер. В то же время, получив методом <code>getItem()</code> из источника данных хранящийся в нем экземпляр, можно напрямую читать и изменять значения его атрибутов.</p> 
          </div> </li> 
        </ul> 
       </div> 
       <div class="admonitionblock warning"> 
        <table> 
         <tbody>
          <tr> 
           <td class="icon"> 
            <div class="title">
             Warning
            </div> </td> 
           <td class="content"> 
            <div class="paragraph"> 
             <p>Как правило, визуальный компонент привязывается к атрибуту, непосредственно принадлежащему сущности, находящейся в источнике данных. В приведенном выше примере компонент привязан к атрибуту <code>customer</code> сущности <code>Order</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Можно также привязать компонент к атрибуту связанной сущности, например к <code>customer.name</code>. В этом случае компонент будет корректно отображать значение атрибута <code>name</code>, но при его изменении пользователем слушатели источника данных вызваны не будут, и изменения не будут сохранены. Поэтому привязывать компонент к атрибутам второго и более порядка имеет смысл только для отображения, например в <a href="/manual.html#gui_Label">Label</a>, колонке <a href="/manual.html#gui_Table">Table</a> или установив для <a href="/manual.html#gui_TextField">TextField</a> свойство <code>editable = false</code>.</p> 
            </div> </td> 
          </tr> 
         </tbody>
        </table> 
       </div> 
       <div class="paragraph"> 
        <p>Источники данных также отслеживают изменения содержащихся в них сущностей, и могут отправлять измененные экземпляры обратно на <strong>Middleware</strong> для сохранения в базе данных.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Рассмотрим основные интерфейсы источников.</p> 
       </div> 
       <div class="imageblock" style="text-align: center"> 
        <div class="content"> 
         <img src="assets/Datasources.png" alt="Datasources"> 
        </div> 
        <div class="title">
         Рисунок 22. Интерфейсы источников данных
        </div> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>Datasource</code> − простейший источник данных, предназначенный для работы с одним экземпляром сущности. Экземпляр устанавливается методом <code>setItem()</code> и доступен через <code>getItem()</code>.</p> 
          <div class="paragraph"> 
           <p>Стандартной реализацией такого источника является класс <code>DatasourceImpl</code>, который используется, например, как главный источник данных в <a href="/manual.html#screen_edit">экранах редактирования</a> сущностей.</p> 
          </div> </li> 
         <li> <p><code>CollectionDatasource</code> − источник данных, предназначенный для работы с коллекцией экземпляров сущности. Коллекция загружается при вызове метода <code>refresh()</code>, ключи экземпляров доступны через метод <code>getItemIds()</code>. Метод <code>setItem()</code> устанавливает, а <code>getItem()</code> возвращает "текущий" экземпляр коллекции, т.е., например, соответствующий выбранной в данный момент строке таблицы.</p> 
          <div class="paragraph"> 
           <p>Способ загрузки коллекции сущностей определяется реализацией. Наиболее типичный - загрузка с Middleware через <a href="/manual.html#dataManager">DataManager</a>, при этом для формирования JPQL запроса используются методы <code>setQuery()</code>, <code>setQueryFilter()</code>.</p> 
          </div> 
          <div class="paragraph"> 
           <p>Стандартной реализацией такого источника является класс <code>CollectionDatasourceImpl</code>, который используется в экранах, отображающих списки сущностей.</p> 
          </div> 
          <div class="ulist"> 
           <ul> 
            <li> <p><code>GroupDatasource</code> − подвид <code>CollectionDatasource</code>, предназначенный для работы с компонентом <code><a href="/manual.html#gui_GroupTable">GroupTable</a></code>.</p> 
             <div class="paragraph"> 
              <p>Стандартной реализацией является класс <code>GroupDatasourceImpl</code>.</p> 
             </div> </li> 
            <li> <p><code>HierarchicalDatasource</code> − подвид <code>CollectionDatasource</code>, предназначенный для работы с компонентами <code><a href="/manual.html#gui_Tree">Tree</a></code> и <code><a href="/manual.html#gui_TreeTable">TreeTable</a></code>.</p> 
             <div class="paragraph"> 
              <p>Стандартной реализацией является класс <code>HierarchicalDatasourceImpl</code>.</p> 
             </div> </li> 
           </ul> 
          </div> </li> 
         <li> <p><code>NestedDatasource</code> - источник данных, предназначенный для работы с экземплярами, загруженными в атрибуте другой сущности. При этом источник, содержащий сущность-хозяина, доступен методом <code>getMaster()</code>, а <a href="/manual.html#metaProperty">мета-свойство</a>, соответствующее атрибуту хозяина, содержащему экземпляры данного источника, доступно через метод <code>getProperty()</code>.</p> 
          <div class="paragraph"> 
           <p>Например, в источнике <code>dsOrder</code> установлен экземпляр сущности <code>Order</code>, содержащий ссылку на экземпляр <code>Customer</code>. Тогда для связи экземпляра <code>Customer</code> с визуальными компонентами достаточно создать <code>NestedDatasource</code>, у которого хозяином является <code>dsOrder</code>, а мета-свойство указывает на атрибут <code>Order.customer</code>.</p> 
          </div> 
          <div class="ulist"> 
           <ul> 
            <li> <p><code>PropertyDatasource</code> - подвид <code>NestedDatasource</code>, предназначенный для работы с одним экземпляром или коллекцией связанных сущностей, не являющихся встроенными (embedded).</p> 
             <div class="paragraph"> 
              <p>Стандартные реализации: для работы с одним экземпляром - <code>PropertyDatasourceImpl</code>, для работы с коллекцией - <code>CollectionPropertyDatasourceImpl</code>, <code>GroupPropertyDatasourceImpl</code>, <code>HierarchicalPropertyDatasourceImpl</code>. Последние реализуют также интерфейс <code>CollectionDatasource</code>, однако некоторые его нерелевантные методы, связанные с загрузкой, например, <code>setQuery()</code>, выбрасывают <code>UnsupportedOperationException</code>.</p> 
             </div> </li> 
            <li> <p><code>EmbeddedDatasource</code> - подвид <code>NestedDatasource</code>, содержащий экземпляр встроенной сущности.</p> 
             <div class="paragraph"> 
              <p>Стандартной реализацией является класс <code>EmbeddedDatasourceImpl</code>.</p> 
             </div> </li> 
           </ul> 
          </div> </li> 
         <li> <p><code>RuntimePropsDatasource</code> − специфический источник, предназначенный для работы с <a href="/manual.html#dynamic_attributes">динамическими атрибутами</a> сущностей.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Как правило, источники данных объявляются декларативно в секции <code>dsContext</code> <a href="/manual.html#screen_xml">дескриптора экрана</a>.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="datasource_creation"><a class="anchor" href="/manual.html#datasource_creation"></a>5.5.3.1. Создание источников данных</h5> 
        <div class="paragraph"> 
         <p>Объекты источников данных могут быть созданы как декларативно - путем объявления в XML-дескрипторе экрана, так и программно в контроллере. Обычно используются стандартные реализации интерфейсов источников, однако при необходимости можно создать собственный класс, унаследовав его от стандартного.</p> 
        </div> 
        <div class="sect5"> 
         <h6 id="datasource_decl_creation"><a class="anchor" href="/manual.html#datasource_decl_creation"></a>5.5.3.1.1. Декларативное создание</h6> 
         <div class="paragraph"> 
          <p>Как правило, источники данных объявляются декларативно в элементе <code>dsContext</code> дескриптора экрана. В зависимости от взаимного расположения элементов объявлений создаются источники двух разновидностей:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>если элемент расположен непосредственно в <code>dsContext</code>, создается обычный <code>Datasource</code> или <code>CollectionDatasource</code>, который содержит независимо загруженную сущность или коллекцию;</p> </li> 
           <li> <p>если элемент расположен внутри элемента другого источника, создается <code>NestedDatasource</code>, при этом внешний источник становится его хозяином.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Пример объявления источников данных:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;datasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.sample.entity.Car</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">carEdit</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">allocationsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">driverAllocations</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">repairsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">repairs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/datasource&gt;</span>

    <span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">colorsDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.haulmont.sample.entity.Color</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>select c from sample$Color c order by c.name<span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/query&gt;</span>
    <span class="tag">&lt;/collectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Здесь источник <code>carDs</code> содержит один экземпляр сущности <code>Car</code>, а вложенные в него <code>allocationsDs</code> и <code>repairsDs</code> содержат коллекции связанных сущностей из атрибутов <code>Car.driverAllocations</code> и <code>Car.repairs</code> соответственно. Экземпляр <code>Car</code> вместе со связанными сущностями проставляется в источник данных извне. Если данный экран является <a href="/manual.html#screen_edit">экраном редактирования</a>, то это происходит автоматически при открытии экрана. Источник данных <code>colorsDs</code> содержит коллекцию экземпляров сущности <code>Color</code>, загружаемую самим источником по указанному JPQL-<a href="/manual.html#datasource_query">запросу</a> с <a href="/manual.html#views">представлением</a> <code>_local</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Рассмотрим схему XML.</p> 
         </div> 
         <div class="paragraph"> 
          <p><code>dsContext</code> - корневой элемент.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Элементы <code>dsContext</code>:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>datasource</code> - определяет источник данных, содержащий единственный экземпляр сущности.</p> 
            <div class="paragraph"> 
             <p>Атрибуты:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>id</code> - идентификатор источника, должен быть уникальным для данного <code>DsContext</code>.</p> </li> 
              <li> <p><code>class</code> - Java класс сущности, которая будет содержаться в данном источнике</p> </li> 
              <li> <p><code>view</code> - имя <a href="/manual.html#views">представления</a> сущности. Если источник сам загружает экземпляры, то это представление будет использовано при загрузке. В противном случае это представление сигнализирует внешним механизмам о том, как нужно загрузить сущность для данного источника.</p> </li> 
              <li> <p><code>allowCommit</code> - при установке значения <code>false</code> метод <code>isModified()</code> данного источника всегда возвращает <code>false</code>, а метод <code>commit()</code> ничего не делает. Таким образом, изменения содержащихся в источнике сущностей игнорируются. По умолчанию <code>true</code>, т.е. изменения отслеживаются и могут быть сохранены.</p> </li> 
              <li> <p><code>datasourceClass</code> - <a href="/manual.html#datasource_custom_class">собственный класс реализации</a> источника данных, если необходим.</p> </li> 
             </ul> 
            </div> </li> 
           <li> <p><code>collectionDatasource</code> - определяет источник данных, содержащий коллекцию экземпляров.</p> 
            <div class="paragraph"> 
             <p>Атрибуты <code>collectionDatasource</code>:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>refreshMode</code> - режим обновления источника, по умолчанию <code>ALWAYS</code>. В режиме <code>NEVER</code> при вызове <code>refresh()</code> источник не производит загрузку данных, а только переходит в состояние <code>Datasource.State.VALID</code>, оповещает слушателей и сортирует имеющиеся в нем экземпляры. Режим <code>NEVER</code> удобен, если необходимо программно заполнить <code>CollectionDatasource</code> предварительно загруженными или созданными сущностями. Например:</p> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="predefined-type">Set</span>&lt;Customer&gt; entities = (<span class="predefined-type">Set</span>&lt;Customer&gt;) params.get(<span class="string"><span class="delimiter">"</span><span class="content">customers</span><span class="delimiter">"</span></span>);
    <span class="keyword">for</span> (Customer entity : entities) {
        customersDs.includeItem(entity);
    }
    customersDs.refresh();
}</code></pre> 
                </div> 
               </div> </li> 
              <li> <p><code>softDeletion</code> - значение <code>false</code> отключает режим <a href="/manual.html#soft_deletion">мягкого удаления</a> при загрузке сущностей, т.е. будут загружены также и удаленные экземпляры. По умолчанию <code>true</code>.</p> 
               <div class="paragraph"> 
                <p>Элементы <code>collectionDatasource</code>:</p> 
               </div> </li> 
              <li> <p><code>query</code> - <a href="/manual.html#datasource_query">запрос</a> для загрузки сущностей</p> </li> 
             </ul> 
            </div> </li> 
           <li> <p><code>groupDatasource</code> - полностью аналогичен <code>collectionDatasource</code>, но создает реализацию источника данных, пригодную для использования совместно с компонентом <code><a href="/manual.html#gui_GroupTable">GroupTable</a></code>.</p> </li> 
           <li> <p><code>hierarchicalDatasource</code> - аналогичен <code>collectionDatasource</code>, и создает реализацию источника данных, пригодную для использования совместно с компонентами <code><a href="/manual.html#gui_Tree">Tree</a></code> и <code><a href="/manual.html#gui_TreeTable">TreeTable</a></code>.</p> 
            <div class="paragraph"> 
             <p>Специфическим атрибутом является <code>hierarchyProperty</code>, задающий имя атрибута сущности, по которому строится иерархия.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Класс реализации источника выбирается неявно на основе имени элемента XML и, как было сказано выше, взаимного расположения элементов. Однако если необходимо применить нестандартный источник данных, его класс может быть явно указан в атрибуте <code>datasourceClass</code>.</p> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="datasource_prog_creation"><a class="anchor" href="/manual.html#datasource_prog_creation"></a>5.5.3.1.2. Программное создание</h6> 
         <div class="paragraph"> 
          <p>При необходимости создать источник данных в Java коде рекомендуется воспользоваться специальным классом <code>DsBuilder</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Экземпляр <code>DsBuilder</code> параметризуется цепочкой вызовов его методов в стиле текучего (fluent) интерфейса. Если установлены параметры <code>master</code> и <code>property</code>, то в результате будет создан <code>NestedDatasource</code>, в противном случае - <code>Datasource</code> или <code>CollectionDatasource</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java">CollectionDatasource ds = <span class="keyword">new</span> DsBuilder(getDsContext())
        .setJavaClass(Order.class)
        .setViewName(<span class="predefined-type">View</span>.LOCAL)
        .setId(<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span>)
        .buildCollectionDatasource();</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="datasource_custom_class"><a class="anchor" href="/manual.html#datasource_custom_class"></a>5.5.3.1.3. Собственные классы реализации</h6> 
         <div class="paragraph"> 
          <p>Как правило, нестандартная реализация источника данных требуется для изменения процесса загрузки коллекции сущностей. При создании класса такого источника рекомендуется унаследовать его от <code>CustomCollectionDatasource</code>, либо от <code>CustomGroupDatasource</code> или <code>CustomHierarchicalDatasource</code>, и определить метод <code>getEntities()</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyDatasource</span> <span class="directive">extends</span> CustomCollectionDatasource&lt;SomeEntity, <span class="predefined-type">UUID</span>&gt; {

    <span class="directive">private</span> SomeService someService = AppBeans.get(SomeService.NAME);

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">Collection</span>&lt;SomeEntity&gt; getEntities(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        <span class="keyword">return</span> someService.getEntities();
    }
}</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Для создания экземпляра нестандартного источника данных декларативным способом необходимо указать класс в атрибуте <code>datasourceClass</code> элемента XML. При программном создании через <code>DsBuilder</code> класс источника указывается вызовом <code>setDsClass()</code> или в параметре одного из методов <code>build*()</code>.</p> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="datasource_query"><a class="anchor" href="/manual.html#datasource_query"></a>5.5.3.2. Запросы в CollectionDatasourceImpl</h5> 
        <div class="paragraph"> 
         <p>Класс <code>CollectionDatasourceImpl</code> и его наследники <code>GroupDatasourceImpl</code>, <code>HierarchicalDatasourceImpl</code> являются стандартной реализацией источников данных, работающих с коллекциями независимых экземпляров сущностей. Эти источники загружают данные через <code>DataManager</code>, отправляя на <strong>Middleware</strong> запрос на языке JPQL. Далее рассматриваются особенности формирования таких запросов.</p> 
        </div> 
        <div class="sect5"> 
         <h6 id="datasource_query_results"><a class="anchor" href="/manual.html#datasource_query_results"></a>5.5.3.2.1. Возвращаемые значения</h6> 
         <div class="paragraph"> 
          <p>Запрос должен возвращать сущности того типа, который указан при создании источника данных. Тип сущности при декларативном создании указывается в атрибуте <code>class</code> элемента XML, при создании через <code>DsBuilder</code> - в методе <code>setJavaClass()</code> или <code>setMetaClass()</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Например, запрос источника данных типа <code>Customer</code> может выглядеть следующим образом:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">select</span> c <span class="keyword">from</span> sales<span class="error">$</span>Customer c</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>или</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">select</span> o.customer <span class="keyword">from</span> sales<span class="error">$</span><span class="keyword">Order</span> o</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Запрос не может возвращать агрегированные значения или отдельные атрибуты, например:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">select</span> c.id, c.name <span class="keyword">from</span> sales<span class="error">$</span>Customer c <span class="comment">/* неверно - возвращает отдельные поля, а не весь объект Customer */</span></code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="datasource_query_params"><a class="anchor" href="/manual.html#datasource_query_params"></a>5.5.3.2.2. Параметры запроса</h6> 
         <div class="paragraph"> 
          <p>JPQL-запрос в источнике данных может содержать параметры нескольких видов. Вид параметра определяется по префиксу имени параметра. Префиксом является часть имени до знака "$". Интерпретация имени после "$" рассматривается ниже.</p> 
         </div> 
         <div id="datasource_query_params_ds" class="ulist"> 
          <ul> 
           <li> <p>Префикс <code>ds</code>.</p> 
            <div class="paragraph"> 
             <p>Значением параметра являются данные другого источника данных, зарегистрированного в этом же <code>DsContext</code>. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">customersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Customer</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;query&gt;</span>
         <span class="inline-delimiter">&lt;![CDATA[</span>select c from sales$Customer c<span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/query&gt;</span>
<span class="tag">&lt;/collectionDatasource&gt;</span>

<span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;query&gt;</span>
         <span class="inline-delimiter">&lt;![CDATA[</span>select o from sales$Order o where o.customer.id = :ds$customersDs<span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/query&gt;</span>
<span class="tag">&lt;/collectionDatasource&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>В данном случае параметром запроса источника данных <code>ordersDs</code> будет текущий экземпляр сущности, находящийся в источнике данных <code>customersDs</code>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>При использовании параметров с префиксом <code>ds</code> между источниками данных автоматически создаются зависимости, приводящие к обновлению источника если меняется значение его параметра. В приведенном примере если изменяется выбранный Покупатель, автоматически обновляется список его Заказов.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Обратите внимание, что в примере запроса с параметром левой частью оператора сравнения является значение идентификатора <code>o.customer.id</code>, а правой - экземпляр <code>Customer</code>, содержащийся в источнике <code>customersDs</code>. Такое сравнение допустимо, так как при выполнении запроса на <strong>Middleware</strong> реализация интерфейса <a href="/manual.html#query">Query</a>, присваивая значения параметрам запроса, автоматически подставляет ID сущности вместо переданного экземпляра сущности.</p> 
            </div> 
            <div class="paragraph"> 
             <p>В имени параметра после префикса и имени источника может быть также указан путь по графу сущностей к атрибуту, из которого нужно взять значение, например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;query&gt;</span>
    <span class="inline-delimiter">&lt;![CDATA[</span>select o from sales$Order o where o.customer.id = :ds$customersDs.id<span class="inline-delimiter">]]&gt;</span>
<span class="tag">&lt;/query&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>или</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;query&gt;</span>
    <span class="inline-delimiter">&lt;![CDATA[</span>select o from sales$Order o where o.tagName = :ds$customersDs.group.tagName<span class="inline-delimiter">]]&gt;</span>
<span class="tag">&lt;/query&gt;</span></code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="datasource_query_params_custom" class="ulist"> 
          <ul> 
           <li> <p>Префикс <code>custom</code>.</p> 
            <div class="paragraph"> 
             <p>Значение параметра будет взято из объекта <code>Map&lt;String, Object&gt;</code>, переданного в метод <code>refresh()</code> источника данных. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;collectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">ordersDs</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.sample.sales.entity.Order</span><span class="delimiter">"</span></span> <span class="attribute-name">view</span>=<span class="string"><span class="delimiter">"</span><span class="content">_local</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;query&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>select o from sales$Order o where o.number = :custom$number<span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/query&gt;</span>
<span class="tag">&lt;/collectionDatasource&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">ordersDs.refresh(ParamsMap.of(<span class="string"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">1</span><span class="delimiter">"</span></span>));</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Приведение экземпляра при необходимости к его идентификатору осуществляется аналогично параметрам с префиксом <code>ds</code>. Путь по графу сущностей в имени параметра в данном случае не поддерживается.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="datasource_query_params_param" class="ulist"> 
          <ul> 
           <li> <p>Префикс <code>param</code>.</p> 
            <div class="paragraph"> 
             <p>Значение параметра будет взято из объекта <code>Map&lt;String, Object&gt;</code>, переданного при открытии экрана в метод <code>init()</code> <a href="/manual.html#screen_controller">контроллера</a>. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;query&gt;</span>
    <span class="inline-delimiter">&lt;![CDATA[</span>select e from sales$Order e where e.customer = :param$customer<span class="inline-delimiter">]]&gt;</span>
<span class="tag">&lt;/query&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">openWindow(<span class="string"><span class="delimiter">"</span><span class="content">sales$Order.lookup</span><span class="delimiter">"</span></span>, WindowManager.OpenType.DIALOG, ParamsMap.of(<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>, customersTable.getSingleSelected()));</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Приведение экземпляра при необходимости к его идентификатору осуществляется аналогично параметрам с префиксом <code>ds</code>. Поддерживается путь к атрибуту по графу сущностей в имени параметра.</p> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="datasource_query_params_component" class="ulist"> 
          <ul> 
           <li> <p>Префикс <code>component</code>.</p> 
            <div class="paragraph"> 
             <p>Значением параметра будет текущее значение визуального компонента, путь к которому указан в имени параметра. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;query&gt;</span>
    <span class="inline-delimiter">&lt;![CDATA[</span>select o from sales$Order o where o.number = :component$filter.orderNumberField<span class="inline-delimiter">]]&gt;</span>
<span class="tag">&lt;/query&gt;</span></code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Путь к компоненту должен включать все вложенные <a href="/manual.html#frame">фреймы</a>.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Приведение экземпляра при необходимости к его идентификатору аналогично параметрам <code>ds</code>. Поддерживается путь к атрибуту по графу сущностей в имени параметра как продолжение пути к компоненту.</p> 
            </div> 
            <div class="admonitionblock tip"> 
             <table> 
              <tbody>
               <tr> 
                <td class="icon"> 
                 <div class="title">
                  Tip
                 </div> </td> 
                <td class="content"> 
                 <div class="paragraph"> 
                  <p>При изменении значения компонента источник данных автоматически не обновляется.</p> 
                 </div> </td> 
               </tr> 
              </tbody>
             </table> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="datasource_query_params_session" class="ulist"> 
          <ul> 
           <li> <p>Префикс <code>session</code>.</p> 
            <div class="paragraph"> 
             <p>Значением параметра будет значение атрибута <a href="/manual.html#userSession">пользовательской сессии</a>, указанного в имени параметра.</p> 
            </div> 
            <div class="paragraph"> 
             <p>Значение извлекается методом <code>UserSession.getAttribute()</code>, поэтому поддерживаются также предопределенные имена атрибутов сессии:</p> 
            </div> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>userId</code> - ID текущего зарегистрированного или замещенного пользователя;</p> </li> 
              <li> <p><code>userLogin</code> - логин текущего зарегистрированного или замещенного пользователя в нижнем регистре.</p> 
               <div class="paragraph"> 
                <p>Пример:</p> 
               </div> 
               <div class="listingblock"> 
                <div class="content"> 
                 <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;query&gt;</span>
    <span class="inline-delimiter">&lt;![CDATA[</span>select o from sales$Order o where o.createdBy = :session$userLogin<span class="inline-delimiter">]]&gt;</span>
<span class="tag">&lt;/query&gt;</span></code></pre> 
                </div> 
               </div> 
               <div class="paragraph"> 
                <p>Приведение экземпляра при необходимости к его идентификатору аналогично параметрам <code>ds</code>. Путь по графу сущностей в имени параметра в данном случае не поддерживается.</p> 
               </div> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="admonitionblock warning"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Warning
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Если значение параметра не найдено по правилам, задаваемым префиксом, для данного параметра устанавливается значение <code>null</code>. То есть если, например, в запросе указан параметр с именем <code>param$some_name</code>, а в мэп параметров экрана нет ключа <code>some_name</code>, то для параметра <code>param$some_name</code> устанавливается значение <code>null</code>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="datasource_query_filter"><a class="anchor" href="/manual.html#datasource_query_filter"></a>5.5.3.2.3. Фильтр запроса</h6> 
         <div class="paragraph"> 
          <p>Запрос источника данных может быть модифицирован во время работы приложения, в зависимости от вводимых пользователем условий, что позволяет эффективно фильтровать данные на уровне выборки из БД.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Простейший способ обеспечения такой возможности - подключение к источнику данных специального визуального компонента <a href="/manual.html#gui_Filter">Filter</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Если по какой-то причине применение универсального фильтра нежелательно, можно встроить в текст запроса специальную разметку на XML, позволяющую сформировать итоговый запрос в зависимости от значений, введенных пользователем в произвольные визуальные компоненты экрана.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В таком фильтре могут быть использованы следующие элементы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>filter</code> - корневой элемент фильтра. Может непосредственно содержать только одно условие.</p> 
            <div class="ulist"> 
             <ul> 
              <li> <p><code>and</code>, <code>or</code> - логические условия, могут содержать любое количество других условий и предложений.</p> </li> 
              <li> <p><code>c</code> - предложение на JPQL, которое добавляется в секцию <code>where</code>. Содержит только текст и опционально атрибут <code>join</code>, значение которого будет добавлено в соответствующее место запроса, если добавляется данное предложение <code>where</code>.</p> </li> 
             </ul> 
            </div> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Условия и предложения добавляются в итоговый запрос, только если присутствующие внутри них параметры получили значения, т.е. не равны <code>null</code>.</p> 
         </div> 
         <div class="admonitionblock warning"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Warning
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>В фильтрах запросов можно использовать только <a href="/manual.html#datasource_query_params_custom">custom</a>, <a href="/manual.html#datasource_query_params_param">param</a> и <a href="/manual.html#datasource_query_params_component">component</a> параметры. Параметры <a href="/manual.html#datasource_query_params_ds">ds</a> и <a href="/manual.html#datasource_query_params_session">session</a> не будут работать.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div class="paragraph"> 
          <p>Пример:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;query&gt;</span>
    <span class="inline-delimiter">&lt;![CDATA[</span>select distinct d from app$GeneralDoc d<span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;filter&gt;</span>
        <span class="tag">&lt;or&gt;</span>
            <span class="tag">&lt;and&gt;</span>
                <span class="tag">&lt;c</span> <span class="attribute-name">join</span>=<span class="string"><span class="delimiter">"</span><span class="content">, app$DocRole dr</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>dr.doc.id = d.id and d.processState = :custom$state<span class="tag">&lt;/c&gt;</span>
                <span class="tag">&lt;c&gt;</span>d.barCode like :component$barCodeFilterField<span class="tag">&lt;/c&gt;</span>
            <span class="tag">&lt;/and&gt;</span>
            <span class="tag">&lt;c</span> <span class="attribute-name">join</span>=<span class="string"><span class="delimiter">"</span><span class="content">, app$DocRole dr</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>dr.doc.id = d.id and dr.user.id = :custom$initiator<span class="tag">&lt;/c&gt;</span>
        <span class="tag">&lt;/or&gt;</span>
    <span class="tag">&lt;/filter&gt;</span>
<span class="tag">&lt;/query&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В данном случае если в метод <code>refresh()</code> источника данных переданы параметры <code>state</code> и <code>initiator</code>, а в визуальном компоненте <code>barCodeFilterField</code> установлено некоторое значение, то итоговый запрос примет вид:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="jpql">select distinct d from app$GeneralDoc d, app$DocRole dr
where
(
  (dr.doc.id = d.id and d.processState = :custom$state)
  and
  (d.barCode like :component$barCodeFilterField)
)
or
(dr.doc.id = d.id and dr.user.id = :custom$initiator)</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Если же, к примеру, компонент <code>barCodeFilterField</code> пуст, а в <code>refresh()</code> передан только параметр <code>initiator</code>, то запрос получится следующим:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="jpql">select distinct d from app$GeneralDoc d, app$DocRole dr
where
(dr.doc.id = d.id and dr.user.id = :custom$initiator)</code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="datasource_query_case_insensitive"><a class="anchor" href="/manual.html#datasource_query_case_insensitive"></a>5.5.3.2.4. Поиск подстроки без учета регистра</h6> 
         <div class="paragraph"> 
          <p>В источниках данных можно использовать особенность выполнения JPQL-запросов, описанную для интерфейса <code><a href="/manual.html#query">Query</a></code> уровня <strong>Middleware</strong>: для удобного формирования условия поиска без учета регистра символов и по любой части строки можно использовать префикс <code>(?i)</code>. Однако, в связи с тем, что значение параметра обычно передается неявно, имеются следующие отличия:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Префикс <code>(?i)</code> нужно указывать не в значении, а перед именем параметра.</p> </li> 
           <li> <p>Значение параметра будет автоматически переведено в нижний регистр.</p> </li> 
           <li> <p>Если в значении параметра отсутствуют символы <code>%</code>, то они будут добавлены в начало и конец.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Для примера рассмотрим обработку следующего запроса:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="jpql">select c from sales$Customer c where c.name like :(?i)component$customerNameField</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>В данном случае значение параметра, взятое из компонента <code>customerNameField</code>, будет переведено в нижний регистр и обрамлено символами <code>%</code>, а затем в базе данных будет выполнен SQL запрос с условием вида <code>lower(C.NAME) like ?</code></p> 
         </div> 
         <div class="paragraph"> 
          <p>Следует иметь в виду, что при таком поиске индекс, созданный в БД по полю <code>NAME</code>, не используется.</p> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="value_datasources"><a class="anchor" href="/manual.html#value_datasources"></a>5.5.3.3. Value Datasources</h5> 
        <div class="paragraph"> 
         <p>Value datasources позволяют выполнять запросы, возвращающие скалярные и агрегатные значения. Например, следующим запросом можно загрузить некоторую агрегатную статистику по покупателям:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="sql"><span class="class">select</span> o.customer, <span class="predefined">sum</span>(o.amount) <span class="keyword">from</span> demo<span class="error">$</span><span class="keyword">Order</span> o <span class="keyword">group</span> <span class="keyword">by</span> o.customer</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Value datasources работают с сущностями особого типа: <code>KeyValueEntity</code>. Такая сущность может содержать произвольный набор атрибутов, задаваемый во время работы приложения. Так, в примере выше, экземпляры <code>KeyValueEntity</code> будут содержать два атрибута: первый типа <code>Customer</code>, второй типа <code>BigDecimal</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Реализации value datasources унаследованы от других широко используемых классов источников данных и дополнительно реализуют специфический интерфейс <code>ValueDatasource</code>. На диаграмме ниже изображены реализации value datasources и их базовые классы:</p> 
        </div> 
        <div class="imageblock" style="text-align: center"> 
         <div class="content"> 
          <img src="assets/ValueDatasources.png" alt="ValueDatasources"> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Интерфейс <code>ValueDatasource</code> содержит следующие методы:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>addProperty()</code> - так как источник данных может содержать произвольный набор атрибутов, с помощью данного метода необходимо указать, какие атрибуты ожидаются. Он принимает имя атрибута и его тип в виде <a href="/manual.html#datatype">Datatype</a> или Java-класса. В последнем случае класс должен быть либо сущностью, либо классом, поддерживаемым одним из типов данных (datatypes).</p> </li> 
          <li> <p><code>setIdName()</code> - опциональный метод, позволяющий назначить один из атрибутов идентификатором сущности. Это означает, что экземпляры <code>KeyValueEntity</code>, содержащиеся в данном источнике данных будут иметь идентификаторы, получаемые из данного атрибута. В противном случае, экземпляры <code>KeyValueEntity</code> получают случайно сгенерированные UUIDs.</p> </li> 
          <li> <p><code>getMetaClass()</code> возвращает динамическую реализацию интерфейса <code>MetaClass</code>, которая представляет текущую схему экземпляров <code>KeyValueEntity</code>, заданную вызовами метода <code>addProperty()</code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Value datasources могут быть заданы декларативно в XML-дескрипторе. Существует три XML-элемента, соответствующих классам реализации:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>valueCollectionDatasource</code></p> </li> 
          <li> <p><code>valueGroupDatasource</code></p> </li> 
          <li> <p><code>valueHierarchicalDatasource</code></p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>XML описание value datasource должно содержать элемент <code>properties</code>, который задает атрибуты <code>KeyValueEntity</code>, содержащихся в источнике данных (см. метод <code>addProperty()</code> выше). Порядок элементов <code>property</code> должен соответствовать порядку колонок в результирующем наборе, возвращаемом запросом. Например, в следующем определении атрибут <code>customer</code> получит значение из колонки <code>o.customer</code>, а атрибут <code>sum</code> из колонки <code>sum(o.amount)</code>:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dsContext&gt;</span>
    <span class="tag">&lt;valueCollectionDatasource</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">salesDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;query&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>select o.customer, sum(o.amount) from demo$Order o group by o.customer<span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/query&gt;</span>
        <span class="tag">&lt;properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.demo.entity.Customer</span><span class="delimiter">"</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">datatype</span>=<span class="string"><span class="delimiter">"</span><span class="content">decimal</span><span class="delimiter">"</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">sum</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/valueCollectionDatasource&gt;</span>
<span class="tag">&lt;/dsContext&gt;</span></code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Value datasources предназначены только для чтения данных, так как сущность <code>KeyValueEntity</code> является неперсистентной и не может быть сохранена стандартным механизмом работы с БД.</p> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="datasource_listeners"><a class="anchor" href="/manual.html#datasource_listeners"></a>5.5.3.4. Слушатели источников данных</h5> 
        <div class="paragraph"> 
         <p>Слушатели <a href="/manual.html#datasources">источников данных</a> (datasource listeners) позволяют получать оповещения об изменении состояния источников данных и экземпляров сущностей, в них находящихся.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Существует четыре типа слушателей. Три из них: <code>ItemPropertyChangeListener</code>, <code>ItemChangeListener</code> и <code>StateChangeListener</code> определены в интерфейсе <code>Datasource</code> и могут быть использованы в любых источниках данных. <code>CollectionChangeListener</code> определен в интерфейсе <code>CollectionDatasource</code> и может быть использован только в источниках данных, работающих с коллекциями сущностей.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Пример использования слушателей источников данных:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeBrowse</span> <span class="directive">extends</span> AbstractLookup {

    <span class="directive">private</span> <span class="predefined-type">Logger</span> log = LoggerFactory.getLogger(EmployeeBrowse.class);

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> CollectionDatasource&lt;Employee, <span class="predefined-type">UUID</span>&gt; employeesDs;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
        employeesDs.addItemPropertyChangeListener(event -&gt; {
            log.info(<span class="string"><span class="delimiter">"</span><span class="content">Property {} of {} has been changed from {} to {}</span><span class="delimiter">"</span></span>,
                    event.getProperty(), event.getItem(), event.getPrevValue(), event.getValue());
        });

        employeesDs.addStateChangeListener(event -&gt; {
            log.info(<span class="string"><span class="delimiter">"</span><span class="content">State of {} has been changed from {} to {}</span><span class="delimiter">"</span></span>,
                    event.getDs(), event.getPrevState(), event.getState());
        });

        employeesDs.addItemChangeListener(event -&gt; {
            log.info(<span class="string"><span class="delimiter">"</span><span class="content">Datasource {} item has been changed from {} to {}</span><span class="delimiter">"</span></span>,
                    event.getDs(), event.getPrevItem(), event.getItem());
        });

        employeesDs.addCollectionChangeListener(event -&gt; {
            log.info(<span class="string"><span class="delimiter">"</span><span class="content">Datasource {} content has been changed due to {}</span><span class="delimiter">"</span></span>,
                    event.getDs(), event.getOperation());
        });
    }
}</code></pre> 
         </div> 
        </div> 
        <div class="paragraph"> 
         <p>Интерфейсы слушателей описаны ниже.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>ItemPropertyChangeListener</code> добавляется с помощью метода <code>Datasource.addItemPropertyChangeListener()</code>. Слушатель вызывается, если изменилось значение какого-либо атрибута сущности, находящейся в данный момент в источнике. Через объект события можно получить сам измененный экземпляр, имя измененного атрибута, старое и новое значение.</p> 
           <div class="paragraph"> 
            <p>Слушатель <code>ItemPropertyChangeListener</code> можно использовать для действий в ответ на изменение пользователем сущности из UI, то есть редактирования полей ввода.</p> 
           </div> </li> 
          <li> <p><code>ItemChangeListener</code> добавляется с помощью метода <code>Datasource.addItemChangeListener()</code>. Он вызывается при смене выбранного экземпляра, возвращаемого методом <code>getItem()</code>.</p> 
           <div class="paragraph"> 
            <p>Для <code>Datasource</code> это происходит при установке другого экземпляра (или <code>null</code>) методом <code>setItem()</code>.</p> 
           </div> 
           <div class="paragraph"> 
            <p>Для <code>CollectionDatasource</code> данный слушатель вызывается, когда в связанном визуальном компоненте меняется выделенный элемент. Например, это может быть выделенная строка таблицы, элемент дерева, или выделенный элемент выпадающего списка.</p> 
           </div> </li> 
          <li> <p><code>StateChangeListener</code> добавляется с помощью метода <code>Datasource.addStateChangeListener()</code>. Он вызывается при изменении состояния источника данных. Источник данных может находиться в одном из трех состояний, соответствующих перечислению <code>Datasource.State</code>:</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>NOT_INITIALIZED</code> - источник только что создан.</p> </li> 
               <li> <p><code>INVALID</code> - создан весь <code><a href="/manual.html#dsContext">DsContext</a></code>, к которому относится данный источник.</p> </li> 
               <li> <p><code>VALID</code> - источник данных в рабочем состоянии: <code>Datasource</code> содержит экземпляр сущности или <code>null</code>, <code>CollectionDatasource</code> - коллекцию экземпляров или пустую коллекцию.</p> 
                <div class="paragraph"> 
                 <p>Получение оповещения об изменении состояния источника может быть актуально для сложных <a href="/manual.html#screen_edit">редакторов</a>, состоящих из нескольких <a href="/manual.html#frame">фреймов</a>, где сложно отследить момент проставления редактируемой сущности в источник. В этом случае можно использовать слушатель <code>StateChangeListener</code> для отложенной инициализации некоторых элементов экрана:</p> 
                </div> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">employeesDs.addStateChangeListener(event -&gt; {
    <span class="keyword">if</span> (event.getState() == Datasource.State.VALID)
        initDataTypeColumn();
});</code></pre> 
                 </div> 
                </div> </li> 
              </ul> 
             </div> 
            </div> 
           </div> </li> 
          <li> <p><code>CollectionChangeListener</code> добавляется с помощью метода <code>CollectionDatasource.addCollectionChangeListener()</code>. Слушатель вызывается при изменении коллекции сущностей, хранящейся в источнике данных. Объект события имеет метод <code>getOperation()</code>, возвращающий значение типа <code>CollectionDatasource.Operation</code>: <code>REFRESH</code>, <code>CLEAR</code>, <code>ADD</code>, <code>REMOVE</code>, <code>UPDATE</code>. Этот тип указывает операцию, которая привела к изменению коллекции.</p> </li> 
         </ul> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="dsContext"><a class="anchor" href="/manual.html#dsContext"></a>5.5.3.5. DsContext</h5> 
        <div class="paragraph"> 
         <p>Все созданные декларативно источники данных регистрируются в объекте <code>DsContext</code> экрана. Ссылку на <code>DsContext</code> можно получить методом <code>getDsContext()</code> контроллера экрана, либо инжекцией в поле класса.</p> 
        </div> 
        <div class="paragraph"> 
         <p><code>DsContext</code> решает следующие задачи:</p> 
        </div> 
        <div class="olist arabic"> 
         <ol class="arabic"> 
          <li> <p>Позволяет организовать зависимости между источниками данных, когда при навигации по одному источнику (т.е. при изменении "текущего" экземпляра методом <code>setItem()</code>) обновляется связанный источник. Такие зависимости дают возможность в экранах легко организовывать master-detail связи между визуальными компонентами.</p> 
           <div class="paragraph"> 
            <p>Зависимости между источниками организуются с помощью <a href="/manual.html#datasource_query">параметров запросов</a> с префиксом <code>ds$</code>.</p> 
           </div> </li> 
          <li> <p>Позволяет собрать все измененные экземпляры сущностей и отправить их на <strong>Middleware</strong> в одном вызове <code>DataManager.commit()</code>, т.е. сохранить в базе данных в одной транзакции.</p> 
           <div class="paragraph"> 
            <p>В качестве примера предположим, что некоторый экран позволяет редактировать экземпляр сущности <code>Order</code> и коллекцию принадлежащих ему экземпляров <code>OrderLine</code>. Экземпляр <code>Order</code> находится в <code>Datasource</code>, коллекция <code>OrderLine</code> - во вложенном <code>CollectionDatasource</code>, созданном по атрибуту <code>Order.lines</code>. Допустим, пользователь изменил какой-то атрибут <code>Order</code> и создал новый экземпляр <code>OrderLine</code>. Тогда при коммите экрана в <a href="/manual.html#dataManager">DataManager</a> будут одновременно отправлены два экземпляра - измененный <code>Order</code> и новый <code>OrderLine</code>. Далее, они вместе попадут в один <a href="/manual.html#entityManager">персистентный контекст</a> и при коммите транзакции сохранятся в БД. Разумеется, экземпляр <code>OrderLine</code> содержится также в коллекции <code>Order.lines</code>, но если не передавать его в персистентный контекст независимо, то потребуется установка каскадности сохранения между <code>Order</code> и <code>OrderLines</code> на уровне ORM. Жесткие отношения каскадности на уровне ORM иногда вызывают нежелательные последствия в неожиданных местах, поэтому лучше их избегать, что и обеспечивает описываемый механизм <code>DsContext</code>.</p> 
           </div> 
           <div class="paragraph"> 
            <p>В результате коммита <code>DsContext</code> получает от <strong>Middleware</strong> набор сохраненных экземпляров (в случае оптимистической блокировки у них, как минимум, увеличено значение атрибута <code>version</code>), и устанавливает эти экземпляры в источниках данных взамен устаревших. Это позволяет сразу после коммита работать со свежими экземплярами без необходимости лишнего обновления источников данных, связанного с запросами к <strong>Middleware</strong> и базе данных.</p> 
           </div> </li> 
          <li> <p>Объявляет два слушателя: <code>BeforeCommitListener</code> и <code>AfterCommitListener</code>, позволяющие получать оповещения перед коммитом измененных экземпляров и после него. Перед коммитом можно дополнить коллекцию отправляемых в <a href="/manual.html#dataManager">DataManager</a> на Middleware экземпляров, тем самым обеспечив сохранение в той же транзакции произвольных сущностей. После коммита можно получить коллекцию вернувшихся из <code>DataManager</code> сохраненных экземпляров.</p> 
           <div class="paragraph"> 
            <p>Данный механизм необходим, если некоторые сущности, с которыми работает экран, находятся не под управлением источников данных, а создаются и изменяются непосредственно в коде контроллера. Например, визуальный компонент <code><a href="/manual.html#gui_FileUploadField">FileUploadField</a></code> после загрузки файла создает новый экземпляр сущности <code>FileDescriptor</code>, который можно сохранить вместе с другими сущностями экрана именно таким способом - добавив в <code>CommitContext</code> в слушателе <code>BeforeCommitListener</code>.</p> 
           </div> 
           <div class="paragraph"> 
            <p>В следующем примере новый экземпляр <code>Customer</code> будет отправлен на <strong>Middleware</strong> и сохранен в БД вместе с остальными измененными сущностями экрана при его коммите:</p> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">protected</span> Customer customer;

<span class="directive">protected</span> <span class="type">void</span> createNewCustomer() {
    customer = metadata.create(Customer.class);
    customer.setName(<span class="string"><span class="delimiter">"</span><span class="content">John Doe</span><span class="delimiter">"</span></span>);
}

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    getDsContext().addBeforeCommitListener(context -&gt; {
        <span class="keyword">if</span> (customer != <span class="predefined-constant">null</span>)
            context.getCommitInstances().add(customer);
    }
}</code></pre> 
            </div> 
           </div> </li> 
         </ol> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="dataSupplier"><a class="anchor" href="/manual.html#dataSupplier"></a>5.5.3.6. DataSupplier</h5> 
        <div class="paragraph"> 
         <p><code>DataSupplier</code> - интерфейс, через который источники данных обращаются к Middleware для загрузки и сохранения сущностей. Его стандартная реализация просто делегирует выполнение <a href="/manual.html#dataManager">DataManager</a>. Экран может задать свою реализацию интерфейса <code>DataSupplier</code> в атрибуте <code>dataSupplier</code> элемента <code>window</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Ссылку на <code>DataSupplier</code> можно получить либо <a href="/manual.html#screen_controller_injection">инжекцией</a> в контроллер экрана, либо через экземпляры <code>DsContext</code> или <code>Datasource</code>. В обоих случаях возвращается или стандартная, или собственная реализация интерфейса (если таковая определена).</p> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="gui_Action"><a class="anchor" href="/manual.html#gui_Action"></a>5.5.4. Действия. Интерфейс Action</h4> 
       <div class="paragraph"> 
        <p><code>Action</code> − интерфейс, абстрагирующий действие (другими словами, некоторую функцию) от визуального компонента. Он особенно полезен в случаях, когда одно и то же действие может быть вызвано из разных визуальных компонентов. Кроме того, данный интерфейс позволяет снабдить действие дополнительными свойствами, такими как название, признаки доступности и видимости, и другими.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Рассмотрим методы интерфейса <code>Action</code>:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>actionPerform()</code> - вызывается визуальным компонентом, связанным с данным действием. В метод передается экземпляр вызвавшего компонента.</p> </li> 
         <li> <p><code>getId()</code> - возвращает идентификатор данного действия. Идентификатор обычно устанавливается конструктором класса, реализующего <code>Action</code>, и не меняется на протяжении жизни созданного объекта действия.</p> </li> 
         <li> <p>методы получения и установки свойств <code>caption</code>, <code>description</code>, <code>shortcut</code>, <code>icon</code>, <code>enabled</code>, <code>visible</code>. Все эти свойства обычно используется связанными визуальными компонентами для установки собственных одноименных свойств.</p> </li> 
         <li> <p><code>addPropertyChangeListener()</code>, <code>removePropertyChangeListener()</code> - подключение слушателей, реагирующих на изменение вышеупомянутых свойств. Слушатель получает уведомление типа <code>java.beans.PropertyChangeEvent</code>, в котором содержится имя измененного свойства, его старое и новое значение.</p> </li> 
         <li> <p><code>refreshState()</code> - метод, который может быть реализован в конкретном классе действия для инициализации вышеупомянутых свойств в соответствии с какими-либо внешними факторами, например правами пользователя. Вызывается обычно в конструкторах имплементирующих классов или из связанных визуальных компонентов.</p> </li> 
         <li> <p><code>addOwner()</code>, <code>removeOwner()</code>, <code>getOwner()</code>, <code>getOwners()</code> - методы для управления связью действия с визуальными компонентами.</p> </li> 
        </ul> 
       </div> 
       <div class="paragraph"> 
        <p>Для реализации действий рекомендуется использовать <a href="/manual.html#declarative_actions">декларативное создание</a> действий, либо наследоваться от класса <a href="/manual.html#baseAction">AbstractAction</a>. Кроме того, существует набор <a href="/manual.html#standard_actions">стандартных действий</a>, применимых для работы с таблицами и компонентами выбора. От стандартных действий также можно наследоваться для модификации их поведения или перехвата событий.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Визуальные компоненты, связанные с действием, могут быть двух типов:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p>Визуальный компонент, содержащий одно действие, реализует интерфейс <code>Component.ActionOwner</code>. Это <a href="/manual.html#gui_Button">Button</a> и <a href="/manual.html#gui_LinkButton">LinkButton</a>.</p> 
          <div class="paragraph"> 
           <p>Связь компонента с действием осуществляется путем вызова метода <code>ActionOwner.setAction()</code> компонента. В этот момент компонент заменяет свои свойства на соответствующие свойства действия (подробнее см. описание компонентов).</p> 
          </div> </li> 
         <li> <p>Визуальный компонент, содержащий несколько действий, реализует интерфейс <code>Component.ActionsHolder</code>. Это <code>Window</code>, <code>Frame</code>, <a href="/manual.html#gui_Table">Table</a> и ее наследники, <a href="/manual.html#gui_Tree">Tree</a>, <a href="/manual.html#gui_PopupButton">PopupButton</a>, <a href="/manual.html#gui_PickerField">PickerField</a>, <a href="/manual.html#gui_LookupPickerField">LookupPickerField</a>.</p> 
          <div class="paragraph"> 
           <p>Действия добавляются компоненту вызовом метода <code>ActionsHolder.addAction()</code>. Реализация этого метода в компоненте проверяет, нет ли уже в нем действия с таким же идентификатором. Если есть, то имеющееся действие будет заменено на новое переданное. Поэтому можно, например, декларировать стандартное действие в дескрипторе экрана, а затем в контроллере создать новое с переопределенными методами и добавить компоненту.</p> 
          </div> </li> 
        </ul> 
       </div> 
       <div class="sect4"> 
        <h5 id="declarative_actions"><a class="anchor" href="/manual.html#declarative_actions"></a>5.5.4.1. Декларативное создание действий</h5> 
        <div class="paragraph"> 
         <p>В XML-дескрипторе экрана для любого компонента, реализующего интерфейс <code>Component.ActionsHolder</code>, в том числе для всего экрана или фрейма, может быть задан набор <a href="/manual.html#gui_Action">действий</a>. Делается это в элементе <code>actions</code>, который содержит вложенные элементы <code>action</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Элемент <code>action</code> может иметь следующие атрибуты:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>id</code> − идентификатор, должен быть уникален в рамках данного компонента <code>ActionsHolder</code>.</p> </li> 
          <li> <p><code>caption</code> - название действия.</p> </li> 
          <li> <p><code>description</code> - описание действия.</p> </li> 
          <li> <p><code>enable</code> - признак доступности действия (<code>true</code> / <code>false</code>).</p> </li> 
          <li> <p><code>icon</code> - значок действия.</p> </li> 
          <li> <p><code>invoke</code> - имя вызываемого метода контроллера. Метод должен быть <code>public</code>, не возвращать результата и либо не иметь аргументов, либо иметь один аргумент типа <code>Component</code>. Если метод имеет аргумент <code>Component</code>, то при вызове в него будет передан экземпляр визуального компонента, запустившего данное действие.</p> </li> 
          <li> <p><code>shortcut</code> - комбинация клавиш для вызова.</p> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Комбинации можно жёстко задавать в XML-дескрипторе. Возможные модификаторы - <code>ALT</code>, <code>CTRL</code>, <code>SHIFT</code> - отделяются символом "-". Например:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">create</span><span class="delimiter">"</span></span> <span class="attribute-name">shortcut</span>=<span class="string"><span class="delimiter">"</span><span class="content">ALT-N</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Для большей гибкости можно использовать готовые псевдонимы комбинаций из списка ниже, к примеру:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">edit</span><span class="delimiter">"</span></span> <span class="attribute-name">shortcut</span>=<span class="string"><span class="delimiter">"</span><span class="content">${TABLE_EDIT_SHORTCUT}</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
              </div> 
             </div> 
             <div class="ulist"> 
              <ul> 
               <li> <p><code>TABLE_EDIT_SHORTCUT</code></p> </li> 
               <li> <p><code>COMMIT_SHORTCUT</code></p> </li> 
               <li> <p><code>CLOSE_SHORTCUT</code></p> </li> 
               <li> <p><code>FILTER_APPLY_SHORTCUT</code></p> </li> 
               <li> <p><code>FILTER_SELECT_SHORTCUT</code></p> </li> 
               <li> <p><code>NEXT_TAB_SHORTCUT</code></p> </li> 
               <li> <p><code>PREVIOUS_TAB_SHORTCUT</code></p> </li> 
               <li> <p><code>PICKER_LOOKUP_SHORTCUT</code></p> </li> 
               <li> <p><code>PICKER_OPEN_SHORTCUT</code></p> </li> 
               <li> <p><code>PICKER_CLEAR_SHORTCUT</code></p> </li> 
              </ul> 
             </div> 
             <div class="paragraph"> 
              <p>Кроме того, есть возможность задавать комбинацию с помощью полного имени интерфейса <code>Config</code> и имени метода, возвращающего нужную комбинацию:</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">remove</span><span class="delimiter">"</span></span> <span class="attribute-name">shortcut</span>=<span class="string"><span class="delimiter">"</span><span class="content">${com.haulmont.cuba.client.ClientConfig#getTableRemoveShortcut}</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
              </div> 
             </div> 
            </div> 
           </div> </li> 
          <li> <p><code>visible</code> - признак видимости действия (<code>true</code> / <code>false</code>).</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Рассмотрим примеры декларативного объявления действий.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Объявление действий на уровне экрана:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;window</span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
  <span class="tag">&lt;dsContext</span><span class="tag">/&gt;</span>

  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">sayHelloAction</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://sayHello</span><span class="delimiter">"</span></span> <span class="attribute-name">shortcut</span>=<span class="string"><span class="delimiter">"</span><span class="content">ALT-T</span><span class="delimiter">"</span></span> <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">sayHello</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>

  <span class="tag">&lt;layout&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">sayHelloAction</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/layout&gt;</span>
<span class="tag">&lt;/window&gt;</span></code></pre> 
            </div> 
           </div> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// controller</span>

<span class="directive">public</span> <span class="type">void</span> sayHello(<span class="predefined-type">Component</span> component) {
  showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Hello!</span><span class="delimiter">"</span></span>, NotificationType.TRAY);
}</code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Здесь объявляется действие с идентификатором <code>sayHelloAction</code> и названием из <a href="/manual.html#message_packs">пакета сообщений</a>. С этим действием связывается кнопка, заголовок которой будет установлен в название действия. Действие вызовет метод <code>sayHello()</code> контроллера при нажатии на кнопку, а также при нажатии комбинации клавиш <strong>ALT-T</strong>, если в данный момент экран принимает фокус ввода.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Объявление действий для <a href="/manual.html#gui_PopupButton">PopupButton</a>:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;popupButton</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Say something</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
 <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">helloAction</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Say hello</span><span class="delimiter">"</span></span> <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">sayHello</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">goodbyeAction</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Say goodbye</span><span class="delimiter">"</span></span> <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">sayGoodbye</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
 <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/popupButton&gt;</span></code></pre> 
            </div> 
           </div> </li> 
          <li> <p>Объявление действий для <a href="/manual.html#gui_Table">Table</a>:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">copy</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://copy</span><span class="delimiter">"</span></span> <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">icons/copy.png</span><span class="delimiter">"</span></span>
              <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">copy</span><span class="delimiter">"</span></span> <span class="attribute-name">trackSelection</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">changePassw</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">msg://changePassw</span><span class="delimiter">"</span></span> <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">icons/change-pass.png</span><span class="delimiter">"</span></span>
              <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">changePassword</span><span class="delimiter">"</span></span> <span class="attribute-name">trackSelection</span>=<span class="string"><span class="delimiter">"</span><span class="content">true</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
  <span class="tag">&lt;buttonsPanel&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable.create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable.edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable.copy</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable.changePassw</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/buttonsPanel&gt;</span>
  <span class="tag">&lt;rowsCount</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;columns&gt;</span>
      <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">login</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      ...
  <span class="tag">&lt;/columns&gt;</span>
  <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/table&gt;</span></code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Здесь помимо <a href="/manual.html#standard_actions">стандартных действий</a> таблицы <code>create</code> и <code>edit</code> объявлены действия <code>copy</code> и <code>changePassw</code>, вызывающие соответствующие методы контроллера. Для этих действий указан также атрибут <code>trackSelection="true"</code>, в результате чего действие и связанная с ним кнопка становятся недоступными, если в таблице не выбрана ни одна строка. Это удобно, если действие предназначено для выполнения над текущей выбранной строкой таблицы.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Для действий <code>create</code> и <code>edit</code> можно указать дополнительный атрибут <code>openType</code> для указания режима открытия экрана редактирования, как описано для метода <code>setOpenType()</code> класса <a href="/manual.html#createAction">CreateAction</a>.</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Объявление действий для <a href="/manual.html#gui_PickerField">PickerField</a>:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;pickerField</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">colourField</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">lookup</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">show</span><span class="delimiter">"</span></span> <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">icons/show.png</span><span class="delimiter">"</span></span>
              <span class="attribute-name">invoke</span>=<span class="string"><span class="delimiter">"</span><span class="content">showColour</span><span class="delimiter">"</span></span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="delimiter">"</span></span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">"</span><span class="content">Show colour</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/pickerField&gt;</span></code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>В данном примере для компонента <code>PickerField</code> объявлено <a href="/manual.html#standard_actions">стандартное действие</a> <code>lookup</code> и действие <code>show</code>, вызывающее метод <code>showColour()</code> контроллера. Так как в кнопках <code>PickerField</code>, отображающих действия, используются значки, а не надписи, атрибут <code>caption</code> явно установлен в пустую строку, иначе названием действия и заголовком кнопки стал бы идентификатор действия. Атрибут <code>description</code> позволяет отображать всплывающую подсказку при наведении мыши на кнопку действия.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Ссылки на любые декларативно объявленные действия можно получить в контроллере экрана либо непосредственно путем <a href="/manual.html#screen_controller_injection">инжекции</a>, либо из компонентов, реализующих интерфейс <code>Component.ActionsHolder</code>. Это может понадобиться для программной установки свойств действия. Например:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">"</span><span class="content">carsTable.create</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> CreateAction createAction;

<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">"</span><span class="content">carsTable.copy</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> <span class="predefined-type">Action</span> copyAction;

<span class="annotation">@Inject</span>
<span class="directive">private</span> PickerField colourField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
  <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; values = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
  values.put(<span class="string"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>, CarType.PASSENGER);
  createAction.setInitialValues(values);

  copyAction.setEnabled(<span class="predefined-constant">false</span>);

  <span class="predefined-type">Action</span> showAction = colourField.getAction(<span class="string"><span class="delimiter">"</span><span class="content">show</span><span class="delimiter">"</span></span>);
  showAction.setEnabled(<span class="predefined-constant">false</span>);
}</code></pre> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="standard_actions"><a class="anchor" href="/manual.html#standard_actions"></a>5.5.4.2. Стандартные действия</h5> 
        <div class="paragraph"> 
         <p>Стандартные <a href="/manual.html#gui_Action">действия</a> - это классы, имплементирующие интерфейс <code>Action</code>, и предназначенные для решения типовых задач, таких как вызов экрана редактирования для сущности, выбранной в таблице. Стандартные действия имеют строго определенные идентификаторы, поэтому для декларативного объявления некоторого стандартного действия достаточно указать его идентификатор.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Существует два вида стандартных действий:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><a href="/manual.html#list_actions">Действия с коллекцией</a> сущностей, отображаемой в таблице или дереве.</p> </li> 
          <li> <p><a href="/manual.html#picker_actions">Действия поля выбора</a> экземпляра сущности.</p> </li> 
         </ul> 
        </div> 
        <div class="sect5"> 
         <h6 id="list_actions"><a class="anchor" href="/manual.html#list_actions"></a>5.5.4.2.1. Стандартные действия с коллекцией</h6> 
         <div class="paragraph"> 
          <p>Для наследников <code>ListComponent</code> (это <a href="/manual.html#gui_Table">Table</a>, <a href="/manual.html#gui_GroupTable">GroupTable</a>, <a href="/manual.html#gui_TreeTable">TreeTable</a> и <a href="/manual.html#gui_Tree">Tree</a>) набор стандартных действий определен в перечислении <code>ListActionType</code>, классы их реализации находятся в пакете <code>com.haulmont.cuba.gui.components.actions</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования стандартных действий в таблице:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable</span><span class="delimiter">"</span></span> <span class="attribute-name">width</span>=<span class="string"><span class="delimiter">"</span><span class="content">100%</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">remove</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">refresh</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
  <span class="tag">&lt;buttonsPanel&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable.create</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable.edit</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable.remove</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;button</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable.refresh</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/buttonsPanel&gt;</span>
  <span class="tag">&lt;rowsCount</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;columns&gt;</span>
      <span class="tag">&lt;column</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">login</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      ...
  <span class="tag">&lt;/columns&gt;</span>
  <span class="tag">&lt;rows</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersDs</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/table&gt;</span></code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Рассмотрим их подробнее.</p> 
         </div> 
         <div id="createAction" class="paragraph"> 
          <p><strong>CreateAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>CreateAction</code> - действие с идентификатором <strong>create</strong>. Предназначено для создания нового экземпляра сущности и открытия экрана редактирования для этого экземпляра. Если экран редактирования успешно закоммитил новый экземпляр в базу данных, то <code>CreateAction</code> добавляет этот новый экземпляр в источник данных таблицы и делает его выбранным.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В классе <code>CreateAction</code> определены следующие специфические методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setOpenType()</code> - позволяет задать режим открытия экрана редактирования новой сущности. По умолчанию экран открывается в режиме <code>THIS_TAB</code>.</p> 
            <div class="paragraph"> 
             <p>Так как довольно часто требуется открывать экраны редактирования в другом режиме (как правило, <code>DIALOG</code>), при декларативном создании действия <code>create</code> в элементе <code>action</code> можно указать атрибут <code>openType</code> с нужным значением. Это избавляет от необходимости получать ссылку на действие в контроллере и программно устанавливать данное свойство. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">create</span><span class="delimiter">"</span></span> <span class="attribute-name">openType</span>=<span class="string"><span class="delimiter">"</span><span class="content">DIALOG</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>setWindowId()</code> - позволяет задать идентификатор экрана редактирования сущности. По умолчанию используется экран <code>{имя_сущности}.edit</code>, например <code>sales$Customer.edit</code>.</p> </li> 
           <li> <p><code>setWindowParams()</code> - позволяет задать параметры экрана редактирования, передаваемые в его метод <code>init()</code>. Далее эти параметры можно использовать напрямую в <a href="/manual.html#datasource_query_params_param">запросе источника данных</a> через префикс <code>param$</code> или <a href="/manual.html#screen_controller_injection">инжектировать</a> в контроллер экрана с помощью аннотации <code>@WindowParam</code>.</p> </li> 
           <li> <p><code>setWindowParamsSupplier()</code> отличается от <code>setWindowParams()</code> тем, что позволяет получить значения параметров непосредственно перед вызовом действия. Полученные параметры объединяются с предоставленными через <code>setWindowParams()</code> и могут переопределять их. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">createAction.setWindowParamsSupplier(() -&gt; {
   Customer customer = metadata.create(Customer.class);
   customer.setCategory(<span class="comment">/* some value dependent on the current state of the screen */</span>);
   <span class="keyword">return</span> ParamsMap.of(<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>, customer);
});</code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>setInitialValues()</code> - позволяет задать начальные значения атрибутов создаваемой сущности. Принимает объект <code>Map</code>, в котором ключами являются имена атрибутов, а значениями - значения атрибутов. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; values = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
values.put(<span class="string"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>, CarType.PASSENGER);
carCreateAction.setInitialValues(values);</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Пример использования <code>setInitialValues()</code> приведен также в разделе <a href="/manual.html#init_values_in_CreateAction">рецептов разработки</a>.</p> 
            </div> </li> 
           <li> <p><code>setInitialValuesSupplier()</code> отличается от <code>setInitialValues()</code> тем, что позволяет получить значения параметров непосредственно перед вызовом действия. Полученные параметры объединяются с предоставленными через <code>setInitialValues()</code> и могут переопределять их. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">carCreateAction.setInitialValuesSupplier(() -&gt;
    ParamsMap.of(<span class="string"><span class="delimiter">"</span><span class="content">type</span><span class="delimiter">"</span></span>, <span class="comment">/* value depends on the current state of the screen */</span>));</code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>afterCommit()</code> - вызывается действием после того, как экран редактирования успешно закоммитил новую сущность и был закрыт. Данный метод не имеет реализации и может быть переопределен в наследниках для реакции на это событие.</p> </li> 
           <li> <p><code>setAfterCommitHandler()</code> - позволяет задать обработчик, который будет вызван после того, как экран редактирования успешно закоммитил новую сущность и был закрыт. Данный обработчик можно использовать вместо переопределения метода <code>afterCommit()</code>, тем самым избавившись от необходимости создания наследника действия. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">"</span><span class="content">customersTable.create</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> CreateAction customersTableCreate;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    customersTableCreate.setAfterCommitHandler(<span class="keyword">new</span> CreateAction.AfterCommitHandler() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> handle(<span class="predefined-type">Entity</span> entity) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Committed</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
        }
    });
}</code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>afterWindowClosed()</code> - вызывается действием в последнюю очередь после закрытия экрана редактирования, независимо от того, была ли закоммичена новая сущность или нет. Данный метод не имеет реализации и может быть переопределен в наследниках для реакции на это событие.</p> </li> 
           <li> <p><code>setAfterWindowClosedHandler()</code> - позволяет задать обработчик, который будет вызван после закрытия экрана редактирования, независимо от того, была ли закоммичена новая сущность или нет. Данный обработчик можно использовать вместо переопределения метода <code>afterWindowClosed()</code>, тем самым избавившись от необходимости создания наследника действия.</p> </li> 
          </ul> 
         </div> 
         <div id="editAction" class="paragraph"> 
          <p><strong>EditAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>EditAction</code> - действие с идентификатором <strong>edit</strong>. Открывает экран редактирования для выбранного экземпляра сущности. Если экран редактирования успешно закоммитил экземпляр в базу данных, то <code>EditAction</code> обновляет этот экземпляр в источнике данных таблицы.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В классе <code>EditAction</code> определены следующие специфические методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setOpenType()</code> - позволяет задать режим открытия экрана редактирования сущности. По умолчанию экран открывается в режиме <code>THIS_TAB</code>.</p> 
            <div class="paragraph"> 
             <p>Так как довольно часто требуется открывать экраны редактирования в другом режиме (как правило, <code>DIALOG</code>), при декларативном создании действия <code>edit</code> в элементе <code>action</code> можно указать атрибут <code>openType</code> с нужным значением. Это избавляет от необходимости получать ссылку на действие в контроллере и программно устанавливать данное свойство. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">edit</span><span class="delimiter">"</span></span> <span class="attribute-name">openType</span>=<span class="string"><span class="delimiter">"</span><span class="content">DIALOG</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>setWindowId()</code> - позволяет задать идентификатор экрана редактирования сущности. По умолчанию используется экран <code>{имя_сущности}.edit</code>, например <code>sales$Customer.edit</code>.</p> </li> 
           <li> <p><code>setWindowParams()</code> - позволяет задать параметры экрана редактирования, передаваемые в его метод <code>init()</code>. Далее эти параметры можно использовать напрямую в <a href="/manual.html#datasource_query_params_param">запросе источника данных</a> через префикс <code>param$</code> или <a href="/manual.html#screen_controller_injection">инжектировать</a> в контроллер экрана с помощью аннотации <code>@WindowParam</code>.</p> </li> 
           <li> <p><code>setWindowParamsSupplier()</code> отличается от <code>setWindowParams()</code> тем, что позволяет получить значения параметров непосредственно перед вызовом действия. Полученные параметры объединяются с предоставленными через <code>setWindowParams()</code> и могут переопределять их. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">customersTableEdit.setWindowParamsSupplier(() -&gt;
    ParamsMap.of(<span class="string"><span class="delimiter">"</span><span class="content">category</span><span class="delimiter">"</span></span>, <span class="comment">/* some value dependent on the current state of the screen */</span>));</code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>afterCommit()</code> - вызывается действием после того, как экран редактирования успешно закоммитил сущность и был закрыт. Данный метод не имеет реализации и может быть переопределен в наследниках для реакции на это событие.</p> </li> 
           <li> <p><code>setAfterCommitHandler()</code> - позволяет задать обработчик, который будет вызван после того, как экран редактирования успешно закоммитил новую сущность и был закрыт. Данный обработчик можно использовать вместо переопределения метода <code>afterCommit()</code>, тем самым избавившись от необходимости создания наследника действия. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">"</span><span class="content">customersTable.edit</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> EditAction customersTableEdit;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    customersTableEdit.setAfterCommitHandler(<span class="keyword">new</span> EditAction.AfterCommitHandler() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> handle(<span class="predefined-type">Entity</span> entity) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Committed</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
        }
    });
}</code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>afterWindowClosed()</code> - вызывается действием в последнюю очередь после закрытия экрана редактирования, независимо от того, была ли закоммичена редактируемая сущность. Данный метод не имеет реализации и может быть переопределен в наследниках для реакции на это событие.</p> </li> 
           <li> <p><code>setAfterWindowClosedHandler()</code> - позволяет задать обработчик, который будет вызван после закрытия экрана редактирования, независимо от того, была ли закоммичена новая сущность или нет. Данный обработчик можно использовать вместо переопределения метода <code>afterWindowClosed()</code>, тем самым избавившись от необходимости создания наследника действия.</p> </li> 
           <li> <p><code>getBulkEditorIntegration()</code> позволяет настроить массовое редактирование строк таблицы, для этого атрибут <code>multiselect</code> таблицы должен иметь значение <code>true</code>. Компонент <a href="/manual.html#gui_BulkEditor">BulkEditor</a> будет открыт, если при вызове <code>EditAction</code> в таблице выделено более одной строки.</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Возвращаемый экземпляр <code>BulkEditorIntegration</code> можно изменить с помощью следующих методов:</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p><code>setOpenType()</code>,</p> </li> 
                <li> <p><code>setExcludePropertiesRegex()</code>,</p> </li> 
                <li> <p><code>setFieldValidators()</code>,</p> </li> 
                <li> <p><code>setModelValidators()</code>,</p> </li> 
                <li> <p><code>setAfterEditCloseHandler()</code>.</p> </li> 
               </ul> 
              </div> 
             </div> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">"</span><span class="content">clientsTable.edit</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> EditAction clientsTableEdit;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="local-variable">super</span>.init(params);

    clientsTableEdit.getBulkEditorIntegration()
        .setEnabled(<span class="predefined-constant">true</span>)
        .setOpenType(WindowManager.OpenType.DIALOG);
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="removeAction" class="paragraph"> 
          <p><strong>RemoveAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>RemoveAction</code> - действие с идентификатором <strong>remove</strong>. Предназначено для удаления выбранного экземпляра сущности.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В классе <code>RemoveAction</code> определены следующие специфические методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setAutocommit()</code> - позволяет управлять моментом удаления сущности из базы данных. По умолчанию после срабатывания действия и удаления сущности из источника данных у источника вызывается метод <code>commit()</code>, в результате чего сущность удаляется из базы данных. Cвойство <code>autocommit</code> можно установить в <code>false</code> либо методом <code>setAutocommit()</code>, либо соответствующим параметром конструктора. В результате после удаления сущности из источника данных для подтверждения удаления потребуется явно вызвать метод <code>commit()</code> источника данных.</p> 
            <div class="paragraph"> 
             <p>Значение <code>autocommit</code> не влияет на работу источников данных в режиме <code>Datasource.CommitMode.PARENT</code>, то есть тех, которые обеспечивают редактирование <a href="/manual.html#composition_annotation">композиционных</a> сущностей.</p> 
            </div> </li> 
           <li> <p><code>setConfirmationMessage()</code> - позволяет задать текст сообщения в диалоге подтверждения удаления.</p> </li> 
           <li> <p><code>setConfirmationTitle()</code> - позволяет задать заголовок диалога подтверждения удаления.</p> </li> 
           <li> <p><code>afterRemove()</code> - вызывается действием после успешного удаления сущности. Данный метод не имеет реализации и может быть переопределен в наследниках для реакции на это событие.</p> </li> 
           <li> <p><code>setAfterRemoveHandler()</code> позволяет задать обработчик, который будет вызван после успешного удаления сущности. Данный обработчик можно использовать вместо переопределения метода <code>afterWindowClosed()</code>, тем самым избавившись от необходимости создания наследника действия. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">"</span><span class="content">customersTable.remove</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> RemoveAction customersTableRemove;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    customersTableRemove.setAfterRemoveHandler(<span class="keyword">new</span> RemoveAction.AfterRemoveHandler() {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> handle(<span class="predefined-type">Set</span> removedItems) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Removed</span><span class="delimiter">"</span></span>, NotificationType.HUMANIZED);
        }
    });
}</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="refreshAction" class="paragraph"> 
          <p><strong>RefreshAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>RefreshAction</code> - действие с идентификатором <strong>refresh</strong>. Предназначено для обновления (перезагрузки) коллекции сущностей. При срабатывании вызывает метод <code>refresh()</code> <a href="/manual.html#datasources">источника данных</a>, с которым связан компонент.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В классе <code>RefreshAction</code> определены следующие специфические методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setRefreshParams()</code> - позволяет задать параметры, передаваемые в метод <code>CollectionDatasource.refresh()</code>, для использования внутри <a href="/manual.html#datasource_query">запроса</a>. По умолчанию никакие параметры не передаются.</p> </li> 
           <li> <p><code>setRefreshParamsSupplier()</code> отличается от <code>setRefreshParams()</code> тем, что позволяет получить значения параметров непосредственно перед вызовом действия. Полученные параметры объединяются с предоставленными через <code>setRefreshParams()</code> и могут переопределять их. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">customersTableRefresh.setRefreshParamsSupplier(() -&gt;
    ParamsMap.of(<span class="string"><span class="delimiter">"</span><span class="content">number</span><span class="delimiter">"</span></span>, <span class="comment">/* some value dependent on the current state of the screen */</span>));</code></pre> 
             </div> 
            </div> </li> 
          </ul> 
         </div> 
         <div id="addAction" class="paragraph"> 
          <p><strong>AddAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>AddAction</code> - действие с идентификатором <strong>add</strong>. Предназначено для выбора существующего экземпляра сущности и добавления его в коллекцию. При срабатывании открывает <a href="/manual.html#screen_lookup">экран выбора</a> сущностей.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В классе <code>AddAction</code> определены следующие специфические методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setOpenType()</code> - позволяет задать режим открытия экрана выбора сущности. По умолчанию экран открывается в режиме <code>THIS_TAB</code>.</p> 
            <div class="paragraph"> 
             <p>Так как довольно часто требуется открывать экраны выбора в другом режиме (как правило, <code>DIALOG</code>), при декларативном создании действия <code>add</code> в элементе <code>action</code> можно указать атрибут <code>openType</code> с нужным значением. Это избавляет от необходимости получать ссылку на действие в контроллере и программно устанавливать данное свойство. Например:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;table</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">usersTable</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;actions&gt;</span>
  <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">add</span><span class="delimiter">"</span></span> <span class="attribute-name">openType</span>=<span class="string"><span class="delimiter">"</span><span class="content">DIALOG</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>setWindowId()</code> - позволяет задать идентификатор экрана выбора сущности. По умолчанию используется экран <code>{имя_сущности}.lookup</code>, например <code>sales$Customer.lookup</code>. Если такого экрана не существует, то делается попытка открыть экран <code>{имя_сущности}.browse</code>, например <code>sales$Customer.browse</code>.</p> </li> 
           <li> <p><code>setWindowParams()</code> - позволяет задать параметры экрана выбора, передаваемые в его метод <code>init()</code>. Далее эти параметры можно использовать напрямую в <a href="/manual.html#datasource_query_params_param">запросе источника данных</a> через префикс <code>param$</code> или <a href="/manual.html#screen_controller_injection">инжектировать</a> в контроллер экрана с помощью аннотации <code>@WindowParam</code>.</p> </li> 
           <li> <p><code>setWindowParamsSupplier()</code> отличается от <code>setWindowParams()</code> тем, что позволяет получить значения параметров непосредственно перед вызовом действия. Полученные параметры объединяются с предоставленными через <code>setWindowParams()</code> и могут переопределять их. Например:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="java">tableAdd.setWindowParamsSupplier(() -&gt;
    ParamsMap.of(<span class="string"><span class="delimiter">"</span><span class="content">customer</span><span class="delimiter">"</span></span>, getItem()));</code></pre> 
             </div> 
            </div> </li> 
           <li> <p><code>setHandler()</code> - позволяет задать объект, реализующий интерфейс <code>Window.Lookup.Handler</code>, передаваемый в экран выбора. По умолчанию используется объект класса <code>AddAction.DefaultHandler</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="excludeAction" class="paragraph"> 
          <p><strong>ExcludeAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>ExcludeAction</code> - действие с идентификатором <strong>exclude</strong>. Позволяет исключать экземпляры сущности из коллекции, не удаляя их из базы данных. Класс данного действия является наследником <code>RemoveAction</code>, однако при срабатывании вызывает у <code>CollectionDatasource</code> не <code>removeItem()</code>, а <code>excludeItem()</code>. Кроме того, для вложенных источников данных <code>ExcludeAction</code> разрывает связь с родительской сущностью, поэтому с помощью данного действия можно организовать редактирование ассоциации one-to-many.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В классе <code>ExcludeAction</code> в дополнение к <code>RemoveAction</code> определены следующие специфические методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setConfirm()</code> - показывать ли диалог подтверждения удаления. Это свойство можно также установить через конструктор действия. По умолчанию установлено в <code>false</code>.</p> </li> 
          </ul> 
         </div> 
         <div id="excelAction" class="paragraph"> 
          <p><strong>ExcelAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>ExcelAction</code> - действие с идентификатором <strong>excel</strong>. Предназначено для экспорта данных таблицы в формат XLS и выгрузки соответствующего файла. Данное действие можно связать только с компонентами <a href="/manual.html#gui_Table">Table</a>, <a href="/manual.html#gui_GroupTable">GroupTable</a> и <a href="/manual.html#gui_TreeTable">TreeTable</a>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>При программном создании действия можно задать параметр конструктора <code>display</code>, передав реализацию интерфейса <code>ExportDisplay</code> для выгрузки файла. По умолчанию используется стандартная реализация.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В классе <code>ExcelAction</code> определены следующие специфические методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setFileName()</code> - позволяет задать имя выгружаемого файла Excel без расширения.</p> </li> 
           <li> <p><code>getFileName()</code> - возвращает имя выгружаемого файла Excel без расширения.</p> </li> 
          </ul> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="picker_actions"><a class="anchor" href="/manual.html#picker_actions"></a>5.5.4.2.2. Стандартные действия поля выбора</h6> 
         <div class="paragraph"> 
          <p>Для компонентов <a href="/manual.html#gui_PickerField">PickerField</a>, <a href="/manual.html#gui_LookupPickerField">LookupPickerField</a> и <a href="/manual.html#gui_SearchPickerField">SearchPickerField</a> набор стандартных действий определен в перечислении <code>PickerField.ActionType</code>. Реализации являются внутренними классами интерфейса <code>PickerField</code>.</p> 
         </div> 
         <div class="paragraph"> 
          <p>Пример использования стандартных действий в компоненте выбора:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;searchPickerField</span> <span class="attribute-name">optionsDatasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">coloursDs</span><span class="delimiter">"</span></span>
                 <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">carDs</span><span class="delimiter">"</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">colour</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">clear</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">lookup</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">open</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/searchPickerField&gt;</span></code></pre> 
          </div> 
         </div> 
         <div id="lookupAction" class="paragraph"> 
          <p><strong>LookupAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>LookupAction</code> - действие с идентификатором <strong>lookup</strong>. Предназначено для выбора экземпляра сущности и установки его в качестве значения компонента. При срабатывании открывает <a href="/manual.html#screen_lookup">экран выбора</a> сущностей.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В классе <code>LookupAction</code> определены следующие специфические методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setLookupScreenOpenType()</code> - позволяет задать режим открытия экрана выбора сущности. По умолчанию экран открывается в режиме <code>THIS_TAB</code>.</p> </li> 
           <li> <p><code>setLookupScreen()</code> - позволяет задать идентификатор экрана выбора сущности. По умолчанию используется экран <code>{имя_сущности}.lookup</code>, например <code>sales$Customer.lookup</code>. Если такого экрана не существует, то делается попытка открыть экран <code>{имя_сущности}.browse</code>, например <code>sales$Customer.browse</code>.</p> </li> 
           <li> <p><code>setLookupScreenParams()</code> - позволяет задать параметры экрана выбора, передаваемые в его метод <code>init()</code>.</p> </li> 
           <li> <p><code>afterSelect()</code> - вызывается действием после того, как выбранный экземпляр установлен в качестве значения компонента. Данный метод не имеет реализации и может быть переопределен в наследниках для реакции на это событие.</p> </li> 
           <li> <p><code>afterCloseLookup()</code> - вызывается действием в последнюю очередь после закрытия экрана выбора, независимо от того, был сделан выбор или нет. Данный метод не имеет реализации и может быть переопределен в наследниках для реакции на это событие.</p> </li> 
          </ul> 
         </div> 
         <div id="clearAction" class="paragraph"> 
          <p><strong>ClearAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>ClearAction</code> - действие с идентификатором <strong>clear</strong>. Предназначено для очистки (то есть установки в <code>null</code>) текущего значения компонента.</p> 
         </div> 
         <div id="openAction" class="paragraph"> 
          <p><strong>OpenAction</strong></p> 
         </div> 
         <div class="paragraph"> 
          <p><code>OpenAction</code> - действие с идентификатором <strong>open</strong>. Предназначено для открытия экрана редактирования экземпляра сущности, являющегося текущим значением компонента.</p> 
         </div> 
         <div class="paragraph"> 
          <p>В классе <code>OpenAction</code> определены следующие специфические методы:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p><code>setEditScreenOpenType()</code> - позволяет задать режим открытия экрана редактирования сущности. По умолчанию экран открывается в режиме <code>THIS_TAB</code>.</p> </li> 
           <li> <p><code>setEditScreen()</code> - позволяет задать идентификатор экрана редактирования сущности. По умолчанию используется экран <code>{имя_сущности}.edit</code>, например <code>sales$Customer.edit</code>.</p> </li> 
           <li> <p><code>setEditScreenParams()</code> - позволяет задать параметры экрана редактирования, передаваемые в его метод <code>init()</code>.</p> </li> 
           <li> <p><code>afterWindowClosed()</code> - вызывается действием после закрытия экрана редактирования. Данный метод не имеет реализации и может быть переопределен в наследниках для реакции на это событие.</p> </li> 
          </ul> 
         </div> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="baseAction"><a class="anchor" href="/manual.html#baseAction"></a>5.5.4.3. BaseAction</h5> 
        <div class="paragraph"> 
         <p><code>BaseAction</code> - базовый класс реализации <a href="/manual.html#gui_Action">действий</a>. От него рекомендуется наследовать собственные нестандартные действия, если возможностей <a href="/manual.html#declarative_actions">декларативного создания действий</a> не хватает.</p> 
        </div> 
        <div class="paragraph"> 
         <p>При создании конкретного класса действия необходимо определить метод <code>actionPerform()</code> и передать в конструктор <code>BaseAction</code> идентификатор действия. Можно также переопределить любые методы получения свойств действия: <code>getCaption()</code>, <code>getDescription()</code>, <code>getIcon()</code>, <code>getShortcut()</code>, <code>isEnabled()</code>, <code>isVisible()</code>. Стандартные реализации этих методов возвращают значения, установленные соответствующими set-методами. Исключение составляет метод <code>getCaption()</code>: если название действия явно не установлено методом <code>setCaption()</code>, то он обращается в <a href="/manual.html#message_packs">пакет локализованных сообщений</a> с именем, соответствующим пакету класса действия, и возвращает сообщение с ключом, равным идентификатору действия. Если сообщения с таким ключом нет, то возвращается сам ключ, то есть идентификатор действия.</p> 
        </div> 
        <div class="paragraph"> 
         <p>В качестве альтернативы переопределению методов можно использовать fluent interface для установки свойств и lambda expression для предоставления кода обработки действия: см. методы <code>withXYZ()</code>.</p> 
        </div> 
        <div class="paragraph"> 
         <p><code>BaseAction</code> может изменять свои свойства <code>enabled</code> и <code>visible</code> в соответствии с <a href="/manual.html#permissions">разрешениями</a> пользователя и текущим контекстом.</p> 
        </div> 
        <div class="paragraph"> 
         <p><code>BaseAction</code> видим (visible), если:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>метод <code>setVisible(false)</code> не вызывался;</p> </li> 
          <li> <p>для действия не установлено UI разрешение <code>hide</code>.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Действие разрешено (enabled), если:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>метод <code>setEnabled(false)</code> не вызывался;</p> </li> 
          <li> <p>для действия не установлено UI разрешений <code>hide</code> или <code>read-only</code>;</p> </li> 
          <li> <p>метод <code>isPermitted()</code> возвращает true;</p> </li> 
          <li> <p>метод <code>isApplicable()</code> возвращает true.</p> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Примеры использования:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p>Действие кнопки:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> <span class="predefined-type">Button</span> helloBtn;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;params) {
    helloBtn.setAction(<span class="keyword">new</span> BaseAction(<span class="string"><span class="delimiter">"</span><span class="content">hello</span><span class="delimiter">"</span></span>) {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> actionPerform(<span class="predefined-type">Component</span> component) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Hello!</span><span class="delimiter">"</span></span>, NotificationType.TRAY);
        }
    });
    <span class="comment">// OR</span>
    helloBtn.setAction(<span class="keyword">new</span> BaseAction(<span class="string"><span class="delimiter">"</span><span class="content">hello</span><span class="delimiter">"</span></span>)
            .withHandler(e -&gt; showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Hello</span><span class="delimiter">"</span></span>, NotificationType.TRAY)));
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>В данном случае кнопка <code>helloBtn</code> получит в качестве заголовка строку, находящуюся в пакете сообщений с ключом <code>hello</code>. Для того, чтобы получить название кнопки каким-либо иным способом, можно переопределить метод <code>getCaption()</code> действия.</p> 
           </div> </li> 
          <li> <p>Действие кнопки программно создаваемого <a href="/manual.html#gui_PickerField">PickerField</a>:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> ComponentsFactory componentsFactory;

<span class="annotation">@Inject</span>
<span class="directive">private</span> <span class="predefined-type">BoxLayout</span> box;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;params) {
    PickerField pickerField = componentsFactory.createComponent(PickerField.NAME);

    pickerField.addAction(<span class="keyword">new</span> BaseAction(<span class="string"><span class="delimiter">"</span><span class="content">hello</span><span class="delimiter">"</span></span>) {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getCaption() {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getDescription() {
            <span class="keyword">return</span> getMessage(<span class="string"><span class="delimiter">"</span><span class="content">helloDescription</span><span class="delimiter">"</span></span>);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> getIcon() {
            <span class="keyword">return</span><span class="string"><span class="delimiter">"</span><span class="content">icons/hello.png</span><span class="delimiter">"</span></span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> actionPerform(<span class="predefined-type">Component</span> component) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Hello!</span><span class="delimiter">"</span></span>, NotificationType.TRAY);
        }
    });
    <span class="comment">// OR</span>
    pickerField.addAction(<span class="keyword">new</span> BaseAction(<span class="string"><span class="delimiter">"</span><span class="content">hello</span><span class="delimiter">"</span></span>)
            .withCaption(<span class="predefined-constant">null</span>)
            .withDescription(getMessage(<span class="string"><span class="delimiter">"</span><span class="content">helloDescription</span><span class="delimiter">"</span></span>))
            .withIcon(<span class="string"><span class="delimiter">"</span><span class="content">icons/ok.png</span><span class="delimiter">"</span></span>)
            .withHandler(e -&gt; showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Hello</span><span class="delimiter">"</span></span>, NotificationType.TRAY)));

    box.add(pickerField);
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Здесь анонимный класс-наследник <code>BaseAction</code> используется для задания действия кнопки поля выбора. Заголовок кнопки не отображается, вместо него используется значок и описание, всплывающее при наведении курсора мыши.</p> 
           </div> </li> 
          <li> <p>Действие таблицы:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Table table;

<span class="annotation">@Inject</span>
<span class="directive">private</span> <span class="predefined-type">Security</span> security;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    table.addAction(<span class="keyword">new</span> HelloAction());
}

<span class="directive">private</span> <span class="type">class</span> <span class="class">HelloAction</span> <span class="directive">extends</span> BaseAction {

    <span class="directive">public</span> HelloAction() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">"</span><span class="content">hello</span><span class="delimiter">"</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> actionPerform(<span class="predefined-type">Component</span> component) {
        showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Hello </span><span class="delimiter">"</span></span> + table.getSingleSelected(), NotificationType.TRAY);
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">boolean</span> isPermitted() {
        <span class="keyword">return</span> security.isSpecificPermitted(<span class="string"><span class="delimiter">"</span><span class="content">myapp.allow-greeting</span><span class="delimiter">"</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> isApplicable() {
        <span class="keyword">return</span> target != <span class="predefined-constant">null</span> &amp;&amp; target.getSelected().size() == <span class="integer">1</span>;
    }
}</code></pre> 
            </div> 
           </div> 
           <div class="paragraph"> 
            <p>Здесь объявлен класс <code>HelloAction</code>, экземпляр которого добавляется в список действий таблицы. Действие разрешено пользователям, имеющим специфическое разрешение <code><strong>myapp.allow-greeting</strong></code>, и только когда выбрана одна строка таблицы. Последнее условие реализуется с помощью свойства <code>target</code> действия, которое автоматически устанавливается когда действие добавляется в <code>ListComponent</code> (<code>Table</code> или <code>Tree</code>).</p> 
           </div> </li> 
          <li> <p>Если необходимо действие, которое доступно, когда выделены одна или более строк таблицы, удобно воспользоваться наследником <code>BaseAction</code> - классом <code>ItemTrackingAction</code>, который добавляет стандартную реализацию метода <code>isApplicable()</code>:</p> 
           <div class="listingblock"> 
            <div class="content"> 
             <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">private</span> Table table;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    table.addAction(<span class="keyword">new</span> ItemTrackingAction(<span class="string"><span class="delimiter">"</span><span class="content">hello</span><span class="delimiter">"</span></span>) {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> actionPerform(<span class="predefined-type">Component</span> component) {
            showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Hello </span><span class="delimiter">"</span></span> + table.getSelected().iterator().next(), NotificationType.TRAY);
        }
    });
}</code></pre> 
            </div> 
           </div> </li> 
         </ul> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="dialogs_and_notifications"><a class="anchor" href="/manual.html#dialogs_and_notifications"></a>5.5.5. Диалоговые окна и уведомления</h4> 
       <div class="paragraph"> 
        <p>Для вывода сообщений пользователю можно использовать диалоговые окна и уведомления.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Диалоговые окна имеют заголовок с кнопкой закрытия и отображаются всегда в центре главного окна приложения. Уведомления могут отображаться как в центре, так и в углу приложения, и автоматически исчезать.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="dialogs"><a class="anchor" href="/manual.html#dialogs"></a>5.5.5.1. Диалоговые окна</h5> 
        <div class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Диалоги общего назначения
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Диалоговые окна общего назначения вызываются методами <code>showMessageDialog()</code> и <code>showOptionDialog()</code> интерфейса <code>Frame</code>. Этот интерфейс реализуется <a href="/manual.html#screen_controller">контроллером экрана</a>, поэтому данные методы можно вызывать напрямую в коде контроллера.</p> 
             </div> 
             <div id="dialogs_showMessageDialog" class="ulist"> 
              <ul> 
               <li> <p><code>showMessageDialog()</code> предназначен для отображения сообщения. Метод принимает следующие параметры:</p> 
                <div class="ulist"> 
                 <ul> 
                  <li> <p><code>title</code> - заголовок диалогового окна.</p> </li> 
                  <li> <p><code>message</code> - сообщение. В случае HTML-типа (см. ниже) в сообщении можно использовать теги HTML для форматирования. При использовании HTML обязательно экранируйте данных из БД во избежание code injection в веб-клиенте. В не-HTML сообщениях можно использовать символы <code>\n</code> для переноса строки.</p> </li> 
                  <li> <p><code>messageType</code> - тип сообщения. Возможные типы:</p> 
                   <div class="ulist"> 
                    <ul> 
                     <li> <p><code>CONFIRMATION</code>, <code>CONFIRMATION_HTML</code> - диалог подтверждения.</p> </li> 
                     <li> <p><code>WARNING</code>, <code>WARNING_HTML</code> - диалог преупреждения.</p> 
                      <div class="paragraph"> 
                       <p>Различие типов сообщений отражается только в пользовательском интерфейсе десктоп-приложений.</p> 
                      </div> 
                      <div class="paragraph"> 
                       <p>Типы сообщений могут быть установлены с параметрами:</p> 
                      </div> 
                      <div class="ulist"> 
                       <ul> 
                        <li> <p><code>width</code> - ширина диалога,</p> </li> 
                        <li> <p><code>modal</code> - модальность диалога,</p> </li> 
                        <li> <p><code>maximized</code> - должен ли диалог быть развёрнут во весь экран,</p> </li> 
                        <li> <p><code>closeOnClickOutside</code> - возможность закрыть диалог кликом по любой области за его пределами.</p> 
                         <div class="paragraph"> 
                          <p>Пример вызова диалога:</p> 
                         </div> 
                         <div class="listingblock"> 
                          <div class="content"> 
                           <pre class="CodeRay highlight"><code data-lang="java">showMessageDialog(<span class="string"><span class="delimiter">"</span><span class="content">Warning</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Something is wrong</span><span class="delimiter">"</span></span>, MessageType.WARNING.modal(<span class="predefined-constant">true</span>).closeOnClickOutside(<span class="predefined-constant">true</span>));</code></pre> 
                          </div> 
                         </div> </li> 
                       </ul> 
                      </div> </li> 
                    </ul> 
                   </div> </li> 
                 </ul> 
                </div> </li> 
              </ul> 
             </div> 
             <div id="dialogs_showOptionDialog" class="ulist"> 
              <ul> 
               <li> <p><code>showOptionDialog()</code> предназначен для отображения сообщения и кнопок для выбора пользователем. Метод в дополнение к параметрам, описанным для <code>showMessageDialog()</code>, принимает массив или список <a href="/manual.html#gui_Action">действий</a>. Для каждого действия в диалоге создается кнопка, при нажатии на которую пользователем диалог закрывается и вызывается метод <code>actionPerform()</code> данного действия.</p> 
                <div class="paragraph"> 
                 <p>В качестве кнопок со стандартными названиями и значками удобно использовать анонимные классы, унаследованные от <code>DialogAction</code>. Поддерживаются пять видов действий, определяемых перечислением <code>DialogAction.Type</code>: <code>OK</code>, <code>CANCEL</code>, <code>YES</code>, <code>NO</code>, <code>CLOSE</code>. Названия соответствующих кнопок извлекаются из <a href="/manual.html#main_message_pack">главного пакета</a> локализованных сообщений.</p> 
                </div> 
                <div class="paragraph"> 
                 <p>Пример вызова диалога с кнопками <strong>Да</strong> и <strong>Нет</strong> и с заголовком и сообщением, взятыми из пакета локализованных сообщений текущего экрана:</p> 
                </div> 
                <div class="listingblock"> 
                 <div class="content"> 
                  <pre class="CodeRay highlight"><code data-lang="java">showOptionDialog(
    getMessage(<span class="string"><span class="delimiter">"</span><span class="content">confirmCopy.title</span><span class="delimiter">"</span></span>),
    getMessage(<span class="string"><span class="delimiter">"</span><span class="content">confirmCopy.msg</span><span class="delimiter">"</span></span>),
    MessageType.CONFIRMATION,
    <span class="keyword">new</span> <span class="predefined-type">Action</span><span class="type">[]</span> {
        <span class="keyword">new</span> DialogAction(DialogAction.Type.YES, Status.PRIMARY).withHandler(e -&gt; copySettings()),
        <span class="keyword">new</span> DialogAction(DialogAction.Type.NO, Status.NORMAL)
    }
);</code></pre> 
                 </div> 
                </div> 
                <div class="paragraph"> 
                 <p>Параметр <code>Status</code> конструктора <code>DialogAction</code> используется для определения визуального стиля кнопки, к которой привязано данное действие. Статус <code>Status.PRIMARY</code> подсвечивает кнопку и задаёт ей выделение по умолчанию. Параметр <code>Status</code> можно не использовать, в этом случае используется подсветка кнопок по умолчанию. Если в <code>showOptionDialog</code> передано несколько действий с <code>Status.PRIMARY</code>, то фокус и стиль получает только кнопка первого такого действия в списке.</p> 
                </div> </li> 
              </ul> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
        <div id="dialogs_fileUploadDialog" class="dlist"> 
         <dl> 
          <dt class="hdlist1">
           Диалог загрузки файлов
          </dt> 
          <dd> 
           <div class="openblock"> 
            <div class="content"> 
             <div class="paragraph"> 
              <p>Диалоговое окно <code>FileUploadDialog</code> предоставляет базовую функциональность загрузки файлов в <a href="/manual.html#file_upload">промежуточное хранилище</a>. Оно содержит drop zone для перетаскивания файлов извне браузера и кнопку загрузки файла.</p> 
             </div> 
             <div class="imageblock" style="text-align: center"> 
              <div class="content"> 
               <img src="assets/gui_fileUploadDialog.png" alt="gui fileUploadDialog"> 
              </div> 
             </div> 
             <div class="paragraph"> 
              <p>Открыть диалог можно с помощью метода <code>openWindow()</code>, в случае успешной загрузки окно будет закрыто с <code>COMMIT_ACTION_ID</code>. Закрытие диалога можно отслеживать с помощью слушателей <code>CloseListener</code> и <code>CloseWithCommitListener</code>. Чтобы получить UUID и имя загруженного файла, используйте методы <code>getFileId()</code> и <code>getFileName()</code>. Затем для файла можно, например, создать <code>FileDescriptor</code>, позволяющий ссылаться на него из объектов модели данных, или реализовать другую логику.</p> 
             </div> 
             <div class="listingblock"> 
              <div class="content"> 
               <pre class="CodeRay highlight"><code data-lang="java">FileUploadDialog dialog = (FileUploadDialog) openWindow(<span class="string"><span class="delimiter">"</span><span class="content">fileUploadDialog</span><span class="delimiter">"</span></span>, <span class="predefined-type">OpenType</span>.DIALOG);
dialog.addCloseWithCommitListener(() -&gt; {
    <span class="predefined-type">UUID</span> fileId = dialog.getFileId();
    <span class="predefined-type">String</span> fileName = dialog.getFileName();

    <span class="predefined-type">FileDescriptor</span> fileDescriptor = fileUploadingAPI.getFileDescriptor(fileId, fileName);
    <span class="comment">// your logic here</span>
});</code></pre> 
              </div> 
             </div> 
            </div> 
           </div> 
          </dd> 
         </dl> 
        </div> 
       </div> 
       <div class="sect4"> 
        <h5 id="notifications"><a class="anchor" href="/manual.html#notifications"></a>5.5.5.2. Уведомления</h5> 
        <div class="paragraph"> 
         <p>Уведомления вызываются методом <code>showNotification()</code> интерфейса <code>Frame</code>. Этот интерфейс реализуется <a href="/manual.html#screen_controller">контроллером экрана</a>, поэтому данный метод можно вызывать напрямую в коде контроллера.</p> 
        </div> 
        <div class="paragraph"> 
         <p>Метод <code>showNotification()</code> принимает следующие параметры:</p> 
        </div> 
        <div class="ulist"> 
         <ul> 
          <li> <p><code>caption</code> - текст уведомления. В случае HTML-типа (см. ниже) в сообщении можно использовать теги HTML для форматирования. При использовании HTML обязательно экранируйте данных из БД во избежание code injection в веб-клиенте. В не-HTML сообщениях можно использовать символы <code>\n</code> для переноса строки.</p> </li> 
          <li> <p><code>description</code> - опциональное описание, которое будет отображено ниже <code>caption</code>. Также можно использовать символы <code>\n</code> или HTML-форматирование.</p> </li> 
          <li> <p><code>type</code> - тип уведомления. Возможные типы:</p> 
           <div class="ulist"> 
            <ul> 
             <li> <p><code>TRAY</code>, <code>TRAY_HTML</code> - уведомление показывается в правом нижнем углу приложения и исчезает автоматически.</p> </li> 
             <li> <p><code>HUMANIZED</code>, <code>HUMANIZED_HTML</code> - стандартное уведомление в центре экрана, исчезает автоматически.</p> </li> 
             <li> <p><code>WARNING</code>, <code>WARNING_HTML</code> - предупреждение. Исчезает при клике пользователя.</p> </li> 
             <li> <p><code>ERROR</code>, <code>ERROR_HTML</code> - уведомление об ошибке. Исчезает при клике пользователя.</p> </li> 
            </ul> 
           </div> </li> 
         </ul> 
        </div> 
        <div class="paragraph"> 
         <p>Примеры вызова уведомлений:</p> 
        </div> 
        <div class="listingblock"> 
         <div class="content"> 
          <pre class="CodeRay highlight"><code data-lang="java">showNotification(getMessage(<span class="string"><span class="delimiter">"</span><span class="content">selectBook.text</span><span class="delimiter">"</span></span>), NotificationType.HUMANIZED);

showNotification(<span class="string"><span class="delimiter">"</span><span class="content">Validation error</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">&lt;b&gt;Date&lt;/b&gt; is incorrect</span><span class="delimiter">"</span></span>, NotificationType.TRAY_HTML);</code></pre> 
         </div> 
        </div> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="background_tasks"><a class="anchor" href="/manual.html#background_tasks"></a>5.5.6. Фоновые задачи</h4> 
       <div class="manual-live-demo-container"> 
        <a href="https://demo.cuba-platform.com/sampler/open?screen=normal-progressbar" class="live-demo-btn" target="_blank">ДЕМОНСТРАЦИЯ</a> 
       </div> 
       <div class="paragraph"> 
        <p>Механизм фоновых задач предназначен для асинхронного выполнения длительных операций на клиентском уровне без заморозки пользовательского интерфейса.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Использование фоновых задач:</p> 
       </div> 
       <div class="olist arabic"> 
        <ol class="arabic"> 
         <li> <p>Задача описывается как наследник абстрактного класса <code>BackgroundTask</code>. В конструктор задачи необходимо передать ссылку на контроллер экрана, с которым будет связана задача, и значение таймаута ее выполнения.</p> 
          <div class="paragraph"> 
           <p>Если экран указан, то при его закрытии пользователем активная задача будет прервана. Кроме того, задача будет автоматически прервана по истечении указанного таймаута.</p> 
          </div> 
          <div class="paragraph"> 
           <p>Собственно действия, выполняемые задачей, реализуются в методе <code>run()</code>.</p> 
          </div> </li> 
         <li> <p>Создается объект управления задачей − <code>BackgroundTaskHandler</code>. Для этого экземпляр задачи необходимо передать методу <code>handle()</code> бина <code>BackgroundWorker</code>. Ссылку на <code>BackgroundWorker</code> можно получить инжекцией в <a href="/manual.html#screen_controller">контроллер экрана</a>, либо статическим методом класса <code>AppBeans</code>.</p> </li> 
         <li> <p>Выполняется запуск задачи.</p> </li> 
        </ol> 
       </div> 
       <div class="paragraph"> 
        <p>Пример:</p> 
       </div> 
       <div class="listingblock"> 
        <div class="content"> 
         <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Inject</span>
<span class="directive">protected</span> BackgroundWorker backgroundWorker;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    <span class="comment">// Create task with 10 sec timeout and this screen as owner</span>
    BackgroundTask&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Void</span>&gt; task = <span class="keyword">new</span> BackgroundTask&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Void</span>&gt;(<span class="integer">10</span>, <span class="local-variable">this</span>) {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Void</span> run(TaskLifeCycle&lt;<span class="predefined-type">Integer</span>&gt; taskLifeCycle) <span class="directive">throws</span> <span class="exception">Exception</span> {
            <span class="comment">// Do something in background thread</span>
            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; <span class="integer">5</span>; i++) {
                <span class="predefined-type">TimeUnit</span>.SECONDS.sleep(<span class="integer">1</span>); <span class="comment">// time consuming computations</span>
                taskLifeCycle.publish(i);  <span class="comment">// publish current progress to show it in progress() method</span>
            }
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> canceled() {
            <span class="comment">// Do something in UI thread if the task is canceled</span>
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> done(<span class="predefined-type">Void</span> result) {
            <span class="comment">// Do something in UI thread when the task is done</span>
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> progress(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; changes) {
            <span class="comment">// Show current progress in UI thread</span>
        }
    };
    <span class="comment">// Get task handler object and run the task</span>
    BackgroundTaskHandler taskHandler = backgroundWorker.handle(task);
    taskHandler.execute();
}</code></pre> 
        </div> 
       </div> 
       <div class="paragraph"> 
        <p>Подробная информация о назначении методов приведена в JavaDocs классов <code>BackgroundTask</code>, <code>TaskLifeCycle</code>, <code>BackgroundTaskHandler</code>.</p> 
       </div> 
       <div class="paragraph"> 
        <p>Ниже приведены моменты, на которые следует обратить внимание:</p> 
       </div> 
       <div class="ulist"> 
        <ul> 
         <li> <p><code>BackgroundTask&lt;T, V&gt;</code> − параметризованный класс:</p> 
          <div class="ulist"> 
           <ul> 
            <li> <p><code>T</code> − тип объектов, показывающих прогресс задачи. Объекты этого типа передаются в метод <code>progress()</code> задачи при вызове <code>TaskLifeCycle.publish()</code> в рабочем потоке.</p> </li> 
            <li> <p><code>V</code> − тип результата задачи, он передается в метод <code>done()</code>. Его также можно получить вызовом метода <code>BackgroundTaskHandler.getResult()</code>, что приведет к ожиданию завершения задачи.</p> </li> 
           </ul> 
          </div> </li> 
         <li> <p>Метод <code>canceled()</code> вызывается только в случае управляемой отмены задачи, то есть при вызове <code>cancel()</code> у <code>TaskHandler</code>.</p> </li> 
         <li> <p>Метод <code>handleTimeoutException()</code> вызывается при истечении таймаута задачи. Если окно, в котором выполняется задача, закрывается, то задача останавливается без оповещения.</p> </li> 
         <li> <p>Метод <code>run()</code> задачи должен поддерживать возможность прерывания извне. Для этого в долгих процессах желательно периодически проверять флаг <code>TaskLifeCycle.isInterrupted()</code>, и соответственно завершать выполнение. Кроме того, нельзя тихо проглатывать исключение <code>InterruptedException</code> (или вообще все исключения). Вместо этого нужно либо вообще не перехватывать его, либо выполнять корректный выход из метода.</p> </li> 
         <li> <p>Объекты <code>BackgroundTask</code> не имеют состояния. Если при реализации конкретного класса задачи не заводить полей для хранения промежуточных данных, то можно запускать несколько параллельно работающих процессов, используя единственный экземпляр задачи.</p> </li> 
         <li> <p>Объект <code>BackgroundHandler</code> можно запускать (т.е. вызывать его метод <code>execute()</code>) всего один раз. Если требуется частый перезапуск задачи, то используйте класс <code>BackgroundTaskWrapper</code>.</p> </li> 
         <li> <p>Для показа пользователю модального окна с прогрессом и кнопкой <strong>Отмена</strong> используйте классы <code>BackgroundWorkWindow</code> или <code>BackgroundWorkProgressWindow</code> с набором статических методов.Для окна можно задать режим отображения прогресса и разрешить или запретить отмену фоновой задачи.</p> </li> 
         <li> <p>Если внутри потока задачи необходимо использовать некоторые значения визуальных компонентов, то нужно реализовать их получение в методе <code>getParams()</code>, который выполняется в потоке UI один раз при запуске задачи. В методе run() эти параметры будут доступны через метод <code>getParams()</code> объекта <code>TaskLifeCycle</code>.</p> </li> 
         <li> <p>При возникновении исключительных ситуаций в потоке UI вызывается метод <code>BackgroundTask.handleException()</code>, в котором можно отобразить ошибку.</p> </li> 
         <li> <p>На выполнение фоновых задач влияют свойства приложения <a href="/manual.html#cuba.backgroundWorker.maxActiveTasksCount">cuba.backgroundWorker.maxActiveTasksCount</a> и <a href="/manual.html#cuba.backgroundWorker.timeoutCheckInterval">cuba.backgroundWorker.timeoutCheckInterval</a>.</p> </li> 
        </ul> 
       </div> 
       <div class="admonitionblock warning"> 
        <table> 
         <tbody>
          <tr> 
           <td class="icon"> 
            <div class="title">
             Warning
            </div> </td> 
           <td class="content"> 
            <div class="paragraph"> 
             <p>В блоке Web Client фоновые задачи используют технологию HTTP push, предоставляемую фреймворком Vaadin. См. <a href="https://vaadin.com/wiki/-/wiki/Main/Working+around+push+issues" class="bare" target="_blank">https://vaadin.com/wiki/-/wiki/Main/Working+around+push+issues</a> для получения информации о настройке веб-серверов для использования данной технологии.</p> 
            </div> </td> 
          </tr> 
         </tbody>
        </table> 
       </div> 
       <div class="admonitionblock tip"> 
        <table> 
         <tbody>
          <tr> 
           <td class="icon"> 
            <div class="title">
             Tip
            </div> </td> 
           <td class="content"> 
            <div class="paragraph"> 
             <p>Если вы не используете фоновую задачу, но хотите изменять состояние UI-компонентов из не-UI потока, воспользуйтесь методами интерфейса <code>UIAccessor</code>. Получите ссылку на интерфейс <code>UIAccessor</code> методом <code>BackgroundWorker.getUIAccessor()</code> в UI-потоке, и после этого вы сможете вызывать его методы <code>access()</code> и <code>accessSynchronously()</code> из фонового потока для безопасного чтения и изменения состояния UI-компонентов.</p> 
            </div> </td> 
          </tr> 
         </tbody>
        </table> 
       </div> 
      </div> 
      <div class="sect3"> 
       <h4 id="gui_themes"><a class="anchor" href="/manual.html#gui_themes"></a>5.5.7. Темы приложения</h4> 
       <div class="paragraph"> 
        <p>Тема служит для управления визуальным представлением приложения.</p> 
       </div> 
       <div class="sect4"> 
        <h5 id="web_theme"><a class="anchor" href="/manual.html#web_theme"></a>5.5.7.1. Тема в веб-приложениях</h5> 
        <div class="paragraph"> 
         <p>Тема веб-приложения состоит из файлов <a href="http://sass-lang.com/" target="_blank">SCSS</a> и других ресурсов, в том числе файлов изображений.</p> 
        </div> 
        <div class="sect5"> 
         <h6 id="web_theme_usage"><a class="anchor" href="/manual.html#web_theme_usage"></a>5.5.7.1.1. Использование существующих тем</h6> 
         <div class="paragraph"> 
          <p>Платформа включает в себя две готовые темы: Halo и Havana. Приложение будет по умолчанию использовать ту из них, которая указана в свойстве приложения <a href="/manual.html#cuba.web.theme">cuba.web.theme</a>. Пользователь может выбрать другую доступную тему в стандартном экране <strong>Help</strong> → <strong>Settings</strong>. Если вы не хотите, чтобы пользователи имели возможность сами выбирать тему, зарегистрируйте экран <code>settings</code> в файле <a href="/manual.html#screens.xml">web-screens.xml</a> проекта с параметром <code>changeThemeEnabled = false</code>:</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;screen</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">settings</span><span class="delimiter">"</span></span> <span class="attribute-name">template</span>=<span class="string"><span class="delimiter">"</span><span class="content">/com/haulmont/cuba/web/app/ui/core/settings/settings-window.xml</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">changeThemeEnabled</span><span class="delimiter">"</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">false</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/screen&gt;</span></code></pre> 
          </div> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="web_theme_extension"><a class="anchor" href="/manual.html#web_theme_extension"></a>5.5.7.1.2. Расширение существующей темы</h6> 
         <div class="paragraph"> 
          <p>Существующая в платформе тема может быть изменена в проекте приложения. В измененной теме можно сделать следующее:</p> 
         </div> 
         <div class="ulist"> 
          <ul> 
           <li> <p>Изменить изображения для фирменного стиля.</p> </li> 
           <li> <p>Добавить изображения для использования в визуальных компонентах.</p> </li> 
           <li> <p>Создать новые стили и использовать их в атрибутах <a href="/manual.html#gui_attr_stylename">stylename</a> визуальных компонентов. Для этого требуется знание CSS.</p> </li> 
           <li> <p>Изменить существующие в платформе стили компонентов.</p> </li> 
           <li> <p>Изменить общие параметры, такие как цвет фона, отступы, промежутки и т.д.</p> </li> 
          </ul> 
         </div> 
         <div class="paragraph"> 
          <p>Тема описывается в файлах <a href="http://sass-lang.com/" target="_blank">SCSS</a>. Для изменения (расширения) темы в проекте необходимо создать специальную файловую структуру в модуле <strong>web</strong>. Это удобно сделать с помощью <strong>CUBA Studio</strong>: откройте секцию <strong>Project properties</strong> и нажмите ссылку <strong>Create theme extension</strong>. В диалоговом окне выберите тему, которую вы хотите расширить. В результате в проекте будет создана следующая структура каталогов (для расширения темы Halo):</p> 
         </div> 
         <div class="listingblock"> 
          <div class="content"> 
           <pre class="CodeRay highlight"><code data-lang="plain">themes/
  halo/
    branding/
        app-icon-login.png
        app-icon-menu.png
    com.company.application/
        app-component.scss
        halo-ext.scss
        halo-ext-defaults.scss
    favicon.ico
    styles.scss</code></pre> 
          </div> 
         </div> 
         <div class="paragraph"> 
          <p>Кроме того, скрипт сборки <a href="/manual.html#build.gradle">build.gradle</a> будет дополнен задачей <code>buildScssThemes</code>, автоматически запускаемой при сборке модуля <strong>web</strong>. Опциональная задача <a href="/manual.html#build.gradle_deployThemes">deployThemes</a> может быть использована для быстрого применения изменений в темах на работающем приложении.</p> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Если ваше приложение включает в себя <a href="/manual.html#app_components">компонент</a> с расширением темы и вы хотите применить это расширение ко всему приложению, в этом случае необходимо создать расширение темы и для базового проекта. Подробнее о наследовании тем смотрите в разделе <a href="/manual.html#web_theme_inheritance">Наследование тем из компонентов приложения</a>.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
         <div id="web_theme_extension_branding" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Изменение фирменного стиля
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Можно настроить некоторые параметры фирменного стиля (branding): пиктограммы и заголовки окна логина и главного окна, пиктограмму вебсайта <code>favicon.ico</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Для использования собственных изображений, замените соответствующие файлы в каталоге <code>modules/web/themes/halo/branding</code>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Чтобы задать заголовки главного окна, окна логина и текст приглашения окна логина, в CUBA Studio откройте <strong>Project properties</strong> → <strong>Edit</strong> и нажмите кнопку <strong>Branding</strong> внизу страницы. Используйте соответствующие ссылки для задания заголовков окон и текста приглашения окна логина.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Данные параметры сохраняются в <a href="/manual.html#main_message_pack">главном пакете сообщений</a> модуля <strong>web</strong> (то есть в файле <code>modules/web/&lt;root_package&gt;/web/messages.properties</code> и его вариантах для разных локалей). Использование пакетов сообщений дает возможность использовать разные файлы изображений для разных локалей пользователей. Пример содержимого файла <code>messages.properties</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="properties">application.caption = MyApp
application.logoImage = branding/myapp-menu.png

loginWindow.caption = MyApp Login
loginWindow.welcomeLabel = Welcome to MyApp!
loginWindow.logoImage = branding/myapp-login.png</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Путь к <code>favicon.ico</code> указывать не нужно, он должен обязательно находится в корне каталога с именем темы.</p> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="web_theme_extension_fonts" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Добавление шрифтов
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>В приложение можно добавить собственные шрифты. Для добавления семейства шрифтов импортируйте его в первой строке файла <code>styles.scss</code>, например:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="properties">@import url(http://fonts.googleapis.com/css?family=Roboto);</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="web_theme_extension_icons" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Добавление изображений
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>В расширенную тему можно также добавить файлы изображений для использования в свойствах <a href="/manual.html#gui_attr_icon">icon</a> <a href="/manual.html#gui_Action">действий</a> и визуальных компонентов, например <a href="/manual.html#gui_Button">Button</a>.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Например, чтобы добавить расширение темы Halo пиктограмму, достаточно в описанный выше каталог <code>modules/web/themes/halo</code> добавить файл изображения (желательно в некоторый подкаталог):</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="plain">themes/
  halo/
    images/
      address-book.png</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>После этого можно использовать эту пиктограмму, указывая в свойстве <a href="/manual.html#gui_attr_icon">icon</a> путь к ней относительно каталога темы:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">adresses</span><span class="delimiter">"</span></span>
        <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">images/address-book.png</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Вместо файлов изображений для пиктограмм можно использовать элементы шрифта <a href="http://fortawesome.github.io/Font-Awesome" target="_blank">Font Awesome</a>. Для этого достаточно указать в свойстве <code>icon</code> имя нужной константы перечисления <code>com.vaadin.server.FontAwesome</code> с префиксом <code>font-icon:</code>, например:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;action</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">adresses</span><span class="delimiter">"</span></span>
        <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">font-icon:BOOK</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
           <dt class="hdlist1">
            Добавление изображений из других библиотек шрифтов
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Для более тонкой настройки расширенной темы можно создать изображения, встроенные в шрифты, либо использовать готовые внешние библиотеки изображений.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Создайте в модуле <strong>web</strong> класс <code>enum</code>, реализующий интерфейс <code>com.vaadin.server.FontIcon</code>, в который поместите новые изображения:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.vaadin.server.FontIcon</span>;
<span class="keyword">import</span> <span class="include">com.vaadin.server.GenericFontIcon</span>;

<span class="directive">public</span> <span class="type">enum</span> IcoMoon <span class="directive">implements</span> FontIcon {

    HEADPHONES(<span class="hex">0XE900</span>),
    SPINNER(<span class="hex">0XE905</span>);

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> FONT_FAMILY = <span class="string"><span class="delimiter">"</span><span class="content">IcoMoon</span><span class="delimiter">"</span></span>;
    <span class="directive">private</span> <span class="type">int</span> codepoint;

    IcoMoon(<span class="type">int</span> codepoint) {
        <span class="local-variable">this</span>.codepoint = codepoint;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getFontFamily() {
        <span class="keyword">return</span> FONT_FAMILY;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getCodepoint() {
        <span class="keyword">return</span> codepoint;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getHtml() {
        <span class="keyword">return</span> GenericFontIcon.getHtml(FONT_FAMILY, codepoint);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getMIMEType() {
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">UnsupportedOperationException</span>(FontIcon.class.getSimpleName()
                + <span class="string"><span class="delimiter">"</span><span class="content"> should not be used where a MIME type is needed.</span><span class="delimiter">"</span></span>);
    }

    <span class="directive">public</span> <span class="directive">static</span> IcoMoon fromCodepoint(<span class="directive">final</span> <span class="type">int</span> codepoint) {
        <span class="keyword">for</span> (IcoMoon f : values()) {
            <span class="keyword">if</span> (f.getCodepoint() == codepoint) {
                <span class="keyword">return</span> f;
            }
        }
        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">"</span><span class="content">Codepoint </span><span class="delimiter">"</span></span> + codepoint
                + <span class="string"><span class="delimiter">"</span><span class="content"> not found in IcoMoon</span><span class="delimiter">"</span></span>);
    }
}</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Добавьте новые стили и файлы шрифта в расширение темы. Рекомендуется создать отдельную папку <code>fonts</code> в главном каталоге расширения темы, например, <code>modules/web/themes/halo/com.company.demo/fonts</code>. Поместите в неё стили и файлы шрифтов в своих собственных подпапках, например, <code>fonts/icomoon</code>. Файлы шрифта включают в себя набор следующих расширений: <code>.eot</code>, <code>.svg</code>, <code>.ttf</code>, <code>.woff</code>. Использованный в этом примере набор шрифтов <code>icomoon</code> из открытой библиотеки представлен в виде 4 файлов: <code>icomoon.eot</code>, <code>icomoon.svg</code>, <code>icomoon.ttf</code>, <code>icomoon.woff</code>, которые используются совместно.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Создайте файл стилей, в который включите <code>@font-face</code> и CSS класс со стилем для изображения. Ниже представлен пример файла <code>icomoon.scss</code>, где имя класса <code>IcoMoon</code> соответствует значению, возвращаемому методом <code>FontIcon#getFontFamily</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@mixin</span> <span class="tag">icomoon-style</span> {
    <span class="comment">/* use !important to prevent issues with browser extensions that change fonts */</span>
    <span class="key">font-family</span>: <span class="string"><span class="delimiter">'</span><span class="content">icomoon</span><span class="delimiter">'</span></span> <span class="important">!important</span>;
    <span class="key">speak</span>: <span class="value">none</span>;
    <span class="key">font-style</span>: <span class="value">normal</span>;
    <span class="key">font-weight</span>: <span class="value">normal</span>;
    <span class="key">font-variant</span>: <span class="value">normal</span>;
    <span class="key">text-transform</span>: <span class="value">none</span>;
    <span class="key">line-height</span>: <span class="float">1</span>;

    <span class="comment">/* Better Font Rendering =========== */</span>
    <span class="key">-webkit-font-smoothing</span>: <span class="value">antialiased</span>;
    <span class="key">-moz-osx-font-smoothing</span>: <span class="value">grayscale</span>;
}

<span class="directive">@font-face</span> {
    <span class="key">font-family</span>: <span class="string"><span class="delimiter">'</span><span class="content">icomoon</span><span class="delimiter">'</span></span>;
    <span class="key">src</span>:<span class="function"><span class="delimiter">url(</span><span class="content">'icomoon.eot?hwgbks'</span><span class="delimiter">)</span></span>;
    <span class="key">src</span>:<span class="function"><span class="delimiter">url(</span><span class="content">'icomoon.eot?hwgbks#iefix'</span><span class="delimiter">)</span></span> <span class="error">f</span><span class="error">o</span><span class="error">r</span><span class="error">m</span><span class="error">a</span><span class="error">t</span>(<span class="string"><span class="delimiter">'</span><span class="content">embedded-opentype</span><span class="delimiter">'</span></span>),
        <span class="function"><span class="delimiter">url(</span><span class="content">'icomoon.ttf?hwgbks'</span><span class="delimiter">)</span></span> <span class="error">f</span><span class="error">o</span><span class="error">r</span><span class="error">m</span><span class="error">a</span><span class="error">t</span>(<span class="string"><span class="delimiter">'</span><span class="content">truetype</span><span class="delimiter">'</span></span>),
        <span class="function"><span class="delimiter">url(</span><span class="content">'icomoon.woff?hwgbks'</span><span class="delimiter">)</span></span> <span class="error">f</span><span class="error">o</span><span class="error">r</span><span class="error">m</span><span class="error">a</span><span class="error">t</span>(<span class="string"><span class="delimiter">'</span><span class="content">woff</span><span class="delimiter">'</span></span>),
        <span class="function"><span class="delimiter">url(</span><span class="content">'icomoon.svg?hwgbks#icomoon'</span><span class="delimiter">)</span></span> <span class="error">f</span><span class="error">o</span><span class="error">r</span><span class="error">m</span><span class="error">a</span><span class="error">t</span>(<span class="string"><span class="delimiter">'</span><span class="content">svg</span><span class="delimiter">'</span></span>);
    <span class="key">font-weight</span>: <span class="value">normal</span>;
    <span class="key">font-style</span>: <span class="value">normal</span>;
}

<span class="class">.IcoMoon</span> {
    <span class="directive">@Include</span> <span class="key">icomoon-style</span>;
}</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Подключите файл стилей шрифта в <code>halo-ext.scss</code> или другой файл расширения данной темы:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">fonts/icomoon/icomoon</span><span class="delimiter">"</span></span>;</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Создайте новый класс <code>App.java</code>, расширяющий <code>DefaultApp</code>, в корневом пакете модуля <strong>web</strong> и зарегистрируйте его в <a href="/manual.html#spring.xml">web-spring.xml</a> в качестве бина <code>cuba_App</code>, чтобы переопределить бин центрального класса инфраструктуры приложения, например:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">cuba_App</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">com.company.sample.web.App</span><span class="delimiter">"</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">"</span><span class="content">prototype</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Зарегистрируйте в <code>App.java</code> новый алиас для изображений:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.haulmont.cuba.web.DefaultApp</span>;
<span class="keyword">import</span> <span class="include">com.haulmont.cuba.web.gui.components.WebComponentsHelper</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">App</span> <span class="directive">extends</span> DefaultApp {
    <span class="directive">static</span> {
        WebComponentsHelper.registerFontIcon(<span class="string"><span class="delimiter">"</span><span class="content">ico-moon-icon</span><span class="delimiter">"</span></span>, IcoMoon.class);
    }
}</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Теперь вы можете использовать изображения по прямой ссылке на класс и элемент <code>enum</code> в XML-дескрипторе экрана:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;button</span> <span class="attribute-name">caption</span>=<span class="string"><span class="delimiter">"</span><span class="content">Headphones</span><span class="delimiter">"</span></span> <span class="attribute-name">icon</span>=<span class="string"><span class="delimiter">"</span><span class="content">ico-moon-icon:HEADPHONES</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>или в контроллере Java:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java">spinnerBtn.setIcon(<span class="string"><span class="delimiter">"</span><span class="content">ico-moon-icon:SPINNER</span><span class="delimiter">"</span></span>);</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>В результате, новые изображения добавились к кнопкам:</p> 
              </div> 
              <div class="imageblock" style="text-align: center"> 
               <div class="content"> 
                <img src="assets/add_icons.png" alt="add icons"> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="web_theme_extension_styles" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Создание новых стилей
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Рассмотрим пример установки желтого цвета фона для поля, отображающего название заказчика.</p> 
              </div> 
              <div class="paragraph"> 
               <p>В XML-дескрипторе экрана определен компонент <a href="/manual.html#gui_FieldGroup">FieldGroup</a>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;fieldGroup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup</span><span class="delimiter">"</span></span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">"</span><span class="content">customerDs</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;field</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">"</span><span class="content">address</span><span class="delimiter">"</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/fieldGroup&gt;</span></code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Элементы <code>field</code> компонента <code>FieldGroup</code> не имеют атрибута <a href="/manual.html#gui_attr_stylename">stylename</a>, поэтому необходимо задать имя стиля в контроллере:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>(<span class="string"><span class="delimiter">"</span><span class="content">fieldGroup.name</span><span class="delimiter">"</span></span>)
<span class="directive">private</span> <span class="predefined-type">TextField</span> nameField;

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params) {
    nameField.setStyleName(<span class="string"><span class="delimiter">"</span><span class="content">name-field</span><span class="delimiter">"</span></span>);
}</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>В файле <code>halo-ext.scss</code> добавьте определение нового стиля в mixin <code>halo-ext</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../halo</span><span class="delimiter">"</span></span>;

<span class="directive">@mixin</span> <span class="tag">halo-ext</span> {
  <span class="directive">@include</span> <span class="key">halo</span>;

  .<span class="key">name-field</span> {
    <span class="key">background-color</span>: <span class="value">lightyellow</span>;
  }
}</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>После пересборки проекта поля будут выглядеть следующим образом:</p> 
              </div> 
              <div class="imageblock" style="text-align: center"> 
               <div class="content"> 
                <img src="assets/gui_themes_fieldgroup_1.png" alt="gui themes fieldgroup 1"> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
           <dt class="hdlist1">
            Изменение существующих стилей компонентов
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Для изменения параметров стиля существующих компонентов необходимо добавить соответствующий код CSS в mixin <code>halo-ext</code> файла <code>halo-ext.scss</code>. Например, для того, чтобы пункты главного меню отображались жирным шрифтом, содержимое файла <code>halo-ext.scss</code> должно быть следующим:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../halo/halo</span><span class="delimiter">"</span></span>;

<span class="directive">@mixin</span> <span class="tag">halo-ext</span> {
  <span class="directive">@include</span> <span class="key">halo</span>;

  .<span class="key">v-menubar-menuitem-caption</span> {
      <span class="key">font-weight</span>: <span class="value">bold</span>;
  }
}</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="web_theme_extension_common" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Изменение общих параметров
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Темы содержат переменные SCSS, которые управляют цветом фона, размерами компонентов, отступами и пр.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Рассмотрим пример расширения темы Halo, так как она основана на теме <a href="https://vaadin.com/valo" target="_blank">Valo</a> фреймворка <strong>Vaadin</strong>, и предоставляет максимальные возможности адаптации.</p> 
              </div> 
              <div class="paragraph"> 
               <p>Файл <code>themes/halo/halo-ext-defaults.scss</code> предназначен для размещения в нем переменных темы. Большинство переменных Halo соответствует описанным в <a href="https://vaadin.com/api/valo" target="_blank">документации по Valo</a>, ниже приведены основные:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="css"><span class="error">$</span><span class="tag">v-background-color</span>: <span class="color">#fafafa</span>;        <span class="comment">/* component background colour */</span>
<span class="error">$</span><span class="tag">v-app-background-color</span>: <span class="color">#e7ebf2</span>;    <span class="comment">/* application background colour */</span>
<span class="error">$</span><span class="tag">v-panel-background-color</span>: <span class="color">#fff</span>;     <span class="comment">/* panel background colour */</span>
<span class="error">$</span><span class="tag">v-focus-color</span>: <span class="color">#3b5998</span>;             <span class="comment">/* focused element colour */</span>
<span class="error">$</span><span class="tag">v-error-indicator-color</span>: <span class="color">#ed473b</span>;   <span class="comment">/* empty required fields colour */</span>

<span class="error">$</span><span class="tag">v-line-height</span>: <span class="float">1.35</span>;                <span class="comment">/* line height */</span>
<span class="error">$</span><span class="tag">v-font-size</span>: <span class="float">14px</span>;                  <span class="comment">/* font size */</span>
<span class="error">$</span><span class="tag">v-font-weight</span>: <span class="float">400</span>;                 <span class="comment">/* font weight */</span>
<span class="error">$</span><span class="tag">v-unit-size</span>: <span class="float">30px</span>;                  <span class="comment">/* base theme size, defines the height for buttons, fields and other elements */</span>

<span class="error">$</span><span class="tag">v-font-size--h1</span>: <span class="float">24px</span>;              <span class="comment">/* h1-style Label size */</span>
<span class="error">$</span><span class="tag">v-font-size--h2</span>: <span class="float">20px</span>;              <span class="comment">/* h2-style Label size */</span>
<span class="error">$</span><span class="tag">v-font-size--h3</span>: <span class="float">16px</span>;              <span class="comment">/* h3-style Label size */</span>

<span class="comment">/* margins for containers */</span>
<span class="error">$</span><span class="tag">v-layout-margin-top</span>: <span class="float">10px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-left</span>: <span class="float">10px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-right</span>: <span class="float">10px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-bottom</span>: <span class="float">10px</span>;

<span class="comment">/* spacing between components in a container (if enabled) */</span>
<span class="error">$</span><span class="tag">v-layout-spacing-vertical</span>: <span class="float">10px</span>;
<span class="error">$</span><span class="tag">v-layout-spacing-horizontal</span>: <span class="float">10px</span>;

<span class="comment">/* basic table dimensions */</span>
<span class="error">$</span><span class="tag">v-table-row-height</span>: <span class="float">30px</span>;
<span class="error">$</span><span class="tag">v-table-header-font-size</span>: <span class="float">13px</span>;
<span class="error">$</span><span class="tag">v-table-cell-padding-horizontal</span>: <span class="float">7px</span>;

<span class="comment">/* input field focus style */</span>
<span class="error">$</span><span class="tag">v-focus-style</span>: <span class="tag">inset</span> <span class="float">0px</span> <span class="float">0px</span> <span class="float">5px</span> <span class="float">1px</span> <span class="color">rgba($v-focus-color, 0.5)</span>;
<span class="comment">/* required fields focus style */</span>
<span class="error">$</span><span class="tag">v-error-focus-style</span>: <span class="tag">inset</span> <span class="float">0px</span> <span class="float">0px</span> <span class="float">5px</span> <span class="float">1px</span> <span class="color">rgba($v-error-indicator-color, 0.5)</span>;

<span class="comment">/* animation for elements is enabled by default */</span>
<span class="error">$</span><span class="tag">v-animations-enabled</span>: <span class="tag">true</span>;
<span class="comment">/* popup window animation is disabled by default */</span>
<span class="error">$</span><span class="tag">v-window-animations-enabled</span>: <span class="tag">false</span>;

<span class="comment">/* inverse header is controlled by cuba.web.useInverseHeader property */</span>
<span class="error">$</span><span class="tag">v-support-inverse-menu</span>: <span class="tag">true</span>;

<span class="comment">/* show "required" indicators for components */</span>
<span class="error">$</span><span class="tag">v-show-required-indicators</span>: <span class="tag">false</span> <span class="error">!</span><span class="tag">default</span>;</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Пример содержимого файла <code>halo-ext-defaults.scss</code> для темы с темным фоном и немного уменьшенными отступами:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="css"><span class="error">$</span><span class="tag">v-background-color</span>: <span class="color">#444D50</span>;

<span class="error">$</span><span class="tag">v-font-size--h1</span>: <span class="float">22px</span>;
<span class="error">$</span><span class="tag">v-font-size--h2</span>: <span class="float">18px</span>;
<span class="error">$</span><span class="tag">v-font-size--h3</span>: <span class="float">16px</span>;

<span class="error">$</span><span class="tag">v-layout-margin-top</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-left</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-right</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-bottom</span>: <span class="float">8px</span>;

<span class="error">$</span><span class="tag">v-layout-spacing-vertical</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-spacing-horizontal</span>: <span class="float">8px</span>;

<span class="error">$</span><span class="tag">v-table-row-height</span>: <span class="float">25px</span>;
<span class="error">$</span><span class="tag">v-table-header-font-size</span>: <span class="float">13px</span>;
<span class="error">$</span><span class="tag">v-table-cell-padding-horizontal</span>: <span class="float">5px</span>;

<span class="error">$</span><span class="tag">v-support-inverse-menu</span>: <span class="tag">false</span>;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
         <div id="web_theme_migration" class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Переход с темы Havana на полнофункциональную Halo
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Тема Halo лучше поддаётся расширению, в ней поддерживаются новые визуальные компоненты, такие как <a href="/manual.html#gui_DataGrid">DataGrid</a> и <a href="/manual.html#gui_SideMenu">SideMenu</a>. Если вы хотите использовать эти компоненты, а также получать обновления библиотеки визуальных компонентов, рекомендуется использовать тему Halo. В то же время, если вам важно сохранить внешний вид темы Havana, вы можете использовать следующие переменные в файле <code>halo-ext-defaults.scss</code>:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="css"><span class="error">$</span><span class="tag">cuba-menubar-background-color</span>: <span class="color">#315379</span>;
<span class="error">$</span><span class="tag">cuba-menubar-border-color</span>: <span class="color">#315379</span>;
<span class="error">$</span><span class="tag">v-table-row-height</span>: <span class="float">25px</span>;
<span class="error">$</span><span class="tag">v-selection-color</span>: <span class="color">rgb(77, 122, 178)</span>;
<span class="error">$</span><span class="tag">v-table-header-font-size</span>: <span class="float">12px</span>;
<span class="error">$</span><span class="tag">v-textfield-border</span>: <span class="float">1px</span> <span class="tag">solid</span> <span class="color">#A5C4E0</span>;

<span class="error">$</span><span class="tag">v-selection-item-selection-color</span>: <span class="color">#4D7AB2</span>;

<span class="error">$</span><span class="tag">v-app-background-color</span>: <span class="color">#E3EAF1</span>;
<span class="error">$</span><span class="tag">v-font-size</span>: <span class="float">12px</span>;
<span class="error">$</span><span class="tag">v-font-weight</span>: <span class="float">400</span>;
<span class="error">$</span><span class="tag">v-unit-size</span>: <span class="float">25px</span>;
<span class="error">$</span><span class="tag">v-border-radius</span>: <span class="float">0px</span>;
<span class="error">$</span><span class="tag">v-border</span>: <span class="float">1px</span> <span class="tag">solid</span> <span class="color">#9BB3D3</span> <span class="error">!</span><span class="tag">default</span>;
<span class="error">$</span><span class="tag">v-font-family</span>: <span class="tag">Verdana</span>,<span class="tag">tahoma</span>,<span class="tag">arial</span>,<span class="tag">geneva</span>,<span class="tag">helvetica</span>,<span class="tag">sans-serif</span>,<span class="string"><span class="delimiter">"</span><span class="content">Trebuchet MS</span><span class="delimiter">"</span></span>;

<span class="error">$</span><span class="tag">v-panel-background-color</span>: <span class="color">#ffffff</span>;
<span class="error">$</span><span class="tag">v-background-color</span>: <span class="color">#ffffff</span>;

<span class="error">$</span><span class="tag">cuba-menubar-menuitem-text-color</span>: <span class="color">#ffffff</span>;

<span class="error">$</span><span class="tag">cuba-app-menubar-padding-top</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">cuba-app-menubar-padding-bottom</span>: <span class="float">8px</span>;

<span class="error">$</span><span class="tag">cuba-menubar-text-color</span>: <span class="color">#ffffff</span>;
<span class="error">$</span><span class="tag">cuba-menubar-submenu-padding</span>: <span class="float">1px</span>;</code></pre> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
           <dt class="hdlist1">
            Изменение заголовка приложения
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Тема Halo поддерживает свойство приложения <a href="/manual.html#cuba.web.useInverseHeader">cuba.web.useInverseHeader</a>, управляющее цветом заголовка приложения. По умолчанию это свойство установлено в <code>true</code>, что задает темный (инверсный) заголовок. В проекте можно не изменяя темы сделать заголовок светлым, установив данное свойство в <code>false</code>.</p> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="web_theme_creation"><a class="anchor" href="/manual.html#web_theme_creation"></a>5.5.7.1.3. Создание новой темы</h6> 
         <div class="paragraph"> 
          <p>В проекте можно создать одну или несколько новых тем и дать возможность пользователям выбирать среди них подходящую. Создание новой темы позволяет также переопределять переменные файла <code>*-theme.properties</code>, задающие некоторые параметры, требуемые на стороне сервера:</p> 
         </div> 
         <div class="openblock"> 
          <div class="content"> 
           <div class="ulist"> 
            <ul> 
             <li> <p>Размеры диалоговых окон по умолчанию.</p> </li> 
             <li> <p>Ширина полей ввода по умолчанию.</p> </li> 
             <li> <p>Размеры некоторых компонентов (<a href="/manual.html#gui_Filter">Filter</a>, <a href="/manual.html#gui_FileMultiUploadField">FileMultiUploadField</a>).</p> </li> 
             <li> <p>Соответствие между именами пиктограмм и именами констант перечисления <code>com.vaadin.server.FontAwesome</code> для использования элементов шрифта <strong>Font Awesome</strong> в стандартных действиях и экранах платформы при включенном свойстве <a href="/manual.html#cuba.web.useFontIcons">cuba.web.useFontIcons</a>.</p> </li> 
            </ul> 
           </div> 
          </div> 
         </div> 
         <div class="dlist"> 
          <dl> 
           <dt class="hdlist1">
            Создание новой темы
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>Рассмотрим пример создания на основе Halo новой темы Facebook, напоминающей интерфейс сайта известной социальной сети.</p> 
              </div> 
              <div class="olist arabic"> 
               <ol class="arabic"> 
                <li> <p>В <strong>CUBA Studio</strong> откройте секцию <strong>Project Properties</strong> и нажмите ссылку <strong>Create theme extension</strong>. В диалоговом окне выберите <code>halo</code> и нажмите <strong>Create</strong>. В проекте будет создано расширение темы Halo, как описано в предыдущем разделе.</p> </li> 
                <li> <p>Переименуйте созданный в модуле <strong>web</strong> каталог <code>themes/halo</code> в <code>themes/facebook</code>, аналогично замените префикс <code>halo</code> на <code>facebook</code> в именах файлов.</p> </li> 
                <li> <p>Скопируйте в <code>themes/facebook</code> файл <code>halo-ext.scss</code> и переименуйте его в <code>facebook.scss</code>, также скопируйте и переименуйте <code>halo-ext-defaults.scss</code> в <code>facebook-defaults.scss</code>.</p> </li> 
                <li> <p>Создайте новый каталог <code>com.haulmont.cuba</code> в <code>themes/facebook</code> и скопируйте в него файл <code>app-component.scss</code>. В итоге должна получиться следующая структура:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="plain">themes/
    facebook/
        branding/
            app-icon-login.png
            app-icon-menu.png
        com.company.application/
            app-component.scss
            facebook-ext.scss                   // theme SCSS
            facebook-ext-defaults.scss          // theme customizations
        com.haulmont.cuba/
            app-component.scss                  // cuba app-component include
        facebook.scss                           // main theme file
        facebook-defaults.scss                  // main theme variables
        favicon.ico
        styles.scss                             // entry point of SCSS build procedure</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>Отредактируйте файл <code>styles.scss</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">facebook-defaults</span><span class="delimiter">"</span></span>;
<span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">facebook</span><span class="delimiter">"</span></span>;

<span class="class">.facebook</span> {
  <span class="directive">@include</span> <span class="key">facebook</span>;
}</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>Отредактируйте файл <code>facebook.scss</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../halo/halo</span><span class="delimiter">"</span></span>;

<span class="directive">@mixin</span> <span class="tag">facebook</span> {
  <span class="directive">@include</span> <span class="key">halo</span>;
}</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>Отредактируйте файл <code>app-component.scss</code> из каталога <code>com.haulmont.cuba</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../facebook</span><span class="delimiter">"</span></span>;

<span class="directive">@mixin</span> <span class="tag">com_haulmont_cuba</span> {
  <span class="directive">@include</span> <span class="key">facebook</span>;
}</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>Скопируйте в файл <code>facebook-defaults.scss</code> следующие переменные:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../halo/halo-defaults</span><span class="delimiter">"</span></span>;

<span class="error">$</span><span class="tag">v-background-color</span>: <span class="color">#fafafa</span>;
<span class="error">$</span><span class="tag">v-app-background-color</span>: <span class="color">#e7ebf2</span>;
<span class="error">$</span><span class="tag">v-panel-background-color</span>: <span class="color">#fff</span>;
<span class="error">$</span><span class="tag">v-focus-color</span>: <span class="color">#3b5998</span>;

<span class="error">$</span><span class="tag">v-border-radius</span>: <span class="float">0</span>;
<span class="error">$</span><span class="tag">v-textfield-border-radius</span>: <span class="float">0</span>;

<span class="error">$</span><span class="tag">v-font-family</span>: <span class="tag">Helvetica</span>, <span class="tag">Arial</span>, <span class="string"><span class="delimiter">'</span><span class="content">lucida grande</span><span class="delimiter">'</span></span>, <span class="tag">tahoma</span>, <span class="tag">verdana</span>, <span class="tag">arial</span>, <span class="tag">sans-serif</span>;
<span class="error">$</span><span class="tag">v-font-size</span>: <span class="float">14px</span>;
<span class="error">$</span><span class="tag">v-font-color</span>: <span class="color">#37404E</span>;
<span class="error">$</span><span class="tag">v-font-weight</span>: <span class="float">400</span>;

<span class="error">$</span><span class="tag">v-link-text-decoration</span>: <span class="tag">none</span>;
<span class="error">$</span><span class="tag">v-shadow</span>: <span class="float">0</span> <span class="float">1px</span> <span class="float">0</span> (<span class="tag">v-shade</span> <span class="float">0.2</span>);
<span class="error">$</span><span class="tag">v-bevel</span>: <span class="tag">inset</span> <span class="float">0</span> <span class="float">1px</span> <span class="float">0</span> <span class="tag">v-tint</span>;
<span class="error">$</span><span class="tag">v-unit-size</span>: <span class="float">30px</span>;
<span class="error">$</span><span class="tag">v-gradient</span>: <span class="tag">v-linear</span> <span class="float">12%</span>;
<span class="error">$</span><span class="tag">v-overlay-shadow</span>: <span class="float">0</span> <span class="float">3px</span> <span class="float">8px</span> <span class="tag">v-shade</span>, <span class="float">0</span> <span class="float">0</span> <span class="float">0</span> <span class="float">1px</span> (<span class="tag">v-shade</span> <span class="float">0.7</span>);
<span class="error">$</span><span class="tag">v-shadow-opacity</span>: <span class="float">20%</span>;
<span class="error">$</span><span class="tag">v-selection-overlay-padding-horizontal</span>: <span class="float">0</span>;
<span class="error">$</span><span class="tag">v-selection-overlay-padding-vertical</span>: <span class="float">6px</span>;
<span class="error">$</span><span class="tag">v-selection-item-border-radius</span>: <span class="float">0</span>;

<span class="error">$</span><span class="tag">v-line-height</span>: <span class="float">1.35</span>;
<span class="error">$</span><span class="tag">v-font-size</span>: <span class="float">14px</span>;
<span class="error">$</span><span class="tag">v-font-weight</span>: <span class="float">400</span>;
<span class="error">$</span><span class="tag">v-unit-size</span>: <span class="float">25px</span>;

<span class="error">$</span><span class="tag">v-font-size--h1</span>: <span class="float">22px</span>;
<span class="error">$</span><span class="tag">v-font-size--h2</span>: <span class="float">18px</span>;
<span class="error">$</span><span class="tag">v-font-size--h3</span>: <span class="float">16px</span>;

<span class="error">$</span><span class="tag">v-layout-margin-top</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-left</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-right</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-bottom</span>: <span class="float">8px</span>;

<span class="error">$</span><span class="tag">v-layout-spacing-vertical</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-spacing-horizontal</span>: <span class="float">8px</span>;

<span class="error">$</span><span class="tag">v-table-row-height</span>: <span class="float">25px</span>;
<span class="error">$</span><span class="tag">v-table-header-font-size</span>: <span class="float">13px</span>;
<span class="error">$</span><span class="tag">v-table-cell-padding-horizontal</span>: <span class="float">5px</span>;

<span class="error">$</span><span class="tag">v-focus-style</span>: <span class="tag">inset</span> <span class="float">0px</span> <span class="float">0px</span> <span class="float">1px</span> <span class="float">1px</span> <span class="color">rgba($v-focus-color, 0.5)</span>;
<span class="error">$</span><span class="tag">v-error-focus-style</span>: <span class="tag">inset</span> <span class="float">0px</span> <span class="float">0px</span> <span class="float">1px</span> <span class="float">1px</span> <span class="color">rgba($v-error-indicator-color, 0.5)</span>;</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>Файлы в каталоге <code>com.company.application</code> используются, чтобы модифицировать тему для конкретного проекта. В данном примере мы не будет добавлять к теме <code>facebook</code> дополнительных модификаций, поэтому удалите содержимое этих файлов и оставьте их пустыми.</p> </li> 
                <li> <p>Создайте в подкаталоге <code>src</code> модуля <strong>web</strong> файл <code>facebook-theme.properties</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="properties">modules/
  web/
    src/
      com.company.application/
        web/
          facebook-theme.properties</code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>и поместите в него следующую строку:</p> 
                 </div> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="properties">@include=halo-theme.properties</code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>При необходимости в этом файле можно переопределять server-side переменные темы, заданные в файле <code>halo-theme.properties</code> платформы.</p> 
                 </div> </li> 
                <li> <p>В файл <code>web-app.properties</code> добавьте следующие свойства:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="properties">cuba.web.theme = facebook
cuba.themeConfig = havana-theme.properties halo-theme.properties facebook-theme.properties</code></pre> 
                  </div> 
                 </div> 
                 <div class="paragraph"> 
                  <p>Свойство приложения <a href="/manual.html#cuba.themeConfig">cuba.themeConfig</a> определяет, какие темы будут доступны в меню приложения <strong>Settings</strong>.</p> 
                 </div> </li> 
                <li> <p>Пересоберите приложение и запустите сервер. Теперь при первом входе пользователь увидит приложение в теме Facebook, и в окне <strong>Help</strong> → <strong>Settings</strong> сможет выбирать между темами <strong>Facebook</strong>, <strong>Halo</strong> и <strong>Havana</strong>.</p> </li> 
               </ol> 
              </div> 
             </div> 
            </div> 
           </dd> 
           <dt class="hdlist1">
            Изменение server-side параметров темы
           </dt> 
           <dd> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="paragraph"> 
               <p>В теме Halo по умолчанию (при включенном свойстве приложения <a href="/manual.html#cuba.web.useFontIcons">cuba.web.useFontIcons</a>) пиктограммы стандартных действий и экранов платформы загружаются из шрифта <strong>Font Awesome</strong>. В этом случае можно заменить стандартную пиктограмму, задав в файле <code>&lt;your_theme&gt;-theme.properties</code> нужное соответствие между именем пиктограммы и именем элемента шрифта. Например, чтобы использовать значок "плюс" для действия <code>create</code> в новой теме Facebook, содержимое файла <code>web/src/facebook-theme.properties</code> должно быть следующим:</p> 
              </div> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="properties">@include=halo-theme.properties

cuba.web.icons.create.png = PLUS</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Фрагмент стандартного экрана списка пользователей в теме Facebook и с измененным значком действия <code>create</code>:</p> 
              </div> 
              <div class="imageblock" style="text-align: center"> 
               <div class="content"> 
                <img src="assets/gui_theme_facebook_1.png" alt="gui theme facebook 1"> 
               </div> 
              </div> 
             </div> 
            </div> 
           </dd> 
          </dl> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="web_theme_inheritance"><a class="anchor" href="/manual.html#web_theme_inheritance"></a>5.5.7.1.4. Наследование тем из компонентов приложения</h6> 
         <div class="paragraph"> 
          <p>Если ваш проект включает в себя <a href="/manual.html#app_components">компонент</a> с новой темой, вы можете настроить использование этой темы во всём проекте.</p> 
         </div> 
         <div class="olist arabic"> 
          <ol class="arabic"> 
           <li> <p>В этом примере мы вновь используем тему <code>facebook</code> из предыдущего примера. Создайте тему <code>facebook</code> для компонента приложения, следуя инструкции из раздела <a href="/manual.html#web_theme_creation">Создание новой темы</a>.</p> </li> 
           <li> <p>Установите компонент, используя меню Studio, как описано в разделе <a href="/manual.html#app_components_sample">Использование компонентов приложения</a>.</p> </li> 
           <li> <p>Расширьте тему <code>halo</code> в проекте, в котором используется ваш компонент.</p> </li> 
           <li> <p>В IDE переименуйте все вхождения <code>halo</code> в каталоге <code>themes</code>, включая имена файлов, в <code>facebook</code>. В итоге у вас должна получиться следующая структура:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="plain">themes/
    facebook/
        branding/
            app-icon-login.png
            app-icon-menu.png
        com.company.application/
            app-component.scss
            facebook-ext.scss
            facebook-ext-defaults.scss
        favicon.ico
        styles.scss</code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Файл <code>app-component.scss</code> группирует модификации темы в конкретном компоненте приложения. В процессе сборки SCSS плагин Gradle автоматически находит компоненты и включает их в генерируемый файл <code>modules/web/build/themes-tmp/VAADIN/themes/{theme-name}/app-components.scss</code>.</p> 
            <div class="paragraph"> 
             <p>По умолчанию переменные темы из <code>{theme-name}-ext-defaults</code> не наследуются в проект. Чтобы изменить это поведение, вручную добавьте включение в файл <code>app-component.scss</code>:</p> 
            </div> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="scss">@import "facebook-ext";
@import "facebook-ext-defaults";

@mixin com_company_application {
  @include com_company_application-facebook-ext;
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>На этом этапе тема <code>facebook</code> уже импортирована в проект из компонента приложения.</p> 
            </div> </li> 
           <li> <p>Вы можете использовать файлы <code>facebook-ext.scss</code> и <code>facebook-ext-defaults.scss</code> из пакета <code>com.company.application</code>, чтобы переопределить переменные темы компонента и модифицировать её для конкретного проекта. В данном примере мы будем использовать тему <code>facebook</code> как она есть, поэтому оставим эти файлы пустыми.</p> </li> 
           <li> <p>Добавьте свойства приложения в файл <code>web-app.properties</code>, чтобы сделать тему <code>facebook</code> доступной в меню приложения <strong>Settings</strong>. Используйте относительный путь для ссылки на файл <code>facebook-theme.properties</code>.</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="plain">cuba.web.theme = facebook
cuba.themeConfig = havana-theme.properties halo-theme.properties com/company/{app-component-name}/facebook-theme.properties</code></pre> 
             </div> 
            </div> </li> 
          </ol> 
         </div> 
         <div class="admonitionblock tip"> 
          <table> 
           <tbody>
            <tr> 
             <td class="icon"> 
              <div class="title">
               Tip
              </div> </td> 
             <td class="content"> 
              <div class="paragraph"> 
               <p>Если при сборке тем возникли проблемы, проверьте каталог <code>modules/web/build/themes-tmp</code>. В нём находятся генерируемые файлы и включения <code>app-component.scss</code>, которые можно использовать для поиска проблем компиляции SCSS.</p> 
              </div> </td> 
            </tr> 
           </tbody>
          </table> 
         </div> 
        </div> 
        <div class="sect5"> 
         <h6 id="web_theme_reusable"><a class="anchor" href="/manual.html#web_theme_reusable"></a>5.5.7.1.5. Повторное использование тем</h6> 
         <div class="paragraph"> 
          <p>Любую тему можно создать и использовать отдельно от <a href="/manual.html#web_theme_inheritance">компонента приложения</a>. Для создания темы, которую можно использовать повторно, необходимо создать с нуля отдельный Java-проект и собрать его в единый JAR-файл. Ниже приведена инструкция, как подготовить тему <code>facebook</code> из предыдущих примеров для многократного использования.</p> 
         </div> 
         <div class="olist arabic"> 
          <ol class="arabic"> 
           <li> <p>Создайте в IDE новый Java-проект, содержащий файлы SCSS и свойства темы, со следующей структурой:</p> 
            <div class="openblock"> 
             <div class="content"> 
              <div class="listingblock"> 
               <div class="content"> 
                <pre class="CodeRay highlight"><code data-lang="plain">halo-facebook/
    src/                                            //sources root
        halo-facebook/
            com.haulmont.cuba/
                app-component.scss
            halo-facebook.scss
            halo-facebook-defaults.scss
            halo-facebook-theme.properties
            styles.scss</code></pre> 
               </div> 
              </div> 
              <div class="paragraph"> 
               <p>Этот проект также доступен на <a href="https://github.com/cuba-labs/halo-facebook" target="_blank">GitHub</a>.</p> 
              </div> 
              <div class="ulist"> 
               <ul> 
                <li> <p>содержание скрипта <code>build.gradle</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="groovy">allprojects {
    group = <span class="string"><span class="delimiter">'</span><span class="content">com.haulmont.theme</span><span class="delimiter">'</span></span>
    version = <span class="string"><span class="delimiter">'</span><span class="content">0.1</span><span class="delimiter">'</span></span>
}

apply(<span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>)
apply(<span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">maven</span><span class="delimiter">'</span></span>)

sourceSets {
    main {
        java {
            srcDir <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>
        }
        resources {
            srcDir <span class="string"><span class="delimiter">'</span><span class="content">src</span><span class="delimiter">'</span></span>
        }
    }
}</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>содержание файла <code>settings.gradle</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">halo-facebook</span><span class="delimiter">'</span></span></code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>содержание файла <code>app-component.scss</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="scss">@import "../halo-facebook";

@mixin com_haulmont_cuba {
  @include halo-facebook;
}</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>содержание файла <code>halo-facebook.scss</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="scss">@import "../halo/halo";

@mixin halo-facebook {
  @include halo;
}</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>содержание файла <code>halo-facebook-defaults.scss</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="css"><span class="directive">@import</span> <span class="string"><span class="delimiter">"</span><span class="content">../halo/halo-defaults</span><span class="delimiter">"</span></span>;

<span class="error">$</span><span class="tag">v-background-color</span>: <span class="color">#fafafa</span>;
<span class="error">$</span><span class="tag">v-app-background-color</span>: <span class="color">#e7ebf2</span>;
<span class="error">$</span><span class="tag">v-panel-background-color</span>: <span class="color">#fff</span>;
<span class="error">$</span><span class="tag">v-focus-color</span>: <span class="color">#3b5998</span>;
<span class="error">$</span><span class="tag">v-border-radius</span>: <span class="float">0</span>;
<span class="error">$</span><span class="tag">v-textfield-border-radius</span>: <span class="float">0</span>;
<span class="error">$</span><span class="tag">v-font-family</span>: <span class="tag">Helvetica</span>, <span class="tag">Arial</span>, <span class="string"><span class="delimiter">'</span><span class="content">lucida grande</span><span class="delimiter">'</span></span>, <span class="tag">tahoma</span>, <span class="tag">verdana</span>, <span class="tag">arial</span>, <span class="tag">sans-serif</span>;
<span class="error">$</span><span class="tag">v-font-size</span>: <span class="float">14px</span>;
<span class="error">$</span><span class="tag">v-font-color</span>: <span class="color">#37404E</span>;
<span class="error">$</span><span class="tag">v-font-weight</span>: <span class="float">400</span>;
<span class="error">$</span><span class="tag">v-link-text-decoration</span>: <span class="tag">none</span>;
<span class="error">$</span><span class="tag">v-shadow</span>: <span class="float">0</span> <span class="float">1px</span> <span class="float">0</span> (<span class="tag">v-shade</span> <span class="float">0.2</span>);
<span class="error">$</span><span class="tag">v-bevel</span>: <span class="tag">inset</span> <span class="float">0</span> <span class="float">1px</span> <span class="float">0</span> <span class="tag">v-tint</span>;
<span class="error">$</span><span class="tag">v-unit-size</span>: <span class="float">30px</span>;
<span class="error">$</span><span class="tag">v-gradient</span>: <span class="tag">v-linear</span> <span class="float">12%</span>;
<span class="error">$</span><span class="tag">v-overlay-shadow</span>: <span class="float">0</span> <span class="float">3px</span> <span class="float">8px</span> <span class="tag">v-shade</span>, <span class="float">0</span> <span class="float">0</span> <span class="float">0</span> <span class="float">1px</span> (<span class="tag">v-shade</span> <span class="float">0.7</span>);
<span class="error">$</span><span class="tag">v-shadow-opacity</span>: <span class="float">20%</span>;
<span class="error">$</span><span class="tag">v-selection-overlay-padding-horizontal</span>: <span class="float">0</span>;
<span class="error">$</span><span class="tag">v-selection-overlay-padding-vertical</span>: <span class="float">6px</span>;
<span class="error">$</span><span class="tag">v-selection-item-border-radius</span>: <span class="float">0</span>;

<span class="error">$</span><span class="tag">v-line-height</span>: <span class="float">1.35</span>;
<span class="error">$</span><span class="tag">v-font-size</span>: <span class="float">14px</span>;
<span class="error">$</span><span class="tag">v-font-weight</span>: <span class="float">400</span>;
<span class="error">$</span><span class="tag">v-unit-size</span>: <span class="float">25px</span>;

<span class="error">$</span><span class="tag">v-font-size--h1</span>: <span class="float">22px</span>;
<span class="error">$</span><span class="tag">v-font-size--h2</span>: <span class="float">18px</span>;
<span class="error">$</span><span class="tag">v-font-size--h3</span>: <span class="float">16px</span>;

<span class="error">$</span><span class="tag">v-layout-margin-top</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-left</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-right</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-margin-bottom</span>: <span class="float">8px</span>;

<span class="error">$</span><span class="tag">v-layout-spacing-vertical</span>: <span class="float">8px</span>;
<span class="error">$</span><span class="tag">v-layout-spacing-horizontal</span>: <span class="float">8px</span>;

<span class="error">$</span><span class="tag">v-table-row-height</span>: <span class="float">25px</span>;
<span class="error">$</span><span class="tag">v-table-header-font-size</span>: <span class="float">13px</span>;
<span class="error">$</span><span class="tag">v-table-cell-padding-horizontal</span>: <span class="float">5px</span>;

<span class="error">$</span><span class="tag">v-focus-style</span>: <span class="tag">inset</span> <span class="float">0px</span> <span class="float">0px</span> <span class="float">1px</span> <span class="float">1px</span> <span class="color">rgba($v-focus-color, 0.5)</span>;
<span class="error">$</span><span class="tag">v-error-focus-style</span>: <span class="tag">inset</span> <span class="float">0px</span> <span class="float">0px</span> <span class="float">1px</span> <span class="float">1px</span> <span class="color">rgba($v-error-indicator-color, 0.5)</span>;

<span class="error">$</span><span class="tag">v-show-required-indicators</span>: <span class="tag">true</span>;</code></pre> 
                  </div> 
                 </div> </li> 
                <li> <p>содержание файла <code>halo-facebook-theme.properties</code>:</p> 
                 <div class="listingblock"> 
                  <div class="content"> 
                   <pre class="CodeRay highlight"><code data-lang="scss">@include=halo-theme.properties</code></pre> 
                  </div> 
                 </div> </li> 
               </ul> 
              </div> 
             </div> 
            </div> </li> 
           <li> <p>Соберите и установите проект с помощью задачи Gradle:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="plain">gradle assemble install</code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Теперь добавьте эту тему в свой CUBA-проект в качестве зависимости Maven в двух конфигурациях: themes и compile, добавив в <code>build.gradle</code> следующие строки:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="groovy">configure(webModule) {
    <span class="comment">//...</span>
    dependencies {
        provided(servletApi)
        compile(guiModule)

        compile(<span class="string"><span class="delimiter">'</span><span class="content">com.haulmont.theme:halo-facebook:0.1</span><span class="delimiter">'</span></span>)
        themes(<span class="string"><span class="delimiter">'</span><span class="content">com.haulmont.theme:halo-facebook:0.1</span><span class="delimiter">'</span></span>)
    }
    <span class="comment">//...</span>
}</code></pre> 
             </div> 
            </div> 
            <div class="paragraph"> 
             <p>Если вы установили тему локально, не забудьте добавить локальный репозиторий Maven к списку используемых в проекте репозиториев. Для этого перейдите на вкладку <strong>Advanced</strong> в окне Studio <strong>Project Properties</strong> и установите флажок <strong>Use local Maven repository</strong>.</p> 
            </div> </li> 
           <li> <p>Чтобы унаследовать тему и добавить модификации для конкретного проекта, необходимо сначала расширить эту тему. Расширьте тему <code>halo</code> и переименуйте каталог <code>themes/halo</code> в <code>themes/halo-facebook</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="plain">themes/
    halo-facebook/
        branding/
            app-icon-login.png
            app-icon-menu.png
        com.company.application/
            app-component.scss
            halo-ext.scss
            halo-ext-defaults.scss
        favicon.ico
        styles.scss</code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Внесите следующие изменения в файл <code>styles.scss</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="scss">@import "halo-facebook-defaults";
@import "com.company.application/halo-ext-defaults";
@import "app-components";
@import "com.company.application/halo-ext";

.halo-facebook {
  // include auto-generated app components SCSS
  @include app_components;

  @include com_company_application-halo-ext;
}</code></pre> 
             </div> 
            </div> </li> 
           <li> <p>Последним шагом будет добавление ссылки на <code>halo-facebook-theme.properties</code> в файле <code>web-app.properties</code>:</p> 
            <div class="listingblock"> 
             <div class="content"> 
              <pre class="CodeRay highlight"><code data-lang="plain">cuba.themeConfig = havana-theme.properties halo-theme.properties /halo-facebook/halo-facebook-theme.prope</code></pre></div></div></li></ol></div></div></div></div></div></div></div></div></body></html>